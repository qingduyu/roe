(function e(t,r){if(typeof exports==="object"&&typeof module==="object")module.exports=r(require("echarts"));else if(typeof define==="function"&&define.amd)define(["echarts"],r);else if(typeof exports==="object")exports["echarts-gl"]=r(require("echarts"));else t["echarts-gl"]=r(t["echarts"])})(this,function(r){return function(r){var a={};function i(e){if(a[e]){return a[e].exports}var t=a[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,i);t.l=true;return t.exports}i.m=r;i.c=a;i.d=function(e,t,r){if(!i.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};i.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};i.d(e,"a",e);return e};i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};i.p="";return i(i.s=106)}([function(e,t){e.exports=r},function(e,t,r){"use strict";var a=r(40);var i=r(52);var n=r(5);var o=r(4);var s=r(8);var u=r(19);var l=r(35);var h=r(15);var f=r(0);var c=r.n(f);var d=r(36);var v=r(60);var p=r.n(v);var m=r(61);var g=r(124);var _=r(125);var y=r(129);var x=r(130);var T=r(2);var b=r(132);var w=r(43);var E=r(76);var S=r(133);var A=r(134);var M=r(135);var C=r(136);var L=r(41);var D=r(37);var N=r(26);var I=r(3);var R=r(137);var P=r(56);var O=r(138);var F=r(139);var B=r(140);var U=r(9);var z=r(74);var G=r(54);var H=r(18);var V=r(59);var k=r(141);var W=r(146);var j=r(71);var X=r(147);var q=r(148);var Z=r(149);var Y=r(150);var K=r(151);var Q=r(152);c.a.util.extend(l["a"].prototype,k["a"]);s["a"].import(W["a"]);s["a"].import(j["a"]);s["a"].import(X["a"]);s["a"].import(q["a"]);s["a"].import(Z["a"]);s["a"].import(Y["a"]);s["a"].import(K["a"]);s["a"].import(Q["a"]);function J(e){return!e||e==="none"}function $(e){return e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof Image}function ee(e){return e.getZr&&e.setOption}var te=d["a"].prototype.addToScene;var re=d["a"].prototype.removeFromScene;d["a"].prototype.addToScene=function(e){te.call(this,e);if(this.__zr){var t=this.__zr;e.traverse(function(e){e.__zr=t;if(e.addAnimatorsToZr){e.addAnimatorsToZr(t)}})}};d["a"].prototype.removeFromScene=function(e){re.call(this,e);e.traverse(function(e){var t=e.__zr;e.__zr=null;if(t&&e.removeAnimatorsFromZr){e.removeAnimatorsFromZr(t)}})};u["a"].prototype.setTextureImage=function(t,e,r,a){if(!this.shader){return}var i=r.getZr();var n=this;var o;n.autoUpdateTextureStatus=false;n.disableTexture(t);if(!J(e)){o=ae.loadTexture(e,r,a,function(e){n.enableTexture(t);i&&i.refresh()});n.set(t,o)}return o};var ae={};ae.Renderer=i["a"];ae.Node=l["a"];ae.Mesh=a["a"];ae.Shader=s["a"];ae.Material=u["a"];ae.Texture=o["a"];ae.Texture2D=n["a"];ae.Geometry=h["a"];ae.SphereGeometry=b["a"];ae.PlaneGeometry=w["a"];ae.CubeGeometry=E["a"];ae.AmbientLight=S["a"];ae.DirectionalLight=A["a"];ae.PointLight=M["a"];ae.SpotLight=C["a"];ae.PerspectiveCamera=L["a"];ae.OrthographicCamera=D["a"];ae.Vector2=N["a"];ae.Vector3=I["a"];ae.Vector4=R["a"];ae.Quaternion=P["a"];ae.Matrix2=O["a"];ae.Matrix2d=F["a"];ae.Matrix3=B["a"];ae.Matrix4=U["a"];ae.Plane=z["a"];ae.Ray=G["a"];ae.BoundingBox=H["a"];ae.Frustum=V["a"];var ie=m["a"].createBlank("rgba(255,255,255,0)").image;function ne(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}function oe(e){if((e.wrapS===o["a"].REPEAT||e.wrapT===o["a"].REPEAT)&&e.image){var t=ne(e.width);var r=ne(e.height);if(t!==e.width||r!==e.height){var a=document.createElement("canvas");a.width=t;a.height=r;var i=a.getContext("2d");i.drawImage(e.image,0,0,t,r);e.image=a}}}ae.loadTexture=function(e,t,r,a){if(typeof r==="function"){a=r;r={}}r=r||{};var i=Object.keys(r).sort();var n="";for(var o=0;o<i.length;o++){n+=i[o]+"_"+r[i[o]]+"_"}var s=t.__textureCache=t.__textureCache||new p.a(20);if(ee(e)){var u=e.__textureid__;var l=s.get(n+u);if(!l){var h=new g["a"](e);h.onupdate=function(){t.getZr().refresh()};l={texture:h.getTexture()};for(var o=0;o<i.length;o++){l.texture[i[o]]=r[i[o]]}u=e.__textureid__||"__ecgl_ec__"+l.texture.__uid__;e.__textureid__=u;s.put(n+u,l);a&&a(l.texture)}else{l.texture.surface.setECharts(e);a&&a(l.texture)}return l.texture}else if($(e)){var u=e.__textureid__;var l=s.get(n+u);if(!l){l={texture:new ae.Texture2D({image:e})};for(var o=0;o<i.length;o++){l.texture[i[o]]=r[i[o]]}u=e.__textureid__||"__ecgl_image__"+l.texture.__uid__;e.__textureid__=u;s.put(n+u,l);oe(l.texture);a&&a(l.texture)}return l.texture}else{var l=s.get(n+e);if(l){if(l.callbacks){l.callbacks.push(a)}else{a&&a(l.texture)}}else{if(e.match(/.hdr$|^data:application\/octet-stream/)){l={callbacks:[a]};var f=m["a"].loadTexture(e,{exposure:r.exposure,fileType:"hdr"},function(){f.dirty();l.callbacks.forEach(function(e){e&&e(f)});l.callbacks=null});l.texture=f;s.put(n+e,l)}else{var f=new ae.Texture2D({image:new Image});for(var o=0;o<i.length;o++){f[i[o]]=r[i[o]]}l={texture:f,callbacks:[a]};var c=f.image;c.onload=function(){f.image=c;oe(f);f.dirty();l.callbacks.forEach(function(e){e&&e(f)});l.callbacks=null};c.src=e;f.image=ie;s.put(n+e,l)}}return l.texture}};ae.createAmbientCubemap=function(e,r,t,a){e=e||{};var i=e.texture;var n=T["a"].firstNotNull(e.exposure,1);var o=new _["a"]({intensity:T["a"].firstNotNull(e.specularIntensity,1)});var s=new y["a"]({intensity:T["a"].firstNotNull(e.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});o.cubemap=ae.loadTexture(i,t,{exposure:n},function(){o.cubemap.flipY=false;if(true){var e=Date.now()}o.prefilter(r,32);if(true){var t=Date.now()-e;console.log("Prefilter environment map: "+t+"ms")}s.coefficients=x["a"].projectEnvironmentMap(r,o.cubemap,{lod:1});a&&a()});return{specular:o,diffuse:s}};ae.createBlankTexture=m["a"].createBlank;ae.isImage=$;ae.additiveBlend=function(e){e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)};ae.parseColor=function(e,t){if(e instanceof Array){if(!t){t=[]}t[0]=e[0];t[1]=e[1];t[2]=e[2];if(e.length>3){t[3]=e[3]}else{t[3]=1}return t}t=c.a.color.parse(e||"#000",t)||[0,0,0,0];t[0]/=255;t[1]/=255;t[2]/=255;return t};ae.directionFromAlphaBeta=function(e,t){var r=e/180*Math.PI+Math.PI/2;var a=-t/180*Math.PI+Math.PI/2;var i=[];var n=Math.sin(r);i[0]=n*Math.cos(a);i[1]=-Math.cos(r);i[2]=n*Math.sin(a);return i};ae.getShadowResolution=function(e){var t=1024;switch(e){case"low":t=512;break;case"medium":break;case"high":t=2048;break;case"ultra":t=4096;break}return t};ae.COMMON_SHADERS=["lambert","color","realistic","hatching"];ae.createShader=function(e){var t=s["a"].source(e+".vertex");var r=s["a"].source(e+".fragment");if(!t){console.error("Vertex shader of '%s' not exits",e)}if(!r){console.error("Fragment shader of '%s' not exits",e)}var a=new s["a"](t,r);a.name=e;return a};ae.createMaterial=function(e,t){if(!(t instanceof Array)){t=[t]}var r=ae.createShader(e);var a=new u["a"]({shader:r});t.forEach(function(e){if(typeof e==="string"){a.define(e)}});return a};ae.setMaterialFromModel=function(e,t,r,a){t.autoUpdateTextureStatus=false;var i=r.getModel(e+"Material");var n=i.get("detailTexture");var o=T["a"].firstNotNull(i.get("textureTiling"),1);var s=T["a"].firstNotNull(i.get("textureOffset"),0);if(typeof o==="number"){o=[o,o]}if(typeof s==="number"){s=[s,s]}var u=o[0]>1||o[1]>1?ae.Texture.REPEAT:ae.Texture.CLAMP_TO_EDGE;var l={anisotropic:8,wrapS:u,wrapT:u};if(e==="realistic"){var h=i.get("roughness");var f=i.get("metalness");if(f!=null){if(isNaN(f)){t.setTextureImage("metalnessMap",f,a,l);f=T["a"].firstNotNull(i.get("metalnessAdjust"),.5)}}else{f=0}if(h!=null){if(isNaN(h)){t.setTextureImage("roughnessMap",h,a,l);h=T["a"].firstNotNull(i.get("roughnessAdjust"),.5)}}else{h=.5}var c=i.get("normalTexture");t.setTextureImage("detailMap",n,a,l);t.setTextureImage("normalMap",c,a,l);t.set({roughness:h,metalness:f,detailUvRepeat:o,detailUvOffset:s})}else if(e==="lambert"){t.setTextureImage("detailMap",n,a,l);t.set({detailUvRepeat:o,detailUvOffset:s})}else if(e==="color"){t.setTextureImage("detailMap",n,a,l);t.set({detailUvRepeat:o,detailUvOffset:s})}else if(e==="hatching"){var d=i.get("hatchingTextures")||[];if(d.length<6){if(true){console.error("Invalid hatchingTextures.")}}for(var v=0;v<6;v++){t.setTextureImage("hatch"+(v+1),d[v],a,{anisotropic:8,wrapS:ae.Texture.REPEAT,wrapT:ae.Texture.REPEAT})}t.set({detailUvRepeat:o,detailUvOffset:s})}};ae.updateVertexAnimation=function(e,t,r,a){var i=a.get("animation");var n=a.get("animationDurationUpdate");var o=a.get("animationEasingUpdate");var s=r.shadowDepthMaterial;if(i&&t&&n>0&&t.geometry.vertexCount===r.geometry.vertexCount){r.material.define("vertex","VERTEX_ANIMATION");r.ignorePreZ=true;if(s){s.define("vertex","VERTEX_ANIMATION")}for(var u=0;u<e.length;u++){r.geometry.attributes[e[u][0]].value=t.geometry.attributes[e[u][1]].value}r.geometry.dirty();r.__percent=0;r.material.set("percent",0);r.stopAnimation();r.animate().when(n,{__percent:1}).during(function(){r.material.set("percent",r.__percent);if(s){s.set("percent",r.__percent)}}).done(function(){r.ignorePreZ=false;r.material.undefine("vertex","VERTEX_ANIMATION");if(s){s.undefine("vertex","VERTEX_ANIMATION")}}).start(o)}else{r.material.undefine("vertex","VERTEX_ANIMATION");if(s){s.undefine("vertex","VERTEX_ANIMATION")}}};t["a"]=ae},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n={firstNotNull:function(){for(var e=0,t=arguments.length;e<t;e++){if(arguments[e]!=null){return arguments[e]}}},queryDataIndex:function(t,e){if(e.dataIndexInside!=null){return e.dataIndexInside}else if(e.dataIndex!=null){return i.a.util.isArray(e.dataIndex)?i.a.util.map(e.dataIndex,function(e){return t.indexOfRawIndex(e)}):t.indexOfRawIndex(e.dataIndex)}else if(e.name!=null){return i.a.util.isArray(e.name)?i.a.util.map(e.name,function(e){return t.indexOfName(e)}):t.indexOfName(e.name)}}};t["a"]=n},function(e,t,r){"use strict";var i=r(12);var a=function(e,t,r){e=e||0;t=t||0;r=r||0;this.array=i["a"].fromValues(e,t,r);this._dirty=true};a.prototype={constructor:a,add:function(e){i["a"].add(this.array,this.array,e.array);this._dirty=true;return this},set:function(e,t,r){this.array[0]=e;this.array[1]=t;this.array[2]=r;this._dirty=true;return this},setArray:function(e){this.array[0]=e[0];this.array[1]=e[1];this.array[2]=e[2];this._dirty=true;return this},clone:function(){return new a(this.x,this.y,this.z)},copy:function(e){i["a"].copy(this.array,e.array);this._dirty=true;return this},cross:function(e,t){i["a"].cross(this.array,e.array,t.array);this._dirty=true;return this},dist:function(e){return i["a"].dist(this.array,e.array)},distance:function(e){return i["a"].distance(this.array,e.array)},div:function(e){i["a"].div(this.array,this.array,e.array);this._dirty=true;return this},divide:function(e){i["a"].divide(this.array,this.array,e.array);this._dirty=true;return this},dot:function(e){return i["a"].dot(this.array,e.array)},len:function(){return i["a"].len(this.array)},length:function(){return i["a"].length(this.array)},lerp:function(e,t,r){i["a"].lerp(this.array,e.array,t.array,r);this._dirty=true;return this},min:function(e){i["a"].min(this.array,this.array,e.array);this._dirty=true;return this},max:function(e){i["a"].max(this.array,this.array,e.array);this._dirty=true;return this},mul:function(e){i["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},multiply:function(e){i["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},negate:function(){i["a"].negate(this.array,this.array);this._dirty=true;return this},normalize:function(){i["a"].normalize(this.array,this.array);this._dirty=true;return this},random:function(e){i["a"].random(this.array,e);this._dirty=true;return this},scale:function(e){i["a"].scale(this.array,this.array,e);this._dirty=true;return this},scaleAndAdd:function(e,t){i["a"].scaleAndAdd(this.array,this.array,e.array,t);this._dirty=true;return this},sqrDist:function(e){return i["a"].sqrDist(this.array,e.array)},squaredDistance:function(e){return i["a"].squaredDistance(this.array,e.array)},sqrLen:function(){return i["a"].sqrLen(this.array)},squaredLength:function(){return i["a"].squaredLength(this.array)},sub:function(e){i["a"].sub(this.array,this.array,e.array);this._dirty=true;return this},subtract:function(e){i["a"].subtract(this.array,this.array,e.array);this._dirty=true;return this},transformMat3:function(e){i["a"].transformMat3(this.array,this.array,e.array);this._dirty=true;return this},transformMat4:function(e){i["a"].transformMat4(this.array,this.array,e.array);this._dirty=true;return this},transformQuat:function(e){i["a"].transformQuat(this.array,this.array,e.array);this._dirty=true;return this},applyProjection:function(e){var t=this.array;e=e.array;if(e[15]===0){var r=-1/t[2];t[0]=e[0]*t[0]*r;t[1]=e[5]*t[1]*r;t[2]=(e[10]*t[2]+e[14])*r}else{t[0]=e[0]*t[0]+e[12];t[1]=e[5]*t[1]+e[13];t[2]=e[10]*t[2]+e[14]}this._dirty=true;return this},eulerFromQuat:function(e,t){a.eulerFromQuat(this,e,t)},eulerFromMat3:function(e,t){a.eulerFromMat3(this,e,t)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var n=Object.defineProperty;if(n){var o=a.prototype;n(o,"x",{get:function(){return this.array[0]},set:function(e){this.array[0]=e;this._dirty=true}});n(o,"y",{get:function(){return this.array[1]},set:function(e){this.array[1]=e;this._dirty=true}});n(o,"z",{get:function(){return this.array[2]},set:function(e){this.array[2]=e;this._dirty=true}})}a.add=function(e,t,r){i["a"].add(e.array,t.array,r.array);e._dirty=true;return e};a.set=function(e,t,r,a){i["a"].set(e.array,t,r,a);e._dirty=true};a.copy=function(e,t){i["a"].copy(e.array,t.array);e._dirty=true;return e};a.cross=function(e,t,r){i["a"].cross(e.array,t.array,r.array);e._dirty=true;return e};a.dist=function(e,t){return i["a"].distance(e.array,t.array)};a.distance=a.dist;a.div=function(e,t,r){i["a"].divide(e.array,t.array,r.array);e._dirty=true;return e};a.divide=a.div;a.dot=function(e,t){return i["a"].dot(e.array,t.array)};a.len=function(e){return i["a"].length(e.array)};a.lerp=function(e,t,r,a){i["a"].lerp(e.array,t.array,r.array,a);e._dirty=true;return e};a.min=function(e,t,r){i["a"].min(e.array,t.array,r.array);e._dirty=true;return e};a.max=function(e,t,r){i["a"].max(e.array,t.array,r.array);e._dirty=true;return e};a.mul=function(e,t,r){i["a"].multiply(e.array,t.array,r.array);e._dirty=true;return e};a.multiply=a.mul;a.negate=function(e,t){i["a"].negate(e.array,t.array);e._dirty=true;return e};a.normalize=function(e,t){i["a"].normalize(e.array,t.array);e._dirty=true;return e};a.random=function(e,t){i["a"].random(e.array,t);e._dirty=true;return e};a.scale=function(e,t,r){i["a"].scale(e.array,t.array,r);e._dirty=true;return e};a.scaleAndAdd=function(e,t,r,a){i["a"].scaleAndAdd(e.array,t.array,r.array,a);e._dirty=true;return e};a.sqrDist=function(e,t){return i["a"].sqrDist(e.array,t.array)};a.squaredDistance=a.sqrDist;a.sqrLen=function(e){return i["a"].sqrLen(e.array)};a.squaredLength=a.sqrLen;a.sub=function(e,t,r){i["a"].subtract(e.array,t.array,r.array);e._dirty=true;return e};a.subtract=a.sub;a.transformMat3=function(e,t,r){i["a"].transformMat3(e.array,t.array,r.array);e._dirty=true;return e};a.transformMat4=function(e,t,r){i["a"].transformMat4(e.array,t.array,r.array);e._dirty=true;return e};a.transformQuat=function(e,t,r){i["a"].transformQuat(e.array,t.array,r.array);e._dirty=true;return e};function v(e,t,r){return e<t?t:e>r?r:e}var p=Math.atan2;var m=Math.asin;var g=Math.abs;a.eulerFromQuat=function(e,t,r){e._dirty=true;t=t.array;var a=e.array;var i=t[0],n=t[1],o=t[2],s=t[3];var u=i*i;var l=n*n;var h=o*o;var f=s*s;var r=(r||"XYZ").toUpperCase();switch(r){case"XYZ":a[0]=p(2*(i*s-n*o),f-u-l+h);a[1]=m(v(2*(i*o+n*s),-1,1));a[2]=p(2*(o*s-i*n),f+u-l-h);break;case"YXZ":a[0]=m(v(2*(i*s-n*o),-1,1));a[1]=p(2*(i*o+n*s),f-u-l+h);a[2]=p(2*(i*n+o*s),f-u+l-h);break;case"ZXY":a[0]=m(v(2*(i*s+n*o),-1,1));a[1]=p(2*(n*s-o*i),f-u-l+h);a[2]=p(2*(o*s-i*n),f-u+l-h);break;case"ZYX":a[0]=p(2*(i*s+o*n),f-u-l+h);a[1]=m(v(2*(n*s-i*o),-1,1));a[2]=p(2*(i*n+o*s),f+u-l-h);break;case"YZX":a[0]=p(2*(i*s-o*n),f-u+l-h);a[1]=p(2*(n*s-i*o),f+u-l-h);a[2]=m(v(2*(i*n+o*s),-1,1));break;case"XZY":a[0]=p(2*(i*s+n*o),f-u+l-h);a[1]=p(2*(i*o+n*s),f+u-l-h);a[2]=m(v(2*(o*s-i*n),-1,1));break;default:console.warn("Unkown order: "+r)}return e};a.eulerFromMat3=function(e,t,r){var a=t.array;var i=a[0],n=a[3],o=a[6];var s=a[1],u=a[4],l=a[7];var h=a[2],f=a[5],c=a[8];var d=e.array;var r=(r||"XYZ").toUpperCase();switch(r){case"XYZ":d[1]=m(v(o,-1,1));if(g(o)<.99999){d[0]=p(-l,c);d[2]=p(-n,i)}else{d[0]=p(f,u);d[2]=0}break;case"YXZ":d[0]=m(-v(l,-1,1));if(g(l)<.99999){d[1]=p(o,c);d[2]=p(s,u)}else{d[1]=p(-h,i);d[2]=0}break;case"ZXY":d[0]=m(v(f,-1,1));if(g(f)<.99999){d[1]=p(-h,c);d[2]=p(-n,u)}else{d[1]=0;d[2]=p(s,i)}break;case"ZYX":d[1]=m(-v(h,-1,1));if(g(h)<.99999){d[0]=p(f,c);d[2]=p(s,i)}else{d[0]=0;d[2]=p(-n,u)}break;case"YZX":d[2]=m(v(s,-1,1));if(g(s)<.99999){d[0]=p(-l,u);d[1]=p(-h,i)}else{d[0]=0;d[1]=p(o,c)}break;case"XZY":d[2]=m(-v(n,-1,1));if(g(n)<.99999){d[0]=p(f,u);d[1]=p(o,i)}else{d[0]=p(-l,c);d[1]=0}break;default:console.warn("Unkown order: "+r)}e._dirty=true;return e};Object.defineProperties(a,{POSITIVE_X:{get:function(){return new a(1,0,0)}},NEGATIVE_X:{get:function(){return new a(-1,0,0)}},POSITIVE_Y:{get:function(){return new a(0,1,0)}},NEGATIVE_Y:{get:function(){return new a(0,-1,0)}},POSITIVE_Z:{get:function(){return new a(0,0,1)}},NEGATIVE_Z:{get:function(){return new a(0,0,-1)}},UP:{get:function(){return new a(0,1,0)}},ZERO:{get:function(){return new a}}});t["a"]=a},function(e,t,r){"use strict";var a=r(7);var i=r(11);var n=r(57);var o=a["a"].extend({width:512,height:512,type:i["a"].UNSIGNED_BYTE,format:i["a"].RGBA,wrapS:i["a"].REPEAT,wrapT:i["a"].REPEAT,minFilter:i["a"].LINEAR_MIPMAP_LINEAR,magFilter:i["a"].LINEAR,useMipmap:true,anisotropic:1,flipY:true,sRGB:true,unpackAlignment:4,premultiplyAlpha:false,dynamic:false,NPOT:false,__used:0},function(){this._cache=new n["a"]},{getWebGLTexture:function(e){var t=e.gl;var r=this._cache;r.use(e.__uid__);if(r.miss("webgl_texture")){r.put("webgl_texture",t.createTexture())}if(this.dynamic){this.update(e)}else if(r.isDirty()){this.update(e);r.fresh()}return r.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){if(this._cache){this._cache.dirtyAll()}},update:function(e){},updateCommon:function(e){var t=e.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment);if(this.format===i["a"].DEPTH_COMPONENT){this.useMipmap=false}var r=e.getGLExtension("EXT_sRGB");if(this.format===o.SRGB&&!r){this.format=o.RGB}if(this.format===o.SRGB_ALPHA&&!r){this.format=o.RGBA}this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){if(this.NPOT){return i["a"].CLAMP_TO_EDGE}return this.wrapS},getAvailableWrapT:function(){if(this.NPOT){return i["a"].CLAMP_TO_EDGE}return this.wrapT},getAvailableMinFilter:function(){var e=this.minFilter;if(this.NPOT||!this.useMipmap){if(e===i["a"].NEAREST_MIPMAP_NEAREST||e===i["a"].NEAREST_MIPMAP_LINEAR){return i["a"].NEAREST}else if(e===i["a"].LINEAR_MIPMAP_LINEAR||e===i["a"].LINEAR_MIPMAP_NEAREST){return i["a"].LINEAR}else{return e}}else{return e}},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1){e=e|e>>t}return e+1},dispose:function(e){var t=this._cache;t.use(e.__uid__);var r=t.get("webgl_texture");if(r){e.gl.deleteTexture(r)}t.deleteContext(e.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(o.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}});Object.defineProperty(o.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}});o.BYTE=i["a"].BYTE;o.UNSIGNED_BYTE=i["a"].UNSIGNED_BYTE;o.SHORT=i["a"].SHORT;o.UNSIGNED_SHORT=i["a"].UNSIGNED_SHORT;o.INT=i["a"].INT;o.UNSIGNED_INT=i["a"].UNSIGNED_INT;o.FLOAT=i["a"].FLOAT;o.HALF_FLOAT=36193;o.UNSIGNED_INT_24_8_WEBGL=34042;o.DEPTH_COMPONENT=i["a"].DEPTH_COMPONENT;o.DEPTH_STENCIL=i["a"].DEPTH_STENCIL;o.ALPHA=i["a"].ALPHA;o.RGB=i["a"].RGB;o.RGBA=i["a"].RGBA;o.LUMINANCE=i["a"].LUMINANCE;o.LUMINANCE_ALPHA=i["a"].LUMINANCE_ALPHA;o.SRGB=35904;o.SRGB_ALPHA=35906;o.COMPRESSED_RGB_S3TC_DXT1_EXT=33776;o.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777;o.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778;o.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779;o.NEAREST=i["a"].NEAREST;o.LINEAR=i["a"].LINEAR;o.NEAREST_MIPMAP_NEAREST=i["a"].NEAREST_MIPMAP_NEAREST;o.LINEAR_MIPMAP_NEAREST=i["a"].LINEAR_MIPMAP_NEAREST;o.NEAREST_MIPMAP_LINEAR=i["a"].NEAREST_MIPMAP_LINEAR;o.LINEAR_MIPMAP_LINEAR=i["a"].LINEAR_MIPMAP_LINEAR;o.REPEAT=i["a"].REPEAT;o.CLAMP_TO_EDGE=i["a"].CLAMP_TO_EDGE;o.MIRRORED_REPEAT=i["a"].MIRRORED_REPEAT;t["a"]=o},function(e,t,r){"use strict";var f=r(4);var c=r(11);var i=r(14);var a=r(73);var n=a["a"].isPowerOfTwo;function o(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}function l(e,t){var r=o(e.width);var a=o(e.height);t=t||document.createElement("canvas");t.width=r;t.height=a;var i=t.getContext("2d");i.drawImage(e.image,0,0,r,a);return t}var s=f["a"].extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:false}},{textureType:"texture2D",update:function(e){var t=e.gl;t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture"));this.updateCommon(e);var r=this.format;var a=this.type;var i=!!(this.convertToPOT&&!this.mipmaps.length&&this.image&&(this.wrapS===f["a"].REPEAT||this.wrapT===f["a"].REPEAT)&&this.NPOT);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i?this.wrapS:this.getAvailableWrapS());t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i?this.wrapT:this.getAvailableWrapT());t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i?this.magFilter:this.getAvailableMagFilter());t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i?this.minFilter:this.getAvailableMinFilter());var n=e.getGLExtension("EXT_texture_filter_anisotropic");if(n&&this.anisotropic>1){t.texParameterf(t.TEXTURE_2D,n.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic)}if(a===36193){var o=e.getGLExtension("OES_texture_half_float");if(!o){a=c["a"].FLOAT}}if(this.mipmaps.length){var s=this.width;var u=this.height;for(var l=0;l<this.mipmaps.length;l++){var h=this.mipmaps[l];this._updateTextureData(t,h,l,s,u,r,a,false);s/=2;u/=2}}else{this._updateTextureData(t,this,0,this.width,this.height,r,a,i);if(this.useMipmap&&(!this.NPOT||i)){t.generateMipmap(t.TEXTURE_2D)}}t.bindTexture(t.TEXTURE_2D,null)},_updateTextureData:function(e,t,r,a,i,n,o,s){if(t.image){var u=t.image;if(s){this._potCanvas=l(this,this._potCanvas);u=this._potCanvas}e.texImage2D(e.TEXTURE_2D,r,n,n,o,u)}else{if(n<=f["a"].COMPRESSED_RGBA_S3TC_DXT5_EXT&&n>=f["a"].COMPRESSED_RGB_S3TC_DXT1_EXT){e.compressedTexImage2D(e.TEXTURE_2D,r,n,a,i,0,t.pixels)}else{e.texImage2D(e.TEXTURE_2D,r,n,a,i,0,n,o,t.pixels)}}},generateMipmap:function(e){var t=e.gl;if(this.useMipmap&&!this.NPOT){t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture"));t.generateMipmap(t.TEXTURE_2D)}},isPowerOfTwo:function(){return n(this.width)&&n(this.height)},isRenderable:function(){if(this.image){return this.image.nodeName==="CANVAS"||this.image.nodeName==="VIDEO"||this.image.complete}else{return!!(this.width&&this.height)}},bind:function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,this.getWebGLTexture(e))},unbind:function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,null)},load:function(e,t){var r=i["a"].createImage();if(t){r.crossOrigin=t}var a=this;r.onload=function(){a.dirty();a.trigger("success",a);r.onload=null};r.onerror=function(){a.trigger("error",a);r.onerror=null};r.src=e;this.image=r;return this}});Object.defineProperty(s.prototype,"width",{get:function(){if(this.image){return this.image.width}return this._width},set:function(e){if(this.image){console.warn("Texture from image can't set width")}else{if(this._width!==e){this.dirty()}this._width=e}}});Object.defineProperty(s.prototype,"height",{get:function(){if(this.image){return this.image.height}return this._height},set:function(e){if(this.image){console.warn("Texture from image can't set height")}else{if(this._height!==e){this.dirty()}this._height=e}}});t["a"]=s},function(e,t,r){"use strict";var a=r(161);t["a"]=a["a"]},function(e,t,r){"use strict";var a=r(110);var i=r(53);var n=r(23);var o=function(){this.__uid__=n["a"].genGUID()};o.__initializers__=[function(e){n["a"].extend(this,e)}];n["a"].extend(o,a["a"]);n["a"].extend(o.prototype,i["a"]);t["a"]=o},function(e,t,r){"use strict";var i=r(23);var y=r(14);var a=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;var n=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g;var o=/#define\s+(\w+)?(\s+[\d-.]+)?\s*;?\s*\n/g;var p={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"};function s(e){var t=[];for(var r=0;r<e;r++){t[r]=0}return t}var u={bool:function(){return true},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return s(2)},vec3:function(){return s(3)},vec4:function(){return s(4)},ivec2:function(){return s(2)},ivec3:function(){return s(3)},ivec4:function(){return s(4)},mat2:function(){return s(4)},mat3:function(){return s(9)},mat4:function(){return s(16)},array:function(){return[]}};var x=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"];var T=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME"];var b=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"];var h={vec4:4,vec3:3,vec2:2,float:1};var l={};var f={};function c(e,t){var r="vertex:"+e+"fragment:"+t;if(l[r]){return l[r]}var a=i["a"].genGUID();l[r]=a;f[a]={vertex:e,fragment:t};return a}function d(e){return e.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function w(){console.error("Wrong uniform/attributes syntax")}function m(e,t){var r=/[,=\(\):]/;var a=t.replace(/:\s*\[\s*(.*)\s*\]/g,"="+e+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g);var i=[];for(var n=0;n<a.length;n++){if(a[n].match(r)){i.push(a[n].charAt(0),a[n].slice(1))}else{i.push(a[n])}}a=i;var o=0;var s=1;var u=2;var l=3;var h=4;var f=5;var c=o;var d={};var v=null;var p;m(a[0]);function m(e){if(!e){w()}var t=e.match(/\[(.*?)\]/);p=e.replace(/\[(.*?)\]/,"");d[p]={};if(t){d[p].isArray=true;d[p].arraySize=t[1]}}for(var n=1;n<a.length;n++){var g=a[n];if(!g){continue}if(g==="="){if(c!==o&&c!==l){w();break}c=s;continue}else if(g===":"){c=h;continue}else if(g===","){if(c===u){if(!(v instanceof Array)){w();break}v.push(+a[++n])}else{c=f}continue}else if(g===")"){d[p].value=new y["a"].Float32Array(v);v=null;c=f;continue}else if(g==="("){if(c!==u){w();break}if(!(v instanceof Array)){w();break}v.push(+a[++n]);continue}else if(g.indexOf("vec")>=0){if(c!==s&&c!==h){w();break}c=u;v=[];continue}else if(c===s){if(e==="bool"){d[p].value=g==="true"}else{d[p].value=parseFloat(g)}v=null;continue}else if(c===h){var _=g;if(x.indexOf(_)>=0||T.indexOf(_)>=0||b.indexOf(_)>=0){d[p].semantic=_}else if(_==="ignore"||_==="unconfigurable"){d[p].ignore=true}else{if(e==="bool"){d[p].value=_==="true"}else{d[p].value=parseFloat(_)}}continue}m(g);c=o}return d}function v(e,t){if(typeof e==="object"){t=e.fragment;e=e.vertex}e=d(e);t=d(t);this._shaderID=c(e,t);this._vertexCode=v.parseImport(e);this._fragmentCode=v.parseImport(t);this.attributeSemantics={};this.matrixSemantics={};this.uniformSemantics={};this.matrixSemanticKeys=[];this.uniformTemplates={};this.attributes={};this.textures={};this.vertexDefines={};this.fragmentDefines={};this._parseAttributes();this._parseUniforms();this._parseDefines()}v.prototype={constructor:v,createUniforms:function(){var e={};for(var t in this.uniformTemplates){var r=this.uniformTemplates[t];e[t]={type:r.type,value:r.value()}}return e},_parseImport:function(){this._vertexCode=v.parseImport(this.vertex);this._fragmentCode=v.parseImport(this.fragment)},_addSemanticUniform:function(e,t,r){if(x.indexOf(r)>=0){this.attributeSemantics[r]={symbol:e,type:t}}else if(b.indexOf(r)>=0){var a=false;var i=r;if(r.match(/TRANSPOSE$/)){a=true;i=r.slice(0,-9)}this.matrixSemantics[r]={symbol:e,type:t,isTranspose:a,semanticNoTranspose:i}}else if(T.indexOf(r)>=0){this.uniformSemantics[r]={symbol:e,type:t}}},_addMaterialUniform:function(e,t,r,a,i,n){n[e]={type:r,value:i?u["array"]:a||u[t],semantic:null}},_parseUniforms:function(){var f={};var c=this;var d="vertex";this._uniformList=[];this._vertexCode=this._vertexCode.replace(a,e);d="fragment";this._fragmentCode=this._fragmentCode.replace(a,e);c.matrixSemanticKeys=Object.keys(this.matrixSemantics);function v(e){return e!=null?function(){return e}:null}function e(e,t,r){var a=m(t,r);var i=[];for(var n in a){var o=a[n];var s=o.semantic;var u=n;var l=p[t];var h=v(a[n].value);if(a[n].isArray){u+="["+a[n].arraySize+"]";l+="v"}i.push(u);c._uniformList.push(n);if(!o.ignore){if(t==="sampler2D"||t==="samplerCube"){c.textures[n]={shaderType:d,type:t}}if(s){c._addSemanticUniform(n,l,s)}else{c._addMaterialUniform(n,t,l,h,a[n].isArray,f)}}}return i.length>0?"uniform "+t+" "+i.join(",")+";\n":""}this.uniformTemplates=f},_parseAttributes:function(){var u={};var l=this;this._vertexCode=this._vertexCode.replace(n,e);function e(e,t,r){var a=m(t,r);var i=h[t]||1;var n=[];for(var o in a){var s=a[o].semantic;u[o]={type:"float",size:i,semantic:s||null};if(s){if(x.indexOf(s)<0){throw new Error('Unkown semantic "'+s+'"')}else{l.attributeSemantics[s]={symbol:o,type:t}}}n.push(o)}return"attribute "+t+" "+n.join(",")+";\n"}this.attributes=u},_parseDefines:function(){var i=this;var n="vertex";this._vertexCode=this._vertexCode.replace(o,e);n="fragment";this._fragmentCode=this._fragmentCode.replace(o,e);function e(e,t,r){var a=n==="vertex"?i.vertexDefines:i.fragmentDefines;if(!a[t]){if(r==="false"){a[t]=false}else if(r==="true"){a[t]=true}else{a[t]=r?isNaN(parseFloat(r))?r.trim():parseFloat(r):null}}return""}},clone:function(){var e=f[this._shaderID];var t=new v(e.vertex,e.fragment);return t}};if(Object.defineProperty){Object.defineProperty(v.prototype,"shaderID",{get:function(){return this._shaderID}});Object.defineProperty(v.prototype,"vertex",{get:function(){return this._vertexCode}});Object.defineProperty(v.prototype,"fragment",{get:function(){return this._fragmentCode}});Object.defineProperty(v.prototype,"uniforms",{get:function(){return this._uniformList}})}var g=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;v.parseImport=function(e){e=e.replace(g,function(e,t,r){var e=v.source(r);if(e){return v.parseImport(e)}else{console.error('Shader chunk "'+r+'" not existed in library');return""}});return e};var _=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;v["import"]=function(e){e.replace(_,function(e,t,r,a){var a=a.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(a){var i=r.split(".");var n=v.codes;var o=0;var s;while(o<i.length-1){s=i[o++];if(!n[s]){n[s]={}}n=n[s]}s=i[o];n[s]=a}return a})};v.codes={};v.source=function(e){var t=e.split(".");var r=v.codes;var a=0;while(r&&a<t.length){var i=t[a++];r=r[i]}if(typeof r!=="string"){console.error('Shader "'+e+'" not existed in library');return""}return r};t["a"]=v},function(e,t,r){"use strict";var s=r(21);var c=r(12);var d=r(55);var v=r(34);var a=r(3);var i=function(){this._axisX=new a["a"];this._axisY=new a["a"];this._axisZ=new a["a"];this.array=s["a"].create();this._dirty=true};i.prototype={constructor:i,setArray:function(e){for(var t=0;t<this.array.length;t++){this.array[t]=e[t]}this._dirty=true;return this},adjoint:function(){s["a"].adjoint(this.array,this.array);this._dirty=true;return this},clone:function(){return(new i).copy(this)},copy:function(e){s["a"].copy(this.array,e.array);this._dirty=true;return this},determinant:function(){return s["a"].determinant(this.array)},fromQuat:function(e){s["a"].fromQuat(this.array,e.array);this._dirty=true;return this},fromRotationTranslation:function(e,t){s["a"].fromRotationTranslation(this.array,e.array,t.array);this._dirty=true;return this},fromMat2d:function(e){i.fromMat2d(this,e);return this},frustum:function(e,t,r,a,i,n){s["a"].frustum(this.array,e,t,r,a,i,n);this._dirty=true;return this},identity:function(){s["a"].identity(this.array);this._dirty=true;return this},invert:function(){s["a"].invert(this.array,this.array);this._dirty=true;return this},lookAt:function(e,t,r){s["a"].lookAt(this.array,e.array,t.array,r.array);this._dirty=true;return this},mul:function(e){s["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},mulLeft:function(e){s["a"].mul(this.array,e.array,this.array);this._dirty=true;return this},multiply:function(e){s["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},multiplyLeft:function(e){s["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},ortho:function(e,t,r,a,i,n){s["a"].ortho(this.array,e,t,r,a,i,n);this._dirty=true;return this},perspective:function(e,t,r,a){s["a"].perspective(this.array,e,t,r,a);this._dirty=true;return this},rotate:function(e,t){s["a"].rotate(this.array,this.array,e,t.array);this._dirty=true;return this},rotateX:function(e){s["a"].rotateX(this.array,this.array,e);this._dirty=true;return this},rotateY:function(e){s["a"].rotateY(this.array,this.array,e);this._dirty=true;return this},rotateZ:function(e){s["a"].rotateZ(this.array,this.array,e);this._dirty=true;return this},scale:function(e){s["a"].scale(this.array,this.array,e.array);this._dirty=true;return this},translate:function(e){s["a"].translate(this.array,this.array,e.array);this._dirty=true;return this},transpose:function(){s["a"].transpose(this.array,this.array);this._dirty=true;return this},decomposeMatrix:function(){var u=c["a"].create();var l=c["a"].create();var h=c["a"].create();var f=v["a"].create();return function(e,t,r){var a=this.array;c["a"].set(u,a[0],a[1],a[2]);c["a"].set(l,a[4],a[5],a[6]);c["a"].set(h,a[8],a[9],a[10]);var i=c["a"].length(u);var n=c["a"].length(l);var o=c["a"].length(h);var s=this.determinant();if(s<0){i=-i}if(e){e.set(i,n,o)}r.set(a[12],a[13],a[14]);v["a"].fromMat4(f,a);f[0]/=i;f[1]/=i;f[2]/=i;f[3]/=n;f[4]/=n;f[5]/=n;f[6]/=o;f[7]/=o;f[8]/=o;d["a"].fromMat3(t.array,f);d["a"].normalize(t.array,t.array);t._dirty=true;r._dirty=true}}(),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var n=Object.defineProperty;if(n){var o=i.prototype;n(o,"z",{get:function(){var e=this.array;this._axisZ.set(e[8],e[9],e[10]);return this._axisZ},set:function(e){var t=this.array;e=e.array;t[8]=e[0];t[9]=e[1];t[10]=e[2];this._dirty=true}});n(o,"y",{get:function(){var e=this.array;this._axisY.set(e[4],e[5],e[6]);return this._axisY},set:function(e){var t=this.array;e=e.array;t[4]=e[0];t[5]=e[1];t[6]=e[2];this._dirty=true}});n(o,"x",{get:function(){var e=this.array;this._axisX.set(e[0],e[1],e[2]);return this._axisX},set:function(e){var t=this.array;e=e.array;t[0]=e[0];t[1]=e[1];t[2]=e[2];this._dirty=true}})}i.adjoint=function(e,t){s["a"].adjoint(e.array,t.array);e._dirty=true;return e};i.copy=function(e,t){s["a"].copy(e.array,t.array);e._dirty=true;return e};i.determinant=function(e){return s["a"].determinant(e.array)};i.identity=function(e){s["a"].identity(e.array);e._dirty=true;return e};i.ortho=function(e,t,r,a,i,n,o){s["a"].ortho(e.array,t,r,a,i,n,o);e._dirty=true;return e};i.perspective=function(e,t,r,a,i){s["a"].perspective(e.array,t,r,a,i);e._dirty=true;return e};i.lookAt=function(e,t,r,a){s["a"].lookAt(e.array,t.array,r.array,a.array);e._dirty=true;return e};i.invert=function(e,t){s["a"].invert(e.array,t.array);e._dirty=true;return e};i.mul=function(e,t,r){s["a"].mul(e.array,t.array,r.array);e._dirty=true;return e};i.multiply=i.mul;i.fromQuat=function(e,t){s["a"].fromQuat(e.array,t.array);e._dirty=true;return e};i.fromRotationTranslation=function(e,t,r){s["a"].fromRotationTranslation(e.array,t.array,r.array);e._dirty=true;return e};i.fromMat2d=function(e,t){e._dirty=true;var t=t.array;var e=e.array;e[0]=t[0];e[4]=t[2];e[12]=t[4];e[1]=t[1];e[5]=t[3];e[13]=t[5];return e};i.rotate=function(e,t,r,a){s["a"].rotate(e.array,t.array,r,a.array);e._dirty=true;return e};i.rotateX=function(e,t,r){s["a"].rotateX(e.array,t.array,r);e._dirty=true;return e};i.rotateY=function(e,t,r){s["a"].rotateY(e.array,t.array,r);e._dirty=true;return e};i.rotateZ=function(e,t,r){s["a"].rotateZ(e.array,t.array,r);e._dirty=true;return e};i.scale=function(e,t,r){s["a"].scale(e.array,t.array,r.array);e._dirty=true;return e};i.transpose=function(e,t){s["a"].transpose(e.array,t.array);e._dirty=true;return e};i.translate=function(e,t,r){s["a"].translate(e.array,t.array,r.array);e._dirty=true;return e};t["a"]=i},function(e,t,r){"use strict";var a=r(7);var o=r(4);var i=r(27);var f=r(11);var n=r(57);var s="framebuffer";var c="renderbuffer";var d=c+"_width";var v=c+"_height";var p=c+"_attached";var m="depthtexture_attached";var g=f["a"].FRAMEBUFFER;var _=f["a"].RENDERBUFFER;var y=f["a"].DEPTH_ATTACHMENT;var l=f["a"].COLOR_ATTACHMENT0;var u=a["a"].extend({depthBuffer:true,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new n["a"];this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(e){if(e.__currentFrameBuffer){if(e.__currentFrameBuffer===this){return}console.warn("Renderer already bound with another framebuffer. Unbind it first")}e.__currentFrameBuffer=this;var t=e.gl;t.bindFramebuffer(g,this._getFrameBufferGL(e));this._boundRenderer=e;var r=this._cache;r.put("viewport",e.viewport);var a=false;var i;var n;for(var o in this._textures){a=true;var s=this._textures[o];if(s){i=s.texture.width;n=s.texture.height;this._doAttach(e,s.texture,o,s.target)}}this._width=i;this._height=n;if(!a&&this.depthBuffer){console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height.")}if(this.viewport){e.setViewport(this.viewport)}else{e.setViewport(0,0,i,n,1)}var u=r.get("attached_textures");if(u){for(var o in u){if(!this._textures[o]){var l=u[o];this._doDetach(t,o,l)}}}if(!r.get(m)&&this.depthBuffer){if(r.miss(c)){r.put(c,t.createRenderbuffer())}var h=r.get(c);if(i!==r.get(d)||n!==r.get(v)){t.bindRenderbuffer(_,h);t.renderbufferStorage(_,t.DEPTH_COMPONENT16,i,n);r.put(d,i);r.put(v,n);t.bindRenderbuffer(_,null)}if(!r.get(p)){t.framebufferRenderbuffer(g,y,_,h);r.put(p,true)}}},unbind:function(e){e.__currentFrameBuffer=null;var t=e.gl;t.bindFramebuffer(g,null);this._boundRenderer=null;this._cache.use(e.__uid__);var r=this._cache.get("viewport");if(r){e.setViewport(r)}this.updateMipmap(e)},updateMipmap:function(e){var t=e.gl;for(var r in this._textures){var a=this._textures[r];if(a){var i=a.texture;if(!i.NPOT&&i.useMipmap&&i.minFilter===o["a"].LINEAR_MIPMAP_LINEAR){var n=i.textureType==="textureCube"?f["a"].TEXTURE_CUBE_MAP:f["a"].TEXTURE_2D;t.bindTexture(n,i.getWebGLTexture(e));t.generateMipmap(n);t.bindTexture(n,null)}}}},checkStatus:function(e){return e.checkFramebufferStatus(g)},_getFrameBufferGL:function(e){var t=this._cache;t.use(e.__uid__);if(t.miss(s)){t.put(s,e.gl.createFramebuffer())}return t.get(s)},attach:function(e,t,r){if(!e.width){throw new Error("The texture attached to color buffer is not a valid.")}t=t||l;r=r||f["a"].TEXTURE_2D;var a=this._boundRenderer;var i=a&&a.gl;var n;if(i){var o=this._cache;o.use(a.__uid__);n=o.get("attached_textures")}var s=this._textures[t];if(s&&s.target===r&&s.texture===e&&(n&&n[t]!=null)){return}var u=true;if(a){u=this._doAttach(a,e,t,r);if(!this.viewport){a.setViewport(0,0,e.width,e.height,1)}}if(u){this._textures[t]=this._textures[t]||{};this._textures[t].texture=e;this._textures[t].target=r}},_doAttach:function(e,t,r,a){var i=e.gl;var n=t.getWebGLTexture(e);var o=this._cache.get("attached_textures");if(o&&o[r]){var s=o[r];if(s.texture===t&&s.target===a){return}}r=+r;var u=true;if(r===y||r===f["a"].DEPTH_STENCIL_ATTACHMENT){var l=e.getGLExtension("WEBGL_depth_texture");if(!l){console.error("Depth texture is not supported by the browser");u=false}if(t.format!==f["a"].DEPTH_COMPONENT&&t.format!==f["a"].DEPTH_STENCIL){console.error("The texture attached to depth buffer is not a valid.");u=false}if(u){var h=this._cache.get(c);if(h){i.framebufferRenderbuffer(g,y,_,null);i.deleteRenderbuffer(h);this._cache.put(c,false)}this._cache.put(p,false);this._cache.put(m,true)}}i.framebufferTexture2D(g,r,a,n,0);if(!o){o={};this._cache.put("attached_textures",o)}o[r]=o[r]||{};o[r].texture=t;o[r].target=a;return u},_doDetach:function(e,t,r){e.framebufferTexture2D(g,t,r,null,0);var a=this._cache.get("attached_textures");if(a&&a[t]){a[t]=null}if(t===y||t===f["a"].DEPTH_STENCIL_ATTACHMENT){this._cache.put(m,false)}},detach:function(e,t){this._textures[e]=null;if(this._boundRenderer){var r=this._cache;r.use(this._boundRenderer.__uid__);this._doDetach(this._boundRenderer.gl,e,t)}},dispose:function(e){var t=e.gl;var r=this._cache;r.use(e.__uid__);var a=r.get(c);if(a){t.deleteRenderbuffer(a)}var i=r.get(s);if(i){t.deleteFramebuffer(i)}r.deleteContext(e.__uid__);this._textures={}}});u.DEPTH_ATTACHMENT=y;u.COLOR_ATTACHMENT0=l;u.STENCIL_ATTACHMENT=f["a"].STENCIL_ATTACHMENT;u.DEPTH_STENCIL_ATTACHMENT=f["a"].DEPTH_STENCIL_ATTACHMENT;t["a"]=u},function(e,t,r){"use strict";t["a"]={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}},function(e,t,r){"use strict";var n=r(20);var o={};o.create=function(){var e=new n["a"](3);e[0]=0;e[1]=0;e[2]=0;return e};o.clone=function(e){var t=new n["a"](3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t};o.fromValues=function(e,t,r){var a=new n["a"](3);a[0]=e;a[1]=t;a[2]=r;return a};o.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e};o.set=function(e,t,r,a){e[0]=t;e[1]=r;e[2]=a;return e};o.add=function(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];e[2]=t[2]+r[2];return e};o.subtract=function(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];e[2]=t[2]-r[2];return e};o.sub=o.subtract;o.multiply=function(e,t,r){e[0]=t[0]*r[0];e[1]=t[1]*r[1];e[2]=t[2]*r[2];return e};o.mul=o.multiply;o.divide=function(e,t,r){e[0]=t[0]/r[0];e[1]=t[1]/r[1];e[2]=t[2]/r[2];return e};o.div=o.divide;o.min=function(e,t,r){e[0]=Math.min(t[0],r[0]);e[1]=Math.min(t[1],r[1]);e[2]=Math.min(t[2],r[2]);return e};o.max=function(e,t,r){e[0]=Math.max(t[0],r[0]);e[1]=Math.max(t[1],r[1]);e[2]=Math.max(t[2],r[2]);return e};o.scale=function(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;return e};o.scaleAndAdd=function(e,t,r,a){e[0]=t[0]+r[0]*a;e[1]=t[1]+r[1]*a;e[2]=t[2]+r[2]*a;return e};o.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+a*a+i*i)};o.dist=o.distance;o.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2];return r*r+a*a+i*i};o.sqrDist=o.squaredDistance;o.length=function(e){var t=e[0],r=e[1],a=e[2];return Math.sqrt(t*t+r*r+a*a)};o.len=o.length;o.squaredLength=function(e){var t=e[0],r=e[1],a=e[2];return t*t+r*r+a*a};o.sqrLen=o.squaredLength;o.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e};o.inverse=function(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e};o.normalize=function(e,t){var r=t[0],a=t[1],i=t[2];var n=r*r+a*a+i*i;if(n>0){n=1/Math.sqrt(n);e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n}return e};o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};o.cross=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],u=r[2];e[0]=i*u-n*s;e[1]=n*o-a*u;e[2]=a*s-i*o;return e};o.lerp=function(e,t,r,a){var i=t[0],n=t[1],o=t[2];e[0]=i+a*(r[0]-i);e[1]=n+a*(r[1]-n);e[2]=o+a*(r[2]-o);return e};o.random=function(e,t){t=t||1;var r=Object(n["c"])()*2*Math.PI;var a=Object(n["c"])()*2-1;var i=Math.sqrt(1-a*a)*t;e[0]=Math.cos(r)*i;e[1]=Math.sin(r)*i;e[2]=a*t;return e};o.transformMat4=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[3]*a+r[7]*i+r[11]*n+r[15];o=o||1;e[0]=(r[0]*a+r[4]*i+r[8]*n+r[12])/o;e[1]=(r[1]*a+r[5]*i+r[9]*n+r[13])/o;e[2]=(r[2]*a+r[6]*i+r[10]*n+r[14])/o;return e};o.transformMat3=function(e,t,r){var a=t[0],i=t[1],n=t[2];e[0]=a*r[0]+i*r[3]+n*r[6];e[1]=a*r[1]+i*r[4]+n*r[7];e[2]=a*r[2]+i*r[5]+n*r[8];return e};o.transformQuat=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*a+s*n-u*i,f=l*i+u*a-o*n,c=l*n+o*i-s*a,d=-o*a-s*i-u*n;e[0]=h*l+d*-o+f*-u-c*-s;e[1]=f*l+d*-s+c*-o-h*-u;e[2]=c*l+d*-u+h*-s-f*-o;return e};o.rotateX=function(e,t,r,a){var i=[],n=[];i[0]=t[0]-r[0];i[1]=t[1]-r[1];i[2]=t[2]-r[2];n[0]=i[0];n[1]=i[1]*Math.cos(a)-i[2]*Math.sin(a);n[2]=i[1]*Math.sin(a)+i[2]*Math.cos(a);e[0]=n[0]+r[0];e[1]=n[1]+r[1];e[2]=n[2]+r[2];return e};o.rotateY=function(e,t,r,a){var i=[],n=[];i[0]=t[0]-r[0];i[1]=t[1]-r[1];i[2]=t[2]-r[2];n[0]=i[2]*Math.sin(a)+i[0]*Math.cos(a);n[1]=i[1];n[2]=i[2]*Math.cos(a)-i[0]*Math.sin(a);e[0]=n[0]+r[0];e[1]=n[1]+r[1];e[2]=n[2]+r[2];return e};o.rotateZ=function(e,t,r,a){var i=[],n=[];i[0]=t[0]-r[0];i[1]=t[1]-r[1];i[2]=t[2]-r[2];n[0]=i[0]*Math.cos(a)-i[1]*Math.sin(a);n[1]=i[0]*Math.sin(a)+i[1]*Math.cos(a);n[2]=i[2];e[0]=n[0]+r[0];e[1]=n[1]+r[1];e[2]=n[2]+r[2];return e};o.forEach=function(){var u=o.create();return function(e,t,r,a,i,n){var o,s;if(!t){t=3}if(!r){r=0}if(a){s=Math.min(a*t+r,e.length)}else{s=e.length}for(o=r;o<s;o+=t){u[0]=e[o];u[1]=e[o+1];u[2]=e[o+2];i(u,u,n);e[o]=u[0];e[o+1]=u[1];e[o+2]=u[2]}return e}}();o.angle=function(e,t){var r=o.fromValues(e[0],e[1],e[2]);var a=o.fromValues(t[0],t[1],t[2]);o.normalize(r,r);o.normalize(a,a);var i=o.dot(r,a);if(i>1){return 0}else{return Math.acos(i)}};t["a"]=o},function(e,t){var s={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1};var u={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1};var l=Object.prototype.toString;var r=Array.prototype;var o=r.forEach;var h=r.filter;var a=r.slice;var f=r.map;var c=r.reduce;var i={};function n(e,t){if(e==="createCanvas"){y=null}i[e]=t}function d(e){if(e==null||typeof e!="object"){return e}var t=e;var r=l.call(e);if(r==="[object Array]"){if(!Y(e)){t=[];for(var a=0,i=e.length;a<i;a++){t[a]=d(e[a])}}}else if(u[r]){if(!Y(e)){var n=e.constructor;if(e.constructor.from){t=n.from(e)}else{t=new n(e.length);for(var a=0,i=e.length;a<i;a++){t[a]=d(e[a])}}}}else if(!s[r]&&!Y(e)&&!U(e)){t={};for(var o in e){if(e.hasOwnProperty(o)){t[o]=d(e[o])}}}return t}function v(e,t,r){if(!O(t)||!O(e)){return r?d(t):e}for(var a in t){if(t.hasOwnProperty(a)){var i=e[a];var n=t[a];if(O(n)&&O(i)&&!I(n)&&!I(i)&&!U(n)&&!U(i)&&!F(n)&&!F(i)&&!Y(n)&&!Y(i)){v(i,n,r)}else if(r||!(a in e)){e[a]=d(t[a],true)}}}return e}function p(e,t){var r=e[0];for(var a=1,i=e.length;a<i;a++){r=v(r,e[a],t)}return r}function m(e,t){for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}return e}function g(e,t,r){for(var a in t){if(t.hasOwnProperty(a)&&(r?t[a]!=null:e[a]==null)){e[a]=t[a]}}return e}var _=function(){return i.createCanvas()};i.createCanvas=function(){return document.createElement("canvas")};var y;function x(){if(!y){y=_().getContext("2d")}return y}function T(e,t){if(e){if(e.indexOf){return e.indexOf(t)}for(var r=0,a=e.length;r<a;r++){if(e[r]===t){return r}}}return-1}function b(e,t){var r=e.prototype;function a(){}a.prototype=t.prototype;e.prototype=new a;for(var i in r){e.prototype[i]=r[i]}e.prototype.constructor=e;e.superClass=t}function w(e,t,r){e="prototype"in e?e.prototype:e;t="prototype"in t?t.prototype:t;g(e,t,r)}function E(e){if(!e){return}if(typeof e=="string"){return false}return typeof e.length=="number"}function S(e,t,r){if(!(e&&t)){return}if(e.forEach&&e.forEach===o){e.forEach(t,r)}else if(e.length===+e.length){for(var a=0,i=e.length;a<i;a++){t.call(r,e[a],a,e)}}else{for(var n in e){if(e.hasOwnProperty(n)){t.call(r,e[n],n,e)}}}}function A(e,t,r){if(!(e&&t)){return}if(e.map&&e.map===f){return e.map(t,r)}else{var a=[];for(var i=0,n=e.length;i<n;i++){a.push(t.call(r,e[i],i,e))}return a}}function M(e,t,r,a){if(!(e&&t)){return}if(e.reduce&&e.reduce===c){return e.reduce(t,r,a)}else{for(var i=0,n=e.length;i<n;i++){r=t.call(a,r,e[i],i,e)}return r}}function C(e,t,r){if(!(e&&t)){return}if(e.filter&&e.filter===h){return e.filter(t,r)}else{var a=[];for(var i=0,n=e.length;i<n;i++){if(t.call(r,e[i],i,e)){a.push(e[i])}}return a}}function L(e,t,r){if(!(e&&t)){return}for(var a=0,i=e.length;a<i;a++){if(t.call(r,e[a],a,e)){return e[a]}}}function D(e,t){var r=a.call(arguments,2);return function(){return e.apply(t,r.concat(a.call(arguments)))}}function N(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}}function I(e){return l.call(e)==="[object Array]"}function R(e){return typeof e==="function"}function P(e){return l.call(e)==="[object String]"}function O(e){var t=typeof e;return t==="function"||!!e&&t=="object"}function F(e){return!!s[l.call(e)]}function B(e){return!!u[l.call(e)]}function U(e){return typeof e==="object"&&typeof e.nodeType==="number"&&typeof e.ownerDocument==="object"}function z(e){return e!==e}function G(e){for(var t=0,r=arguments.length;t<r;t++){if(arguments[t]!=null){return arguments[t]}}}function H(e,t){return e!=null?e:t}function V(e,t,r){return e!=null?e:t!=null?t:r}function k(){return Function.call.apply(a,arguments)}function W(e){if(typeof e==="number"){return[e,e,e,e]}var t=e.length;if(t===2){return[e[0],e[1],e[0],e[1]]}else if(t===3){return[e[0],e[1],e[2],e[1]]}return e}function j(e,t){if(!e){throw new Error(t)}}function X(e){if(e==null){return null}else if(typeof e.trim==="function"){return e.trim()}else{return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}var q="__ec_primitive__";function Z(e){e[q]=true}function Y(e){return e[q]}function K(e){var r=I(e);var a=this;e instanceof K?e.each(t):e&&S(e,t);function t(e,t){r?a.set(e,t):a.set(t,e)}}K.prototype={constructor:K,get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){return this[e]=t},each:function(e,t){t!==void 0&&(e=D(e,t));for(var r in this){this.hasOwnProperty(r)&&e(this[r],r)}},removeKey:function(e){delete this[e]}};function Q(e){return new K(e)}function J(e,t){var r=new e.constructor(e.length+t.length);for(var a=0;a<e.length;a++){r[a]=e[a]}var i=e.length;for(a=0;a<t.length;a++){r[a+i]=t[a]}return r}function $(){}t.$override=n;t.clone=d;t.merge=v;t.mergeAll=p;t.extend=m;t.defaults=g;t.createCanvas=_;t.getContext=x;t.indexOf=T;t.inherits=b;t.mixin=w;t.isArrayLike=E;t.each=S;t.map=A;t.reduce=M;t.filter=C;t.find=L;t.bind=D;t.curry=N;t.isArray=I;t.isFunction=R;t.isString=P;t.isObject=O;t.isBuiltInObject=F;t.isTypedArray=B;t.isDom=U;t.eqNaN=z;t.retrieve=G;t.retrieve2=H;t.retrieve3=V;t.slice=k;t.normalizeCssArray=W;t.assert=j;t.trim=X;t.setAsPrimitive=Z;t.isPrimitive=Y;t.createHashMap=Q;t.concatArray=J;t.noop=$},function(e,n,o){"use strict";(function(e){var t=o(112);var r;var a={};a.supportWebGL=function(){if(r==null){try{var e=document.createElement("canvas");var t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t){throw new Error}}catch(e){r=false}}return r};a.Int8Array=typeof Int8Array==="undefined"?Array:Int8Array;a.Uint8Array=typeof Uint8Array==="undefined"?Array:Uint8Array;a.Uint16Array=typeof Uint16Array==="undefined"?Array:Uint16Array;a.Uint32Array=typeof Uint32Array==="undefined"?Array:Uint32Array;a.Int16Array=typeof Int16Array==="undefined"?Array:Int16Array;a.Float32Array=typeof Float32Array==="undefined"?Array:Float32Array;a.Float64Array=typeof Float64Array==="undefined"?Array:Float64Array;var i={};if(typeof window!=="undefined"){i=window}else if(typeof e!=="undefined"){i=e}a.requestAnimationFrame=i.requestAnimationFrame||i.msRequestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||function(e){setTimeout(e,16)};a.createCanvas=function(){return document.createElement("canvas")};a.createImage=function(){return new i.Image};a.request={get:t["a"].get};n["a"]=a}).call(n,o(68))},function(e,t,r){"use strict";var m=r(14);var X=r(12);var u=r(21);var h=r(18);var a=r(118);var q=X["a"].create;var Z=X["a"].add;var g=X["a"].set;var i=a["a"].Attribute;var n=a["a"].extend(function(){return{attributes:{position:new i("position","float",3,"POSITION"),texcoord0:new i("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new i("texcoord1","float",2,"TEXCOORD_1"),normal:new i("normal","float",3,"NORMAL"),tangent:new i("tangent","float",4,"TANGENT"),color:new i("color","float",4,"COLOR"),weight:new i("weight","float",3,"WEIGHT"),joint:new i("joint","float",4,"JOINT"),barycentric:new i("barycentric","float",3,null)},boundingBox:null}},{mainAttribute:"position",updateBoundingBox:function(){var e=this.boundingBox;if(!e){e=this.boundingBox=new h["a"]}var t=this.attributes.position.value;if(t&&t.length){var r=e.min;var a=e.max;var i=r.array;var n=a.array;X["a"].set(i,t[0],t[1],t[2]);X["a"].set(n,t[0],t[1],t[2]);for(var o=3;o<t.length;){var s=t[o++];var u=t[o++];var l=t[o++];if(s<i[0]){i[0]=s}if(u<i[1]){i[1]=u}if(l<i[2]){i[2]=l}if(s>n[0]){n[0]=s}if(u>n[1]){n[1]=u}if(l>n[2]){n[2]=l}}r._dirty=true;a._dirty=true}},generateVertexNormals:function(){if(!this.vertexCount){return}var e=this.indices;var t=this.attributes;var r=t.position.value;var a=t.normal.value;if(!a||a.length!==r.length){a=t.normal.value=new m["a"].Float32Array(r.length)}else{for(var i=0;i<a.length;i++){a[i]=0}}var n=q();var o=q();var s=q();var u=q();var l=q();var h=q();var f=e?e.length:this.vertexCount;var c,d,v;for(var p=0;p<f;){if(e){c=e[p++];d=e[p++];v=e[p++]}else{c=p++;d=p++;v=p++}g(n,r[c*3],r[c*3+1],r[c*3+2]);g(o,r[d*3],r[d*3+1],r[d*3+2]);g(s,r[v*3],r[v*3+1],r[v*3+2]);X["a"].sub(u,n,o);X["a"].sub(l,o,s);X["a"].cross(h,u,l);for(var i=0;i<3;i++){a[c*3+i]=a[c*3+i]+h[i];a[d*3+i]=a[d*3+i]+h[i];a[v*3+i]=a[v*3+i]+h[i]}}for(var i=0;i<a.length;){g(h,a[i],a[i+1],a[i+2]);X["a"].normalize(h,h);a[i++]=h[0];a[i++]=h[1];a[i++]=h[2]}this.dirty()},generateFaceNormals:function(){if(!this.vertexCount){return}if(!this.isUniqueVertex()){this.generateUniqueVertex()}var e=this.indices;var t=this.attributes;var r=t.position.value;var a=t.normal.value;var i=q();var n=q();var o=q();var s=q();var u=q();var l=q();if(!a){a=t.normal.value=new Float32Array(r.length)}var h=e?e.length:this.vertexCount;var f,c,d;for(var v=0;v<h;){if(e){f=e[v++];c=e[v++];d=e[v++]}else{f=v++;c=v++;d=v++}g(i,r[f*3],r[f*3+1],r[f*3+2]);g(n,r[c*3],r[c*3+1],r[c*3+2]);g(o,r[d*3],r[d*3+1],r[d*3+2]);X["a"].sub(s,i,n);X["a"].sub(u,n,o);X["a"].cross(l,s,u);X["a"].normalize(l,l);for(var p=0;p<3;p++){a[f*3+p]=l[p];a[c*3+p]=l[p];a[d*3+p]=l[p]}}this.dirty()},generateTangents:function(){if(!this.vertexCount){return}var e=this.vertexCount;var t=this.attributes;if(!t.tangent.value){t.tangent.value=new Float32Array(e*4)}var r=t.texcoord0.value;var a=t.position.value;var i=t.tangent.value;var n=t.normal.value;if(!r){console.warn("Geometry without texcoords can't generate tangents.");return}var o=[];var s=[];for(var u=0;u<e;u++){o[u]=[0,0,0];s[u]=[0,0,0]}var l=[0,0,0];var h=[0,0,0];var f=this.indices;var c=f?f.length:this.vertexCount;var d,v,p;for(var u=0;u<c;){if(f){d=f[u++];v=f[u++];p=f[u++]}else{d=u++;v=u++;p=u++}var m=r[d*2],g=r[v*2],_=r[p*2],y=r[d*2+1],x=r[v*2+1],T=r[p*2+1],b=a[d*3],w=a[v*3],E=a[p*3],S=a[d*3+1],A=a[v*3+1],M=a[p*3+1],C=a[d*3+2],L=a[v*3+2],D=a[p*3+2];var N=w-b,I=E-b,R=A-S,P=M-S,O=L-C,F=D-C;var B=g-m,U=_-m,z=x-y,G=T-y;var H=1/(B*G-z*U);l[0]=(G*N-z*I)*H;l[1]=(G*R-z*P)*H;l[2]=(G*O-z*F)*H;h[0]=(B*I-U*N)*H;h[1]=(B*P-U*R)*H;h[2]=(B*F-U*O)*H;Z(o[d],o[d],l);Z(o[v],o[v],l);Z(o[p],o[p],l);Z(s[d],s[d],h);Z(s[v],s[v],h);Z(s[p],s[p],h)}var V=q();var k=q();var W=q();for(var u=0;u<e;u++){W[0]=n[u*3];W[1]=n[u*3+1];W[2]=n[u*3+2];var j=o[u];X["a"].scale(V,W,X["a"].dot(W,j));X["a"].sub(V,j,V);X["a"].normalize(V,V);X["a"].cross(k,W,j);i[u*4]=V[0];i[u*4+1]=V[1];i[u*4+2]=V[2];i[u*4+3]=X["a"].dot(k,s[u])<0?-1:1}this.dirty()},isUniqueVertex:function(){if(this.isUseIndices()){return this.vertexCount===this.indices.length}else{return true}},generateUniqueVertex:function(){if(!this.vertexCount||!this.indices){return}if(this.indices.length>65535){this.indices=new m["a"].Uint32Array(this.indices)}var e=this.attributes;var t=this.indices;var r=this.getEnabledAttributes();var a={};for(var i=0;i<r.length;i++){var n=r[i];a[n]=e[n].value;e[n].init(this.indices.length)}var o=0;for(var s=0;s<t.length;s++){var u=t[s];for(var i=0;i<r.length;i++){var n=r[i];var l=e[n].value;var h=e[n].size;for(var f=0;f<h;f++){l[o*h+f]=a[n][u*h+f]}}t[s]=o;o++}this.dirty()},generateBarycentric:function(){if(!this.vertexCount){return}if(!this.isUniqueVertex()){this.generateUniqueVertex()}var e=this.attributes;var t=e.barycentric.value;var r=this.indices;if(t&&t.length===r.length*3){return}t=e.barycentric.value=new Float32Array(r.length*3);for(var a=0;a<(r?r.length:this.vertexCount/3);){for(var i=0;i<3;i++){var n=r?r[a++]:a*3+i;t[n*3+i]=1}}this.dirty()},applyTransform:function(e){var t=this.attributes;var r=t.position.value;var a=t.normal.value;var i=t.tangent.value;e=e.array;var n=u["a"].create();u["a"].invert(n,e);u["a"].transpose(n,n);var o=X["a"].transformMat4;var s=X["a"].forEach;s(r,3,0,null,o,e);if(a){s(a,3,0,null,o,n)}if(i){s(i,4,0,null,o,n)}if(this.boundingBox){this.updateBoundingBox()}},dispose:function(e){var t=this._cache;t.use(e.__uid__);var r=t.get("chunks");if(r){for(var a=0;a<r.length;a++){var i=r[a];for(var n=0;n<i.attributeBuffers.length;n++){var o=i.attributeBuffers[n];e.gl.deleteBuffer(o.buffer)}if(i.indicesBuffer){e.gl.deleteBuffer(i.indicesBuffer.buffer)}}}if(this.__vaoCache){var s=e.getGLExtension("OES_vertex_array_object");for(var u in this.__vaoCache){var l=this.__vaoCache[u].vao;if(l){s.deleteVertexArrayOES(l)}}}this.__vaoCache={};t.deleteContext(e.__uid__)}});n.STATIC_DRAW=a["a"].STATIC_DRAW;n.DYNAMIC_DRAW=a["a"].DYNAMIC_DRAW;n.STREAM_DRAW=a["a"].STREAM_DRAW;n.AttributeBuffer=a["a"].AttributeBuffer;n.IndicesBuffer=a["a"].IndicesBuffer;n.Attribute=i;t["a"]=n},function(e,t,r){"use strict";var a=r(7);var i=r(37);var n=r(43);var o=r(8);var s=r(19);var u=r(40);var l=r(11);var h=r(126);o["a"]["import"](h["a"]);var f=new n["a"];var c=new u["a"]({geometry:f,frustumCulling:false});var d=new i["a"];var v=a["a"].extend(function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:false,clearColor:false,clearDepth:true}},function(){var e=new o["a"](o["a"].source("clay.compositor.vertex"),this.fragment);var t=new s["a"]({shader:e});t.enableTexturesAll();this.material=t},{setUniform:function(e,t){this.material.setUniform(e,t)},getUniform:function(e){var t=this.material.uniforms[e];if(t){return t.value}},attachOutput:function(e,t){if(!this.outputs){this.outputs={}}t=t||l["a"].COLOR_ATTACHMENT0;this.outputs[t]=e},detachOutput:function(e){for(var t in this.outputs){if(this.outputs[t]===e){this.outputs[t]=null}}},bind:function(e,t){if(this.outputs){for(var r in this.outputs){var a=this.outputs[r];if(a){t.attach(a,r)}}}if(t){t.bind(e)}},unbind:function(e,t){t.unbind(e)},render:function(e,t){var r=e.gl;if(t){this.bind(e,t);var a=e.getGLExtension("EXT_draw_buffers");if(a&&this.outputs){var i=[];for(var n in this.outputs){n=+n;if(n>=r.COLOR_ATTACHMENT0&&n<=r.COLOR_ATTACHMENT0+8){i.push(n)}}a.drawBuffersEXT(i)}}this.trigger("beforerender",this,e);var o=this.clearDepth?r.DEPTH_BUFFER_BIT:0;r.depthMask(true);if(this.clearColor){o=o|r.COLOR_BUFFER_BIT;r.colorMask(true,true,true,true);var s=this.clearColor;if(Array.isArray(s)){r.clearColor(s[0],s[1],s[2],s[3])}}r.clear(o);if(this.blendWithPrevious){r.enable(r.BLEND);this.material.transparent=true}else{r.disable(r.BLEND);this.material.transparent=false}this.renderQuad(e);this.trigger("afterrender",this,e);if(t){this.unbind(e,t)}},renderQuad:function(e){c.material=this.material;e.renderPass([c],d)},dispose:function(e){}});t["a"]=v},function(e,t,r){"use strict";t["a"]=function(e,t,r){return{seriesType:e,reset:function(e,t){var r=e.getData();var i=e.visualColorAccessPath.split(".");i[i.length-1]="opacity";var a=e.get(i);r.setVisual("opacity",a==null?1:a);function n(e,t){var r=e.getItemModel(t);var a=r.get(i,true);if(a!=null){e.setItemVisual(t,"opacity",a)}}return{dataEach:r.hasItemOption?n:null}}}}},function(e,t,r){"use strict";var a=r(3);var i=r(12);var n=i["a"].set;var s=i["a"].copy;var o=function(e,t){this.min=e||new a["a"](Infinity,Infinity,Infinity);this.max=t||new a["a"](-Infinity,-Infinity,-Infinity);this.vertices=null};o.prototype={constructor:o,updateFromVertices:function(e){if(e.length>0){var t=this.min;var r=this.max;var a=t.array;var i=r.array;s(a,e[0]);s(i,e[0]);for(var n=1;n<e.length;n++){var o=e[n];if(o[0]<a[0]){a[0]=o[0]}if(o[1]<a[1]){a[1]=o[1]}if(o[2]<a[2]){a[2]=o[2]}if(o[0]>i[0]){i[0]=o[0]}if(o[1]>i[1]){i[1]=o[1]}if(o[2]>i[2]){i[2]=o[2]}}t._dirty=true;r._dirty=true}},union:function(e){var t=this.min;var r=this.max;i["a"].min(t.array,t.array,e.min.array);i["a"].max(r.array,r.array,e.max.array);t._dirty=true;r._dirty=true;return this},intersection:function(e){var t=this.min;var r=this.max;i["a"].max(t.array,t.array,e.min.array);i["a"].min(r.array,r.array,e.max.array);t._dirty=true;r._dirty=true;return this},intersectBoundingBox:function(e){var t=this.min.array;var r=this.max.array;var a=e.min.array;var i=e.max.array;return!(t[0]>i[0]||t[1]>i[1]||t[2]>i[2]||r[0]<a[0]||r[1]<a[1]||r[2]<a[2])},containBoundingBox:function(e){var t=this.min.array;var r=this.max.array;var a=e.min.array;var i=e.max.array;return t[0]<=a[0]&&t[1]<=a[1]&&t[2]<=a[2]&&r[0]>=i[0]&&r[1]>=i[1]&&r[2]>=i[2]},containPoint:function(e){var t=this.min.array;var r=this.max.array;var a=e.array;return t[0]<=a[0]&&t[1]<=a[1]&&t[2]<=a[2]&&r[0]>=a[0]&&r[1]>=a[1]&&r[2]>=a[2]},isFinite:function(){var e=this.min.array;var t=this.max.array;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])},applyTransform:function(e){this.transformFrom(this,e)},transformFrom:function(){var n=i["a"].create();var o=i["a"].create();var s=i["a"].create();var u=i["a"].create();var l=i["a"].create();var h=i["a"].create();return function(e,t){var r=e.min.array;var a=e.max.array;var i=t.array;n[0]=i[0]*r[0];n[1]=i[1]*r[0];n[2]=i[2]*r[0];o[0]=i[0]*a[0];o[1]=i[1]*a[0];o[2]=i[2]*a[0];s[0]=i[4]*r[1];s[1]=i[5]*r[1];s[2]=i[6]*r[1];u[0]=i[4]*a[1];u[1]=i[5]*a[1];u[2]=i[6]*a[1];l[0]=i[8]*r[2];l[1]=i[9]*r[2];l[2]=i[10]*r[2];h[0]=i[8]*a[2];h[1]=i[9]*a[2];h[2]=i[10]*a[2];r=this.min.array;a=this.max.array;r[0]=Math.min(n[0],o[0])+Math.min(s[0],u[0])+Math.min(l[0],h[0])+i[12];r[1]=Math.min(n[1],o[1])+Math.min(s[1],u[1])+Math.min(l[1],h[1])+i[13];r[2]=Math.min(n[2],o[2])+Math.min(s[2],u[2])+Math.min(l[2],h[2])+i[14];a[0]=Math.max(n[0],o[0])+Math.max(s[0],u[0])+Math.max(l[0],h[0])+i[12];a[1]=Math.max(n[1],o[1])+Math.max(s[1],u[1])+Math.max(l[1],h[1])+i[13];a[2]=Math.max(n[2],o[2])+Math.max(s[2],u[2])+Math.max(l[2],h[2])+i[14];this.min._dirty=true;this.max._dirty=true;return this}}(),applyProjection:function(e){var t=this.min.array;var r=this.max.array;var a=e.array;var i=t[0];var n=t[1];var o=t[2];var s=r[0];var u=r[1];var l=t[2];var h=r[0];var f=r[1];var c=r[2];if(a[15]===1){t[0]=a[0]*i+a[12];t[1]=a[5]*n+a[13];r[2]=a[10]*o+a[14];r[0]=a[0]*h+a[12];r[1]=a[5]*f+a[13];t[2]=a[10]*c+a[14]}else{var d=-1/o;t[0]=a[0]*i*d;t[1]=a[5]*n*d;r[2]=(a[10]*o+a[14])*d;d=-1/l;r[0]=a[0]*s*d;r[1]=a[5]*u*d;d=-1/c;t[2]=(a[10]*c+a[14])*d}this.min._dirty=true;this.max._dirty=true;return this},updateVertices:function(){var e=this.vertices;if(!e){e=[];for(var t=0;t<8;t++){e[t]=i["a"].fromValues(0,0,0)}this.vertices=e}var r=this.min.array;var a=this.max.array;n(e[0],r[0],r[1],r[2]);n(e[1],r[0],a[1],r[2]);n(e[2],a[0],r[1],r[2]);n(e[3],a[0],a[1],r[2]);n(e[4],r[0],r[1],a[2]);n(e[5],r[0],a[1],a[2]);n(e[6],a[0],r[1],a[2]);n(e[7],a[0],a[1],a[2]);return this},copy:function(e){var t=this.min;var r=this.max;s(t.array,e.min.array);s(r.array,e.max.array);t._dirty=true;r._dirty=true;return this},clone:function(){var e=new o;e.copy(this);return e}};t["a"]=o},function(e,t,r){"use strict";var a=r(7);var l=r(23);var i=r(113);var n=i["a"].parseToFloat;var u={};function h(e){var t=Object.keys(e);t.sort();var r=[];for(var a=0;a<t.length;a++){var i=t[a];var n=e[i];if(n===null){r.push(i)}else{r.push(i+" "+n.toString())}}return r.join("\n")}function o(e,t,r){r.sort();var a=[];for(var i=0;i<r.length;i++){var n=r[i];a.push(n)}var o=h(e)+"\n"+h(t)+"\n"+a.join("\n");if(u[o]){return u[o]}var s=l["a"].genGUID();u[o]=s;return s}var s=a["a"].extend(function(){return{name:"",depthTest:true,depthMask:true,transparent:false,blend:null,autoUpdateTextureStatus:true,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){if(!this.name){this.name="MATERIAL_"+this.__uid__}if(this.shader){this.attachShader(this.shader,true)}},{precision:"highp",setUniform:function(e,t){if(t===undefined){console.warn('Uniform value "'+e+'" is undefined')}var r=this.uniforms[e];if(r){if(typeof t==="string"){t=n(t)||t}r.value=t;if(this.autoUpdateTextureStatus&&r.type==="t"){if(t){this.enableTexture(e)}else{this.disableTexture(e)}}}},setUniforms:function(e){for(var t in e){var r=e[t];this.setUniform(t,r)}},isUniformEnabled:function(e){return this._enabledUniforms.indexOf(e)>=0},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(e,t){if(typeof e==="object"){for(var r in e){var a=e[r];this.setUniform(r,a)}}else{this.setUniform(e,t)}},get:function(e){var t=this.uniforms[e];if(t){return t.value}},attachShader:function(e,t){var r=this.uniforms;this.uniforms=e.createUniforms();this.shader=e;var a=this.uniforms;this._enabledUniforms=Object.keys(a);this._enabledUniforms.sort();this._textureUniforms=this._enabledUniforms.filter(function(e){var t=this.uniforms[e].type;return t==="t"||t==="tv"},this);var i=this.vertexDefines;var n=this.fragmentDefines;this.vertexDefines=l["a"].clone(e.vertexDefines);this.fragmentDefines=l["a"].clone(e.fragmentDefines);if(t){for(var o in r){if(a[o]){a[o].value=r[o].value}}l["a"].defaults(this.vertexDefines,i);l["a"].defaults(this.fragmentDefines,n)}var s={};for(var u in e.textures){s[u]={shaderType:e.textures[u].shaderType,type:e.textures[u].type,enabled:t&&this._textureStatus[u]?this._textureStatus[u].enabled:false}}this._textureStatus=s;this._programKey=""},clone:function(){var e=new this.constructor({name:this.name,shader:this.shader});for(var t in this.uniforms){e.uniforms[t].value=this.uniforms[t].value}e.depthTest=this.depthTest;e.depthMask=this.depthMask;e.transparent=this.transparent;e.blend=this.blend;e.vertexDefines=l["a"].clone(this.vertexDefines);e.fragmentDefines=l["a"].clone(this.fragmentDefines);e.enableTexture(this.getEnabledTextures());e.precision=this.precision;return e},define:function(e,t,r){var a=this.vertexDefines;var i=this.fragmentDefines;if(e!=="vertex"&&e!=="fragment"&&e!=="both"&&arguments.length<3){r=t;t=e;e="both"}r=r!=null?r:null;if(e==="vertex"||e==="both"){if(a[t]!==r){a[t]=r;this._programKey=""}}if(e==="fragment"||e==="both"){if(i[t]!==r){i[t]=r;if(e!=="both"){this._programKey=""}}}},undefine:function(e,t){if(e!=="vertex"&&e!=="fragment"&&e!=="both"&&arguments.length<2){t=e;e="both"}if(e==="vertex"||e==="both"){if(this.isDefined("vertex",t)){delete this.vertexDefines[t];this._programKey=""}}if(e==="fragment"||e==="both"){if(this.isDefined("fragment",t)){delete this.fragmentDefines[t];if(e!=="both"){this._programKey=""}}}},isDefined:function(e,t){switch(e){case"vertex":return this.vertexDefines[t]!==undefined;case"fragment":return this.fragmentDefines[t]!==undefined}},getDefine:function(e,t){switch(e){case"vertex":return this.vertexDefines[t];case"fragment":return this.fragmentDefines[t]}},enableTexture:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){this.enableTexture(e[t])}return}var r=this._textureStatus[e];if(r){var a=r.enabled;if(!a){r.enabled=true;this._programKey=""}}},enableTexturesAll:function(){var e=this._textureStatus;for(var t in e){e[t].enabled=true}this._programKey=""},disableTexture:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){this.disableTexture(e[t])}return}var r=this._textureStatus[e];if(r){var a=!r.enabled;if(!a){r.enabled=false;this._programKey=""}}},disableTexturesAll:function(){var e=this._textureStatus;for(var t in e){e[t].enabled=false}this._programKey=""},isTextureEnabled:function(e){var t=this._textureStatus;return!!t[e]&&t[e].enabled},getEnabledTextures:function(){var e=[];var t=this._textureStatus;for(var r in t){if(t[r].enabled){e.push(r)}}return e},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){if(!this._programKey){this._programKey=o(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())}return this._programKey}});t["a"]=s},function(e,t,r){"use strict";r.d(t,"b",function(){return a});r.d(t,"a",function(){return i});r.d(t,"c",function(){return n});var a=1e-6;var i=Array;var n=Math.random},function(e,t,r){"use strict";var I=r(20);var w={};w.create=function(){var e=new I["a"](16);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};w.clone=function(e){var t=new I["a"](16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t};w.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e};w.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};w.transpose=function(e,t){if(e===t){var r=t[1],a=t[2],i=t[3],n=t[6],o=t[7],s=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=r;e[6]=t[9];e[7]=t[13];e[8]=a;e[9]=n;e[11]=t[14];e[12]=i;e[13]=o;e[14]=s}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e};w.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],u=t[6],l=t[7],h=t[8],f=t[9],c=t[10],d=t[11],v=t[12],p=t[13],m=t[14],g=t[15],_=r*s-a*o,y=r*u-i*o,x=r*l-n*o,T=a*u-i*s,b=a*l-n*s,w=i*l-n*u,E=h*p-f*v,S=h*m-c*v,A=h*g-d*v,M=f*m-c*p,C=f*g-d*p,L=c*g-d*m,D=_*L-y*C+x*M+T*A-b*S+w*E;if(!D){return null}D=1/D;e[0]=(s*L-u*C+l*M)*D;e[1]=(i*C-a*L-n*M)*D;e[2]=(p*w-m*b+g*T)*D;e[3]=(c*b-f*w-d*T)*D;e[4]=(u*A-o*L-l*S)*D;e[5]=(r*L-i*A+n*S)*D;e[6]=(m*x-v*w-g*y)*D;e[7]=(h*w-c*x+d*y)*D;e[8]=(o*C-s*A+l*E)*D;e[9]=(a*A-r*C-n*E)*D;e[10]=(v*b-p*x+g*_)*D;e[11]=(f*x-h*b-d*_)*D;e[12]=(s*S-o*M-u*E)*D;e[13]=(r*M-a*S+i*E)*D;e[14]=(p*y-v*T-m*_)*D;e[15]=(h*T-f*y+c*_)*D;return e};w.adjoint=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],u=t[6],l=t[7],h=t[8],f=t[9],c=t[10],d=t[11],v=t[12],p=t[13],m=t[14],g=t[15];e[0]=s*(c*g-d*m)-f*(u*g-l*m)+p*(u*d-l*c);e[1]=-(a*(c*g-d*m)-f*(i*g-n*m)+p*(i*d-n*c));e[2]=a*(u*g-l*m)-s*(i*g-n*m)+p*(i*l-n*u);e[3]=-(a*(u*d-l*c)-s*(i*d-n*c)+f*(i*l-n*u));e[4]=-(o*(c*g-d*m)-h*(u*g-l*m)+v*(u*d-l*c));e[5]=r*(c*g-d*m)-h*(i*g-n*m)+v*(i*d-n*c);e[6]=-(r*(u*g-l*m)-o*(i*g-n*m)+v*(i*l-n*u));e[7]=r*(u*d-l*c)-o*(i*d-n*c)+h*(i*l-n*u);e[8]=o*(f*g-d*p)-h*(s*g-l*p)+v*(s*d-l*f);e[9]=-(r*(f*g-d*p)-h*(a*g-n*p)+v*(a*d-n*f));e[10]=r*(s*g-l*p)-o*(a*g-n*p)+v*(a*l-n*s);e[11]=-(r*(s*d-l*f)-o*(a*d-n*f)+h*(a*l-n*s));e[12]=-(o*(f*m-c*p)-h*(s*m-u*p)+v*(s*c-u*f));e[13]=r*(f*m-c*p)-h*(a*m-i*p)+v*(a*c-i*f);e[14]=-(r*(s*m-u*p)-o*(a*m-i*p)+v*(a*u-i*s));e[15]=r*(s*c-u*f)-o*(a*c-i*f)+h*(a*u-i*s);return e};w.determinant=function(e){var t=e[0],r=e[1],a=e[2],i=e[3],n=e[4],o=e[5],s=e[6],u=e[7],l=e[8],h=e[9],f=e[10],c=e[11],d=e[12],v=e[13],p=e[14],m=e[15],g=t*o-r*n,_=t*s-a*n,y=t*u-i*n,x=r*s-a*o,T=r*u-i*o,b=a*u-i*s,w=l*v-h*d,E=l*p-f*d,S=l*m-c*d,A=h*p-f*v,M=h*m-c*v,C=f*m-c*p;return g*C-_*M+y*A+x*S-T*E+b*w};w.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=t[9],d=t[10],v=t[11],p=t[12],m=t[13],g=t[14],_=t[15];var y=r[0],x=r[1],T=r[2],b=r[3];e[0]=y*a+x*s+T*f+b*p;e[1]=y*i+x*u+T*c+b*m;e[2]=y*n+x*l+T*d+b*g;e[3]=y*o+x*h+T*v+b*_;y=r[4];x=r[5];T=r[6];b=r[7];e[4]=y*a+x*s+T*f+b*p;e[5]=y*i+x*u+T*c+b*m;e[6]=y*n+x*l+T*d+b*g;e[7]=y*o+x*h+T*v+b*_;y=r[8];x=r[9];T=r[10];b=r[11];e[8]=y*a+x*s+T*f+b*p;e[9]=y*i+x*u+T*c+b*m;e[10]=y*n+x*l+T*d+b*g;e[11]=y*o+x*h+T*v+b*_;y=r[12];x=r[13];T=r[14];b=r[15];e[12]=y*a+x*s+T*f+b*p;e[13]=y*i+x*u+T*c+b*m;e[14]=y*n+x*l+T*d+b*g;e[15]=y*o+x*h+T*v+b*_;return e};w.multiplyAffine=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[4],s=t[5],u=t[6],l=t[8],h=t[9],f=t[10],c=t[12],d=t[13],v=t[14];var p=r[0],m=r[1],g=r[2];e[0]=p*a+m*o+g*l;e[1]=p*i+m*s+g*h;e[2]=p*n+m*u+g*f;p=r[4];m=r[5];g=r[6];e[4]=p*a+m*o+g*l;e[5]=p*i+m*s+g*h;e[6]=p*n+m*u+g*f;p=r[8];m=r[9];g=r[10];e[8]=p*a+m*o+g*l;e[9]=p*i+m*s+g*h;e[10]=p*n+m*u+g*f;p=r[12];m=r[13];g=r[14];e[12]=p*a+m*o+g*l+c;e[13]=p*i+m*s+g*h+d;e[14]=p*n+m*u+g*f+v;return e};w.mul=w.multiply;w.mulAffine=w.multiplyAffine;w.translate=function(e,t,r){var a=r[0],i=r[1],n=r[2],o,s,u,l,h,f,c,d,v,p,m,g;if(t===e){e[12]=t[0]*a+t[4]*i+t[8]*n+t[12];e[13]=t[1]*a+t[5]*i+t[9]*n+t[13];e[14]=t[2]*a+t[6]*i+t[10]*n+t[14];e[15]=t[3]*a+t[7]*i+t[11]*n+t[15]}else{o=t[0];s=t[1];u=t[2];l=t[3];h=t[4];f=t[5];c=t[6];d=t[7];v=t[8];p=t[9];m=t[10];g=t[11];e[0]=o;e[1]=s;e[2]=u;e[3]=l;e[4]=h;e[5]=f;e[6]=c;e[7]=d;e[8]=v;e[9]=p;e[10]=m;e[11]=g;e[12]=o*a+h*i+v*n+t[12];e[13]=s*a+f*i+p*n+t[13];e[14]=u*a+c*i+m*n+t[14];e[15]=l*a+d*i+g*n+t[15]}return e};w.scale=function(e,t,r){var a=r[0],i=r[1],n=r[2];e[0]=t[0]*a;e[1]=t[1]*a;e[2]=t[2]*a;e[3]=t[3]*a;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*n;e[9]=t[9]*n;e[10]=t[10]*n;e[11]=t[11]*n;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e};w.rotate=function(e,t,r,a){var i=a[0],n=a[1],o=a[2],s=Math.sqrt(i*i+n*n+o*o),u,l,h,f,c,d,v,p,m,g,_,y,x,T,b,w,E,S,A,M,C,L,D,N;if(Math.abs(s)<I["b"]){return null}s=1/s;i*=s;n*=s;o*=s;u=Math.sin(r);l=Math.cos(r);h=1-l;f=t[0];c=t[1];d=t[2];v=t[3];p=t[4];m=t[5];g=t[6];_=t[7];y=t[8];x=t[9];T=t[10];b=t[11];w=i*i*h+l;E=n*i*h+o*u;S=o*i*h-n*u;A=i*n*h-o*u;M=n*n*h+l;C=o*n*h+i*u;L=i*o*h+n*u;D=n*o*h-i*u;N=o*o*h+l;e[0]=f*w+p*E+y*S;e[1]=c*w+m*E+x*S;e[2]=d*w+g*E+T*S;e[3]=v*w+_*E+b*S;e[4]=f*A+p*M+y*C;e[5]=c*A+m*M+x*C;e[6]=d*A+g*M+T*C;e[7]=v*A+_*M+b*C;e[8]=f*L+p*D+y*N;e[9]=c*L+m*D+x*N;e[10]=d*L+g*D+T*N;e[11]=v*L+_*D+b*N;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e};w.rotateX=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],s=t[6],u=t[7],l=t[8],h=t[9],f=t[10],c=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=n*i+l*a;e[5]=o*i+h*a;e[6]=s*i+f*a;e[7]=u*i+c*a;e[8]=l*i-n*a;e[9]=h*i-o*a;e[10]=f*i-s*a;e[11]=c*i-u*a;return e};w.rotateY=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],s=t[2],u=t[3],l=t[8],h=t[9],f=t[10],c=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=n*i-l*a;e[1]=o*i-h*a;e[2]=s*i-f*a;e[3]=u*i-c*a;e[8]=n*a+l*i;e[9]=o*a+h*i;e[10]=s*a+f*i;e[11]=u*a+c*i;return e};w.rotateZ=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],s=t[2],u=t[3],l=t[4],h=t[5],f=t[6],c=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=n*i+l*a;e[1]=o*i+h*a;e[2]=s*i+f*a;e[3]=u*i+c*a;e[4]=l*i-n*a;e[5]=h*i-o*a;e[6]=f*i-s*a;e[7]=c*i-u*a;return e};w.fromRotationTranslation=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=a+a,u=i+i,l=n+n,h=a*s,f=a*u,c=a*l,d=i*u,v=i*l,p=n*l,m=o*s,g=o*u,_=o*l;e[0]=1-(d+p);e[1]=f+_;e[2]=c-g;e[3]=0;e[4]=f-_;e[5]=1-(h+p);e[6]=v+m;e[7]=0;e[8]=c+g;e[9]=v-m;e[10]=1-(h+d);e[11]=0;e[12]=r[0];e[13]=r[1];e[14]=r[2];e[15]=1;return e};w.fromQuat=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r+r,s=a+a,u=i+i,l=r*o,h=a*o,f=a*s,c=i*o,d=i*s,v=i*u,p=n*o,m=n*s,g=n*u;e[0]=1-f-v;e[1]=h+g;e[2]=c-m;e[3]=0;e[4]=h-g;e[5]=1-l-v;e[6]=d+p;e[7]=0;e[8]=c+m;e[9]=d-p;e[10]=1-l-f;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};w.frustum=function(e,t,r,a,i,n,o){var s=1/(r-t),u=1/(i-a),l=1/(n-o);e[0]=n*2*s;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n*2*u;e[6]=0;e[7]=0;e[8]=(r+t)*s;e[9]=(i+a)*u;e[10]=(o+n)*l;e[11]=-1;e[12]=0;e[13]=0;e[14]=o*n*2*l;e[15]=0;return e};w.perspective=function(e,t,r,a,i){var n=1/Math.tan(t/2),o=1/(a-i);e[0]=n/r;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(i+a)*o;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*i*a*o;e[15]=0;return e};w.ortho=function(e,t,r,a,i,n,o){var s=1/(t-r),u=1/(a-i),l=1/(n-o);e[0]=-2*s;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*u;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*l;e[11]=0;e[12]=(t+r)*s;e[13]=(i+a)*u;e[14]=(o+n)*l;e[15]=1;return e};w.lookAt=function(e,t,r,a){var i,n,o,s,u,l,h,f,c,d,v=t[0],p=t[1],m=t[2],g=a[0],_=a[1],y=a[2],x=r[0],T=r[1],b=r[2];if(Math.abs(v-x)<I["b"]&&Math.abs(p-T)<I["b"]&&Math.abs(m-b)<I["b"]){return w.identity(e)}h=v-x;f=p-T;c=m-b;d=1/Math.sqrt(h*h+f*f+c*c);h*=d;f*=d;c*=d;i=_*c-y*f;n=y*h-g*c;o=g*f-_*h;d=Math.sqrt(i*i+n*n+o*o);if(!d){i=0;n=0;o=0}else{d=1/d;i*=d;n*=d;o*=d}s=f*o-c*n;u=c*i-h*o;l=h*n-f*i;d=Math.sqrt(s*s+u*u+l*l);if(!d){s=0;u=0;l=0}else{d=1/d;s*=d;u*=d;l*=d}e[0]=i;e[1]=s;e[2]=h;e[3]=0;e[4]=n;e[5]=u;e[6]=f;e[7]=0;e[8]=o;e[9]=l;e[10]=c;e[11]=0;e[12]=-(i*v+n*p+o*m);e[13]=-(s*v+u*p+l*m);e[14]=-(h*v+f*p+c*m);e[15]=1;return e};w.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))};t["a"]=w},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var o=r(36);var s=r(174);var n=r(41);var u=r(37);var f=r(9);var c=r(3);var l=r(26);var h=r(53);var d=r(176);var v=r(200);var p=r(49);function m(e){e=e||"perspective";this.layer=null;this.scene=new o["a"];this.rootNode=this.scene;this.viewport={x:0,y:0,width:0,height:0};this.setProjection(e);this._compositor=new d["a"];this._temporalSS=new v["a"];this._shadowMapPass=new s["a"];var t=[];var r=0;for(var a=0;a<30;a++){var i=[];for(var n=0;n<6;n++){i.push(Object(p["a"])(r,2)*4-2);i.push(Object(p["a"])(r,3)*4-2);r++}t.push(i)}this._pcfKernels=t;this.scene.on("beforerender",function(e,t,r){if(this.needsTemporalSS()){this._temporalSS.jitterProjection(e,r)}},this)}m.prototype.setProjection=function(e){var t=this.camera;t&&t.update();if(e==="perspective"){if(!(this.camera instanceof n["a"])){this.camera=new n["a"];if(t){this.camera.setLocalTransform(t.localTransform)}}}else{if(!(this.camera instanceof u["a"])){this.camera=new u["a"];if(t){this.camera.setLocalTransform(t.localTransform)}}}this.camera.near=.1;this.camera.far=2e3};m.prototype.setViewport=function(e,t,r,a,i){if(this.camera instanceof n["a"]){this.camera.aspect=r/a}i=i||1;this.viewport.x=e;this.viewport.y=t;this.viewport.width=r;this.viewport.height=a;this.viewport.devicePixelRatio=i;this._compositor.resize(r*i,a*i);this._temporalSS.resize(r*i,a*i)};m.prototype.containPoint=function(e,t){var r=this.viewport;var a=this.layer.renderer.getHeight();t=a-t;return e>=r.x&&t>=r.y&&e<=r.x+r.width&&t<=r.y+r.height};var g=new l["a"];m.prototype.castRay=function(e,t,r){var a=this.layer.renderer;var i=a.viewport;a.viewport=this.viewport;a.screenToNDC(e,t,g);this.camera.castRay(g,r);a.viewport=i;return r};m.prototype.prepareRender=function(){this.scene.update();this.camera.update();this.scene.updateLights();var e=this.scene.updateRenderList(this.camera);this._needsSortProgressively=false;for(var t=0;t<e.transparent.length;t++){var r=e.transparent[t];var a=r.geometry;if(a.needsSortVerticesProgressively&&a.needsSortVerticesProgressively()){this._needsSortProgressively=true}if(a.needsSortTrianglesProgressively&&a.needsSortTrianglesProgressively()){this._needsSortProgressively=true}}this._frame=0;this._temporalSS.resetFrame()};m.prototype.render=function(e,t){this._doRender(e,t,this._frame);this._frame++};m.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively};m.prototype.needsTemporalSS=function(){var e=this._enableTemporalSS;if(e==="auto"){e=this._enablePostEffect}return e};m.prototype.hasDOF=function(){return this._enableDOF};m.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():this._frame>30};m.prototype._doRender=function(e,t,r){var a=this.scene;var i=this.camera;r=r||0;this._updateTransparent(e,a,i,r);if(!t){this._shadowMapPass.kernelPCF=this._pcfKernels[0];this._shadowMapPass.render(e,a,i,true)}this._updateShadowPCFKernel(r);var n=e.clearColor;e.gl.clearColor(n[0],n[1],n[2],n[3]);if(this._enablePostEffect){if(this.needsTemporalSS()){this._temporalSS.jitterProjection(e,i)}this._compositor.updateNormal(e,a,i,this._temporalSS.getFrame())}this._updateSSAO(e,a,i,this._temporalSS.getFrame());if(this._enablePostEffect){var o=this._compositor.getSourceFrameBuffer();o.bind(e);e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT);e.render(a,i,true,true);o.unbind(e);if(this.needsTemporalSS()&&t){this._compositor.composite(e,a,i,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame());e.setViewport(this.viewport);this._temporalSS.render(e)}else{e.setViewport(this.viewport);this._compositor.composite(e,a,i,null,0)}}else{if(this.needsTemporalSS()&&t){var o=this._temporalSS.getSourceFrameBuffer();o.bind(e);e.saveClear();e.clearBit=e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT;e.render(a,i,true,true);e.restoreClear();o.unbind(e);e.setViewport(this.viewport);this._temporalSS.render(e)}else{e.setViewport(this.viewport);e.render(a,i,true,true)}}};m.prototype._updateTransparent=function(e,t,r,a){var i=new c["a"];var n=new f["a"];var o=r.getWorldPosition();var s=t.getRenderList(r).transparent;for(var u=0;u<s.length;u++){var l=s[u];var h=l.geometry;f["a"].invert(n,l.worldTransform);c["a"].transformMat4(i,o,n);if(h.needsSortTriangles&&h.needsSortTriangles()){h.doSortTriangles(i,a)}if(h.needsSortVertices&&h.needsSortVertices()){h.doSortVertices(i,a)}}};m.prototype._updateSSAO=function(e,t,r){var a=this._enableSSAO&&this._enablePostEffect;if(a){this._compositor.updateSSAO(e,t,r,this._temporalSS.getFrame())}var i=t.getRenderList(r);for(var n=0;n<i.opaque.length;n++){var o=i.opaque[n];if(o.renderNormal){o.material[a?"enableTexture":"disableTexture"]("ssaoMap")}if(a){o.material.set("ssaoMap",this._compositor.getSSAOTexture())}}};m.prototype._updateShadowPCFKernel=function(e){var t=this._pcfKernels[e%this._pcfKernels.length];var r=this.scene.getRenderList(this.camera);var a=r.opaque;for(var i=0;i<a.length;i++){if(a[i].receiveShadow){a[i].material.set("pcfKernel",t);a[i].material.define("fragment","PCF_KERNEL_SIZE",t.length/2)}}};m.prototype.dispose=function(e){this._compositor.dispose(e.gl);this._temporalSS.dispose(e.gl);this._shadowMapPass.dispose(e)};m.prototype.setPostEffect=function(e,t){var r=this._compositor;this._enablePostEffect=e.get("enable");var a=e.getModel("bloom");var i=e.getModel("edge");var n=e.getModel("DOF",e.getModel("depthOfField"));var o=e.getModel("SSAO",e.getModel("screenSpaceAmbientOcclusion"));var s=e.getModel("SSR",e.getModel("screenSpaceReflection"));var u=e.getModel("FXAA");var l=e.getModel("colorCorrection");a.get("enable")?r.enableBloom():r.disableBloom();n.get("enable")?r.enableDOF():r.disableDOF();s.get("enable")?r.enableSSR():r.disableSSR();l.get("enable")?r.enableColorCorrection():r.disableColorCorrection();i.get("enable")?r.enableEdge():r.disableEdge();u.get("enable")?r.enableFXAA():r.disableFXAA();this._enableDOF=n.get("enable");this._enableSSAO=o.get("enable");this._enableSSAO?r.enableSSAO():r.disableSSAO();r.setBloomIntensity(a.get("intensity"));r.setEdgeColor(i.get("color"));r.setColorLookupTexture(l.get("lookupTexture"),t);r.setExposure(l.get("exposure"));["radius","quality","intensity"].forEach(function(e){r.setSSAOParameter(e,o.get(e))});["quality","maxRoughness","physical"].forEach(function(e){r.setSSRParameter(e,s.get(e))});["quality","focalDistance","focalRange","blurRadius","fstop"].forEach(function(e){r.setDOFParameter(e,n.get(e))});["brightness","contrast","saturation"].forEach(function(e){r.setColorCorrection(e,l.get(e))})};m.prototype.setDOFFocusOnPoint=function(e){if(this._enablePostEffect){if(e>this.camera.far||e<this.camera.near){return}this._compositor.setDOFParameter("focalDistance",e);return true}};m.prototype.setTemporalSuperSampling=function(e){this._enableTemporalSS=e.get("enable")};m.prototype.isLinearSpace=function(){return this._enablePostEffect};m.prototype.setRootNode=function(e){if(this.rootNode===e){return}var t=this.rootNode.children();for(var r=0;r<t.length;r++){e.add(t[r])}if(e!==this.scene){this.scene.add(e)}this.rootNode=e};m.prototype.add=function(e){this.rootNode.add(e)};m.prototype.remove=function(e){this.rootNode.remove(e)};m.prototype.removeAll=function(e){this.rootNode.removeAll(e)};i.a.util.extend(m.prototype,h["a"]);t["a"]=m},function(e,t,r){"use strict";var a=0;var i=Array.prototype;var o=i.forEach;var n={genGUID:function(){return++a},relative2absolute:function(e,t){if(!t||e.match(/^\//)){return e}var r=e.split("/");var a=t.split("/");var i=r[0];while(i==="."||i===".."){if(i===".."){a.pop()}r.shift();i=r[0]}return a.join("/")+"/"+r.join("/")},extend:function(e,t){if(t){for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}}return e},defaults:function(e,t){if(t){for(var r in t){if(e[r]===undefined){e[r]=t[r]}}}return e},extendWithPropList:function(e,t,r){if(t){for(var a=0;a<r.length;a++){var i=r[a];e[i]=t[i]}}return e},defaultsWithPropList:function(e,t,r){if(t){for(var a=0;a<r.length;a++){var i=r[a];if(e[i]==null){e[i]=t[i]}}}return e},each:function(e,t,r){if(!(e&&t)){return}if(e.forEach&&e.forEach===o){e.forEach(t,r)}else if(e.length===+e.length){for(var a=0,i=e.length;a<i;a++){t.call(r,e[a],a,e)}}else{for(var n in e){if(e.hasOwnProperty(n)){t.call(r,e[n],n,e)}}}},isObject:function(e){return e===Object(e)},isArray:function(e){return Array.isArray(e)},isArrayLike:function(e){if(!e){return false}else{return e.length===+e.length}},clone:function(e){if(!n.isObject(e)){return e}else if(n.isArray(e)){return e.slice()}else if(n.isArrayLike(e)){var t=new e.constructor(e.length);for(var r=0;r<e.length;r++){t[r]=e[r]}return t}else{return n.extend({},e)}}};t["a"]=n},function(e,t,r){"use strict";var a=r(35);var i=r(8);var n=r(119);i["a"]["import"](n["a"]);var o=a["a"].extend(function(){return{color:[1,1,1],intensity:1,castShadow:true,shadowResolution:512,group:0}},{type:"",clone:function(){var e=a["a"].prototype.clone.call(this);e.color=Array.prototype.slice.call(this.color);e.intensity=this.intensity;e.castShadow=this.castShadow;e.shadowResolution=this.shadowResolution;return e}});t["a"]=o},function(e,t,r){"use strict";var a=r(15);var i=r(0);var n=r.n(i);var o=r(38);var s=r(6);var u=s["a"].vec3;var l=[[0,0],[1,1]];var h=a["a"].extend(function(){return{segmentScale:1,dynamic:true,useNativeLine:true,attributes:{position:new a["a"].Attribute("position","float",3,"POSITION"),positionPrev:new a["a"].Attribute("positionPrev","float",3),positionNext:new a["a"].Attribute("positionNext","float",3),prevPositionPrev:new a["a"].Attribute("prevPositionPrev","float",3),prevPosition:new a["a"].Attribute("prevPosition","float",3),prevPositionNext:new a["a"].Attribute("prevPositionNext","float",3),offset:new a["a"].Attribute("offset","float",1),color:new a["a"].Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._triangleOffset=0;this._itemVertexOffsets=[]},setVertexCount:function(e){var t=this.attributes;if(this.vertexCount!==e){t.position.init(e);t.color.init(e);if(!this.useNativeLine){t.positionPrev.init(e);t.positionNext.init(e);t.offset.init(e)}if(e>65535){if(this.indices instanceof Uint16Array){this.indices=new Uint32Array(this.indices)}}else{if(this.indices instanceof Uint32Array){this.indices=new Uint16Array(this.indices)}}}},setTriangleCount:function(e){if(this.triangleCount!==e){if(e===0){this.indices=null}else{this.indices=this.vertexCount>65535?new Uint32Array(e*3):new Uint16Array(e*3)}}},_getCubicCurveApproxStep:function(e,t,r,a){var i=u.dist(e,t)+u.dist(r,t)+u.dist(a,r);var n=1/(i+1)*this.segmentScale;return n},getCubicCurveVertexCount:function(e,t,r,a){var i=this._getCubicCurveApproxStep(e,t,r,a);var n=Math.ceil(1/i);if(!this.useNativeLine){return n*2+2}else{return n*2}},getCubicCurveTriangleCount:function(e,t,r,a){var i=this._getCubicCurveApproxStep(e,t,r,a);var n=Math.ceil(1/i);if(!this.useNativeLine){return n*2}else{return 0}},getLineVertexCount:function(){return this.getPolylineVertexCount(l)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(l)},getPolylineVertexCount:function(e){var t;if(typeof e==="number"){t=e}else{var r=typeof e[0]!=="number";t=r?e.length:e.length/3}return!this.useNativeLine?(t-1)*2+2:(t-1)*2},getPolylineTriangleCount:function(e){var t;if(typeof e==="number"){t=e}else{var r=typeof e[0]!=="number";t=r?e.length:e.length/3}return!this.useNativeLine?Math.max(t-1,0)*2:0},addCubicCurve:function(e,t,r,a,i,n){if(n==null){n=1}var o=e[0],s=e[1],u=e[2];var l=t[0],h=t[1],f=t[2];var c=r[0],d=r[1],v=r[2];var p=a[0],m=a[1],g=a[2];var _=this._getCubicCurveApproxStep(e,t,r,a);var y=_*_;var x=y*_;var T=3*_;var b=3*y;var w=6*y;var E=6*x;var S=o-l*2+c;var A=s-h*2+d;var M=u-f*2+v;var C=(l-c)*3-o+p;var L=(h-d)*3-s+m;var D=(f-v)*3-u+g;var N=o;var I=s;var R=u;var P=(l-o)*T+S*b+C*x;var O=(h-s)*T+A*b+L*x;var F=(f-u)*T+M*b+D*x;var B=S*w+C*E;var U=A*w+L*E;var z=M*w+D*E;var G=C*E;var H=L*E;var V=D*E;var k=0;var W=0;var j=Math.ceil(1/_);var X=new Float32Array((j+1)*3);var X=[];var q=0;for(var W=0;W<j+1;W++){X[q++]=N;X[q++]=I;X[q++]=R;N+=P;I+=O;R+=F;P+=B;O+=U;F+=z;B+=G;U+=H;z+=V;k+=_;if(k>1){N=P>0?Math.min(N,p):Math.max(N,p);I=O>0?Math.min(I,m):Math.max(I,m);R=F>0?Math.min(R,g):Math.max(R,g)}}return this.addPolyline(X,i,n)},addLine:function(e,t,r,a){return this.addPolyline([e,t],r,a)},addPolyline:function(e,t,r,a,i){if(!e.length){return}var n=typeof e[0]!=="number";if(i==null){i=n?e.length:e.length/3}if(i<2){return}if(a==null){a=0}if(r==null){r=1}this._itemVertexOffsets.push(this._vertexOffset);var n=typeof e[0]!=="number";var o=n?typeof t[0]!=="number":t.length/4===i;var s=this.attributes.position;var u=this.attributes.positionPrev;var l=this.attributes.positionNext;var h=this.attributes.color;var f=this.attributes.offset;var c=this.indices;var d=this._vertexOffset;var v;var p;r=Math.max(r,.01);for(var m=a;m<i;m++){if(n){v=e[m];if(o){p=t[m]}else{p=t}}else{var g=m*3;v=v||[];v[0]=e[g];v[1]=e[g+1];v[2]=e[g+2];if(o){var _=m*4;p=p||[];p[0]=t[_];p[1]=t[_+1];p[2]=t[_+2];p[3]=t[_+3]}else{p=t}}if(!this.useNativeLine){if(m<i-1){u.set(d+2,v);u.set(d+3,v)}if(m>0){l.set(d-2,v);l.set(d-1,v)}s.set(d,v);s.set(d+1,v);h.set(d,p);h.set(d+1,p);f.set(d,r/2);f.set(d+1,-r/2);d+=2}else{if(m>1){s.copy(d,d-1);h.copy(d,d-1);d++}}if(!this.useNativeLine){if(m>0){var y=this._triangleOffset*3;var c=this.indices;c[y]=d-4;c[y+1]=d-3;c[y+2]=d-2;c[y+3]=d-3;c[y+4]=d-1;c[y+5]=d-2;this._triangleOffset+=2}}else{h.set(d,p);s.set(d,v);d++}}if(!this.useNativeLine){var x=this._vertexOffset;var T=this._vertexOffset+i*2;u.copy(x,x+2);u.copy(x+1,x+3);l.copy(T-1,T-3);l.copy(T-2,T-4)}this._vertexOffset=d;return this._vertexOffset},setItemColor:function(e,t){var r=this._itemVertexOffsets[e];var a=e<this._itemVertexOffsets.length-1?this._itemVertexOffsets[e+1]:this._vertexOffset;for(var i=r;i<a;i++){this.attributes.color.set(i,t)}this.dirty("color")},currentTriangleOffset:function(){return this._triangleOffset},currentVertexOffset:function(){return this._vertexOffset}});n.a.util.defaults(h.prototype,o["a"]);t["a"]=h},function(e,t,r){"use strict";var i=r(70);var a=function(e,t){e=e||0;t=t||0;this.array=i["a"].fromValues(e,t);this._dirty=true};a.prototype={constructor:a,add:function(e){i["a"].add(this.array,this.array,e.array);this._dirty=true;return this},set:function(e,t){this.array[0]=e;this.array[1]=t;this._dirty=true;return this},setArray:function(e){this.array[0]=e[0];this.array[1]=e[1];this._dirty=true;return this},clone:function(){return new a(this.x,this.y)},copy:function(e){i["a"].copy(this.array,e.array);this._dirty=true;return this},cross:function(e,t){i["a"].cross(e.array,this.array,t.array);e._dirty=true;return this},dist:function(e){return i["a"].dist(this.array,e.array)},distance:function(e){return i["a"].distance(this.array,e.array)},div:function(e){i["a"].div(this.array,this.array,e.array);this._dirty=true;return this},divide:function(e){i["a"].divide(this.array,this.array,e.array);this._dirty=true;return this},dot:function(e){return i["a"].dot(this.array,e.array)},len:function(){return i["a"].len(this.array)},length:function(){return i["a"].length(this.array)},lerp:function(e,t,r){i["a"].lerp(this.array,e.array,t.array,r);this._dirty=true;return this},min:function(e){i["a"].min(this.array,this.array,e.array);this._dirty=true;return this},max:function(e){i["a"].max(this.array,this.array,e.array);this._dirty=true;return this},mul:function(e){i["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},multiply:function(e){i["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},negate:function(){i["a"].negate(this.array,this.array);this._dirty=true;return this},normalize:function(){i["a"].normalize(this.array,this.array);this._dirty=true;return this},random:function(e){i["a"].random(this.array,e);this._dirty=true;return this},scale:function(e){i["a"].scale(this.array,this.array,e);this._dirty=true;return this},scaleAndAdd:function(e,t){i["a"].scaleAndAdd(this.array,this.array,e.array,t);this._dirty=true;return this},sqrDist:function(e){return i["a"].sqrDist(this.array,e.array)},squaredDistance:function(e){return i["a"].squaredDistance(this.array,e.array)},sqrLen:function(){return i["a"].sqrLen(this.array)},squaredLength:function(){return i["a"].squaredLength(this.array)},sub:function(e){i["a"].sub(this.array,this.array,e.array);this._dirty=true;return this},subtract:function(e){i["a"].subtract(this.array,this.array,e.array);this._dirty=true;return this},transformMat2:function(e){i["a"].transformMat2(this.array,this.array,e.array);this._dirty=true;return this},transformMat2d:function(e){i["a"].transformMat2d(this.array,this.array,e.array);this._dirty=true;return this},transformMat3:function(e){i["a"].transformMat3(this.array,this.array,e.array);this._dirty=true;return this},transformMat4:function(e){i["a"].transformMat4(this.array,this.array,e.array);this._dirty=true;return this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};if(Object.defineProperty){var n=a.prototype;Object.defineProperty(n,"x",{get:function(){return this.array[0]},set:function(e){this.array[0]=e;this._dirty=true}});Object.defineProperty(n,"y",{get:function(){return this.array[1]},set:function(e){this.array[1]=e;this._dirty=true}})}a.add=function(e,t,r){i["a"].add(e.array,t.array,r.array);e._dirty=true;return e};a.set=function(e,t,r){i["a"].set(e.array,t,r);e._dirty=true;return e};a.copy=function(e,t){i["a"].copy(e.array,t.array);e._dirty=true;return e};a.cross=function(e,t,r){i["a"].cross(e.array,t.array,r.array);e._dirty=true;return e};a.dist=function(e,t){return i["a"].distance(e.array,t.array)};a.distance=a.dist;a.div=function(e,t,r){i["a"].divide(e.array,t.array,r.array);e._dirty=true;return e};a.divide=a.div;a.dot=function(e,t){return i["a"].dot(e.array,t.array)};a.len=function(e){return i["a"].length(e.array)};a.lerp=function(e,t,r,a){i["a"].lerp(e.array,t.array,r.array,a);e._dirty=true;return e};a.min=function(e,t,r){i["a"].min(e.array,t.array,r.array);e._dirty=true;return e};a.max=function(e,t,r){i["a"].max(e.array,t.array,r.array);e._dirty=true;return e};a.mul=function(e,t,r){i["a"].multiply(e.array,t.array,r.array);e._dirty=true;return e};a.multiply=a.mul;a.negate=function(e,t){i["a"].negate(e.array,t.array);e._dirty=true;return e};a.normalize=function(e,t){i["a"].normalize(e.array,t.array);e._dirty=true;return e};a.random=function(e,t){i["a"].random(e.array,t);e._dirty=true;return e};a.scale=function(e,t,r){i["a"].scale(e.array,t.array,r);e._dirty=true;return e};a.scaleAndAdd=function(e,t,r,a){i["a"].scaleAndAdd(e.array,t.array,r.array,a);e._dirty=true;return e};a.sqrDist=function(e,t){return i["a"].sqrDist(e.array,t.array)};a.squaredDistance=a.sqrDist;a.sqrLen=function(e){return i["a"].sqrLen(e.array)};a.squaredLength=a.sqrLen;a.sub=function(e,t,r){i["a"].subtract(e.array,t.array,r.array);e._dirty=true;return e};a.subtract=a.sub;a.transformMat2=function(e,t,r){i["a"].transformMat2(e.array,t.array,r.array);e._dirty=true;return e};a.transformMat2d=function(e,t,r){i["a"].transformMat2d(e.array,t.array,r.array);e._dirty=true;return e};a.transformMat3=function(e,t,r){i["a"].transformMat3(e.array,t.array,r.array);e._dirty=true;return e};a.transformMat4=function(e,t,r){i["a"].transformMat4(e.array,t.array,r.array);e._dirty=true;return e};t["a"]=a},function(e,t,r){"use strict";var a=r(4);var h=r(11);var o=r(23);var i=r(73);var s=r(14);var n=i["a"].isPowerOfTwo;var f=["px","nx","py","ny","pz","nz"];var u=a["a"].extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:"textureCube",update:function(e){var t=e.gl;t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture"));this.updateCommon(e);var r=this.format;var a=this.type;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this.getAvailableWrapS());t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this.getAvailableWrapT());t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this.getAvailableMagFilter());t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this.getAvailableMinFilter());var i=e.getGLExtension("EXT_texture_filter_anisotropic");if(i&&this.anisotropic>1){t.texParameterf(t.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic)}if(a===36193){var n=e.getGLExtension("OES_texture_half_float");if(!n){a=h["a"].FLOAT}}if(this.mipmaps.length){var o=this.width;var s=this.height;for(var u=0;u<this.mipmaps.length;u++){var l=this.mipmaps[u];this._updateTextureData(t,l,u,o,s,r,a);o/=2;s/=2}}else{this._updateTextureData(t,this,0,this.width,this.height,r,a);if(!this.NPOT&&this.useMipmap){t.generateMipmap(t.TEXTURE_CUBE_MAP)}}t.bindTexture(t.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(e,t,r,a,i,n,o){for(var s=0;s<6;s++){var u=f[s];var l=t.image&&t.image[u];if(l){e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,r,n,n,o,l)}else{e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,r,n,a,i,0,n,o,t.pixels&&t.pixels[u])}}},generateMipmap:function(e){var t=e.gl;if(this.useMipmap&&!this.NPOT){t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture"));t.generateMipmap(t.TEXTURE_CUBE_MAP)}},bind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(e))},unbind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){if(this.image.px){return n(this.image.px.width)&&n(this.image.px.height)}else{return n(this.width)&&n(this.height)}},isRenderable:function(){if(this.image.px){return l(this.image.px)&&l(this.image.nx)&&l(this.image.py)&&l(this.image.ny)&&l(this.image.pz)&&l(this.image.nz)}else{return!!(this.width&&this.height)}},load:function(e,a){var i=0;var n=this;o["a"].each(e,function(e,t){var r=s["a"].createImage();if(a){r.crossOrigin=a}r.onload=function(){i--;if(i===0){n.dirty();n.trigger("success",n)}r.onload=null};r.onerror=function(){i--;r.onerror=null};i++;r.src=e;n.image[t]=r});return this}});Object.defineProperty(u.prototype,"width",{get:function(){if(this.image&&this.image.px){return this.image.px.width}return this._width},set:function(e){if(this.image&&this.image.px){console.warn("Texture from image can't set width")}else{if(this._width!==e){this.dirty()}this._width=e}}});Object.defineProperty(u.prototype,"height",{get:function(){if(this.image&&this.image.px){return this.image.px.height}return this._height},set:function(e){if(this.image&&this.image.px){console.warn("Texture from image can't set height")}else{if(this._height!==e){this.dirty()}this._height=e}}});function l(e){return e.nodeName==="CANVAS"||e.nodeName==="VIDEO"||e.complete}t["a"]=u},function(e,t,r){"use strict";t["a"]={defaultOption:{postEffect:{enable:false,bloom:{enable:true,intensity:.1},depthOfField:{enable:false,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:"medium"},screenSpaceAmbientOcclusion:{enable:false,radius:2,quality:"medium",intensity:1},screenSpaceReflection:{enable:false,quality:"medium",maxRoughness:.8},colorCorrection:{enable:true,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},edge:{enable:false},FXAA:{enable:false}},temporalSuperSampling:{enable:"auto"}}}},function(e,t,r){"use strict";t["a"]={defaultOption:{light:{main:{shadow:false,shadowQuality:"high",color:"#fff",intensity:1,alpha:0,beta:0},ambient:{color:"#fff",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}}},function(e,t,r){"use strict";var v=r(1);var p=r(42);var a=r(0);var m=r.n(a);function i(){}i.prototype={constructor:i,setScene:function(e){this._scene=e;if(this._skybox){this._skybox.attachScene(this._scene)}},initLight:function(e){this._lightRoot=e;this.mainLight=new v["a"].DirectionalLight({shadowBias:.005});this.ambientLight=new v["a"].AmbientLight;e.add(this.mainLight);e.add(this.ambientLight)},dispose:function(){if(this._lightRoot){this._lightRoot.remove(this.mainLight);this._lightRoot.remove(this.ambientLight)}},updateLight:function(e){var t=this.mainLight;var r=this.ambientLight;var a=e.getModel("light");var i=a.getModel("main");var n=a.getModel("ambient");t.intensity=i.get("intensity");r.intensity=n.get("intensity");t.color=v["a"].parseColor(i.get("color")).slice(0,3);r.color=v["a"].parseColor(n.get("color")).slice(0,3);var o=i.get("alpha")||0;var s=i.get("beta")||0;t.position.setArray(v["a"].directionFromAlphaBeta(o,s));t.lookAt(v["a"].Vector3.ZERO);t.castShadow=i.get("shadow");t.shadowResolution=v["a"].getShadowResolution(i.get("shadowQuality"))},updateAmbientCubemap:function(e,t,r){var a=t.getModel("light.ambientCubemap");var i=a.get("texture");if(i){this._cubemapLightsCache=this._cubemapLightsCache||{};var n=this._cubemapLightsCache[i];if(!n){var o=this;n=this._cubemapLightsCache[i]=v["a"].createAmbientCubemap(a.option,e,r,function(){if(o._isSkyboxFromAmbientCubemap){o._skybox.setEnvironmentMap(n.specular.cubemap)}r.getZr().refresh()})}this._lightRoot.add(n.diffuse);this._lightRoot.add(n.specular);this._currentCubemapLights=n}else if(this._currentCubemapLights){this._lightRoot.remove(this._currentCubemapLights.diffuse);this._lightRoot.remove(this._currentCubemapLights.specular);this._currentCubemapLights=null}},updateSkybox:function(e,t,r){var a=t.get("environment");var i=this;function n(){i._skybox=i._skybox||new p["a"];return i._skybox}var o=n();if(a&&a!=="none"){if(a==="auto"){this._isSkyboxFromAmbientCubemap=true;if(this._currentCubemapLights){var s=this._currentCubemapLights.specular.cubemap;o.setEnvironmentMap(s);if(this._scene){o.attachScene(this._scene)}o.material.set("lod",3)}else if(this._skybox){this._skybox.detachScene()}}else if(typeof a==="object"&&a.colorStops||typeof a==="string"&&m.a.color.parse(a)){this._isSkyboxFromAmbientCubemap=false;var u=new v["a"].Texture2D({anisotropic:8,flipY:false});o.setEnvironmentMap(u);var l=u.image=document.createElement("canvas");l.width=l.height=16;var h=l.getContext("2d");var f=new m.a.graphic.Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:a}});f.brush(h);o.attachScene(this._scene)}else{this._isSkyboxFromAmbientCubemap=false;var u=v["a"].loadTexture(a,r,{anisotropic:8,flipY:false});o.setEnvironmentMap(u);o.attachScene(this._scene)}}else{if(this._skybox){this._skybox.detachScene(this._scene)}this._skybox=null}var c=t.coordinateSystem;if(this._skybox){if(c&&c.viewGL&&a!=="auto"&&!(a.match&&a.match(/.hdr$/))){var d=c.viewGL.isLinearSpace()?"define":"undefine";this._skybox.material[d]("fragment","SRGB_DECODE")}else{this._skybox.material.undefine("fragment","SRGB_DECODE")}}}};t["a"]=i},function(e,t,r){"use strict";t["a"]={defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:"#fff"}}}},function(e,t,r){"use strict";var a=r(0);var h=r.n(a);var i={};i.getFormattedLabel=function(e,t,r,a,i){r=r||"normal";var n=e.getData(a);var o=n.getItemModel(t);var s=e.getDataParams(t,a);if(i!=null&&s.value instanceof Array){s.value=s.value[i]}var u=o.get(r==="normal"?["label","formatter"]:["emphasis","label","formatter"]);if(u==null){u=o.get(["label","formatter"])}var l;if(typeof u==="function"){s.status=r;l=u(s)}else if(typeof u==="string"){l=h.a.format.formatTpl(u,s)}return l};i.normalizeToArray=function(e){return e instanceof Array?e:e==null?[]:[e]};t["a"]=i},function(e,t,r){"use strict";var n=r(20);var a={};a.create=function(){var e=new n["a"](4);e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e};a.clone=function(e){var t=new n["a"](4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t};a.fromValues=function(e,t,r,a){var i=new n["a"](4);i[0]=e;i[1]=t;i[2]=r;i[3]=a;return i};a.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e};a.set=function(e,t,r,a,i){e[0]=t;e[1]=r;e[2]=a;e[3]=i;return e};a.add=function(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];e[2]=t[2]+r[2];e[3]=t[3]+r[3];return e};a.subtract=function(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];e[2]=t[2]-r[2];e[3]=t[3]-r[3];return e};a.sub=a.subtract;a.multiply=function(e,t,r){e[0]=t[0]*r[0];e[1]=t[1]*r[1];e[2]=t[2]*r[2];e[3]=t[3]*r[3];return e};a.mul=a.multiply;a.divide=function(e,t,r){e[0]=t[0]/r[0];e[1]=t[1]/r[1];e[2]=t[2]/r[2];e[3]=t[3]/r[3];return e};a.div=a.divide;a.min=function(e,t,r){e[0]=Math.min(t[0],r[0]);e[1]=Math.min(t[1],r[1]);e[2]=Math.min(t[2],r[2]);e[3]=Math.min(t[3],r[3]);return e};a.max=function(e,t,r){e[0]=Math.max(t[0],r[0]);e[1]=Math.max(t[1],r[1]);e[2]=Math.max(t[2],r[2]);e[3]=Math.max(t[3],r[3]);return e};a.scale=function(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;e[3]=t[3]*r;return e};a.scaleAndAdd=function(e,t,r,a){e[0]=t[0]+r[0]*a;e[1]=t[1]+r[1]*a;e[2]=t[2]+r[2]*a;e[3]=t[3]+r[3]*a;return e};a.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+a*a+i*i+n*n)};a.dist=a.distance;a.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2],n=t[3]-e[3];return r*r+a*a+i*i+n*n};a.sqrDist=a.squaredDistance;a.length=function(e){var t=e[0],r=e[1],a=e[2],i=e[3];return Math.sqrt(t*t+r*r+a*a+i*i)};a.len=a.length;a.squaredLength=function(e){var t=e[0],r=e[1],a=e[2],i=e[3];return t*t+r*r+a*a+i*i};a.sqrLen=a.squaredLength;a.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e};a.inverse=function(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e};a.normalize=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3];var o=r*r+a*a+i*i+n*n;if(o>0){o=1/Math.sqrt(o);e[0]=t[0]*o;e[1]=t[1]*o;e[2]=t[2]*o;e[3]=t[3]*o}return e};a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]};a.lerp=function(e,t,r,a){var i=t[0],n=t[1],o=t[2],s=t[3];e[0]=i+a*(r[0]-i);e[1]=n+a*(r[1]-n);e[2]=o+a*(r[2]-o);e[3]=s+a*(r[3]-s);return e};a.random=function(e,t){t=t||1;e[0]=Object(n["c"])();e[1]=Object(n["c"])();e[2]=Object(n["c"])();e[3]=Object(n["c"])();a.normalize(e,e);a.scale(e,e,t);return e};a.transformMat4=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3];e[0]=r[0]*a+r[4]*i+r[8]*n+r[12]*o;e[1]=r[1]*a+r[5]*i+r[9]*n+r[13]*o;e[2]=r[2]*a+r[6]*i+r[10]*n+r[14]*o;e[3]=r[3]*a+r[7]*i+r[11]*n+r[15]*o;return e};a.transformQuat=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],u=r[2],l=r[3],h=l*a+s*n-u*i,f=l*i+u*a-o*n,c=l*n+o*i-s*a,d=-o*a-s*i-u*n;e[0]=h*l+d*-o+f*-u-c*-s;e[1]=f*l+d*-s+c*-o-h*-u;e[2]=c*l+d*-u+h*-s-f*-o;return e};a.forEach=function(){var u=a.create();return function(e,t,r,a,i,n){var o,s;if(!t){t=4}if(!r){r=0}if(a){s=Math.min(a*t+r,e.length)}else{s=e.length}for(o=r;o<s;o+=t){u[0]=e[o];u[1]=e[o+1];u[2]=e[o+2];u[3]=e[o+3];i(u,u,n);e[o]=u[0];e[o+1]=u[1];e[o+2]=u[2];e[o+3]=u[3]}return e}}();t["a"]=a},function(e,t,r){"use strict";var a=r(20);var i={};i.create=function(){var e=new a["a"](9);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};i.fromMat4=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e};i.clone=function(e){var t=new a["a"](9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t};i.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e};i.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};i.transpose=function(e,t){if(e===t){var r=t[1],a=t[2],i=t[5];e[1]=t[3];e[2]=t[6];e[3]=r;e[5]=t[7];e[6]=a;e[7]=i}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e};i.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],u=t[6],l=t[7],h=t[8],f=h*o-s*l,c=-h*n+s*u,d=l*n-o*u,v=r*f+a*c+i*d;if(!v){return null}v=1/v;e[0]=f*v;e[1]=(-h*a+i*l)*v;e[2]=(s*a-i*o)*v;e[3]=c*v;e[4]=(h*r-i*u)*v;e[5]=(-s*r+i*n)*v;e[6]=d*v;e[7]=(-l*r+a*u)*v;e[8]=(o*r-a*n)*v;return e};i.adjoint=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],u=t[6],l=t[7],h=t[8];e[0]=o*h-s*l;e[1]=i*l-a*h;e[2]=a*s-i*o;e[3]=s*u-n*h;e[4]=r*h-i*u;e[5]=i*n-r*s;e[6]=n*l-o*u;e[7]=a*u-r*l;e[8]=r*o-a*n;return e};i.determinant=function(e){var t=e[0],r=e[1],a=e[2],i=e[3],n=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*n-o*u)+r*(-l*i+o*s)+a*(u*i-n*s)};i.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=r[0],d=r[1],v=r[2],p=r[3],m=r[4],g=r[5],_=r[6],y=r[7],x=r[8];e[0]=c*a+d*o+v*l;e[1]=c*i+d*s+v*h;e[2]=c*n+d*u+v*f;e[3]=p*a+m*o+g*l;e[4]=p*i+m*s+g*h;e[5]=p*n+m*u+g*f;e[6]=_*a+y*o+x*l;e[7]=_*i+y*s+x*h;e[8]=_*n+y*u+x*f;return e};i.mul=i.multiply;i.translate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=r[0],d=r[1];e[0]=a;e[1]=i;e[2]=n;e[3]=o;e[4]=s;e[5]=u;e[6]=c*a+d*o+l;e[7]=c*i+d*s+h;e[8]=c*n+d*u+f;return e};i.rotate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=Math.sin(r),d=Math.cos(r);e[0]=d*a+c*o;e[1]=d*i+c*s;e[2]=d*n+c*u;e[3]=d*o-c*a;e[4]=d*s-c*i;e[5]=d*u-c*n;e[6]=l;e[7]=h;e[8]=f;return e};i.scale=function(e,t,r){var a=r[0],i=r[1];e[0]=a*t[0];e[1]=a*t[1];e[2]=a*t[2];e[3]=i*t[3];e[4]=i*t[4];e[5]=i*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e};i.fromMat2d=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e};i.fromQuat=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r+r,s=a+a,u=i+i,l=r*o,h=a*o,f=a*s,c=i*o,d=i*s,v=i*u,p=n*o,m=n*s,g=n*u;e[0]=1-f-v;e[3]=h-g;e[6]=c+m;e[1]=h+g;e[4]=1-l-v;e[7]=d-p;e[2]=c-m;e[5]=d+p;e[8]=1-l-f;return e};i.normalFromMat4=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],u=t[6],l=t[7],h=t[8],f=t[9],c=t[10],d=t[11],v=t[12],p=t[13],m=t[14],g=t[15],_=r*s-a*o,y=r*u-i*o,x=r*l-n*o,T=a*u-i*s,b=a*l-n*s,w=i*l-n*u,E=h*p-f*v,S=h*m-c*v,A=h*g-d*v,M=f*m-c*p,C=f*g-d*p,L=c*g-d*m,D=_*L-y*C+x*M+T*A-b*S+w*E;if(!D){return null}D=1/D;e[0]=(s*L-u*C+l*M)*D;e[1]=(u*A-o*L-l*S)*D;e[2]=(o*C-s*A+l*E)*D;e[3]=(i*C-a*L-n*M)*D;e[4]=(r*L-i*A+n*S)*D;e[5]=(a*A-r*C-n*E)*D;e[6]=(p*w-m*b+g*T)*D;e[7]=(m*x-v*w-g*y)*D;e[8]=(v*b-p*x+g*_)*D;return e};i.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))};t["a"]=i},function(e,t,r){"use strict";var a=r(7);var o=r(3);var i=r(56);var s=r(9);var n=r(21);var u=r(18);var l=0;var h=a["a"].extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:true,_parent:null,_scene:null,_needsUpdateWorldTransform:true,_inIterating:false,__depth:0},function(){if(!this.name){this.name=(this.type||"NODE")+"_"+l++}if(!this.position){this.position=new o["a"]}if(!this.rotation){this.rotation=new i["a"]}if(!this.scale){this.scale=new o["a"](1,1,1)}this.worldTransform=new s["a"];this.localTransform=new s["a"];this._children=[]},{target:null,invisible:false,isSkinnedMesh:function(){return false},isRenderable:function(){return false},setName:function(e){var t=this._scene;if(t){var r=t._nodeRepository;delete r[this.name];r[e]=this}this.name=e},add:function(e){var t=e._parent;if(t===this){return}if(t){t.remove(e)}e._parent=this;this._children.push(e);var r=this._scene;if(r&&r!==e.scene){e.traverse(this._addSelfToScene,this)}e._needsUpdateWorldTransform=true},remove:function(e){var t=this._children;var r=t.indexOf(e);if(r<0){return}t.splice(r,1);e._parent=null;if(this._scene){e.traverse(this._removeSelfFromScene,this)}},removeAll:function(){var e=this._children;for(var t=0;t<e.length;t++){e[t]._parent=null;if(this._scene){e[t].traverse(this._removeSelfFromScene,this)}}this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(e){e._scene.removeFromScene(e);e._scene=null},_addSelfToScene:function(e){this._scene.addToScene(e);e._scene=this._scene},isAncestor:function(e){var t=e._parent;while(t){if(t===this){return true}t=t._parent}return false},children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},getChildByName:function(e){var t=this._children;for(var r=0;r<t.length;r++){if(t[r].name===e){return t[r]}}},getDescendantByName:function(e){var t=this._children;for(var r=0;r<t.length;r++){var a=t[r];if(a.name===e){return a}else{var i=a.getDescendantByName(e);if(i){return i}}}},queryNode:function(e){if(!e){return}var t=e.split("/");var r=this;for(var a=0;a<t.length;a++){var i=t[a];if(!i){continue}var n=false;var o=r._children;for(var s=0;s<o.length;s++){var u=o[s];if(u.name===i){r=u;n=true;break}}if(!n){return}}return r},getPath:function(e){if(!this._parent){return"/"}var t=this._parent;var r=this.name;while(t._parent){r=t.name+"/"+r;if(t._parent==e){break}t=t._parent}if(!t._parent&&e){return null}return r},traverse:function(e,t){e.call(t,this);var r=this._children;for(var a=0,i=r.length;a<i;a++){r[a].traverse(e,t)}},eachChild:function(e,t){var r=this._children;for(var a=0,i=r.length;a<i;a++){var n=r[a];e.call(t,n,a)}},setLocalTransform:function(e){n["a"].copy(this.localTransform.array,e.array);this.decomposeLocalTransform()},decomposeLocalTransform:function(e){var t=!e?this.scale:null;this.localTransform.decomposeMatrix(t,this.rotation,this.position)},setWorldTransform:function(e){n["a"].copy(this.worldTransform.array,e.array);this.decomposeWorldTransform()},decomposeWorldTransform:function(){var i=n["a"].create();return function(e){var t=this.localTransform;var r=this.worldTransform;if(this._parent){n["a"].invert(i,this._parent.worldTransform.array);n["a"].multiply(t.array,i,r.array)}else{n["a"].copy(t.array,r.array)}var a=!e?this.scale:null;t.decomposeMatrix(a,this.rotation,this.position)}}(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var e=this.position;var t=this.rotation;var r=this.scale;if(this.transformNeedsUpdate()){var a=this.localTransform.array;n["a"].fromRotationTranslation(a,t.array,e.array);n["a"].scale(a,a,r.array);t._dirty=false;r._dirty=false;e._dirty=false;this._needsUpdateWorldTransform=true}},_updateWorldTransformTopDown:function(){var e=this.localTransform.array;var t=this.worldTransform.array;if(this._parent){n["a"].multiplyAffine(t,this._parent.worldTransform.array,e)}else{n["a"].copy(t,e)}},updateWorldTransform:function(){var e=this;while(e&&e.getParent()&&e.getParent().transformNeedsUpdate()){e=e.getParent()}e.update()},update:function(e){if(this.autoUpdateLocalTransform){this.updateLocalTransform()}else{e=true}if(e||this._needsUpdateWorldTransform){this._updateWorldTransformTopDown();e=true;this._needsUpdateWorldTransform=false}var t=this._children;for(var r=0,a=t.length;r<a;r++){t[r].update(e)}},getBoundingBox:function(){function r(e){return!e.invisible&&e.geometry}var a=new u["a"];var i=new s["a"];var n=new s["a"];return function(e,t){t=t||new u["a"];e=e||r;if(this._parent){s["a"].invert(n,this._parent.worldTransform)}else{s["a"].identity(n)}this.traverse(function(e){if(e.geometry&&e.geometry.boundingBox){a.copy(e.geometry.boundingBox);s["a"].multiply(i,n,e.worldTransform);a.applyTransform(i);t.union(a)}},this,r);return t}}(),getWorldPosition:function(e){if(this.transformNeedsUpdate()){this.updateWorldTransform()}var t=this.worldTransform.array;if(e){var r=e.array;r[0]=t[12];r[1]=t[13];r[2]=t[14];return e}else{return new o["a"](t[12],t[13],t[14])}},clone:function(){var e=new this.constructor;var t=this._children;e.setName(this.name);e.position.copy(this.position);e.rotation.copy(this.rotation);e.scale.copy(this.scale);for(var r=0;r<t.length;r++){e.add(t[r].clone())}return e},rotateAround:function(){var i=new o["a"];var n=new s["a"];return function(e,t,r){i.copy(this.position).subtract(e);var a=this.localTransform;a.identity();a.translate(e);a.rotate(r,t);n.fromRotationTranslation(this.rotation,i);a.multiply(n);a.scale(this.scale);this.decomposeLocalTransform();this._needsUpdateWorldTransform=true}}(),lookAt:function(){var r=new s["a"];return function(e,t){r.lookAt(this.position,e,t||this.localTransform.y).invert();this.setLocalTransform(r);this.target=e}}()});t["a"]=h},function(e,t,r){"use strict";var a=r(35);var i=r(24);var n=r(58);var u=r(18);var s=r(23);var l=r(21);var o=r(69);var h=r(9);var f=l["a"].create();var c=l["a"].create();var d={};function v(e){var t=[];var r=Object.keys(e);r.sort();for(var a=0;a<r.length;a++){var i=r[a];t.push(i+" "+e[i])}var n=t.join("\n");if(d[n]){return d[n]}var o=s["a"].genGUID();d[n]=o;return o}function p(){this.opaque=[];this.transparent=[];this._opaqueCount=0;this._transparentCount=0}p.prototype.startCount=function(){this._opaqueCount=0;this._transparentCount=0};p.prototype.add=function(e,t){if(t){this.transparent[this._transparentCount++]=e}else{this.opaque[this._opaqueCount++]=e}};p.prototype.endCount=function(){this.transparent.length=this._transparentCount;this.opaque.length=this._opaqueCount};var m=a["a"].extend(function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new u["a"],shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new o["a"](20)}},function(){this._scene=this},{addToScene:function(e){if(e instanceof n["a"]){if(this._cameraList.length>0){console.warn("Found multiple camera in one scene. Use the fist one.")}this._cameraList.push(e)}else if(e instanceof i["a"]){this.lights.push(e)}if(e.name){this._nodeRepository[e.name]=e}},removeFromScene:function(e){var t;if(e instanceof n["a"]){t=this._cameraList.indexOf(e);if(t>=0){this._cameraList.splice(t,1)}}else if(e instanceof i["a"]){t=this.lights.indexOf(e);if(t>=0){this.lights.splice(t,1)}}if(e.name){delete this._nodeRepository[e.name]}},getNode:function(e){return this._nodeRepository[e]},setMainCamera:function(e){var t=this._cameraList.indexOf(e);if(t>=0){this._cameraList.splice(t,1)}this._cameraList.unshift(e)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var e=this.lights;this._previousLightNumber=this._lightNumber;var t={};for(var r=0;r<e.length;r++){var a=e[r];if(a.invisible){continue}var i=a.group;if(!t[i]){t[i]={}}t[i][a.type]=t[i][a.type]||0;t[i][a.type]++}this._lightNumber=t;for(var n in t){this._lightProgramKeys[n]=v(t[n])}this._updateLightUniforms()},cloneNode:function(e){var t=e.clone();var n={};function o(e,t){n[e.__uid__]=t;for(var r=0;r<e._children.length;r++){var a=e._children[r];var i=t._children[r];o(a,i)}}o(e,t);t.traverse(function(e){if(e.skeleton){e.skeleton=e.skeleton.clone(n)}if(e.material){e.material=e.material.clone()}});return t},updateRenderList:function(e,t){var r=e.__uid__;var a=this._renderLists.get(r);if(!a){a=new p;this._renderLists.put(r,a)}a.startCount();if(t){this.viewBoundingBoxLastFrame.min.set(Infinity,Infinity,Infinity);this.viewBoundingBoxLastFrame.max.set(-Infinity,-Infinity,-Infinity)}var i=this.material&&this.material.transparent||false;this._doUpdateRenderList(this,e,i,a,t);a.endCount();return a},getRenderList:function(e){return this._renderLists.get(e.__uid__)},_doUpdateRenderList:function(e,t,r,a,i){if(e.invisible){return}for(var n=0;n<e._children.length;n++){var o=e._children[n];if(o.isRenderable()){var s=o.isSkinnedMesh()?f:o.worldTransform.array;var u=o.geometry;l["a"].multiplyAffine(c,t.viewMatrix.array,s);if(i&&!u.boundingBox||!this.isFrustumCulled(o,t,c)){a.add(o,o.material.transparent||r)}}if(o._children.length>0){this._doUpdateRenderList(o,t,r,a,i)}}},isFrustumCulled:function(){var o=new u["a"];var s=new h["a"];return function(e,t,r){var a=e.boundingBox;if(!a){if(e.skeleton&&e.skeleton.boundingBox){a=e.skeleton.boundingBox}else{a=e.geometry.boundingBox}}if(!a){return false}s.array=r;o.transformFrom(a,s);if(e.castShadow){this.viewBoundingBoxLastFrame.union(o)}if(e.frustumCulling){if(!o.intersectBoundingBox(t.frustum.boundingBox)){return true}s.array=t.projectionMatrix.array;if(o.max.array[2]>0&&o.min.array[2]<0){o.max.array[2]=-1e-20}o.applyProjection(s);var i=o.min.array;var n=o.max.array;if(n[0]<-1||i[0]>1||n[1]<-1||i[1]>1||n[2]<-1||i[2]>1){return true}}return false}}(),_updateLightUniforms:function(){var e=this.lights;e.sort(g);var t=this._lightUniforms;for(var r in t){for(var a in t[r]){t[r][a].value.length=0}}for(var i=0;i<e.length;i++){var n=e[i];if(n.invisible){continue}var r=n.group;for(var a in n.uniformTemplates){var o=n.uniformTemplates[a];var s=o.value(n);if(s==null){continue}if(!t[r]){t[r]={}}if(!t[r][a]){t[r][a]={type:"",value:[]}}var u=t[r][a];u.type=o.type+"v";switch(o.type){case"1i":case"1f":case"t":u.value.push(s);break;case"2f":case"3f":case"4f":for(var l=0;l<s.length;l++){u.value.push(s[l])}break;default:console.error("Unkown light uniform type "+o.type)}}}},getLightGroups:function(){var e=[];for(var t in this._lightNumber){e.push(t)}return e},getNumberChangedLightGroups:function(){var e=[];for(var t in this._lightNumber){if(this.isLightNumberChanged(t)){e.push(t)}}return e},isLightNumberChanged:function(e){var t=this._previousLightNumber;var r=this._lightNumber;for(var a in r[e]){if(!t[e]){return true}if(r[e][a]!==t[e][a]){return true}}for(var a in t[e]){if(!r[e]){return true}if(r[e][a]!==t[e][a]){return true}}return false},getLightsNumbers:function(e){return this._lightNumber[e]},getProgramKey:function(e){return this._lightProgramKeys[e]},setLightUniforms:function(){function a(e,t,r){for(var a in e){var i=e[a];if(i.type==="tv"){if(!t.hasUniform(a)){continue}var n=[];for(var o=0;o<i.value.length;o++){var s=i.value[o];var u=t.takeCurrentTextureSlot(r,s);n.push(u)}t.setUniform(r.gl,"1iv",a,n)}else{t.setUniform(r.gl,i.type,a,i.value)}}}return function(e,t,r){a(this._lightUniforms[t],e,r);a(this.shadowUniforms,e,r)}}(),dispose:function(){this.material=null;this._opaqueList=[];this._transparentList=[];this.lights=[];this._lightUniforms={};this._lightNumber={};this._nodeRepository={}}});function g(e,t){if(t.castShadow&&!e.castShadow){return true}}t["a"]=m},function(e,t,r){"use strict";var a=r(58);var i=a["a"].extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var e=this.projectionMatrix.array;this.left=(-1-e[12])/e[0];this.right=(1-e[12])/e[0];this.top=(1-e[13])/e[5];this.bottom=(-1-e[13])/e[5];this.near=-(-1-e[14])/e[10];this.far=-(1-e[14])/e[10]},clone:function(){var e=a["a"].prototype.clone.call(this);e.left=this.left;e.right=this.right;e.near=this.near;e.far=this.far;e.top=this.top;e.bottom=this.bottom;return e}});t["a"]=i},function(e,t,r){"use strict";t["a"]={convertToDynamicArray:function(e){if(e){this.resetOffset()}var t=this.attributes;for(var r in t){if(e||!t[r].value){t[r].value=[]}else{t[r].value=Array.prototype.slice.call(t[r].value)}}if(e||!this.indices){this.indices=[]}else{this.indices=Array.prototype.slice.call(this.indices)}},convertToTypedArray:function(){var e=this.attributes;for(var t in e){if(e[t].value&&e[t].value.length>0){e[t].value=new Float32Array(e[t].value)}else{e[t].value=null}}if(this.indices&&this.indices.length>0){this.indices=this.vertexCount>65535?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.dirty()}}},function(e,t,r){"use strict";var a=r(0);var f=r.n(a);function c(i,n){var o=[];f.a.util.each(i.dimensions,function(e){var t=i.getDimensionInfo(e);var r=t.otherDims;var a=r[n];if(a!=null&&a!==false){o[a]=t.name}});return o}t["a"]=function(e,a,s){function t(e){var n=true;var o=[];var t=c(u,"tooltip");t.length?f.a.util.each(t,function(e){r(u.get(e,a),e)}):f.a.util.each(e,r);function r(e,t){var r=u.getDimensionInfo(t);if(!r||r.otherDims.tooltip===false){return}var a=r.type;var i=(n?"- "+(r.tooltipName||r.name)+": ":"")+(a==="ordinal"?e+"":a==="time"?s?"":f.a.format.formatTime("yyyy/MM/dd hh:mm:ss",e):f.a.format.addCommas(e));i&&o.push(f.a.format.encodeHTML(i))}return(n?"<br/>":"")+o.join(n?"<br/>":", ")}var u=e.getData();var r=e.getRawValue(a);var i=f.a.util.isArray(r)?t(r):f.a.format.encodeHTML(f.a.format.addCommas(r));var n=u.getName(a);var o=u.getItemVisual(a,"color");if(f.a.util.isObject(o)&&o.colorStops){o=(o.colorStops[0]||{}).color}o=o||"transparent";var l=f.a.format.getTooltipMarker(o);var h=e.name;if(h==="\0-"){h=""}h=h?f.a.format.encodeHTML(h)+(!s?"<br/>":": "):"";return!s?h+l+(n?f.a.format.encodeHTML(n)+": "+i:i):l+h+i}},function(e,t,r){"use strict";var a=r(72);var i=r(11);var n=a["a"].extend({skeleton:null,joints:null,useSkinMatricesTexture:false},function(){if(!this.joints){this.joints=[]}},{isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&this.joints.length>0)},clone:function(){var e=a["a"].prototype.clone.call(this);e.skeleton=this.skeleton;if(this.joints){e.joints=this.joints.slice()}return e}});n.POINTS=i["a"].POINTS;n.LINES=i["a"].LINES;n.LINE_LOOP=i["a"].LINE_LOOP;n.LINE_STRIP=i["a"].LINE_STRIP;n.TRIANGLES=i["a"].TRIANGLES;n.TRIANGLE_STRIP=i["a"].TRIANGLE_STRIP;n.TRIANGLE_FAN=i["a"].TRIANGLE_FAN;n.BACK=i["a"].BACK;n.FRONT=i["a"].FRONT;n.FRONT_AND_BACK=i["a"].FRONT_AND_BACK;n.CW=i["a"].CW;n.CCW=i["a"].CCW;t["a"]=n},function(e,t,r){"use strict";var a=r(58);var i=a["a"].extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var e=this.fov/180*Math.PI;this.projectionMatrix.perspective(e,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var e=this.projectionMatrix.array;var t=Math.atan(1/e[5])*2;this.fov=t/Math.PI*180;this.aspect=e[5]/e[0];this.near=e[14]/(e[10]-1);this.far=e[14]/(e[10]+1)},clone:function(){var e=a["a"].prototype.clone.call(this);e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;return e}});t["a"]=i},function(e,t,r){"use strict";var a=r(40);var i=r(76);var n=r(8);var o=r(19);var s=r(4);var u=r(121);n["a"].import(u["a"]);var l=a["a"].extend(function(){var e=new n["a"]({vertex:n["a"].source("clay.skybox.vertex"),fragment:n["a"].source("clay.skybox.fragment")});var t=new o["a"]({shader:e,depthMask:false});return{scene:null,geometry:new i["a"],material:t,environmentMap:null,culling:false}},function(){var e=this.scene;if(e){this.attachScene(e)}if(this.environmentMap){this.setEnvironmentMap(this.environmentMap)}},{attachScene:function(e){if(this.scene){this.detachScene()}e.skybox=this;this.scene=e;e.on("beforerender",this._beforeRenderScene,this)},detachScene:function(){if(this.scene){this.scene.off("beforerender",this._beforeRenderScene);this.scene.skybox=null}this.scene=null},dispose:function(e){this.detachScene();this.geometry.dispose(e)},setEnvironmentMap:function(e){if(e.textureType==="texture2D"){this.material.define("EQUIRECTANGULAR");e.minFilter=s["a"].LINEAR}else{this.material.undefine("EQUIRECTANGULAR")}this.material.set("environmentMap",e)},getEnvironmentMap:function(){return this.material.get("environmentMap")},_beforeRenderScene:function(e,t,r){this.renderSkybox(e,r)},renderSkybox:function(e,t){this.position.copy(t.getWorldPosition());this.update();e.gl.disable(e.gl.BLEND);if(this.material.get("lod")>0){this.material.define("fragment","LOD")}else{this.material.undefine("fragment","LOD")}e.renderPass([this],t)}});t["a"]=l},function(e,t,r){"use strict";var a=r(15);var c=r(18);var i=a["a"].extend({dynamic:false,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){var e=this.heightSegments;var t=this.widthSegments;var r=this.attributes;var a=[];var i=[];var n=[];var o=[];for(var s=0;s<=e;s++){var u=s/e;for(var l=0;l<=t;l++){var h=l/t;a.push([2*h-1,2*u-1,0]);if(i){i.push([h,u])}if(n){n.push([0,0,1])}if(l<t&&s<e){var f=l+s*(t+1);o.push([f,f+1,f+t+1]);o.push([f+t+1,f+1,f+t+2])}}}r.position.fromArray(a);r.texcoord0.fromArray(i);r.normal.fromArray(n);this.initIndicesFromArray(o);this.boundingBox=new c["a"];this.boundingBox.min.set(-1,-1,0);this.boundingBox.max.set(1,1,0)}});t["a"]=i},function(e,t,r){"use strict";t["a"]={defaultOption:{viewControl:{projection:"perspective",autoRotate:false,autoRotateDirection:"cw",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(e){e=e||{};this.option.viewControl=this.option.viewControl||{};if(e.alpha!=null){this.option.viewControl.alpha=e.alpha}if(e.beta!=null){this.option.viewControl.beta=e.beta}if(e.distance!=null){this.option.viewControl.distance=e.distance}if(e.center!=null){this.option.viewControl.center=e.center}}}},function(e,t,r){"use strict";var a=r(7);var i=r(26);var n=r(3);var o=r(56);var s=r(2);var c=s["a"].firstNotNull;var u={left:0,middle:1,right:2};function l(e){if(!(e instanceof Array)){e=[e,e]}return e}var h=a["a"].extend(function(){return{zr:null,viewGL:null,_center:new n["a"],minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-Infinity,maxBeta:Infinity,autoRotateAfterStill:0,autoRotateDirection:"cw",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",_mode:"rotate",_camera:null,_needsUpdate:false,_rotating:false,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new i["a"],_panVelocity:new i["a"],_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}},function(){["_mouseDownHandler","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_pinchHandler","_contextMenuHandler","_update"].forEach(function(e){this[e]=this[e].bind(this)},this)},{init:function(){var e=this.zr;if(e){e.on("mousedown",this._mouseDownHandler);e.on("globalout",this._mouseUpHandler);e.on("mousewheel",this._mouseWheelHandler);e.on("pinch",this._pinchHandler);e.animation.on("frame",this._update);e.dom.addEventListener("contextmenu",this._contextMenuHandler)}},dispose:function(){var e=this.zr;if(e){e.off("mousedown",this._mouseDownHandler);e.off("mousemove",this._mouseMoveHandler);e.off("mouseup",this._mouseUpHandler);e.off("mousewheel",this._mouseWheelHandler);e.off("pinch",this._pinchHandler);e.off("globalout",this._mouseUpHandler);e.dom.removeEventListener("contextmenu",this._contextMenuHandler);e.animation.off("frame",this._update)}this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(e){this._distance=e;this._needsUpdate=true},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(e){this._orthoSize=e;this._needsUpdate=true},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(e){e=Math.max(Math.min(this.maxAlpha,e),this.minAlpha);this._theta=e/180*Math.PI;this._needsUpdate=true},setBeta:function(e){e=Math.max(Math.min(this.maxBeta,e),this.minBeta);this._phi=-e/180*Math.PI;this._needsUpdate=true},setCenter:function(e){this._center.setArray(e)},setViewGL:function(e){this.viewGL=e},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(t,e){e=e||{};var r=e.baseDistance||0;var a=e.baseOrthoSize||1;var i=t.get("projection");if(i!=="perspective"&&i!=="orthographic"&&i!=="isometric"){if(true){console.error("Unkown projection type %s, use perspective projection instead.",i)}i="perspective"}this._projection=i;this.viewGL.setProjection(i);var n=t.get("distance")+r;var o=t.get("orthographicSize")+a;[["damping",.8],["autoRotate",false],["autoRotateAfterStill",3],["autoRotateDirection","cw"],["autoRotateSpeed",10],["minDistance",30],["maxDistance",400],["minOrthographicSize",30],["maxOrthographicSize",300],["minAlpha",-90],["maxAlpha",90],["minBeta",-Infinity],["maxBeta",Infinity],["rotateSensitivity",1],["zoomSensitivity",1],["panSensitivity",1],["panMouseButton","left"],["rotateMouseButton","middle"]].forEach(function(e){this[e[0]]=c(t.get(e[0]),e[1])},this);this.minDistance+=r;this.maxDistance+=r;this.minOrthographicSize+=a,this.maxOrthographicSize+=a;var s=t.ecModel;var u={};["animation","animationDurationUpdate","animationEasingUpdate"].forEach(function(e){u[e]=c(t.get(e),s&&s.get(e))});var l=c(e.alpha,t.get("alpha"))||0;var h=c(e.beta,t.get("beta"))||0;var f=c(e.center,t.get("center"))||[0,0,0];if(u.animation&&u.animationDurationUpdate>0&&this._notFirst){this.animateTo({alpha:l,beta:h,center:f,distance:n,targetOrthographicSize:o,easing:u.animationEasingUpdate,duration:u.animationDurationUpdate})}else{this.setDistance(n);this.setAlpha(l);this.setBeta(h);this.setCenter(f);this.setOrthographicSize(o)}this._notFirst=true;this._validateProperties()},_validateProperties:function(){if(true){if(u[this.panMouseButton]==null){console.error("Unkown panMouseButton %s. It should be left|middle|right",this.panMouseButton)}if(u[this.rotateMouseButton]==null){console.error("Unkown rotateMouseButton %s. It should be left|middle|right",this.rotateMouseButton)}if(this.autoRotateDirection!=="cw"&&this.autoRotateDirection!=="ccw"){console.error("Unkown autoRotateDirection %s. It should be cw|ccw",this.autoRotateDirection)}}},animateTo:function(e){var t=this.zr;var r=this;var a={};var i={};if(e.distance!=null){a.distance=this.getDistance();i.distance=e.distance}if(e.orthographicSize!=null){a.orthographicSize=this.getOrthographicSize();i.orthographicSize=e.orthographicSize}if(e.alpha!=null){a.alpha=this.getAlpha();i.alpha=e.alpha}if(e.beta!=null){a.beta=this.getBeta();i.beta=e.beta}if(e.center!=null){a.center=this.getCenter();i.center=e.center}return this._addAnimator(t.animation.animate(a).when(e.duration||1e3,i).during(function(){if(a.alpha!=null){r.setAlpha(a.alpha)}if(a.beta!=null){r.setBeta(a.beta)}if(a.distance!=null){r.setDistance(a.distance)}if(a.center!=null){r.setCenter(a.center)}if(a.orthographicSize!=null){r.setOrthographicSize(a.orthographicSize)}r._needsUpdate=true})).start(e.easing||"linear")},stopAllAnimation:function(){for(var e=0;e<this._animators.length;e++){this._animators[e].stop()}this._animators.length=0},update:function(){this._needsUpdate=true;this._update(20)},_isAnimating:function(){return this._animators.length>0},_update:function(e){if(this._rotating){var t=(this.autoRotateDirection==="cw"?1:-1)*this.autoRotateSpeed/180*Math.PI;this._phi-=t*e/1e3;this._needsUpdate=true}else if(this._rotateVelocity.len()>0){this._needsUpdate=true}if(Math.abs(this._zoomSpeed)>.1||this._panVelocity.len()>0){this._needsUpdate=true}if(!this._needsUpdate){return}e=Math.min(e,50);this._updateDistanceOrSize(e);this._updatePan(e);this._updateRotate(e);this._updateTransform();this.getCamera().update();this.zr&&this.zr.refresh();this.trigger("update");this._needsUpdate=false},_updateRotate:function(e){var t=this._rotateVelocity;this._phi=t.y*e/20+this._phi;this._theta=t.x*e/20+this._theta;this.setAlpha(this.getAlpha());this.setBeta(this.getBeta());this._vectorDamping(t,Math.pow(this.damping,e/16))},_updateDistanceOrSize:function(e){if(this._projection==="perspective"){this._setDistance(this._distance+this._zoomSpeed*e/20)}else{this._setOrthoSize(this._orthoSize+this._zoomSpeed*e/20)}this._zoomSpeed*=Math.pow(this.damping,e/16)},_setDistance:function(e){this._distance=Math.max(Math.min(e,this.maxDistance),this.minDistance)},_setOrthoSize:function(e){this._orthoSize=Math.max(Math.min(e,this.maxOrthographicSize),this.minOrthographicSize);var t=this.getCamera();var r=this._orthoSize;var a=r/this.viewGL.viewport.height*this.viewGL.viewport.width;t.left=-a/2;t.right=a/2;t.top=r/2;t.bottom=-r/2},_updatePan:function(e){var t=this._panVelocity;var r=this._distance;var a=this.getCamera();var i=a.worldTransform.y;var n=a.worldTransform.x;this._center.scaleAndAdd(n,-t.x*r/200).scaleAndAdd(i,-t.y*r/200);this._vectorDamping(t,0)},_updateTransform:function(){var e=this.getCamera();var t=new n["a"];var r=this._theta+Math.PI/2;var a=this._phi+Math.PI/2;var i=Math.sin(r);t.x=i*Math.cos(a);t.y=-Math.cos(r);t.z=i*Math.sin(a);e.position.copy(this._center).scaleAndAdd(t,this._distance);e.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var e=this.autoRotateAfterStill;var t=this;if(!isNaN(e)&&e>0){this._stillTimeout=setTimeout(function(){t._rotating=true},e*1e3)}},_vectorDamping:function(e,t){var r=e.len();r=r*t;if(r<1e-4){r=0}e.normalize().scale(r)},_decomposeTransform:function(){if(!this.getCamera()){return}this.getCamera().updateWorldTransform();var e=this.getCamera().worldTransform.z;var t=Math.asin(e.y);var r=Math.atan2(e.x,e.z);this._theta=t;this._phi=-r;this.setBeta(this.getBeta());this.setAlpha(this.getAlpha());if(this.getCamera().aspect){this._setDistance(this.getCamera().position.dist(this._center))}else{this._setOrthoSize(this.getCamera().top-this.getCamera().bottom)}},_mouseDownHandler:function(e){if(e.target){return}if(this._isAnimating()){return}var t=e.offsetX;var r=e.offsetY;if(this.viewGL&&!this.viewGL.containPoint(t,r)){return}this.zr.on("mousemove",this._mouseMoveHandler);this.zr.on("mouseup",this._mouseUpHandler);if(e.event.targetTouches){if(e.event.targetTouches.length===1){this._mode="rotate"}}else{if(e.event.button===u[this.rotateMouseButton]){this._mode="rotate"}else if(e.event.button===u[this.panMouseButton]){this._mode="pan"}else{this._mode=""}}this._rotateVelocity.set(0,0);this._rotating=false;if(this.autoRotate){this._startCountingStill()}this._mouseX=e.offsetX;this._mouseY=e.offsetY},_mouseMoveHandler:function(e){if(e.target&&e.target.__isGLToZRProxy){return}if(this._isAnimating()){return}var t=l(this.panSensitivity);var r=l(this.rotateSensitivity);if(this._mode==="rotate"){this._rotateVelocity.y=(e.offsetX-this._mouseX)/this.zr.getHeight()*2*r[0];this._rotateVelocity.x=(e.offsetY-this._mouseY)/this.zr.getWidth()*2*r[1]}else if(this._mode==="pan"){this._panVelocity.x=(e.offsetX-this._mouseX)/this.zr.getWidth()*t[0]*400;this._panVelocity.y=(-e.offsetY+this._mouseY)/this.zr.getHeight()*t[1]*400}this._mouseX=e.offsetX;this._mouseY=e.offsetY;e.event.preventDefault()},_mouseWheelHandler:function(e){if(this._isAnimating()){return}var t=e.event.wheelDelta||-e.event.detail;this._zoomHandler(e,t)},_pinchHandler:function(e){if(this._isAnimating()){return}this._zoomHandler(e,e.pinchScale>1?1:-1);this._mode=""},_zoomHandler:function(e,t){if(t===0){return}var r=e.offsetX;var a=e.offsetY;if(this.viewGL&&!this.viewGL.containPoint(r,a)){return}var i;if(this._projection==="perspective"){i=Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5)}else{i=Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5)}this._zoomSpeed=(t>0?-1:1)*i*this.zoomSensitivity;this._rotating=false;if(this.autoRotate&&this._mode==="rotate"){this._startCountingStill()}e.event.preventDefault()},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler);this.zr.off("mouseup",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return this.rotateMouseButton==="right"||this.panMouseButton==="right"},_contextMenuHandler:function(e){if(this._isRightMouseButtonUsed()){e.preventDefault()}},_addAnimator:function(t){var r=this._animators;r.push(t);t.done(function(){var e=r.indexOf(t);if(e>=0){r.splice(e,1)}});return t}});Object.defineProperty(h.prototype,"autoRotate",{get:function(e){return this._autoRotate},set:function(e){this._autoRotate=e;this._rotating=e}});t["a"]=h},function(e,t,r){"use strict";t["a"]="@export ecgl.lines3D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, 1.0);\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n}\n@end\n\n\n\n@export ecgl.lines3D.clipNear\n\nvec4 clipNear(vec4 p1, vec4 p2) {\n float n = (p1.w - near) / (p1.w - p2.w);\n return vec4(mix(p1.xy, p2.xy, n), -near, near);\n}\n\n@end\n\n@export ecgl.lines3D.expandLine\n#ifdef VERTEX_ANIMATION\n vec4 prevProj = worldViewProjection * vec4(mix(prevPositionPrev, positionPrev, percent), 1.0);\n vec4 currProj = worldViewProjection * vec4(mix(prevPosition, position, percent), 1.0);\n vec4 nextProj = worldViewProjection * vec4(mix(prevPositionNext, positionNext, percent), 1.0);\n#else\n vec4 prevProj = worldViewProjection * vec4(positionPrev, 1.0);\n vec4 currProj = worldViewProjection * vec4(position, 1.0);\n vec4 nextProj = worldViewProjection * vec4(positionNext, 1.0);\n#endif\n\n if (currProj.w < 0.0) {\n if (nextProj.w > 0.0) {\n currProj = clipNear(currProj, nextProj);\n }\n else if (prevProj.w > 0.0) {\n currProj = clipNear(currProj, prevProj);\n }\n }\n\n vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;\n\n vec2 dir;\n float len = offset;\n if (position == positionPrev) {\n dir = normalize(nextScreen - currScreen);\n }\n else if (position == positionNext) {\n dir = normalize(currScreen - prevScreen);\n }\n else {\n vec2 dirA = normalize(currScreen - prevScreen);\n vec2 dirB = normalize(nextScreen - currScreen);\n\n vec2 tanget = normalize(dirA + dirB);\n\n float miter = 1.0 / max(dot(tanget, dirA), 0.5);\n len *= miter;\n dir = tanget;\n }\n\n dir = vec2(-dir.y, dir.x) * len;\n currScreen += dir;\n\n currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);\n@end\n\n\n@export ecgl.meshLines3D.vertex\n\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevPositionPrev;\nattribute vec3 prevPositionNext;\nuniform float percent : 1.0;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n}\n@end\n\n\n@export ecgl.meshLines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(e,t,r){var v=r(13);var p=r(82);var a=r(85);var m=a.parsePercent;var g=r(171);var _=v.each;var i=["left","right","top","bottom","width","height"];var n=[["width","left","right"],["height","top","bottom"]];function o(h,f,c,d,v){var p=0;var m=0;if(d==null){d=Infinity}if(v==null){v=Infinity}var g=0;f.eachChild(function(e,t){var r=e.position;var a=e.getBoundingRect();var i=f.childAt(t+1);var n=i&&i.getBoundingRect();var o;var s;if(h==="horizontal"){var u=a.width+(n?-n.x+a.x:0);o=p+u;if(o>d||e.newline){p=0;o=u;m+=g+c;g=a.height}else{g=Math.max(g,a.height)}}else{var l=a.height+(n?-n.y+a.y:0);s=m+l;if(s>v||e.newline){p+=g+c;m=0;s=l;g=a.width}else{g=Math.max(g,a.width)}}if(e.newline){return}r[0]=p;r[1]=m;h==="horizontal"?p=o+c:m=s+c})}var s=o;var u=v.curry(o,"vertical");var l=v.curry(o,"horizontal");function h(e,t,r){var a=t.width;var i=t.height;var n=m(e.x,a);var o=m(e.y,i);var s=m(e.x2,a);var u=m(e.y2,i);(isNaN(n)||isNaN(parseFloat(e.x)))&&(n=0);(isNaN(s)||isNaN(parseFloat(e.x2)))&&(s=a);(isNaN(o)||isNaN(parseFloat(e.y)))&&(o=0);(isNaN(u)||isNaN(parseFloat(e.y2)))&&(u=i);r=g.normalizeCssArray(r||0);return{width:Math.max(s-n-r[1]-r[3],0),height:Math.max(u-o-r[0]-r[2],0)}}function d(e,t,r){r=g.normalizeCssArray(r||0);var a=t.width;var i=t.height;var n=m(e.left,a);var o=m(e.top,i);var s=m(e.right,a);var u=m(e.bottom,i);var l=m(e.width,a);var h=m(e.height,i);var f=r[2]+r[0];var c=r[1]+r[3];var d=e.aspect;if(isNaN(l)){l=a-s-c-n}if(isNaN(h)){h=i-u-f-o}if(d!=null){if(isNaN(l)&&isNaN(h)){if(d>a/i){l=a*.8}else{h=i*.8}}if(isNaN(l)){l=d*h}if(isNaN(h)){h=l/d}}if(isNaN(n)){n=a-s-l-c}if(isNaN(o)){o=i-u-h-f}switch(e.left||e.right){case"center":n=a/2-l/2-r[3];break;case"right":n=a-l-c;break}switch(e.top||e.bottom){case"middle":case"center":o=i/2-h/2-r[0];break;case"bottom":o=i-h-f;break}n=n||0;o=o||0;if(isNaN(l)){l=a-c-n-(s||0)}if(isNaN(h)){h=i-f-o-(u||0)}var v=new p(n+r[3],o+r[0],l,h);v.margin=r;return v}function f(e,t,r,a,i){var n=!i||!i.hv||i.hv[0];var o=!i||!i.hv||i.hv[1];var s=i&&i.boundingMode||"all";if(!n&&!o){return}var u;if(s==="raw"){u=e.type==="group"?new p(0,0,+t.width||0,+t.height||0):e.getBoundingRect()}else{u=e.getBoundingRect();if(e.needLocalTransform()){var l=e.getLocalTransform();u=u.clone();u.applyTransform(l)}}t=d(v.defaults({width:u.width,height:u.height},t),r,a);var h=e.position;var f=n?t.x-u.x:0;var c=o?t.y-u.y:0;e.attr("position",s==="raw"?[f,c]:[h[0]+f,h[1]+c])}function c(e,t){return e[n[t][0]]!=null||e[n[t][1]]!=null&&e[n[t][2]]!=null}function y(l,h,e){!v.isObject(e)&&(e={});var f=e.ignoreSize;!v.isArray(f)&&(f=[f,f]);var t=a(n[0],0);var r=a(n[1],1);i(n[0],l,t);i(n[1],l,r);function a(e,t){var r={};var a=0;var i={};var n=0;var o=2;_(e,function(e){i[e]=l[e]});_(e,function(e){c(h,e)&&(r[e]=i[e]=h[e]);d(r,e)&&a++;d(i,e)&&n++});if(f[t]){if(d(h,e[1])){i[e[2]]=null}else if(d(h,e[2])){i[e[1]]=null}return i}if(n===o||!a){return i}else if(a>=o){return r}else{for(var s=0;s<e.length;s++){var u=e[s];if(!c(r,u)&&c(l,u)){r[u]=l[u];break}}return r}}function c(e,t){return e.hasOwnProperty(t)}function d(e,t){return e[t]!=null&&e[t]!=="auto"}function i(e,t,r){_(e,function(e){t[e]=r[e]})}}function x(e){return T({},e)}function T(t,r){r&&t&&_(i,function(e){r.hasOwnProperty(e)&&(t[e]=r[e])});return t}t.LOCATION_PARAMS=i;t.HV_NAMES=n;t.box=s;t.vbox=u;t.hbox=l;t.getAvailableSize=h;t.getLayoutRect=d;t.positionElement=f;t.sizeCalculable=c;t.mergeLayoutParam=y;t.getLayoutParams=x;t.copyLayoutParams=T},function(e,t,r){"use strict";var a=r(7);var i=a["a"].extend(function(){return{name:"",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:false,_rendered:false,_compositor:null}},{updateParameter:function(e,t){var r=this.outputs[e];var a=r.parameters;var i=r._parametersCopy;if(!i){i=r._parametersCopy={}}if(a){for(var n in a){if(n!=="width"&&n!=="height"){i[n]=a[n]}}}var o,s;if(a.width instanceof Function){o=a.width.call(this,t)}else{o=a.width}if(a.height instanceof Function){s=a.height.call(this,t)}else{s=a.height}if(i.width!==o||i.height!==s){if(this._outputTextures[e]){this._outputTextures[e].dispose(t.gl)}}i.width=o;i.height=s;return i},setParameter:function(e,t){},getParameter:function(e){},setParameters:function(e){for(var t in e){this.setParameter(t,e[t])}},render:function(){},getOutput:function(e,t){if(t==null){t=e;return this._outputTextures[t]}var r=this.outputs[t];if(!r){return}if(this._rendered){if(r.outputLastFrame){return this._prevOutputTextures[t]}else{return this._outputTextures[t]}}else if(this._rendering){if(!this._prevOutputTextures[t]){this._prevOutputTextures[t]=this._compositor.allocateTexture(r.parameters||{})}return this._prevOutputTextures[t]}this.render(e);return this._outputTextures[t]},removeReference:function(e){this._outputReferences[e]--;if(this._outputReferences[e]===0){var t=this.outputs[e];if(t.keepLastFrame){if(this._prevOutputTextures[e]){this._compositor.releaseTexture(this._prevOutputTextures[e])}this._prevOutputTextures[e]=this._outputTextures[e]}else{this._compositor.releaseTexture(this._outputTextures[e])}}},link:function(e,t,r){this.inputLinks[e]={node:t,pin:r};if(!t.outputLinks[r]){t.outputLinks[r]=[]}t.outputLinks[r].push({node:this,pin:e});this.pass.material.enableTexture(e)},clear:function(){this.inputLinks={};this.outputLinks={}},updateReference:function(e){if(!this._rendering){this._rendering=true;for(var t in this.inputLinks){var r=this.inputLinks[t];r.node.updateReference(r.pin)}this._rendering=false}if(e){this._outputReferences[e]++}},beforeFrame:function(){this._rendered=false;for(var e in this.outputLinks){this._outputReferences[e]=0}},afterFrame:function(){for(var e in this.outputLinks){if(this._outputReferences[e]>0){var t=this.outputs[e];if(t.keepLastFrame){if(this._prevOutputTextures[e]){this._compositor.releaseTexture(this._prevOutputTextures[e])}this._prevOutputTextures[e]=this._outputTextures[e]}else{this._compositor.releaseTexture(this._outputTextures[e])}}}}});t["a"]=i},function(e,t,r){"use strict";function a(e,t){var r=0;var a=1/t;var i=e;while(i>0){r=r+a*(i%t);i=Math.floor(i/t);a=a/t}return r}t["a"]=a},function(e,t,r){"use strict";var a=r(0);var s=r.n(a);t["a"]=function(r,e,t){t=t||r.getSource();var a=e||s.a.getCoordinateSystemDimensions(r.get("coordinateSystem"))||["x","y","z"];var i=s.a.helper.createDimensions(t,{dimensionsDefine:t.dimensionsDefine||r.get("dimensions"),encodeDefine:t.encodeDefine||r.get("encode"),coordDimensions:a.map(function(e){var t=r.getReferringComponents(e+"Axis3D")[0];return{type:t&&t.get("type")==="category"?"ordinal":"float",name:e}})});if(r.get("coordinateSystem")==="cartesian3D"){i.forEach(function(e){if(a.indexOf(e.coordDim)>=0){var t=r.getReferringComponents(e.coordDim+"Axis3D")[0];if(t&&t.get("type")==="category"){e.ordinalMeta=t.getOrdinalMeta()}}})}var n=s.a.helper.dataStack.enableDataStack(r,i,{byIndex:true,stackedCoordDimension:"z"});var o=new s.a.List(i,r);o.setCalculationInfo(n);o.initData(t);return o}},function(e,t){function r(e,s,h){return{seriesType:e,performRawSeries:true,reset:function(u,e,t){var r=u.getData();var a=u.get("symbol")||s;var l=u.get("symbolSize");var i=u.get("symbolKeepAspect");r.setVisual({legendSymbol:h||a,symbol:a,symbolSize:l,symbolKeepAspect:i});if(e.isSeriesFiltered(u)){return}var n=typeof l==="function";function o(e,t){if(typeof l==="function"){var r=u.getRawValue(t);var a=u.getDataParams(t);e.setItemVisual(t,"symbolSize",l(r,a))}if(e.hasItemOption){var i=e.getItemModel(t);var n=i.getShallow("symbol",true);var o=i.getShallow("symbolSize",true);var s=i.getShallow("symbolKeepAspect",true);if(n!=null){e.setItemVisual(t,"symbol",n)}if(o!=null){e.setItemVisual(t,"symbolSize",o)}if(s!=null){e.setItemVisual(t,"symbolKeepAspect",s)}}}return{dataEach:r.hasItemOption||n?o:null}}}}e.exports=r},function(e,t,r){"use strict";var a=r(7);var i=r(111);var n=r(11);var o=r(14);var s=r(19);var u=r(26);var l=r(115);var h=r(8);var f=r(71);var k=r(21);var g=r(12);h["a"]["import"](f["a"]);var _=k["a"].create;var c={};function W(e){return e.material}function j(e,t,r){return t.uniforms[r].value}function X(e,t,r,a){return r!==a}function q(e){return true}function Z(){}var A={float:n["a"].FLOAT,byte:n["a"].BYTE,ubyte:n["a"].UNSIGNED_BYTE,short:n["a"].SHORT,ushort:n["a"].UNSIGNED_SHORT};function M(e,t,r){this.availableAttributes=e;this.availableAttributeSymbols=t;this.indicesBuffer=r;this.vao=null}function d(e){var a;var i;this.bind=function(e){if(!a){a=o["a"].createCanvas();a.width=a.height=1;a.getContext("2d")}var t=e.gl;var r=!i;if(r){i=t.createTexture()}t.bindTexture(t.TEXTURE_2D,i);if(r){t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a)}};this.unbind=function(e){e.gl.bindTexture(e.gl.TEXTURE_2D,null)};this.isRenderable=function(){return true}}var v=a["a"].extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:typeof window!=="undefined"&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:true,depth:true,stencil:false,antialias:true,premultipliedAlpha:true,preserveDrawingBuffer:false,throwError:true,gl:null,viewport:{},__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){if(!this.canvas){this.canvas=o["a"].createCanvas()}var e=this.canvas;try{var t={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};this.gl=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!this.gl){throw new Error}this._glinfo=new i["a"](this.gl);if(this.gl.targetRenderer){console.error("Already created a renderer")}this.gl.targetRenderer=this;this.resize()}catch(e){throw"Error creating WebGL Context "+e}this._programMgr=new l["a"](this);this._placeholderTexture=new d(this)},{resize:function(e,t){var r=this.canvas;var a=this.devicePixelRatio;if(e!=null){r.style.width=e+"px";r.style.height=t+"px";r.width=e*a;r.height=t*a;this._width=e;this._height=t}else{this._width=r.width/a;this._height=r.height/a}this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var e=this.viewport;return e.width/e.height},setDevicePixelRatio:function(e){this.devicePixelRatio=e;this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(e){return this._glinfo.getExtension(e)},getGLParameter:function(e){return this._glinfo.getParameter(e)},setViewport:function(e,t,r,a,i){if(typeof e==="object"){var n=e;e=n.x;t=n.y;r=n.width;a=n.height;i=n.devicePixelRatio}i=i||this.devicePixelRatio;this.gl.viewport(e*i,t*i,r*i,a*i);this.viewport={x:e,y:t,width:r,height:a,devicePixelRatio:i}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){if(this._viewportStack.length>0){this.setViewport(this._viewportStack.pop())}},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){if(this._clearStack.length>0){var e=this._clearStack.pop();this.clearColor=e.clearColor;this.clearBit=e.clearBit}},bindSceneRendering:function(e){this._sceneRendering=e},render:function(e,t,r,a){var i=this.gl;var n=this.clearColor;if(this.clearBit){i.colorMask(true,true,true,true);i.depthMask(true);var o=this.viewport;var s=false;var u=o.devicePixelRatio;if(o.width!==this._width||o.height!==this._height||u&&u!==this.devicePixelRatio||o.x||o.y){s=true;i.enable(i.SCISSOR_TEST);i.scissor(o.x*u,o.y*u,o.width*u,o.height*u)}i.clearColor(n[0],n[1],n[2],n[3]);i.clear(this.clearBit);if(s){i.disable(i.SCISSOR_TEST)}}if(!r){e.update(false)}e.updateLights();t=t||e.getMainCamera();if(!t){console.error("Can't find camera in the scene.");return}t.update();var l=e.updateRenderList(t,true);this._sceneRendering=e;var h=l.opaque;var f=l.transparent;var c=e.material;e.trigger("beforerender",this,e,t,l);if(a){this.renderPreZ(h,e,t);i.depthFunc(i.LEQUAL)}else{i.depthFunc(i.LESS)}var d=_();var v=g["a"].create();for(var p=0;p<f.length;p++){var m=f[p];k["a"].multiplyAffine(d,t.viewMatrix.array,m.worldTransform.array);g["a"].transformMat4(v,m.position.array,d);m.__depth=v[2]}this.renderPass(h,t,{getMaterial:function(e){return c||e.material},sortCompare:this.opaqueSortCompare});this.renderPass(f,t,{getMaterial:function(e){return c||e.material},sortCompare:this.transparentSortCompare});e.trigger("afterrender",this,e,t,l);this._sceneRendering=null},getProgram:function(e,t,r){t=t||e.material;return this._programMgr.getProgram(e,t,r)},validateProgram:function(e){if(e.__error){var t=e.__error;if(c[e.__uid__]){return}c[e.__uid__]=true;if(this.throwError){throw new Error(t)}else{this.trigger("error",t)}}},updatePrograms:function(e,t,r){var a=r&&r.getMaterial||W;t=t||null;for(var i=0;i<e.length;i++){var n=e[i];var o=a.call(this,n);if(i>0){var s=e[i-1];var u=s.joints?s.joints.length:0;var l=n.joints?n.joints.length:0;if(l===u&&n.material===s.material&&n.lightGroup===s.lightGroup){n.__program=s.__program;continue}}var h=this._programMgr.getProgram(n,o,t);this.validateProgram(h);n.__program=h}},renderPass:function(e,t,r){this.trigger("beforerenderpass",this,e,t,r);r=r||{};r.getMaterial=r.getMaterial||W;r.getUniform=r.getUniform||j;r.isMaterialChanged=r.isMaterialChanged||X;r.beforeRender=r.beforeRender||Z;r.afterRender=r.afterRender||Z;var a=r.ifRender||q;this.updatePrograms(e,this._sceneRendering,r);if(r.sortCompare){e.sort(r.sortCompare)}var i=this.viewport;var n=i.devicePixelRatio;var o=[i.x*n,i.y*n,i.width*n,i.height*n];var s=this.devicePixelRatio;var u=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*s,this._height*s];var l=[o[2],o[3]];var h=Date.now();if(t){k["a"].copy(Y.VIEW,t.viewMatrix.array);k["a"].copy(Y.PROJECTION,t.projectionMatrix.array);k["a"].copy(Y.VIEWINVERSE,t.worldTransform.array)}else{k["a"].identity(Y.VIEW);k["a"].identity(Y.PROJECTION);k["a"].identity(Y.VIEWINVERSE)}k["a"].multiply(Y.VIEWPROJECTION,Y.PROJECTION,Y.VIEW);k["a"].invert(Y.PROJECTIONINVERSE,Y.PROJECTION);k["a"].invert(Y.VIEWPROJECTIONINVERSE,Y.VIEWPROJECTION);var f=this.gl;var c=this._sceneRendering;var d;var v;var p;var m,g;var _,y,x;var T;var b;var w;var E;var S=this.getGLExtension("OES_vertex_array_object");for(var A=0;A<e.length;A++){var M=e[A];var C=M.worldTransform!=null;var L;if(!a(M)){continue}if(C){L=M.isSkinnedMesh&&M.isSkinnedMesh()?Y.IDENTITY:M.worldTransform.array}var D=M.geometry;var N=r.getMaterial.call(this,M);var I=M.__program;var R=N.shader;var P=D.__uid__+"-"+I.__uid__;var O=P!==b;b=P;if(O&&S){S.bindVertexArrayOES(null)}if(C){k["a"].copy(Y.WORLD,L);k["a"].multiply(Y.WORLDVIEWPROJECTION,Y.VIEWPROJECTION,L);k["a"].multiplyAffine(Y.WORLDVIEW,Y.VIEW,L);if(R.matrixSemantics.WORLDINVERSE||R.matrixSemantics.WORLDINVERSETRANSPOSE){k["a"].invert(Y.WORLDINVERSE,L)}if(R.matrixSemantics.WORLDVIEWINVERSE||R.matrixSemantics.WORLDVIEWINVERSETRANSPOSE){k["a"].invert(Y.WORLDVIEWINVERSE,Y.WORLDVIEW)}if(R.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||R.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE){k["a"].invert(Y.WORLDVIEWPROJECTIONINVERSE,Y.WORLDVIEWPROJECTION)}}M.beforeRender&&M.beforeRender(this);r.beforeRender.call(this,M,N,d);var F=I!==v;if(F){I.bind(this);I.setUniformOfSemantic(f,"VIEWPORT",o);I.setUniformOfSemantic(f,"WINDOW_SIZE",u);if(t){I.setUniformOfSemantic(f,"NEAR",t.near);I.setUniformOfSemantic(f,"FAR",t.far)}I.setUniformOfSemantic(f,"DEVICEPIXELRATIO",n);I.setUniformOfSemantic(f,"TIME",h);I.setUniformOfSemantic(f,"VIEWPORT_SIZE",l);if(c){c.setLightUniforms(I,M.lightGroup,this)}}else{I=v}if(F||r.isMaterialChanged(M,p,N,d)){if(N.depthTest!==m){N.depthTest?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST);m=N.depthTest}if(N.depthMask!==g){f.depthMask(N.depthMask);g=N.depthMask}if(N.transparent!==T){N.transparent?f.enable(f.BLEND):f.disable(f.BLEND);T=N.transparent}if(N.transparent){if(N.blend){N.blend(f)}else{f.blendEquationSeparate(f.FUNC_ADD,f.FUNC_ADD);f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA)}}E=this._bindMaterial(M,N,I,p||null,d||null,v||null,r.getUniform);d=N}var B=R.matrixSemanticKeys;if(C){for(var U=0;U<B.length;U++){var z=B[U];var G=R.matrixSemantics[z];var H=Y[z];if(G.isTranspose){var V=Y[G.semanticNoTranspose];k["a"].transpose(H,V)}I.setUniform(f,G.type,G.symbol,H)}}if(M.cullFace!==y){y=M.cullFace;f.cullFace(y)}if(M.frontFace!==x){x=M.frontFace;f.frontFace(x)}if(M.culling!==_){_=M.culling;_?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE)}this._updateSkeleton(M,I,E);if(O){w=this._bindVAO(S,R,D,I)}this._renderObject(M,w);r.afterRender(this,M);M.afterRender&&M.afterRender(this);v=I;p=M}if(S){S.bindVertexArrayOES(null)}this.trigger("afterrenderpass",this,e,t,r)},getMaxJointNumber:function(){return this._glinfo.getMaxJointNumber()},_updateSkeleton:function(e,t,r){var a=this.gl;var i=e.skeleton;if(i){i.update();if(e.joints.length>this._glinfo.getMaxJointNumber()){var n=i.getSubSkinMatricesTexture(e.__uid__,e.joints);t.useTextureSlot(this,n,r);t.setUniform(a,"1i","skinMatricesTexture",r);t.setUniform(a,"1f","skinMatricesTextureSize",n.width)}else{var o=i.getSubSkinMatrices(e.__uid__,e.joints);t.setUniformOfSemantic(a,"SKIN_MATRIX",o)}}},_renderObject:function(e,t){var r=this.gl;var a=e.geometry;var i=e.mode;if(i==null){i=4}if(t.indicesBuffer){var n=this.getGLExtension("OES_element_index_uint");var o=n&&a.indices instanceof Uint32Array;var s=o?r.UNSIGNED_INT:r.UNSIGNED_SHORT;r.drawElements(i,t.indicesBuffer.count,s,0)}else{r.drawArrays(i,0,a.vertexCount)}},_bindMaterial:function(e,t,r,a,i,n,o){var s=this.gl;var u=n===r;var l=r.currentTextureSlot();var h=t.getEnabledUniforms();var f=t.getTextureUniforms();var c=this._placeholderTexture;for(var d=0;d<f.length;d++){var v=f[d];var p=o(e,t,v);var m=t.uniforms[v].type;if(m==="t"&&p){p.__slot=-1}else if(m==="tv"){for(var g=0;g<p.length;g++){if(p[g]){p[g].__slot=-1}}}}c.__slot=-1;for(var d=0;d<h.length;d++){var v=h[d];var _=t.uniforms[v];var p=o(e,t,v);var m=_.type;var y=m==="t";if(y){if(!p||!p.isRenderable()){p=c}}if(i&&u){var x=o(a,i,v);if(y){if(!x||!x.isRenderable()){x=c}}if(x===p){if(y){r.takeCurrentTextureSlot(this,null)}else if(m==="tv"&&p){for(var g=0;g<p.length;g++){r.takeCurrentTextureSlot(this,null)}}continue}}if(p==null){continue}else if(y){if(p.__slot<0){var T=r.currentTextureSlot();var b=r.setUniform(s,"1i",v,T);if(b){r.takeCurrentTextureSlot(this,p);p.__slot=T}}else{r.setUniform(s,"1i",v,p.__slot)}}else if(Array.isArray(p)){if(p.length===0){continue}if(m==="tv"){if(!r.hasUniform(v)){continue}var w=[];for(var g=0;g<p.length;g++){var E=p[g];if(E.__slot<0){var T=r.currentTextureSlot();w.push(T);r.takeCurrentTextureSlot(this,E);E.__slot=T}else{w.push(E.__slot)}}r.setUniform(s,"1iv",v,w)}else{r.setUniform(s,_.type,v,p)}}else{r.setUniform(s,_.type,v,p)}}var S=r.currentTextureSlot();r.resetTextureSlot(l);return S},_bindVAO:function(e,t,r,a){var i=!r.dynamic;var n=this.gl;var o=this.__uid__+"-"+a.__uid__;var s=r.__vaoCache[o];if(!s){var u=r.getBufferChunks(this);if(!u||!u.length){return}var l=u[0];var h=l.attributeBuffers;var f=l.indicesBuffer;var c=[];var d=[];for(var v=0;v<h.length;v++){var p=h[v];var m=p.name;var g=p.semantic;var _;if(g){var y=t.attributeSemantics[g];_=y&&y.symbol}else{_=m}if(_&&a.attributes[_]){c.push(p);d.push(_)}}s=new M(c,d,f);if(i){r.__vaoCache[o]=s}}var x=true;if(e&&i){if(s.vao==null){s.vao=e.createVertexArrayOES()}else{x=false}e.bindVertexArrayOES(s.vao)}var c=s.availableAttributes;var f=s.indicesBuffer;if(x){var T=a.enableAttributes(this,s.availableAttributeSymbols,e&&i&&s);for(var v=0;v<c.length;v++){var b=T[v];if(b===-1){continue}var p=c[v];var w=p.buffer;var E=p.size;var S=A[p.type]||n.FLOAT;n.bindBuffer(n.ARRAY_BUFFER,w);n.vertexAttribPointer(b,E,S,false,0,0)}if(r.isUseIndices()){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,f.buffer)}}return s},renderPreZ:function(e,t,r){var a=this.gl;var i=this._prezMaterial||new s["a"]({shader:new h["a"](h["a"].source("clay.prez.vertex"),h["a"].source("clay.prez.fragment"))});this._prezMaterial=i;a.colorMask(false,false,false,false);a.depthMask(true);this.renderPass(e,r,{ifRender:function(e){return!e.ignorePreZ},isMaterialChanged:function(e,t){var r=e.material;var a=t.material;return r.get("diffuseMap")!==a.get("diffuseMap")||(r.get("alphaCutoff")||0)!==(a.get("alphaCutoff")||0)},getUniform:function(e,t,r){if(r==="alphaMap"){return e.material.get("diffuseMap")}else if(r==="alphaCutoff"){if(e.material.isDefined("fragment","ALPHA_TEST")&&e.material.get("diffuseMap")){var a=e.material.get("alphaCutoff");return a||0}return 0}else{return t.get(r)}},getMaterial:function(){return i},sort:this.opaqueSortCompare});a.colorMask(true,true,true,true);a.depthMask(true)},disposeScene:function(e){this.disposeNode(e,true,true);e.dispose()},disposeNode:function(e,u,l){if(e.getParent()){e.getParent().remove(e)}var h={};e.traverse(function(e){var t=e.material;if(e.geometry&&u){e.geometry.dispose(this)}if(l&&t&&!h[t.__uid__]){var r=t.getTextureUniforms();for(var a=0;a<r.length;a++){var i=r[a];var n=t.uniforms[i].value;var o=t.uniforms[i].type;if(!n){continue}if(o==="t"){n.dispose&&n.dispose(this)}else if(o==="tv"){for(var s=0;s<n.length;s++){if(n[s]){n[s].dispose&&n[s].dispose(this)}}}}h[t.__uid__]=true}if(e.dispose){e.dispose(this)}},this)},disposeGeometry:function(e){e.dispose(this)},disposeTexture:function(e){e.dispose(this)},disposeFrameBuffer:function(e){e.dispose(this)},dispose:function(){},screenToNDC:function(e,t,r){if(!r){r=new u["a"]}t=this._height-t;var a=this.viewport;var i=r.array;i[0]=(e-a.x)/a.width;i[0]=i[0]*2-1;i[1]=(t-a.y)/a.height;i[1]=i[1]*2-1;return r}});v.opaqueSortCompare=v.prototype.opaqueSortCompare=function(e,t){if(e.renderOrder===t.renderOrder){if(e.__program===t.__program){if(e.material===t.material){return e.geometry.__uid__-t.geometry.__uid__}return e.material.__uid__-t.material.__uid__}if(e.__program&&t.__program){return e.__program.__uid__-t.__program.__uid__}return 0}return e.renderOrder-t.renderOrder};v.transparentSortCompare=v.prototype.transparentSortCompare=function(e,t){if(e.renderOrder===t.renderOrder){if(e.__depth===t.__depth){if(e.__program===t.__program){if(e.material===t.material){return e.geometry.__uid__-t.geometry.__uid__}return e.material.__uid__-t.material.__uid__}if(e.__program&&t.__program){return e.__program.__uid__-t.__program.__uid__}return 0}return e.__depth-t.__depth}return e.renderOrder-t.renderOrder};var Y={IDENTITY:_(),WORLD:_(),VIEW:_(),PROJECTION:_(),WORLDVIEW:_(),VIEWPROJECTION:_(),WORLDVIEWPROJECTION:_(),WORLDINVERSE:_(),VIEWINVERSE:_(),PROJECTIONINVERSE:_(),WORLDVIEWINVERSE:_(),VIEWPROJECTIONINVERSE:_(),WORLDVIEWPROJECTIONINVERSE:_(),WORLDTRANSPOSE:_(),VIEWTRANSPOSE:_(),PROJECTIONTRANSPOSE:_(),WORLDVIEWTRANSPOSE:_(),VIEWPROJECTIONTRANSPOSE:_(),WORLDVIEWPROJECTIONTRANSPOSE:_(),WORLDINVERSETRANSPOSE:_(),VIEWINVERSETRANSPOSE:_(),PROJECTIONINVERSETRANSPOSE:_(),WORLDVIEWINVERSETRANSPOSE:_(),VIEWPROJECTIONINVERSETRANSPOSE:_(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:_()};v.COLOR_BUFFER_BIT=n["a"].COLOR_BUFFER_BIT;v.DEPTH_BUFFER_BIT=n["a"].DEPTH_BUFFER_BIT;v.STENCIL_BUFFER_BIT=n["a"].STENCIL_BUFFER_BIT;t["a"]=v},function(e,t,r){"use strict";function n(e,t){this.action=e;this.context=t}var a={trigger:function(e){if(!this.hasOwnProperty("__handlers__")){return}if(!this.__handlers__.hasOwnProperty(e)){return}var t=this.__handlers__[e];var r=t.length,a=-1,i=arguments;switch(i.length){case 1:while(++a<r){t[a].action.call(t[a].context)}return;case 2:while(++a<r){t[a].action.call(t[a].context,i[1])}return;case 3:while(++a<r){t[a].action.call(t[a].context,i[1],i[2])}return;case 4:while(++a<r){t[a].action.call(t[a].context,i[1],i[2],i[3])}return;case 5:while(++a<r){t[a].action.call(t[a].context,i[1],i[2],i[3],i[4])}return;default:while(++a<r){t[a].action.apply(t[a].context,Array.prototype.slice.call(i,1))}return}},on:function(e,t,r){if(!e||!t){return}var a=this.__handlers__||(this.__handlers__={});if(!a[e]){a[e]=[]}else{if(this.has(e,t)){return}}var i=new n(t,r||this);a[e].push(i);return this},once:function(e,t,r){if(!e||!t){return}var a=this;function i(){a.off(e,i);t.apply(this,arguments)}return this.on(e,i,r)},before:function(e,t,r){if(!e||!t){return}e="before"+e;return this.on(e,t,r)},after:function(e,t,r){if(!e||!t){return}e="after"+e;return this.on(e,t,r)},success:function(e,t){return this.once("success",e,t)},error:function(e,t){return this.once("error",e,t)},off:function(e,t){var r=this.__handlers__||(this.__handlers__={});if(!t){r[e]=[];return}if(r[e]){var a=r[e];var i=[];for(var n=0;n<a.length;n++){if(t&&a[n].action!==t){i.push(a[n])}}r[e]=i}return this},has:function(e,t){var r=this.__handlers__;if(!r||!r[e]){return false}var a=r[e];for(var i=0;i<a.length;i++){if(a[i].action===t){return true}}}};t["a"]=a},function(e,t,r){"use strict";var m=r(3);var g=r(12);var _=1e-5;var a=function(e,t){this.origin=e||new m["a"];this.direction=t||new m["a"]};a.prototype={constructor:a,intersectPlane:function(e,t){var r=e.normal.array;var a=e.distance;var i=this.origin.array;var n=this.direction.array;var o=g["a"].dot(r,n);if(o===0){return null}if(!t){t=new m["a"]}var s=(g["a"].dot(r,i)-a)/o;g["a"].scaleAndAdd(t.array,i,n,-s);t._dirty=true;return t},mirrorAgainstPlane:function(e){var t=g["a"].dot(e.normal.array,this.direction.array);g["a"].scaleAndAdd(this.direction.array,this.direction.array,e.normal.array,-t*2);this.direction._dirty=true},distanceToPoint:function(){var a=g["a"].create();return function(e){g["a"].sub(a,e,this.origin.array);var t=g["a"].dot(a,this.direction.array);if(t<0){return g["a"].distance(this.origin.array,e)}var r=g["a"].lenSquared(a);return Math.sqrt(r-t*t)}}(),intersectSphere:function(){var c=g["a"].create();return function(e,t,r){var a=this.origin.array;var i=this.direction.array;e=e.array;g["a"].sub(c,e,a);var n=g["a"].dot(c,i);var o=g["a"].squaredLength(c);var s=o-n*n;var u=t*t;if(s>u){return}var l=Math.sqrt(u-s);var h=n-l;var f=n+l;if(!r){r=new m["a"]}if(h<0){if(f<0){return null}else{g["a"].scaleAndAdd(r.array,a,i,f);return r}}else{g["a"].scaleAndAdd(r.array,a,i,h);return r}}}(),intersectBoundingBox:function(e,t){var r=this.direction.array;var a=this.origin.array;var i=e.min.array;var n=e.max.array;var o=1/r[0];var s=1/r[1];var u=1/r[2];var l,h,f,c,d,v;if(o>=0){l=(i[0]-a[0])*o;h=(n[0]-a[0])*o}else{h=(i[0]-a[0])*o;l=(n[0]-a[0])*o}if(s>=0){f=(i[1]-a[1])*s;c=(n[1]-a[1])*s}else{c=(i[1]-a[1])*s;f=(n[1]-a[1])*s}if(l>c||f>h){return null}if(f>l||l!==l){l=f}if(c<h||h!==h){h=c}if(u>=0){d=(i[2]-a[2])*u;v=(n[2]-a[2])*u}else{v=(i[2]-a[2])*u;d=(n[2]-a[2])*u}if(l>v||d>h){return null}if(d>l||l!==l){l=d}if(v<h||h!==h){h=v}if(h<0){return null}var p=l>=0?l:h;if(!t){t=new m["a"]}g["a"].scaleAndAdd(t.array,a,r,p);return t},intersectTriangle:function(){var c=g["a"].create();var d=g["a"].create();var v=g["a"].create();var p=g["a"].create();return function(e,t,r,a,i,n){var o=this.direction.array;var s=this.origin.array;e=e.array;t=t.array;r=r.array;g["a"].sub(c,t,e);g["a"].sub(d,r,e);g["a"].cross(p,d,o);var u=g["a"].dot(c,p);if(a){if(u>-_){return null}}else{if(u>-_&&u<_){return null}}g["a"].sub(v,s,e);var l=g["a"].dot(p,v)/u;if(l<0||l>1){return null}g["a"].cross(p,c,v);var h=g["a"].dot(o,p)/u;if(h<0||h>1||l+h>1){return null}g["a"].cross(p,c,d);var f=-g["a"].dot(v,p)/u;if(f<0){return null}if(!i){i=new m["a"]}if(n){m["a"].set(n,1-l-h,l,h)}g["a"].scaleAndAdd(i.array,s,o,f);return i}}(),applyTransform:function(e){m["a"].add(this.direction,this.direction,this.origin);m["a"].transformMat4(this.origin,this.origin,e);m["a"].transformMat4(this.direction,this.direction,e);m["a"].sub(this.direction,this.direction,this.origin);m["a"].normalize(this.direction,this.direction)},copy:function(e){m["a"].copy(this.origin,e.origin);m["a"].copy(this.direction,e.direction)},clone:function(){var e=new a;e.copy(this);return e}};t["a"]=a},function(e,t,r){"use strict";var a=r(20);var s=r(12);var i=r(33);var n=r(34);var u={};u.create=function(){var e=new a["a"](4);e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e};u.rotationTo=function(){var i=s["a"].create();var n=s["a"].fromValues(1,0,0);var o=s["a"].fromValues(0,1,0);return function(e,t,r){var a=s["a"].dot(t,r);if(a<-.999999){s["a"].cross(i,n,t);if(s["a"].length(i)<1e-6)s["a"].cross(i,o,t);s["a"].normalize(i,i);u.setAxisAngle(e,i,Math.PI);return e}else if(a>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{s["a"].cross(i,t,r);e[0]=i[0];e[1]=i[1];e[2]=i[2];e[3]=1+a;return u.normalize(e,e)}}}();u.setAxes=function(){var i=n["a"].create();return function(e,t,r,a){i[0]=r[0];i[3]=r[1];i[6]=r[2];i[1]=a[0];i[4]=a[1];i[7]=a[2];i[2]=-t[0];i[5]=-t[1];i[8]=-t[2];return u.normalize(e,u.fromMat3(e,i))}}();u.clone=i["a"].clone;u.fromValues=i["a"].fromValues;u.copy=i["a"].copy;u.set=i["a"].set;u.identity=function(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e};u.setAxisAngle=function(e,t,r){r=r*.5;var a=Math.sin(r);e[0]=a*t[0];e[1]=a*t[1];e[2]=a*t[2];e[3]=Math.cos(r);return e};u.add=i["a"].add;u.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=r[0],u=r[1],l=r[2],h=r[3];e[0]=a*h+o*s+i*l-n*u;e[1]=i*h+o*u+n*s-a*l;e[2]=n*h+o*l+a*u-i*s;e[3]=o*h-a*s-i*u-n*l;return e};u.mul=u.multiply;u.scale=i["a"].scale;u.rotateX=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=a*u+o*s;e[1]=i*u+n*s;e[2]=n*u-i*s;e[3]=o*u-a*s;return e};u.rotateY=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=a*u-n*s;e[1]=i*u+o*s;e[2]=n*u+a*s;e[3]=o*u-i*s;return e};u.rotateZ=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=a*u+i*s;e[1]=i*u-a*s;e[2]=n*u+o*s;e[3]=o*u-n*s;return e};u.calculateW=function(e,t){var r=t[0],a=t[1],i=t[2];e[0]=r;e[1]=a;e[2]=i;e[3]=Math.sqrt(Math.abs(1-r*r-a*a-i*i));return e};u.dot=i["a"].dot;u.lerp=i["a"].lerp;u.slerp=function(e,t,r,a){var i=t[0],n=t[1],o=t[2],s=t[3],u=r[0],l=r[1],h=r[2],f=r[3];var c,d,v,p,m;d=i*u+n*l+o*h+s*f;if(d<0){d=-d;u=-u;l=-l;h=-h;f=-f}if(1-d>1e-6){c=Math.acos(d);v=Math.sin(c);p=Math.sin((1-a)*c)/v;m=Math.sin(a*c)/v}else{p=1-a;m=a}e[0]=p*i+m*u;e[1]=p*n+m*l;e[2]=p*o+m*h;e[3]=p*s+m*f;return e};u.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r*r+a*a+i*i+n*n,s=o?1/o:0;e[0]=-r*s;e[1]=-a*s;e[2]=-i*s;e[3]=n*s;return e};u.conjugate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e};u.length=i["a"].length;u.len=u.length;u.squaredLength=i["a"].squaredLength;u.sqrLen=u.squaredLength;u.normalize=i["a"].normalize;u.fromMat3=function(e,t){var r=t[0]+t[4]+t[8];var a;if(r>0){a=Math.sqrt(r+1);e[3]=.5*a;a=.5/a;e[0]=(t[5]-t[7])*a;e[1]=(t[6]-t[2])*a;e[2]=(t[1]-t[3])*a}else{var i=0;if(t[4]>t[0])i=1;if(t[8]>t[i*3+i])i=2;var n=(i+1)%3;var o=(i+2)%3;a=Math.sqrt(t[i*3+i]-t[n*3+n]-t[o*3+o]+1);e[i]=.5*a;a=.5/a;e[3]=(t[n*3+o]-t[o*3+n])*a;e[n]=(t[n*3+i]+t[i*3+n])*a;e[o]=(t[o*3+i]+t[i*3+o])*a}return e};t["a"]=u},function(e,t,r){"use strict";var n=r(55);var a=r(34);var i=function(e,t,r,a){e=e||0;t=t||0;r=r||0;a=a===undefined?1:a;this.array=n["a"].fromValues(e,t,r,a);this._dirty=true};i.prototype={constructor:i,add:function(e){n["a"].add(this.array,this.array,e.array);this._dirty=true;return this},calculateW:function(){n["a"].calculateW(this.array,this.array);this._dirty=true;return this},set:function(e,t,r,a){this.array[0]=e;this.array[1]=t;this.array[2]=r;this.array[3]=a;this._dirty=true;return this},setArray:function(e){this.array[0]=e[0];this.array[1]=e[1];this.array[2]=e[2];this.array[3]=e[3];this._dirty=true;return this},clone:function(){return new i(this.x,this.y,this.z,this.w)},conjugate:function(){n["a"].conjugate(this.array,this.array);this._dirty=true;return this},copy:function(e){n["a"].copy(this.array,e.array);this._dirty=true;return this},dot:function(e){return n["a"].dot(this.array,e.array)},fromMat3:function(e){n["a"].fromMat3(this.array,e.array);this._dirty=true;return this},fromMat4:function(){var t=a["a"].create();return function(e){a["a"].fromMat4(t,e.array);a["a"].transpose(t,t);n["a"].fromMat3(this.array,t);this._dirty=true;return this}}(),identity:function(){n["a"].identity(this.array);this._dirty=true;return this},invert:function(){n["a"].invert(this.array,this.array);this._dirty=true;return this},len:function(){return n["a"].len(this.array)},length:function(){return n["a"].length(this.array)},lerp:function(e,t,r){n["a"].lerp(this.array,e.array,t.array,r);this._dirty=true;return this},mul:function(e){n["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},mulLeft:function(e){n["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},multiply:function(e){n["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},multiplyLeft:function(e){n["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},normalize:function(){n["a"].normalize(this.array,this.array);this._dirty=true;return this},rotateX:function(e){n["a"].rotateX(this.array,this.array,e);this._dirty=true;return this},rotateY:function(e){n["a"].rotateY(this.array,this.array,e);this._dirty=true;return this},rotateZ:function(e){n["a"].rotateZ(this.array,this.array,e);this._dirty=true;return this},rotationTo:function(e,t){n["a"].rotationTo(this.array,e.array,t.array);this._dirty=true;return this},setAxes:function(e,t,r){n["a"].setAxes(this.array,e.array,t.array,r.array);this._dirty=true;return this},setAxisAngle:function(e,t){n["a"].setAxisAngle(this.array,e.array,t);this._dirty=true;return this},slerp:function(e,t,r){n["a"].slerp(this.array,e.array,t.array,r);this._dirty=true;return this},sqrLen:function(){return n["a"].sqrLen(this.array)},squaredLength:function(){return n["a"].squaredLength(this.array)},fromEuler:function(e,t){return i.fromEuler(this,e,t)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var o=Object.defineProperty;if(o){var s=i.prototype;o(s,"x",{get:function(){return this.array[0]},set:function(e){this.array[0]=e;this._dirty=true}});o(s,"y",{get:function(){return this.array[1]},set:function(e){this.array[1]=e;this._dirty=true}});o(s,"z",{get:function(){return this.array[2]},set:function(e){this.array[2]=e;this._dirty=true}});o(s,"w",{get:function(){return this.array[3]},set:function(e){this.array[3]=e;this._dirty=true}})}i.add=function(e,t,r){n["a"].add(e.array,t.array,r.array);e._dirty=true;return e};i.set=function(e,t,r,a,i){n["a"].set(e.array,t,r,a,i);e._dirty=true};i.copy=function(e,t){n["a"].copy(e.array,t.array);e._dirty=true;return e};i.calculateW=function(e,t){n["a"].calculateW(e.array,t.array);e._dirty=true;return e};i.conjugate=function(e,t){n["a"].conjugate(e.array,t.array);e._dirty=true;return e};i.identity=function(e){n["a"].identity(e.array);e._dirty=true;return e};i.invert=function(e,t){n["a"].invert(e.array,t.array);e._dirty=true;return e};i.dot=function(e,t){return n["a"].dot(e.array,t.array)};i.len=function(e){return n["a"].length(e.array)};i.lerp=function(e,t,r,a){n["a"].lerp(e.array,t.array,r.array,a);e._dirty=true;return e};i.slerp=function(e,t,r,a){n["a"].slerp(e.array,t.array,r.array,a);e._dirty=true;return e};i.mul=function(e,t,r){n["a"].multiply(e.array,t.array,r.array);e._dirty=true;return e};i.multiply=i.mul;i.rotateX=function(e,t,r){n["a"].rotateX(e.array,t.array,r);e._dirty=true;return e};i.rotateY=function(e,t,r){n["a"].rotateY(e.array,t.array,r);e._dirty=true;return e};i.rotateZ=function(e,t,r){n["a"].rotateZ(e.array,t.array,r);e._dirty=true;return e};i.setAxisAngle=function(e,t,r){n["a"].setAxisAngle(e.array,t.array,r);e._dirty=true;return e};i.normalize=function(e,t){n["a"].normalize(e.array,t.array);e._dirty=true;return e};i.sqrLen=function(e){return n["a"].sqrLen(e.array)};i.squaredLength=i.sqrLen;i.fromMat3=function(e,t){n["a"].fromMat3(e.array,t.array);e._dirty=true;return e};i.setAxes=function(e,t,r,a){n["a"].setAxes(e.array,t.array,r.array,a.array);e._dirty=true;return e};i.rotationTo=function(e,t,r){n["a"].rotationTo(e.array,t.array,r.array);e._dirty=true;return e};i.fromEuler=function(e,t,r){e._dirty=true;t=t.array;var a=e.array;var i=Math.cos(t[0]/2);var n=Math.cos(t[1]/2);var o=Math.cos(t[2]/2);var s=Math.sin(t[0]/2);var u=Math.sin(t[1]/2);var l=Math.sin(t[2]/2);var r=(r||"XYZ").toUpperCase();switch(r){case"XYZ":a[0]=s*n*o+i*u*l;a[1]=i*u*o-s*n*l;a[2]=i*n*l+s*u*o;a[3]=i*n*o-s*u*l;break;case"YXZ":a[0]=s*n*o+i*u*l;a[1]=i*u*o-s*n*l;a[2]=i*n*l-s*u*o;a[3]=i*n*o+s*u*l;break;case"ZXY":a[0]=s*n*o-i*u*l;a[1]=i*u*o+s*n*l;a[2]=i*n*l+s*u*o;a[3]=i*n*o-s*u*l;break;case"ZYX":a[0]=s*n*o-i*u*l;a[1]=i*u*o+s*n*l;a[2]=i*n*l-s*u*o;a[3]=i*n*o+s*u*l;break;case"YZX":a[0]=s*n*o+i*u*l;a[1]=i*u*o+s*n*l;a[2]=i*n*l-s*u*o;a[3]=i*n*o-s*u*l;break;case"XZY":a[0]=s*n*o-i*u*l;a[1]=i*u*o-s*n*l;a[2]=i*n*l+s*u*o;a[3]=i*n*o+s*u*l;break}};t["a"]=i},function(e,t,r){"use strict";var i="__dt__";var a=function(){this._contextId=0;this._caches=[];this._context={}};a.prototype={use:function(e,t){var r=this._caches;if(!r[e]){r[e]={};if(t){r[e]=t()}}this._contextId=e;this._context=r[e]},put:function(e,t){this._context[e]=t},get:function(e){return this._context[e]},dirty:function(e){e=e||"";var t=i+e;this.put(t,true)},dirtyAll:function(e){e=e||"";var t=i+e;var r=this._caches;for(var a=0;a<r.length;a++){if(r[a]){r[a][t]=true}}},fresh:function(e){e=e||"";var t=i+e;this.put(t,false)},freshAll:function(e){e=e||"";var t=i+e;var r=this._caches;for(var a=0;a<r.length;a++){if(r[a]){r[a][t]=false}}},isDirty:function(e){e=e||"";var t=i+e;var r=this._context;return!r.hasOwnProperty(t)||r[t]===true},deleteContext:function(e){delete this._caches[e];this._context={}},delete:function(e){delete this._context[e]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,r){var e=Object.keys(this._caches);e.forEach(function(e){t&&t.call(r,e)})},miss:function(e){return!this._context.hasOwnProperty(e)}};a.prototype.constructor=a;t["a"]=a},function(e,t,r){"use strict";var a=r(35);var i=r(9);var n=r(59);var o=r(54);var s=r(33);var u=r(12);var l=a["a"].extend(function(){return{projectionMatrix:new i["a"],invProjectionMatrix:new i["a"],viewMatrix:new i["a"],frustum:new n["a"]}},function(){this.update(true)},{update:function(e){a["a"].prototype.update.call(this,e);i["a"].invert(this.viewMatrix,this.worldTransform);this.updateProjectionMatrix();i["a"].invert(this.invProjectionMatrix,this.projectionMatrix);this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(e){i["a"].copy(this.viewMatrix,e);i["a"].invert(this.worldTransform,e);this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(e){i["a"].copy(this.projectionMatrix,e);i["a"].invert(this.invProjectionMatrix,e);this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:function(){var n=s["a"].create();return function(e,t){var r=t!==undefined?t:new o["a"];var a=e.array[0];var i=e.array[1];s["a"].set(n,a,i,-1,1);s["a"].transformMat4(n,n,this.invProjectionMatrix.array);s["a"].transformMat4(n,n,this.worldTransform.array);u["a"].scale(r.origin.array,n,1/n[3]);s["a"].set(n,a,i,1,1);s["a"].transformMat4(n,n,this.invProjectionMatrix.array);s["a"].transformMat4(n,n,this.worldTransform.array);u["a"].scale(n,n,1/n[3]);u["a"].sub(r.direction.array,n,r.origin.array);u["a"].normalize(r.direction.array,r.direction.array);r.direction._dirty=true;r.origin._dirty=true;return r}}()});t["a"]=l},function(e,t,r){"use strict";var a=r(18);var i=r(74);var n=r(12);var P=n["a"].set;var f=n["a"].copy;var c=n["a"].transformMat4;var d=Math.min;var v=Math.max;var o=function(){this.planes=[];for(var e=0;e<6;e++){this.planes.push(new i["a"])}this.boundingBox=new a["a"];this.vertices=[];for(var e=0;e<8;e++){this.vertices[e]=n["a"].fromValues(0,0,0)}};o.prototype={setFromProjection:function(e){var t=this.planes;var r=e.array;var a=r[0],i=r[1],n=r[2],o=r[3];var s=r[4],u=r[5],l=r[6],h=r[7];var f=r[8],c=r[9],d=r[10],v=r[11];var p=r[12],m=r[13],g=r[14],_=r[15];P(t[0].normal.array,o-a,h-s,v-f);t[0].distance=-(_-p);t[0].normalize();P(t[1].normal.array,o+a,h+s,v+f);t[1].distance=-(_+p);t[1].normalize();P(t[2].normal.array,o+i,h+u,v+c);t[2].distance=-(_+m);t[2].normalize();P(t[3].normal.array,o-i,h-u,v-c);t[3].distance=-(_-m);t[3].normalize();P(t[4].normal.array,o-n,h-l,v-d);t[4].distance=-(_-g);t[4].normalize();P(t[5].normal.array,o+n,h+l,v+d);t[5].distance=-(_+g);t[5].normalize();var y=this.boundingBox;var x=this.vertices;if(_===0){var T=u/a;var b=-g/(d-1);var w=-g/(d+1);var E=-w/u;var S=-b/u;y.min.set(-E*T,-E,w);y.max.set(E*T,E,b);P(x[0],-E*T,-E,w);P(x[1],-E*T,E,w);P(x[2],E*T,-E,w);P(x[3],E*T,E,w);P(x[4],-S*T,-S,b);P(x[5],-S*T,S,b);P(x[6],S*T,-S,b);P(x[7],S*T,S,b)}else{var A=(-1-p)/a;var M=(1-p)/a;var C=(1-m)/u;var L=(-1-m)/u;var D=(-1-g)/d;var N=(1-g)/d;y.min.set(Math.min(A,M),Math.min(L,C),Math.min(N,D));y.max.set(Math.max(M,A),Math.max(C,L),Math.max(D,N));var I=y.min.array;var R=y.max.array;P(x[0],I[0],I[1],I[2]);P(x[1],I[0],R[1],I[2]);P(x[2],R[0],I[1],I[2]);P(x[3],R[0],R[1],I[2]);P(x[4],I[0],I[1],R[2]);P(x[5],I[0],R[1],R[2]);P(x[6],R[0],I[1],R[2]);P(x[7],R[0],R[1],R[2])}},getTransformedBoundingBox:function(){var h=n["a"].create();return function(e,t){var r=this.vertices;var a=t.array;var i=e.min;var n=e.max;var o=i.array;var s=n.array;var u=r[0];c(h,u,a);f(o,h);f(s,h);for(var l=1;l<8;l++){u=r[l];c(h,u,a);o[0]=d(h[0],o[0]);o[1]=d(h[1],o[1]);o[2]=d(h[2],o[2]);s[0]=v(h[0],s[0]);s[1]=v(h[1],s[1]);s[2]=v(h[2],s[2])}i._dirty=true;n._dirty=true;return e}}()};t["a"]=o},function(e,t){var r=function(){this.head=null;this.tail=null;this._len=0};var a=r.prototype;a.insert=function(e){var t=new u(e);this.insertEntry(t);return t};a.insertEntry=function(e){if(!this.head){this.head=this.tail=e}else{this.tail.next=e;e.prev=this.tail;e.next=null;this.tail=e}this._len++};a.remove=function(e){var t=e.prev;var r=e.next;if(t){t.next=r}else{this.head=r}if(r){r.prev=t}else{this.tail=t}e.next=e.prev=null;this._len--};a.len=function(){return this._len};a.clear=function(){this.head=this.tail=null;this._len=0};var u=function(e){this.value=e;this.next;this.prev};var i=function(e){this._list=new r;this._map={};this._maxSize=e||10;this._lastRemovedEntry=null};var n=i.prototype;n.put=function(e,t){var r=this._list;var a=this._map;var i=null;if(a[e]==null){var n=r.len();var o=this._lastRemovedEntry;if(n>=this._maxSize&&n>0){var s=r.head;r.remove(s);delete a[s.key];i=s.value;this._lastRemovedEntry=s}if(o){o.value=t}else{o=new u(t)}o.key=e;r.insertEntry(o);a[e]=o}return i};n.get=function(e){var t=this._map[e];var r=this._list;if(t!=null){if(t!==r.tail){r.remove(t);r.insertEntry(t)}return t.value}};n.clear=function(){this._list.clear();this._map={}};var o=i;e.exports=o},function(e,t,r){"use strict";var f=r(5);var n=r(27);var a=r(14);var o=r(62);var s=r(75);var u=r(36);var l=r(122);var h=r(123);var c={loadTexture:function(e,t,r,a){var i;if(typeof t==="function"){r=t;a=r;t={}}else{t=t||{}}if(typeof e==="string"){if(e.match(/.hdr$/)||t.fileType==="hdr"){i=new f["a"]({width:0,height:0,sRGB:false});c._fetchTexture(e,function(e){h["a"].parseRGBE(e,i,t.exposure);i.dirty();r&&r(i)},a);return i}else if(e.match(/.dds$/)||t.fileType==="dds"){i=new f["a"]({width:0,height:0});c._fetchTexture(e,function(e){l["a"].parse(e,i);i.dirty();r&&r(i)},a)}else{i=new f["a"];i.load(e);i.success(r);i.error(a)}}else if(typeof e==="object"&&typeof e.px!=="undefined"){i=new n["a"];i.load(e);i.success(r);i.error(a)}return i},loadPanorama:function(t,e,r,a,i,n){var o=this;if(typeof a==="function"){i=a;n=i;a={}}else{a=a||{}}c.loadTexture(e,a,function(e){e.flipY=a.flipY||false;o.panoramaToCubeMap(t,e,r,a);e.dispose(t);i&&i(r)},n)},panoramaToCubeMap:function(e,t,r,a){var i=new o["a"];var n=new s["a"]({scene:new u["a"]});n.setEnvironmentMap(t);a=a||{};if(a.encodeRGBM){n.material.define("fragment","RGBM_ENCODE")}r.sRGB=t.sRGB;i.texture=r;i.render(e,n.scene);i.texture=null;i.dispose(e);return r},heightToNormal:function(e,t){var r=document.createElement("canvas");var a=r.width=e.width;var i=r.height=e.height;var n=r.getContext("2d");n.drawImage(e,0,0,a,i);t=t||false;var o=n.getImageData(0,0,a,i);var s=n.createImageData(a,i);for(var u=0;u<o.data.length;u+=4){if(t){var l=o.data[u];var h=o.data[u+1];var f=o.data[u+2];var c=Math.abs(l-h)+Math.abs(h-f);if(c>20){console.warn("Given image is not a height map");return e}}var d,v,p,m;if(u%(a*4)===0){d=o.data[u];p=o.data[u+4]}else if(u%(a*4)===(a-1)*4){d=o.data[u-4];p=o.data[u]}else{d=o.data[u-4];p=o.data[u+4]}if(u<a*4){v=o.data[u];m=o.data[u+a*4]}else if(u>a*(i-1)*4){v=o.data[u-a*4];m=o.data[u]}else{v=o.data[u-a*4];m=o.data[u+a*4]}s.data[u]=d-p+127;s.data[u+1]=v-m+127;s.data[u+2]=255;s.data[u+3]=255}n.putImageData(s,0,0);return r},isHeightImage:function(e,t,r){if(!e||!e.width||!e.height){return false}var a=document.createElement("canvas");var i=a.getContext("2d");var n=t||32;r=r||20;a.width=a.height=n;i.drawImage(e,0,0,n,n);var o=i.getImageData(0,0,n,n);for(var s=0;s<o.data.length;s+=4){var u=o.data[s];var l=o.data[s+1];var h=o.data[s+2];var f=Math.abs(u-l)+Math.abs(l-h);if(f>r){return false}}return true},_fetchTexture:function(e,t,r){a["a"].request.get({url:e,responseType:"arraybuffer",onload:t,onerror:r})},createChessboard:function(e,t,r,a){e=e||512;t=t||64;r=r||"black";a=a||"white";var i=Math.ceil(e/t);var n=document.createElement("canvas");n.width=e;n.height=e;var o=n.getContext("2d");o.fillStyle=a;o.fillRect(0,0,e,e);o.fillStyle=r;for(var s=0;s<i;s++){for(var u=0;u<i;u++){var l=u%2?s%2:s%2-1;if(l){o.fillRect(s*t,u*t,t,t)}}}var h=new f["a"]({image:n,anisotropic:8});return h},createBlank:function(e){var t=document.createElement("canvas");t.width=1;t.height=1;var r=t.getContext("2d");r.fillStyle=e;r.fillRect(0,0,1,1);var a=new f["a"]({image:t});return a}};t["a"]=c},function(e,t,r){"use strict";var a=r(7);var h=r(3);var i=r(41);var n=r(10);var f=["px","nx","py","ny","pz","nz"];var o=a["a"].extend(function(){var e={position:new h["a"],far:1e3,near:.1,texture:null,shadowMapPass:null};var t=e._cameras={px:new i["a"]({fov:90}),nx:new i["a"]({fov:90}),py:new i["a"]({fov:90}),ny:new i["a"]({fov:90}),pz:new i["a"]({fov:90}),nz:new i["a"]({fov:90})};t.px.lookAt(h["a"].POSITIVE_X,h["a"].NEGATIVE_Y);t.nx.lookAt(h["a"].NEGATIVE_X,h["a"].NEGATIVE_Y);t.py.lookAt(h["a"].POSITIVE_Y,h["a"].POSITIVE_Z);t.ny.lookAt(h["a"].NEGATIVE_Y,h["a"].NEGATIVE_Z);t.pz.lookAt(h["a"].POSITIVE_Z,h["a"].NEGATIVE_Y);t.nz.lookAt(h["a"].NEGATIVE_Z,h["a"].NEGATIVE_Y);e._frameBuffer=new n["a"];return e},{getCamera:function(e){return this._cameras[e]},render:function(e,t,r){var a=e.gl;if(!r){t.update()}var i=this.texture.width;var n=2*Math.atan(i/(i-.5))/Math.PI*180;for(var o=0;o<6;o++){var s=f[o];var u=this._cameras[s];h["a"].copy(u.position,this.position);u.far=this.far;u.near=this.near;u.fov=n;if(this.shadowMapPass){u.update();var l=t.getBoundingBox();l.applyTransform(u.viewMatrix);t.viewBoundingBoxLastFrame.copy(l);this.shadowMapPass.render(e,t,u,true)}this._frameBuffer.attach(this.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o);this._frameBuffer.bind(e);e.render(t,u,true);this._frameBuffer.unbind(e)}},dispose:function(e){this._frameBuffer.dispose(e)}});t["a"]=o},function(e,t,r){"use strict";var a=r(1);var i=r(165);var n=r(166);a["a"].Shader.import(n["a"]);t["a"]=a["a"].Mesh.extend(function(){var e=new i["a"]({dynamic:true});var t=new a["a"].Material({shader:a["a"].createShader("ecgl.labels"),transparent:true,depthMask:false});return{geometry:e,material:t,culling:false,castShadow:false,ignorePicking:true}})},function(e,t,r){"use strict";var a=r(0);var u=r.n(a);var w=r(1);var S=r(204);var i=r(25);var E=r(2);var n=r(6);var o=r(65);var s=r(66);var l=r(46);var W=n["a"].vec3;w["a"].Shader.import(l["a"]);function h(e){this.rootNode=new w["a"].Node;this._triangulationResults={};this._shadersMap=w["a"].COMMON_SHADERS.reduce(function(e,t){e[t]=w["a"].createShader("ecgl."+t);return e},{});this._linesShader=w["a"].createShader("ecgl.meshLines3D");var t={};w["a"].COMMON_SHADERS.forEach(function(e){t[e]=new w["a"].Material({shader:w["a"].createShader("ecgl."+e)})});this._groundMaterials=t;this._groundMesh=new w["a"].Mesh({geometry:new w["a"].PlaneGeometry({dynamic:true}),castShadow:false,renderNormal:true,$ignorePicking:true});this._groundMesh.rotation.rotateX(-Math.PI/2);this._labelsBuilder=new s["a"](512,512,e);this._labelsBuilder.getMesh().renderOrder=100;this._labelsBuilder.getMesh().material.depthTest=false;this.rootNode.add(this._labelsBuilder.getMesh());this._initMeshes();this._api=e}h.prototype={constructor:h,extrudeY:true,update:function(e,t,r,a,i){var l=e.getData();if(a==null){a=0}if(i==null){i=l.count()}this._startIndex=a;this._endIndex=i-1;this._triangulation(e,a,i);var n=this._getShader(e.get("shading"));this._prepareMesh(e,n,r,a,i);this.rootNode.updateWorldTransform();this._updateRegionMesh(e,r,a,i);var h=e.coordinateSystem;if(h.type==="geo3D"){this._updateGroundPlane(e,h,r)}var f=this;this._labelsBuilder.updateData(l,a,i);this._labelsBuilder.getLabelPosition=function(e,t,r){var a=l.getName(e);var i;var n=r;if(h.type==="geo3D"){var o=h.getRegion(a);if(!o){return[NaN,NaN,NaN]}i=o.center;var s=h.dataToPoint([i[0],i[1],n]);return s}else{var u=f._triangulationResults[e-f._startIndex];var i=f.extrudeY?[(u.max[0]+u.min[0])/2,u.max[1]+n,(u.max[2]+u.min[2])/2]:[(u.max[0]+u.min[0])/2,(u.max[1]+u.min[1])/2,u.max[2]+n]}};this._data=l;this._labelsBuilder.updateLabels();this._updateDebugWireframe(e);this._lastHoverDataIndex=0},_initMeshes:function(){var t=this;function e(){var e=new w["a"].Mesh({name:"Polygon",material:new w["a"].Material({shader:t._shadersMap.lambert}),geometry:new w["a"].Geometry({sortTriangles:true,dynamic:true}),culling:false,ignorePicking:true,renderNormal:true});u.a.util.extend(e.geometry,o["a"]);return e}var r=e();var a=new w["a"].Mesh({material:new w["a"].Material({shader:this._linesShader}),castShadow:false,ignorePicking:true,$ignorePicking:true,geometry:new i["a"]({useNativeLine:false})});this.rootNode.add(r);this.rootNode.add(a);r.material.define("both","VERTEX_COLOR");r.material.define("fragment","DOUBLE_SIDED");this._polygonMesh=r;this._linesMesh=a;this.rootNode.add(this._groundMesh)},_getShader:function(e){var t=this._shadersMap[e];if(!t){if(true){console.warn("Unkown shading "+e)}t=this._shadersMap.lambert}t.__shading=e;return t},_prepareMesh:function(e,t,r,a,i){var n=0;var o=0;var s=0;var u=0;for(var l=a;l<i;l++){var h=this._getRegionPolygonInfo(l);var f=this._getRegionLinesInfo(l,e,this._linesMesh.geometry);n+=h.vertexCount;o+=h.triangleCount;s+=f.vertexCount;u+=f.triangleCount}var c=this._polygonMesh;var d=c.geometry;["position","normal","texcoord0","color"].forEach(function(e){d.attributes[e].init(n)});d.indices=n>65535?new Uint32Array(o*3):new Uint16Array(o*3);if(c.material.shader!==t){c.material.attachShader(t,true)}w["a"].setMaterialFromModel(t.__shading,c.material,e,r);if(s>0){this._linesMesh.geometry.resetOffset();this._linesMesh.geometry.setVertexCount(s);this._linesMesh.geometry.setTriangleCount(u)}this._dataIndexOfVertex=new Uint32Array(n);this._vertexRangeOfDataIndex=new Uint32Array((i-a)*2)},_updateRegionMesh:function(e,t,r,a){var i=e.getData();var n=0;var o=0;var s=false;var u=this._polygonMesh;var l=this._linesMesh;for(var h=r;h<a;h++){var f=e.getRegionModel(h);var c=f.getModel("itemStyle");var d=c.get("color");var v=E["a"].firstNotNull(c.get("opacity"),1);var p=i.getItemVisual(h,"color",true);if(p!=null&&i.hasValue(h)){d=p}i.setItemVisual(h,"color",d);i.setItemVisual(h,"opacity",v);d=w["a"].parseColor(d);var m=w["a"].parseColor(c.get("borderColor"));d[3]*=v;m[3]*=v;var g=d[3]<.99;u.material.set("color",[1,1,1,1]);s=s||g;var _=E["a"].firstNotNull(f.get("height",true),e.get("regionHeight"));var y=this._updatePolygonGeometry(e,u.geometry,h,_,n,o,d);for(var x=n;x<y.vertexOffset;x++){this._dataIndexOfVertex[x]=h}this._vertexRangeOfDataIndex[(h-r)*2]=n;this._vertexRangeOfDataIndex[(h-r)*2+1]=y.vertexOffset;n=y.vertexOffset;o=y.triangleOffset;var T=c.get("borderWidth");var b=T>0;if(b){T*=t.getDevicePixelRatio();this._updateLinesGeometry(l.geometry,e,h,_,T,e.coordinateSystem.transform)}l.invisible=!b;l.material.set({color:m})}var u=this._polygonMesh;u.material.transparent=s;u.material.depthMask=!s;u.geometry.updateBoundingBox();u.frontFace=this.extrudeY?w["a"].Mesh.CCW:w["a"].Mesh.CW;if(u.material.get("normalMap")){u.geometry.generateTangents()}u.seriesIndex=e.seriesIndex;u.on("mousemove",this._onmousemove,this);u.on("mouseout",this._onmouseout,this)},_updateDebugWireframe:function(e){var t=e.getModel("debug.wireframe");if(t.get("show")){var r=w["a"].parseColor(t.get("lineStyle.color")||"rgba(0,0,0,0.5)");var a=E["a"].firstNotNull(t.get("lineStyle.width"),1);var i=this._polygonMesh;i.geometry.generateBarycentric();i.material.define("both","WIREFRAME_TRIANGLE");i.material.set("wireframeLineColor",r);i.material.set("wireframeLineWidth",a)}},_onmousemove:function(e){var t=this._dataIndexOfVertex[e.triangle[0]];if(t==null){t=-1}if(t!==this._lastHoverDataIndex){this.downplay(this._lastHoverDataIndex);this.highlight(t);this._labelsBuilder.updateLabels([t])}this._lastHoverDataIndex=t;this._polygonMesh.dataIndex=t},_onmouseout:function(e){if(e.target){this.downplay(this._lastHoverDataIndex);this._lastHoverDataIndex=-1;this._polygonMesh.dataIndex=-1}this._labelsBuilder.updateLabels([])},_updateGroundPlane:function(e,t,r){var a=e.getModel("groundPlane",e);this._groundMesh.invisible=!a.get("show",true);if(this._groundMesh.invisible){return}var i=e.get("shading");var n=this._groundMaterials[i];if(!n){if(true){console.warn("Unkown shading "+i)}n=this._groundMaterials.lambert}w["a"].setMaterialFromModel(i,n,a,r);if(n.get("normalMap")){this._groundMesh.geometry.generateTangents()}this._groundMesh.material=n;this._groundMesh.material.set("color",w["a"].parseColor(a.get("color")));this._groundMesh.scale.set(t.size[0],t.size[2],1)},_triangulation:function(e,t,r){this._triangulationResults=[];var a=[Infinity,Infinity,Infinity];var i=[-Infinity,-Infinity,-Infinity];var n=e.coordinateSystem;for(var o=t;o<r;o++){var s=[];var u=e.getRegionPolygonCoords(o);for(var l=0;l<u.length;l++){var h=u[l].exterior;var f=u[l].interiors;var c=[];var d=[];if(h.length<3){continue}var v=0;for(var p=0;p<h.length;p++){var m=h[p];c[v++]=m[0];c[v++]=m[1]}for(var p=0;p<f.length;p++){if(f[p].length<3){continue}var g=c.length/2;for(var _=0;_<f[p].length;_++){var m=f[p][_];c.push(m[0]);c.push(m[1])}d.push(g)}var y=Object(S["a"])(c,d);var x=new Float64Array(c.length/2*3);var T=[];var b=[Infinity,Infinity,Infinity];var w=[-Infinity,-Infinity,-Infinity];var E=0;for(var p=0;p<c.length;){W.set(T,c[p++],0,c[p++]);if(n&&n.transform){W.transformMat4(T,T,n.transform)}W.min(b,b,T);W.max(w,w,T);x[E++]=T[0];x[E++]=T[1];x[E++]=T[2]}W.min(a,a,b);W.max(i,i,w);s.push({points:x,indices:y,min:b,max:w})}this._triangulationResults.push(s)}this._geoBoundingBox=[a,i]},_getRegionPolygonInfo:function(e){var t=this._triangulationResults[e-this._startIndex];var r=0;var a=0;for(var i=0;i<t.length;i++){r+=t[i].points.length/3;a+=t[i].indices.length/3}var n=r*2+r*4;var o=a*2+r*2;return{vertexCount:n,triangleCount:o}},_updatePolygonGeometry:function(e,t,r,a,u,o,l){var i=e.get("projectUVOnGround");var h=t.attributes.position;var n=t.attributes.normal;var f=t.attributes.texcoord0;var c=t.attributes.color;var s=this._triangulationResults[r-this._startIndex];var d=c.value&&l;var v=t.indices;var p=this.extrudeY?1:2;var m=this.extrudeY?2:1;var g=[this.rootNode.worldTransform.x.len(),this.rootNode.worldTransform.y.len(),this.rootNode.worldTransform.z.len()];var _=W.mul([],this._geoBoundingBox[0],g);var y=W.mul([],this._geoBoundingBox[1],g);var x=Math.max(y[0]-_[0],y[2]-_[2]);function T(e,t,r){var a=e.points;var i=a.length;var n=[];var o=[];for(var s=0;s<i;s+=3){n[0]=a[s];n[p]=t;n[m]=a[s+2];o[0]=(a[s]*g[0]-_[0])/x;o[1]=(a[s+2]*g[m]-_[2])/x;h.set(u,n);if(d){c.set(u,l)}f.set(u++,o)}}function b(e,t,r){var a=u;T(e,t,r);var i=e.indices.length;for(var n=0;n<i;n++){v[o*3+n]=e.indices[n]+a}o+=e.indices.length/3}var w=this.extrudeY?[0,1,0]:[0,0,1];var E=W.negate([],w);for(var S=0;S<s.length;S++){var A=u;var M=s[S];b(M,0,0);b(M,a,0);var C=M.points.length/3;for(var L=0;L<C;L++){n.set(A+L,E);n.set(A+L+C,w)}var D=[0,3,1,1,3,2];var N=[[],[],[],[]];var I=[];var R=[];var P=[];var O=[];var F=0;for(var L=0;L<C;L++){var B=(L+1)%C;var U=(M.points[B*3]-M.points[L*3])*g[0];var z=(M.points[B*3+2]-M.points[L*3+2])*g[m];var G=Math.sqrt(U*U+z*z);for(var H=0;H<4;H++){var V=H===0||H===3;var k=(V?L:B)*3;N[H][0]=M.points[k];N[H][p]=H>1?a:0;N[H][m]=M.points[k+2];h.set(u+H,N[H]);if(i){O[0]=(M.points[k]*g[0]-_[0])/x;O[1]=(M.points[k+2]*g[m]-_[m])/x}else{O[0]=(V?F:F+G)/x;O[1]=(N[H][p]*g[p]-_[p])/x}f.set(u+H,O)}W.sub(I,N[1],N[0]);W.sub(R,N[3],N[0]);W.cross(P,I,R);W.normalize(P,P);for(var H=0;H<4;H++){n.set(u+H,P);if(d){c.set(u+H,l)}}for(var H=0;H<6;H++){v[o*3+H]=D[H]+u}u+=4;o+=2;F+=G}}t.dirty();return{vertexOffset:u,triangleOffset:o}},_getRegionLinesInfo:function(e,t,i){var n=0;var o=0;var r=t.getRegionModel(e);var a=r.getModel("itemStyle");var s=a.get("borderWidth");if(s>0){var u=t.getRegionPolygonCoords(e);u.forEach(function(e){var t=e.exterior;var r=e.interiors;n+=i.getPolylineVertexCount(t);o+=i.getPolylineTriangleCount(t);for(var a=0;a<r.length;a++){n+=i.getPolylineVertexCount(r[a]);o+=i.getPolylineTriangleCount(r[a])}},this)}return{vertexCount:n,triangleCount:o}},_updateLinesGeometry:function(i,e,t,n,o,s){function u(e){var t=new Float64Array(e.length*3);var r=0;var a=[];for(var i=0;i<e.length;i++){a[0]=e[i][0];a[1]=n+.1;a[2]=e[i][1];if(s){W.transformMat4(a,a,s)}t[r++]=a[0];t[r++]=a[1];t[r++]=a[2]}return t}var l=[1,1,1,1];var r=e.getRegionPolygonCoords(t);r.forEach(function(e){var t=e.exterior;var r=e.interiors;i.addPolyline(u(t),l,o);for(var a=0;a<r.length;a++){i.addPolyline(u(r[a]),l,o)}})},highlight:function(e){var t=this._data;if(!t){return}var r=t.getItemModel(e);var a=r.getModel("emphasis.itemStyle");var i=a.get("color");var n=E["a"].firstNotNull(a.get("opacity"),t.getItemVisual(e,"opacity"),1);if(i==null){var o=t.getItemVisual(e,"color");i=u.a.color.lift(o,-.4)}if(n==null){n=t.getItemVisual(e,"opacity")}var s=w["a"].parseColor(i);s[3]*=n;this._setColorOfDataIndex(t,e,s)},downplay:function(e){var t=this._data;if(!t){return}var r=t.getItemVisual(e,"color");var a=E["a"].firstNotNull(t.getItemVisual(e,"opacity"),1);var i=w["a"].parseColor(r);i[3]*=a;this._setColorOfDataIndex(t,e,i)},_setColorOfDataIndex:function(e,t,r){if(t<this._startIndex&&t>this._endIndex){return}t-=this._startIndex;for(var a=this._vertexRangeOfDataIndex[t*2];a<this._vertexRangeOfDataIndex[t*2+1];a++){this._polygonMesh.geometry.attributes.color.set(a,r)}this._polygonMesh.geometry.dirty();this._api.getZr().refresh()}};t["a"]=h},function(e,t,r){"use strict";var i=r(97);var a=r(6);var _=a["a"].vec3;var y=_.create();var x=_.create();var T=_.create();t["a"]={needsSortTriangles:function(){return this.indices&&this.sortTriangles},needsSortTrianglesProgressively:function(){return this.needsSortTriangles()&&this.triangleCount>=2e4},doSortTriangles:function(e,t){var r=this.indices;if(t===0){var a=this.attributes.position;var e=e.array;if(!this._triangleZList||this._triangleZList.length!==this.triangleCount){this._triangleZList=new Float32Array(this.triangleCount);this._sortedTriangleIndices=new Uint32Array(this.triangleCount);this._indicesTmp=new r.constructor(r.length);this._triangleZListTmp=new Float32Array(this.triangleCount)}var i=0;var n;for(var o=0;o<r.length;){a.get(r[o++],y);a.get(r[o++],x);a.get(r[o++],T);var s=_.sqrDist(y,e);var u=_.sqrDist(x,e);var l=_.sqrDist(T,e);var h=Math.min(s,u);h=Math.min(h,l);if(o===3){n=h;h=0}else{h=h-n}this._triangleZList[i++]=h}}var f=this._sortedTriangleIndices;for(var o=0;o<f.length;o++){f[o]=o}if(this.triangleCount<2e4){if(t===0){this._simpleSort(true)}}else{for(var o=0;o<3;o++){this._progressiveQuickSort(t*3+o)}}var c=this._indicesTmp;var d=this._triangleZListTmp;var v=this._triangleZList;for(var o=0;o<this.triangleCount;o++){var p=f[o]*3;var m=o*3;c[m++]=r[p++];c[m++]=r[p++];c[m]=r[p];d[o]=v[f[o]]}var g=this._indicesTmp;this._indicesTmp=this.indices;this.indices=g;var g=this._triangleZListTmp;this._triangleZListTmp=this._triangleZList;this._triangleZList=g;this.dirtyIndices()},_simpleSort:function(e){var r=this._triangleZList;var t=this._sortedTriangleIndices;function a(e,t){return r[t]-r[e]}if(e){Array.prototype.sort.call(t,a)}else{i["a"].sort(t,a,0,t.length-1)}},_progressiveQuickSort:function(e){var r=this._triangleZList;var t=this._sortedTriangleIndices;this._quickSort=this._quickSort||new i["a"];this._quickSort.step(t,function(e,t){return r[t]-r[e]},e)}}},function(e,t,r){"use strict";var a=r(0);var C=r.n(a);var i=r(81);var n=r(63);var L=r(2);var D=1;var N=2;function o(e,t,r){this._labelsMesh=new n["a"];this._labelTextureSurface=new i["a"]({width:512,height:512,devicePixelRatio:r.getDevicePixelRatio(),onupdate:function(){r.getZr().refresh()}});this._api=r;this._labelsMesh.material.set("textureAtlas",this._labelTextureSurface.getTexture())}o.prototype.getLabelPosition=function(e,t,r){return[0,0,0]};o.prototype.getLabelDistance=function(e,t,r){return 0};o.prototype.getMesh=function(){return this._labelsMesh};o.prototype.updateData=function(e,t,r){if(t==null){t=0}if(r==null){r=e.count()}if(!this._labelsVisibilitiesBits||this._labelsVisibilitiesBits.length!==r-t){this._labelsVisibilitiesBits=new Uint8Array(r-t)}var a=["label","show"];var i=["emphasis","label","show"];for(var n=t;n<r;n++){var o=e.getItemModel(n);var s=o.get(a);var u=o.get(i);if(u==null){u=s}var l=(s?D:0)|(u?N:0);this._labelsVisibilitiesBits[n-t]=l}this._start=t;this._end=r;this._data=e};o.prototype.updateLabels=function(e){if(!this._data){return}e=e||[];var t=e.length>0;var r={};for(var a=0;a<e.length;a++){r[e[a]]=true}this._labelsMesh.geometry.convertToDynamicArray(true);this._labelTextureSurface.clear();var i=["label"];var n=["emphasis","label"];var o=this._data.hostModel;var s=this._data;var u=o.getModel(i);var l=o.getModel(n,u);var h={left:"right",right:"left",top:"center",bottom:"center"};var f={left:"middle",right:"middle",top:"bottom",bottom:"top"};for(var c=this._start;c<this._end;c++){var d=false;if(t&&r[c]){d=true}var v=this._labelsVisibilitiesBits[c-this._start]&(d?N:D);if(!v){continue}var p=s.getItemModel(c);var m=p.getModel(d?n:i,d?l:u);var g=m.get("distance")||0;var _=m.get("position");var y=m.getModel("textStyle");var x=this._api.getDevicePixelRatio();var T=o.getFormattedLabel(c,d?"emphasis":"normal");if(T==null||T===""){return}var b=new C.a.graphic.Text;C.a.graphic.setTextStyle(b.style,y,{text:T,textFill:y.get("color")||s.getItemVisual(c,"color")||"#000",textAlign:"left",textVerticalAlign:"top",opacity:L["a"].firstNotNull(y.get("opacity"),s.getItemVisual(c,"opacity"),1)});var w=b.getBoundingRect();var E=1.2;w.height*=E;var S=this._labelTextureSurface.add(b);var A=h[_]||"center";var M=f[_]||"bottom";this._labelsMesh.geometry.addSprite(this.getLabelPosition(c,_,g),[w.width*x,w.height*x],S,A,M,this.getLabelDistance(c,_,g)*x)}this._labelsMesh.material.set("uvScale",this._labelTextureSurface.getCoordsScale());this._labelTextureSurface.getZr().refreshImmediately();this._labelsMesh.geometry.convertToTypedArray();this._labelsMesh.geometry.dirty()};t["a"]=o},function(e,t,r){"use strict";var a=r(0);var u=r.n(a);var M=r(1);var n=r(239);var C=r(240);var i=r(66);var o=r(9);var d=r(2);var s=20;var L=-10;function l(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]}function h(e,t){this.rootNode=new M["a"].Node;this.is2D=e;this._labelsBuilder=new i["a"](256,256,t);this._labelsBuilder.getMesh().renderOrder=100;this.rootNode.add(this._labelsBuilder.getMesh());this._api=t;this._spriteImageCanvas=document.createElement("canvas");this._startDataIndex=0;this._endDataIndex=0;this._sizeScale=1}h.prototype={constructor:h,highlightOnMouseover:true,update:function(e,t,r,a,i){var n=this._prevMesh;this._prevMesh=this._mesh;this._mesh=n;var o=e.getData();if(a==null){a=0}if(i==null){i=o.count()}this._startDataIndex=a;this._endDataIndex=i-1;if(!this._mesh){var s=this._prevMesh&&this._prevMesh.material;this._mesh=new C["a"]({renderOrder:10,frustumCulling:false});if(s){this._mesh.material=s}}var s=this._mesh.material;var u=this._mesh.geometry;var l=u.attributes;this.rootNode.remove(this._prevMesh);this.rootNode.add(this._mesh);this._setPositionTextureToMesh(this._mesh,this._positionTexture);var h=this._getSymbolInfo(e,a,i);var f=r.getDevicePixelRatio();var c=e.getModel("itemStyle").getItemStyle();var d=e.get("large");var v=1;if(h.maxSize>2){v=this._updateSymbolSprite(e,c,h,f);s.enableTexture("sprite")}else{s.disableTexture("sprite")}l.position.init(i-a);var p=[];if(d){s.undefine("VERTEX_SIZE");s.undefine("VERTEX_COLOR");var m=o.getVisual("color");var g=o.getVisual("opacity");M["a"].parseColor(m,p);p[3]*=g;s.set({color:p,u_Size:h.maxSize*this._sizeScale})}else{s.set({color:[1,1,1,1]});s.define("VERTEX_SIZE");s.define("VERTEX_COLOR");l.size.init(i-a);l.color.init(i-a);this._originalOpacity=new Float32Array(i-a)}var _=o.getLayout("points");var y=l.position.value;var x=false;for(var T=0;T<i-a;T++){var b=T*3;var w=T*2;if(this.is2D){y[b]=_[w];y[b+1]=_[w+1];y[b+2]=L}else{y[b]=_[b];y[b+1]=_[b+1];y[b+2]=_[b+2]}if(!d){var m=o.getItemVisual(T,"color");var g=o.getItemVisual(T,"opacity");M["a"].parseColor(m,p);p[3]*=g;l.color.set(T,p);if(p[3]<.99){x=true}var E=o.getItemVisual(T,"symbolSize");E=E instanceof Array?Math.max(E[0],E[1]):E;if(isNaN(E)){E=0}l.size.value[T]=E*v*this._sizeScale;this._originalOpacity[T]=p[3]}}this._mesh.sizeScale=v;u.updateBoundingBox();u.dirty();this._updateMaterial(e,c);var S=e.coordinateSystem;if(S&&S.viewGL){var A=S.viewGL.isLinearSpace()?"define":"undefine";s[A]("fragment","SRGB_DECODE")}if(!d){this._updateLabelBuilder(e,a,i)}this._updateHandler(e,t,r);this._updateAnimation(e);this._api=r},getPointsMesh:function(){return this._mesh},updateLabels:function(e){this._labelsBuilder.updateLabels(e)},hideLabels:function(){this.rootNode.remove(this._labelsBuilder.getMesh())},showLabels:function(){this.rootNode.add(this._labelsBuilder.getMesh())},_updateSymbolSprite:function(e,t,r,a){r.maxSize=Math.min(r.maxSize*2,200);var i=[];if(r.aspect>1){i[0]=r.maxSize;i[1]=r.maxSize/r.aspect}else{i[1]=r.maxSize;i[0]=r.maxSize*r.aspect}i[0]=i[0]||1;i[1]=i[1]||1;if(this._symbolType!==r.type||!l(this._symbolSize,i)||this._lineWidth!==t.lineWidth){n["a"].createSymbolSprite(r.type,i,{fill:"#fff",lineWidth:t.lineWidth,stroke:"transparent",shadowColor:"transparent",minMargin:Math.min(i[0]/2,10)},this._spriteImageCanvas);n["a"].createSDFFromCanvas(this._spriteImageCanvas,Math.min(this._spriteImageCanvas.width,32),s,this._mesh.material.get("sprite").image);this._symbolType=r.type;this._symbolSize=i;this._lineWidth=t.lineWidth}return this._spriteImageCanvas.width/r.maxSize*a},_updateMaterial:function(e,t){var r=e.get("blendMode")==="lighter"?M["a"].additiveBlend:null;var a=this._mesh.material;a.blend=r;a.set("lineWidth",t.lineWidth/s);var i=M["a"].parseColor(t.stroke);a.set("strokeColor",i);a.transparent=true;a.depthMask=false;a.depthTest=!this.is2D;a.sortVertices=!this.is2D},_updateLabelBuilder:function(e,i,t){var r=e.getData();var n=this._mesh.geometry;var o=n.attributes.position.value;var i=this._startDataIndex;var s=this._mesh.sizeScale;this._labelsBuilder.updateData(r,i,t);this._labelsBuilder.getLabelPosition=function(e,t,r){var a=(e-i)*3;return[o[a],o[a+1],o[a+2]]};this._labelsBuilder.getLabelDistance=function(e,t,r){var a=n.attributes.size.get(e-i)/s;return a/2+r};this._labelsBuilder.updateLabels()},_updateAnimation:function(e){M["a"].updateVertexAnimation([["prevPosition","position"],["prevSize","size"]],this._prevMesh,this._mesh,e)},_updateHandler:function(r,e,a){var i=r.getData();var n=this._mesh;var o=this;var s=-1;var u=r.coordinateSystem&&r.coordinateSystem.type==="cartesian3D";var l;if(u){l=r.coordinateSystem.model}n.seriesIndex=r.seriesIndex;n.off("mousemove");n.off("mouseout");n.on("mousemove",function(e){var t=e.vertexIndex+o._startDataIndex;if(t!==s){if(this.highlightOnMouseover){this.downplay(i,s);this.highlight(i,t);this._labelsBuilder.updateLabels([t])}if(u){a.dispatchAction({type:"grid3DShowAxisPointer",value:[i.get(r.coordDimToDataDim("x")[0],t),i.get(r.coordDimToDataDim("y")[0],t),i.get(r.coordDimToDataDim("z")[0],t)],grid3DIndex:l.componentIndex})}}n.dataIndex=t;s=t},this);n.on("mouseout",function(e){var t=e.vertexIndex+o._startDataIndex;if(this.highlightOnMouseover){this.downplay(i,t);this._labelsBuilder.updateLabels()}s=-1;n.dataIndex=-1;if(u){a.dispatchAction({type:"grid3DHideAxisPointer",grid3DIndex:l.componentIndex})}},this)},updateLayout:function(e,t,r){var a=e.getData();if(!this._mesh){return}var i=this._mesh.geometry.attributes.position.value;var n=a.getLayout("points");if(this.is2D){for(var o=0;o<n.length/2;o++){var s=o*3;var u=o*2;i[s]=n[u];i[s+1]=n[u+1];i[s+2]=L}}else{for(var o=0;o<n.length;o++){i[o]=n[o]}}this._mesh.geometry.dirty();r.getZr().refresh()},updateView:function(e){if(!this._mesh){return}var t=new o["a"];o["a"].mul(t,e.viewMatrix,this._mesh.worldTransform);o["a"].mul(t,e.projectionMatrix,t);this._mesh.updateNDCPosition(t,this.is2D,this._api)},highlight:function(e,t){if(t>this._endDataIndex||t<this._startDataIndex){return}var r=e.getItemModel(t);var a=r.getModel("emphasis.itemStyle");var i=a.get("color");var n=a.get("opacity");if(i==null){var o=e.getItemVisual(t,"color");i=u.a.color.lift(o,-.4)}if(n==null){n=e.getItemVisual(t,"opacity")}var s=M["a"].parseColor(i);s[3]*=n;this._mesh.geometry.attributes.color.set(t-this._startDataIndex,s);this._mesh.geometry.dirtyAttribute("color");this._api.getZr().refresh()},downplay:function(e,t){if(t>this._endDataIndex||t<this._startDataIndex){return}var r=e.getItemVisual(t,"color");var a=e.getItemVisual(t,"opacity");var i=M["a"].parseColor(r);i[3]*=a;this._mesh.geometry.attributes.color.set(t-this._startDataIndex,i);this._mesh.geometry.dirtyAttribute("color");this._api.getZr().refresh()},fadeOutAll:function(e){if(this._originalOpacity){var t=this._mesh.geometry;for(var r=0;r<t.vertexCount;r++){var a=this._originalOpacity[r]*e;t.attributes.color.value[r*4+3]=a}t.dirtyAttribute("color");this._api.getZr().refresh()}},fadeInAll:function(){this.fadeOutAll(1)},setPositionTexture:function(e){if(this._mesh){this._setPositionTextureToMesh(this._mesh,e)}this._positionTexture=e},removePositionTexture:function(){this._positionTexture=null;if(this._mesh){this._setPositionTextureToMesh(this._mesh,null)}},setSizeScale:function(e){if(e!==this._sizeScale){if(this._mesh){var t=this._mesh.material.get("u_Size");this._mesh.material.set("u_Size",t/this._sizeScale*e);var r=this._mesh.geometry.attributes;if(r.size.value){for(var a=0;a<r.size.value.length;a++){r.size.value[a]=r.size.value[a]/this._sizeScale*e}}}this._sizeScale=e}},_setPositionTextureToMesh:function(e,t){if(t){e.material.set("positionTexture",t)}e.material[t?"enableTexture":"disableTexture"]("positionTexture")},_getSymbolInfo:function(e,t,r){if(e.get("large")){var a=d["a"].firstNotNull(e.get("symbolSize"),1);var i;var n;if(a instanceof Array){i=Math.max(a[0],a[1]);n=a[0]/a[1]}else{i=a;n=1}return{maxSize:a,type:e.get("symbol"),aspect:n}}var o=e.getData();var n;var s=false;var u=o.getItemVisual(0,"symbol")||"circle";var l=false;var i=0;for(var h=t;h<r;h++){var a=o.getItemVisual(h,"symbolSize");var f=o.getItemVisual(h,"symbol");var c;if(!(a instanceof Array)){if(isNaN(a)){return}c=1;i=Math.max(a,i)}else{c=a[0]/a[1];i=Math.max(Math.max(a[0],a[1]),i)}if(true){if(n!=null&&Math.abs(c-n)>.05){s=true}if(f!==u){l=true}}u=f;n=c}if(true){if(s){console.warn("Different symbol width / height ratio will be ignored.")}if(l){console.warn("Different symbol type will be ignored.")}}return{maxSize:i,type:u,aspect:n}}};t["a"]=h},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(1,eval)("this")}catch(e){if(typeof window==="object")r=window}e.exports=r},function(e,t,r){"use strict";var a=r(114);var i=function(e){this._list=new a["a"];this._map={};this._maxSize=e||10};i.prototype.setMaxSize=function(e){this._maxSize=e};i.prototype.put=function(e,t){if(!this._map.hasOwnProperty(e)){var r=this._list.length();if(r>=this._maxSize&&r>0){var a=this._list.head;this._list.remove(a);delete this._map[a.key]}var i=this._list.insert(t);i.key=e;this._map[e]=i}};i.prototype.get=function(e){var t=this._map[e];if(this._map.hasOwnProperty(e)){if(t!==this._list.tail){this._list.remove(t);this._list.insertEntry(t)}return t.value}};i.prototype.remove=function(e){var t=this._map[e];if(typeof t!=="undefined"){delete this._map[e];this._list.remove(t)}};i.prototype.clear=function(){this._list.clear();this._map={}};t["a"]=i},function(e,t,r){"use strict";var a=r(20);var i={};i.create=function(){var e=new a["a"](2);e[0]=0;e[1]=0;return e};i.clone=function(e){var t=new a["a"](2);t[0]=e[0];t[1]=e[1];return t};i.fromValues=function(e,t){var r=new a["a"](2);r[0]=e;r[1]=t;return r};i.copy=function(e,t){e[0]=t[0];e[1]=t[1];return e};i.set=function(e,t,r){e[0]=t;e[1]=r;return e};i.add=function(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];return e};i.subtract=function(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];return e};i.sub=i.subtract;i.multiply=function(e,t,r){e[0]=t[0]*r[0];e[1]=t[1]*r[1];return e};i.mul=i.multiply;i.divide=function(e,t,r){e[0]=t[0]/r[0];e[1]=t[1]/r[1];return e};i.div=i.divide;i.min=function(e,t,r){e[0]=Math.min(t[0],r[0]);e[1]=Math.min(t[1],r[1]);return e};i.max=function(e,t,r){e[0]=Math.max(t[0],r[0]);e[1]=Math.max(t[1],r[1]);return e};i.scale=function(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;return e};i.scaleAndAdd=function(e,t,r,a){e[0]=t[0]+r[0]*a;e[1]=t[1]+r[1]*a;return e};i.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(r*r+a*a)};i.dist=i.distance;i.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1];return r*r+a*a};i.sqrDist=i.squaredDistance;i.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)};i.len=i.length;i.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r};i.sqrLen=i.squaredLength;i.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];return e};i.inverse=function(e,t){e[0]=1/t[0];e[1]=1/t[1];return e};i.normalize=function(e,t){var r=t[0],a=t[1];var i=r*r+a*a;if(i>0){i=1/Math.sqrt(i);e[0]=t[0]*i;e[1]=t[1]*i}return e};i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]};i.cross=function(e,t,r){var a=t[0]*r[1]-t[1]*r[0];e[0]=e[1]=0;e[2]=a;return e};i.lerp=function(e,t,r,a){var i=t[0],n=t[1];e[0]=i+a*(r[0]-i);e[1]=n+a*(r[1]-n);return e};i.random=function(e,t){t=t||1;var r=GLMAT_RANDOM()*2*Math.PI;e[0]=Math.cos(r)*t;e[1]=Math.sin(r)*t;return e};i.transformMat2=function(e,t,r){var a=t[0],i=t[1];e[0]=r[0]*a+r[2]*i;e[1]=r[1]*a+r[3]*i;return e};i.transformMat2d=function(e,t,r){var a=t[0],i=t[1];e[0]=r[0]*a+r[2]*i+r[4];e[1]=r[1]*a+r[3]*i+r[5];return e};i.transformMat3=function(e,t,r){var a=t[0],i=t[1];e[0]=r[0]*a+r[3]*i+r[6];e[1]=r[1]*a+r[4]*i+r[7];return e};i.transformMat4=function(e,t,r){var a=t[0],i=t[1];e[0]=r[0]*a+r[4]*i+r[12];e[1]=r[1]*a+r[5]*i+r[13];return e};i.forEach=function(){var u=i.create();return function(e,t,r,a,i,n){var o,s;if(!t){t=2}if(!r){r=0}if(a){s=Math.min(a*t+r,e.length)}else{s=e.length}for(o=r;o<s;o+=t){u[0]=e[o];u[1]=e[o+1];i(u,u,n);e[o]=u[0];e[o+1]=u[1]}return e}}();t["a"]=i},function(e,t,r){"use strict";t["a"]="@export clay.prez.vertex\nuniform mat4 WVP : WORLDVIEWPROJECTION;\nattribute vec3 pos : POSITION;\nattribute vec2 uv : TEXCOORD_0;\n@import clay.chunk.skinning_header\nvarying vec2 v_Texcoord;\nvoid main()\n{\n vec3 P = pos;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = (skinMatrixWS * vec4(pos, 1.0)).xyz;\n#endif\n gl_Position = WVP * vec4(P, 1.0);\n v_Texcoord = uv;\n}\n@end\n@export clay.prez.fragment\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n@end"},function(e,t,r){"use strict";var i=r(35);var a=r(11);var n=i["a"].extend({material:null,geometry:null,mode:a["a"].TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:true,cullFace:a["a"].BACK,frontFace:a["a"].CCW,frustumCulling:true,receiveShadow:true,castShadow:true,ignorePicking:false,ignorePreZ:false,ignoreGBuffer:false,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&this.geometry.vertexCount>0},beforeRender:function(e){},afterRender:function(e,t){},getBoundingBox:function(e,t){t=i["a"].prototype.getBoundingBox.call(this,e,t);if(this.geometry&&this.geometry.boundingBox){t.union(this.geometry.boundingBox)}return t},clone:function(){var a=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"];return function(){var e=i["a"].prototype.clone.call(this);e.geometry=this.geometry;e.material=this.material;for(var t=0;t<a.length;t++){var r=a[t];if(e[r]!==this[r]){e[r]=this[r]}}return e}}()});n.POINTS=a["a"].POINTS;n.LINES=a["a"].LINES;n.LINE_LOOP=a["a"].LINE_LOOP;n.LINE_STRIP=a["a"].LINE_STRIP;n.TRIANGLES=a["a"].TRIANGLES;n.TRIANGLE_STRIP=a["a"].TRIANGLE_STRIP;n.TRIANGLE_FAN=a["a"].TRIANGLE_FAN;n.BACK=a["a"].BACK;n.FRONT=a["a"].FRONT;n.FRONT_AND_BACK=a["a"].FRONT_AND_BACK;n.CW=a["a"].CW;n.CCW=a["a"].CCW;t["a"]=n},function(e,t,r){"use strict";var a={};a.isPowerOfTwo=function(e){return(e&e-1)===0};a.nextPowerOfTwo=function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;return e};a.nearestPowerOfTwo=function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))};t["a"]=a},function(e,t,r){"use strict";var f=r(3);var i=r(21);var c=r(12);var n=r(33);var a=function(e,t){this.normal=e||new f["a"](0,1,0);this.distance=t||0};a.prototype={constructor:a,distanceToPoint:function(e){return c["a"].dot(e.array,this.normal.array)-this.distance},projectPoint:function(e,t){if(!t){t=new f["a"]}var r=this.distanceToPoint(e);c["a"].scaleAndAdd(t.array,e.array,this.normal.array,-r);t._dirty=true;return t},normalize:function(){var e=1/c["a"].len(this.normal.array);c["a"].scale(this.normal.array,e);this.distance*=e},intersectFrustum:function(e){var t=e.vertices;var r=this.normal.array;var a=c["a"].dot(t[0].array,r)>this.distance;for(var i=1;i<8;i++){if(c["a"].dot(t[i].array,r)>this.distance!=a){return true}}},intersectLine:function(){var h=c["a"].create();return function(e,t,r){var a=this.distanceToPoint(e);var i=this.distanceToPoint(t);if(a>0&&i>0||a<0&&i<0){return null}var n=this.normal.array;var o=this.distance;var s=e.array;c["a"].sub(h,t.array,e.array);c["a"].normalize(h,h);var u=c["a"].dot(n,h);if(u===0){return null}if(!r){r=new f["a"]}var l=(c["a"].dot(n,s)-o)/u;c["a"].scaleAndAdd(r.array,s,h,-l);r._dirty=true;return r}}(),applyTransform:function(){var t=i["a"].create();var r=n["a"].create();var a=n["a"].create();a[3]=1;return function(e){e=e.array;c["a"].scale(a,this.normal.array,this.distance);n["a"].transformMat4(a,a,e);this.distance=c["a"].dot(a,this.normal.array);i["a"].invert(t,e);i["a"].transpose(t,t);r[3]=0;c["a"].copy(r,this.normal.array);n["a"].transformMat4(r,r,t);c["a"].copy(this.normal.array,r)}}(),copy:function(e){c["a"].copy(this.normal.array,e.normal.array);this.normal._dirty=true;this.distance=e.distance},clone:function(){var e=new a;e.copy(this);return e}};t["a"]=a},function(e,t,r){"use strict";var a=r(42);t["a"]=a["a"]},function(e,t,r){"use strict";var a=r(15);var i=r(43);var n=r(9);var o=r(3);var m=r(18);var g=r(14);var s=new n["a"];var u=a["a"].extend({dynamic:false,widthSegments:1,heightSegments:1,depthSegments:1,inside:false},function(){this.build()},{build:function(){var e={px:_("px",this.depthSegments,this.heightSegments),nx:_("nx",this.depthSegments,this.heightSegments),py:_("py",this.widthSegments,this.depthSegments),ny:_("ny",this.widthSegments,this.depthSegments),pz:_("pz",this.widthSegments,this.heightSegments),nz:_("nz",this.widthSegments,this.heightSegments)};var t=["position","texcoord0","normal"];var r=0;var a=0;for(var i in e){r+=e[i].vertexCount;a+=e[i].indices.length}for(var n=0;n<t.length;n++){this.attributes[t[n]].init(r)}this.indices=new g["a"].Uint16Array(a);var o=0;var s=0;for(var i in e){var u=e[i];for(var n=0;n<t.length;n++){var l=t[n];var h=u.attributes[l].value;var f=u.attributes[l].size;var c=l==="normal";for(var d=0;d<h.length;d++){var v=h[d];if(this.inside&&c){v=-v}this.attributes[l].value[d+f*s]=v}}var p=u.indices.length;for(var d=0;d<u.indices.length;d++){this.indices[d+o]=s+u.indices[this.inside?p-d-1:d]}o+=u.indices.length;s+=u.vertexCount}this.boundingBox=new m["a"];this.boundingBox.max.set(1,1,1);this.boundingBox.min.set(-1,-1,-1)}});function _(e,t,r){s.identity();var a=new i["a"]({widthSegments:t,heightSegments:r});switch(e){case"px":n["a"].translate(s,s,o["a"].POSITIVE_X);n["a"].rotateY(s,s,Math.PI/2);break;case"nx":n["a"].translate(s,s,o["a"].NEGATIVE_X);n["a"].rotateY(s,s,-Math.PI/2);break;case"py":n["a"].translate(s,s,o["a"].POSITIVE_Y);n["a"].rotateX(s,s,-Math.PI/2);break;case"ny":n["a"].translate(s,s,o["a"].NEGATIVE_Y);n["a"].rotateX(s,s,Math.PI/2);break;case"pz":n["a"].translate(s,s,o["a"].POSITIVE_Z);break;case"nz":n["a"].translate(s,s,o["a"].NEGATIVE_Z);n["a"].rotateY(s,s,Math.PI);break}a.applyTransform(s);return a}t["a"]=u},function(e,t,r){"use strict";var S=r(5);var A=r(27);var M=r(4);var C=r(10);var n=r(16);var L=r(19);var D=r(8);var N=r(42);var I=r(36);var R=r(62);var P=r(14);var O=r(61);var o=r(127);var F=r(128);var B={};var U=["px","nx","py","ny","pz","nz"];B.prefilterEnvironmentMap=function(e,t,r,a,i){if(!i||!a){a=B.generateNormalDistribution();i=B.integrateBRDF(e,a)}r=r||{};var n=r.width||64;var o=r.height||64;var s=r.type||t.type;var u=new A["a"]({width:n,height:o,type:s,flipY:false,mipmaps:[]});if(!u.isPowerOfTwo()){console.warn("Width and height must be power of two to enable mipmap.")}var l=Math.min(n,o);var h=Math.log(l)/Math.log(2)+1;var f=new L["a"]({shader:new D["a"]({vertex:D["a"].source("clay.skybox.vertex"),fragment:F["a"]})});f.set("normalDistribution",a);r.encodeRGBM&&f.define("fragment","RGBM_ENCODE");r.decodeRGBM&&f.define("fragment","RGBM_DECODE");var c=new I["a"];var d;if(t.textureType==="texture2D"){var v=new A["a"]({width:n,height:o,type:s===M["a"].FLOAT?M["a"].HALF_FLOAT:s});O["a"].panoramaToCubeMap(e,t,v,{encodeRGBM:r.decodeRGBM});t=v}d=new N["a"]({scene:c,material:f});d.material.set("environmentMap",t);var p=new R["a"]({texture:u});if(r.encodeRGBM){s=u.type=M["a"].UNSIGNED_BYTE}var m=new S["a"]({width:n,height:o,type:s});var g=new C["a"]({depthBuffer:false});var _=P["a"][s===M["a"].UNSIGNED_BYTE?"Uint8Array":"Float32Array"];for(var y=0;y<h;y++){u.mipmaps[y]={pixels:{}};d.material.set("roughness",y/(h-1));var x=m.width;var T=2*Math.atan(x/(x-.5))/Math.PI*180;for(var b=0;b<U.length;b++){var w=new _(m.width*m.height*4);g.attach(m);g.bind(e);var E=p.getCamera(U[b]);E.fov=T;e.render(c,E);e.gl.readPixels(0,0,m.width,m.height,M["a"].RGBA,s,w);g.unbind(e);u.mipmaps[y].pixels[U[b]]=w}m.width/=2;m.height/=2;m.dirty()}g.dispose(e);m.dispose(e);d.dispose(e);a.dispose(e);return{environmentMap:u,brdfLookup:i,normalDistribution:a,maxMipmapLevel:h}};B.integrateBRDF=function(e,t){t=t||B.generateNormalDistribution();var r=new C["a"]({depthBuffer:false});var a=new n["a"]({fragment:o["a"]});var i=new S["a"]({width:512,height:256,type:M["a"].HALF_FLOAT,wrapS:M["a"].CLAMP_TO_EDGE,wrapT:M["a"].CLAMP_TO_EDGE,minFilter:M["a"].NEAREST,magFilter:M["a"].NEAREST,useMipmap:false});a.setUniform("normalDistribution",t);a.setUniform("viewportSize",[512,256]);a.attachOutput(i);a.render(e,r);r.dispose(e);return i};B.generateNormalDistribution=function(e,t){var e=e||256;var t=t||1024;var r=new S["a"]({width:e,height:t,type:M["a"].FLOAT,minFilter:M["a"].NEAREST,magFilter:M["a"].NEAREST,wrapS:M["a"].CLAMP_TO_EDGE,wrapT:M["a"].CLAMP_TO_EDGE,useMipmap:false});var a=new Float32Array(t*e*4);var i=[];for(var n=0;n<e;n++){var o=n/e;var s=o*o;for(var u=0;u<t;u++){var l=(u<<16|u>>>16)>>>0;l=((l&1431655765)<<1|(l&2863311530)>>>1)>>>0;l=((l&858993459)<<2|(l&3435973836)>>>2)>>>0;l=((l&252645135)<<4|(l&4042322160)>>>4)>>>0;l=(((l&16711935)<<8|(l&4278255360)>>>8)>>>0)/4294967296;var h=Math.sqrt((1-l)/(1+(s*s-1)*l));i[u]=h}for(var u=0;u<t;u++){var f=(u*e+n)*4;var h=i[u];var c=Math.sqrt(1-h*h);var d=u/t;var v=2*Math.PI*d;a[f]=c*Math.cos(v);a[f+1]=h;a[f+2]=c*Math.sin(v);a[f+3]=1}}r.pixels=a;return r};t["a"]=B},function(e,t,r){"use strict";var a=r(20);var i={};i.create=function(){var e=new a["a"](4);e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e};i.clone=function(e){var t=new a["a"](4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t};i.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e};i.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e};i.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2];e[2]=r}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e};i.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r*n-i*a;if(!o){return null}o=1/o;e[0]=n*o;e[1]=-a*o;e[2]=-i*o;e[3]=r*o;return e};i.adjoint=function(e,t){var r=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=r;return e};i.determinant=function(e){return e[0]*e[3]-e[2]*e[1]};i.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3];var s=r[0],u=r[1],l=r[2],h=r[3];e[0]=a*s+n*u;e[1]=i*s+o*u;e[2]=a*l+n*h;e[3]=i*l+o*h;return e};i.mul=i.multiply;i.rotate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=a*u+n*s;e[1]=i*u+o*s;e[2]=a*-s+n*u;e[3]=i*-s+o*u;return e};i.scale=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=r[0],u=r[1];e[0]=a*s;e[1]=i*s;e[2]=n*u;e[3]=o*u;return e};i.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))};i.LDU=function(e,t,r,a){e[2]=a[2]/a[0];r[0]=a[0];r[1]=a[1];r[3]=a[3]-e[2]*r[1];return[e,t,r]};t["a"]=i},function(e,t,r){"use strict";var a=r(20);var i={};i.create=function(){var e=new a["a"](6);e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e};i.clone=function(e){var t=new a["a"](6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t};i.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e};i.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e};i.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5];var u=r*n-a*i;if(!u){return null}u=1/u;e[0]=n*u;e[1]=-a*u;e[2]=-i*u;e[3]=r*u;e[4]=(i*s-n*o)*u;e[5]=(a*o-r*s)*u;return e};i.determinant=function(e){return e[0]*e[3]-e[1]*e[2]};i.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=r[0],h=r[1],f=r[2],c=r[3],d=r[4],v=r[5];e[0]=a*l+n*h;e[1]=i*l+o*h;e[2]=a*f+n*c;e[3]=i*f+o*c;e[4]=a*d+n*v+s;e[5]=i*d+o*v+u;return e};i.mul=i.multiply;i.rotate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=Math.sin(r),h=Math.cos(r);e[0]=a*h+n*l;e[1]=i*h+o*l;e[2]=a*-l+n*h;e[3]=i*-l+o*h;e[4]=s;e[5]=u;return e};i.scale=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=r[0],h=r[1];e[0]=a*l;e[1]=i*l;e[2]=n*h;e[3]=o*h;e[4]=s;e[5]=u;return e};i.translate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],u=t[5],l=r[0],h=r[1];e[0]=a;e[1]=i;e[2]=n;e[3]=o;e[4]=a*l+n*h+s;e[5]=i*l+o*h+u;return e};i.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)};t["a"]=i},function(e,t){var r=typeof window!=="undefined"&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){setTimeout(e,16)};e.exports=r},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(5);function u(e,t,r,a,i,n,o){this._zr=e;this._x=0;this._y=0;this._rowHeight=0;this.width=a;this.height=i;this.offsetX=t;this.offsetY=r;this.dpr=o;this.gap=n}u.prototype={constructor:u,clear:function(){this._x=0;this._y=0;this._rowHeight=0},add:function(e,t,r){var a=e.getBoundingRect();if(t==null){t=a.width}if(r==null){r=a.height}t*=this.dpr;r*=this.dpr;this._fitElement(e,t,r);var i=this._x;var n=this._y;var o=this.width*this.dpr;var s=this.height*this.dpr;var u=this.gap;if(i+t+u>o){i=this._x=0;n+=this._rowHeight+u;this._y=n;this._rowHeight=0}this._x+=t+u;this._rowHeight=Math.max(this._rowHeight,r);if(n+r+u>s){return null}e.position[0]+=this.offsetX*this.dpr+i;e.position[1]+=this.offsetY*this.dpr+n;this._zr.add(e);var l=[this.offsetX/this.width,this.offsetY/this.height];var h=[[i/o+l[0],n/s+l[1]],[(i+t)/o+l[0],(n+r)/s+l[1]]];return h},_fitElement:function(e,t,r){var a=e.getBoundingRect();var i=t/a.width;var n=r/a.height;e.position=[-a.x*i,-a.y*n];e.scale=[i,n];e.update()}};function o(e){e=e||{};e.width=e.width||512;e.height=e.height||512;e.devicePixelRatio=e.devicePixelRatio||1;e.gap=e.gap==null?2:e.gap;var t=document.createElement("canvas");t.width=e.width*e.devicePixelRatio;t.height=e.height*e.devicePixelRatio;this._canvas=t;this._texture=new n["a"]({image:t,flipY:false});var r=this;this._zr=i.a.zrender.init(t);var a=this._zr.refreshImmediately;this._zr.refreshImmediately=function(){a.call(this);r._texture.dirty();r.onupdate&&r.onupdate()};this._dpr=e.devicePixelRatio;this._coords={};this.onupdate=e.onupdate;this._gap=e.gap;this._textureAtlasNodes=[new u(this._zr,0,0,e.width,e.height,this._gap,this._dpr)];this._nodeWidth=e.width;this._nodeHeight=e.height;this._currentNodeIdx=0}o.prototype={clear:function(){for(var e=0;e<this._textureAtlasNodes.length;e++){this._textureAtlasNodes[e].clear()}this._currentNodeIdx=0;this._zr.clear();this._coords={}},getWidth:function(){return this._width},getHeight:function(){return this._height},getTexture:function(){return this._texture},getDevicePixelRatio:function(){return this._dpr},getZr:function(){return this._zr},_getCurrentNode:function(){return this._textureAtlasNodes[this._currentNodeIdx]},_expand:function(){this._currentNodeIdx++;if(this._textureAtlasNodes[this._currentNodeIdx]){return this._textureAtlasNodes[this._currentNodeIdx]}var e=4096/this._dpr;var t=this._textureAtlasNodes;var r=t.length;var a=r*this._nodeWidth%e;var i=Math.floor(r*this._nodeWidth/e)*this._nodeHeight;if(i>=e){if(true){console.error("Too much labels. Some will be ignored.")}return}var n=(a+this._nodeWidth)*this._dpr;var o=(i+this._nodeHeight)*this._dpr;try{this._zr.resize({width:n,height:o})}catch(e){this._canvas.width=n;this._canvas.height=o}var s=new u(this._zr,a,i,this._nodeWidth,this._nodeHeight,this._gap,this._dpr);this._textureAtlasNodes.push(s);return s},add:function(e,t,r){if(this._coords[e.id]){if(true){console.warn("Element already been add")}return this._coords[e.id]}var a=this._getCurrentNode().add(e,t,r);if(!a){var i=this._expand();if(!i){return}a=i.add(e,t,r)}this._coords[e.id]=a;return a},getCoordsScale:function(){var e=this._dpr;return[this._nodeWidth/this._canvas.width*e,this._nodeHeight/this._canvas.height*e]},getCoords:function(e){return this._coords[e]}};t["a"]=o},function(e,t,r){var a=r(83);var n=r(84);var s=a.applyTransform;var u=Math.min;var l=Math.max;function h(e,t,r,a){if(r<0){e=e+r;r=-r}if(a<0){t=t+a;a=-a}this.x=e;this.y=t;this.width=r;this.height=a}h.prototype={constructor:h,union:function(e){var t=u(e.x,this.x);var r=u(e.y,this.y);this.width=l(e.x+e.width,this.x+this.width)-t;this.height=l(e.y+e.height,this.y+this.height)-r;this.x=t;this.y=r},applyTransform:function(){var a=[];var i=[];var n=[];var o=[];return function(e){if(!e){return}a[0]=n[0]=this.x;a[1]=o[1]=this.y;i[0]=o[0]=this.x+this.width;i[1]=n[1]=this.y+this.height;s(a,a,e);s(i,i,e);s(n,n,e);s(o,o,e);this.x=u(a[0],i[0],n[0],o[0]);this.y=u(a[1],i[1],n[1],o[1]);var t=l(a[0],i[0],n[0],o[0]);var r=l(a[1],i[1],n[1],o[1]);this.width=t-this.x;this.height=r-this.y}}(),calculateTransform:function(e){var t=this;var r=e.width/t.width;var a=e.height/t.height;var i=n.create();n.translate(i,i,[-t.x,-t.y]);n.scale(i,i,[r,a]);n.translate(i,i,[e.x,e.y]);return i},intersect:function(e){if(!e){return false}if(!(e instanceof h)){e=h.create(e)}var t=this;var r=t.x;var a=t.x+t.width;var i=t.y;var n=t.y+t.height;var o=e.x;var s=e.x+e.width;var u=e.y;var l=e.y+e.height;return!(a<o||s<r||n<u||l<i)},contain:function(e,t){var r=this;return e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height},clone:function(){return new h(this.x,this.y,this.width,this.height)},copy:function(e){this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}};h.create=function(e){return new h(e.x,e.y,e.width,e.height)};var i=h;e.exports=i},function(e,t){var a=typeof Float32Array==="undefined"?Array:Float32Array;function r(e,t){var r=new a(2);if(e==null){e=0}if(t==null){t=0}r[0]=e;r[1]=t;return r}function i(e,t){e[0]=t[0];e[1]=t[1];return e}function n(e){var t=new a(2);t[0]=e[0];t[1]=e[1];return t}function o(e,t,r){e[0]=t;e[1]=r;return e}function s(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];return e}function u(e,t,r,a){e[0]=t[0]+r[0]*a;e[1]=t[1]+r[1]*a;return e}function l(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];return e}function h(e){return Math.sqrt(c(e))}var f=h;function c(e){return e[0]*e[0]+e[1]*e[1]}var d=c;function v(e,t,r){e[0]=t[0]*r[0];e[1]=t[1]*r[1];return e}function p(e,t,r){e[0]=t[0]/r[0];e[1]=t[1]/r[1];return e}function m(e,t){return e[0]*t[0]+e[1]*t[1]}function g(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;return e}function _(e,t){var r=h(t);if(r===0){e[0]=0;e[1]=0}else{e[0]=t[0]/r;e[1]=t[1]/r}return e}function y(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var x=y;function T(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var b=T;function w(e,t){e[0]=-t[0];e[1]=-t[1];return e}function E(e,t,r,a){e[0]=t[0]+a*(r[0]-t[0]);e[1]=t[1]+a*(r[1]-t[1]);return e}function S(e,t,r){var a=t[0];var i=t[1];e[0]=r[0]*a+r[2]*i+r[4];e[1]=r[1]*a+r[3]*i+r[5];return e}function A(e,t,r){e[0]=Math.min(t[0],r[0]);e[1]=Math.min(t[1],r[1]);return e}function M(e,t,r){e[0]=Math.max(t[0],r[0]);e[1]=Math.max(t[1],r[1]);return e}t.create=r;t.copy=i;t.clone=n;t.set=o;t.add=s;t.scaleAndAdd=u;t.sub=l;t.len=h;t.length=f;t.lenSquare=c;t.lengthSquare=d;t.mul=v;t.div=p;t.dot=m;t.scale=g;t.normalize=_;t.distance=y;t.dist=x;t.distanceSquare=T;t.distSquare=b;t.negate=w;t.lerp=E;t.applyTransform=S;t.min=A;t.max=M},function(e,t){var r=typeof Float32Array==="undefined"?Array:Float32Array;function a(){var e=new r(6);i(e);return e}function i(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function n(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function o(e,t,r){var a=t[0]*r[0]+t[2]*r[1];var i=t[1]*r[0]+t[3]*r[1];var n=t[0]*r[2]+t[2]*r[3];var o=t[1]*r[2]+t[3]*r[3];var s=t[0]*r[4]+t[2]*r[5]+t[4];var u=t[1]*r[4]+t[3]*r[5]+t[5];e[0]=a;e[1]=i;e[2]=n;e[3]=o;e[4]=s;e[5]=u;return e}function s(e,t,r){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4]+r[0];e[5]=t[5]+r[1];return e}function u(e,t,r){var a=t[0];var i=t[2];var n=t[4];var o=t[1];var s=t[3];var u=t[5];var l=Math.sin(r);var h=Math.cos(r);e[0]=a*h+o*l;e[1]=-a*l+o*h;e[2]=i*h+s*l;e[3]=-i*l+h*s;e[4]=h*n+l*u;e[5]=h*u-l*n;return e}function l(e,t,r){var a=r[0];var i=r[1];e[0]=t[0]*a;e[1]=t[1]*i;e[2]=t[2]*a;e[3]=t[3]*i;e[4]=t[4]*a;e[5]=t[5]*i;return e}function h(e,t){var r=t[0];var a=t[2];var i=t[4];var n=t[1];var o=t[3];var s=t[5];var u=r*o-n*a;if(!u){return null}u=1/u;e[0]=o*u;e[1]=-n*u;e[2]=-a*u;e[3]=r*u;e[4]=(a*s-o*i)*u;e[5]=(n*i-r*s)*u;return e}function f(e){var t=a();n(t,e);return t}t.create=a;t.identity=i;t.copy=n;t.mul=o;t.translate=s;t.rotate=u;t.scale=l;t.invert=h;t.clone=f},function(e,t,r){var v=r(13);var a=1e-4;function i(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function n(e,t,r,a){var i=t[1]-t[0];var n=r[1]-r[0];if(i===0){return n===0?r[0]:(r[0]+r[1])/2}if(a){if(i>0){if(e<=t[0]){return r[0]}else if(e>=t[1]){return r[1]}}else{if(e>=t[0]){return r[0]}else if(e<=t[1]){return r[1]}}}else{if(e===t[0]){return r[0]}if(e===t[1]){return r[1]}}return(e-t[0])/i*n+r[0]}function o(e,t){switch(e){case"center":case"middle":e="50%";break;case"left":case"top":e="0%";break;case"right":case"bottom":e="100%";break}if(typeof e==="string"){if(i(e).match(/%$/)){return parseFloat(e)/100*t}return parseFloat(e)}return e==null?NaN:+e}function s(e,t,r){if(t==null){t=10}t=Math.min(Math.max(0,t),20);e=(+e).toFixed(t);return r?e:+e}function u(e){e.sort(function(e,t){return e-t});return e}function l(e){e=+e;if(isNaN(e)){return 0}var t=1;var r=0;while(Math.round(e*t)/t!==e){t*=10;r++}return r}function h(e){var t=e.toString();var r=t.indexOf("e");if(r>0){var a=+t.slice(r+1);return a<0?-a:0}else{var i=t.indexOf(".");return i<0?0:t.length-1-i}}function f(e,t){var r=Math.log;var a=Math.LN10;var i=Math.floor(r(e[1]-e[0])/a);var n=Math.round(r(Math.abs(t[1]-t[0]))/a);var o=Math.min(Math.max(-i+n,0),20);return!isFinite(o)?20:o}function c(e,t,r){if(!e[t]){return 0}var a=v.reduce(e,function(e,t){return e+(isNaN(t)?0:t)},0);if(a===0){return 0}var i=Math.pow(10,r);var n=v.map(e,function(e){return(isNaN(e)?0:e)/a*i*100});var o=i*100;var s=v.map(n,function(e){return Math.floor(e)});var u=v.reduce(s,function(e,t){return e+t},0);var l=v.map(n,function(e,t){return e-s[t]});while(u<o){var h=Number.NEGATIVE_INFINITY;var f=null;for(var c=0,d=l.length;c<d;++c){if(l[c]>h){h=l[c];f=c}}++s[f];l[f]=0;++u}return s[t]/i}var d=9007199254740991;function p(e){var t=Math.PI*2;return(e%t+t)%t}function m(e){return e>-a&&e<a}var g=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function _(e){if(e instanceof Date){return e}else if(typeof e==="string"){var t=g.exec(e);if(!t){return new Date(NaN)}if(!t[8]){return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,+t[7]||0)}else{var r=+t[4]||0;if(t[8].toUpperCase()!=="Z"){r-=t[8].slice(0,3)}return new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,r,+(t[5]||0),+t[6]||0,+t[7]||0))}}else if(e==null){return new Date(NaN)}return new Date(Math.round(e))}function y(e){return Math.pow(10,x(e))}function x(e){return Math.floor(Math.log(e)/Math.LN10)}function T(e,t){var r=x(e);var a=Math.pow(10,r);var i=e/a;var n;if(t){if(i<1.5){n=1}else if(i<2.5){n=2}else if(i<4){n=3}else if(i<7){n=5}else{n=10}}else{if(i<1){n=1}else if(i<2){n=2}else if(i<3){n=3}else if(i<5){n=5}else{n=10}}e=n*a;return r>=-20?+e.toFixed(r<0?-r:0):e}function b(e){e.sort(function(e,t){return s(e,t,0)?-1:1});var t=-Infinity;var r=1;for(var a=0;a<e.length;){var i=e[a].interval;var n=e[a].close;for(var o=0;o<2;o++){if(i[o]<=t){i[o]=t;n[o]=!o?1-r:1}t=i[o];r=n[o]}if(i[0]===i[1]&&n[0]*n[1]!==1){e.splice(a,1)}else{a++}}return e;function s(e,t,r){return e.interval[r]<t.interval[r]||e.interval[r]===t.interval[r]&&(e.close[r]-t.close[r]===(!r?1:-1)||!r&&s(e,t,1))}}function w(e){return e-parseFloat(e)>=0}t.linearMap=n;t.parsePercent=o;t.round=s;t.asc=u;t.getPrecision=l;t.getPrecisionSafe=h;t.getPixelPrecision=f;t.getPercentWithPrecision=c;t.MAX_SAFE_INTEGER=d;t.remRadian=p;t.isRadianAroundZero=m;t.parseDate=_;t.quantity=y;t.nice=T;t.reformIntervals=b;t.isNumeric=w},function(e,t,r){"use strict";var i=r(5);var a=r(11);var n=r(23);var o=function(){this._pool={};this._allocatedTextures=[]};o.prototype={constructor:o,get:function(e){var t=l(e);if(!this._pool.hasOwnProperty(t)){this._pool[t]=[]}var r=this._pool[t];if(!r.length){var a=new i["a"](e);this._allocatedTextures.push(a);return a}return r.pop()},put:function(e){var t=l(e);if(!this._pool.hasOwnProperty(t)){this._pool[t]=[]}var r=this._pool[t];r.push(e)},clear:function(e){for(var t=0;t<this._allocatedTextures.length;t++){this._allocatedTextures[t].dispose(e)}this._pool={};this._allocatedTextures=[]}};var s={width:512,height:512,type:a["a"].UNSIGNED_BYTE,format:a["a"].RGBA,wrapS:a["a"].CLAMP_TO_EDGE,wrapT:a["a"].CLAMP_TO_EDGE,minFilter:a["a"].LINEAR_MIPMAP_LINEAR,magFilter:a["a"].LINEAR,useMipmap:true,anisotropic:1,flipY:true,unpackAlignment:4,premultiplyAlpha:false};var u=Object.keys(s);function l(e){n["a"].defaultsWithPropList(e,s,u);h(e);var t="";for(var r=0;r<u.length;r++){var a=u[r];var i=e[a].toString();t+=i}return t}function h(e){var t=f(e.width,e.height);if(e.format===a["a"].DEPTH_COMPONENT){e.useMipmap=false}if(!t||!e.useMipmap){if(e.minFilter==a["a"].NEAREST_MIPMAP_NEAREST||e.minFilter==a["a"].NEAREST_MIPMAP_LINEAR){e.minFilter=a["a"].NEAREST}else if(e.minFilter==a["a"].LINEAR_MIPMAP_LINEAR||e.minFilter==a["a"].LINEAR_MIPMAP_NEAREST){e.minFilter=a["a"].LINEAR}}if(!t){e.wrapS=a["a"].CLAMP_TO_EDGE;e.wrapT=a["a"].CLAMP_TO_EDGE}}function f(e,t){return(e&e-1)===0&&(t&t-1)===0}t["a"]=o},function(e,t,r){"use strict";t["a"]="@export clay.compositor.kernel.gaussian_9\nfloat gaussianKernel[9];\ngaussianKernel[0] = 0.07;\ngaussianKernel[1] = 0.09;\ngaussianKernel[2] = 0.12;\ngaussianKernel[3] = 0.14;\ngaussianKernel[4] = 0.16;\ngaussianKernel[5] = 0.14;\ngaussianKernel[6] = 0.12;\ngaussianKernel[7] = 0.09;\ngaussianKernel[8] = 0.07;\n@end\n@export clay.compositor.kernel.gaussian_13\nfloat gaussianKernel[13];\ngaussianKernel[0] = 0.02;\ngaussianKernel[1] = 0.03;\ngaussianKernel[2] = 0.06;\ngaussianKernel[3] = 0.08;\ngaussianKernel[4] = 0.11;\ngaussianKernel[5] = 0.13;\ngaussianKernel[6] = 0.14;\ngaussianKernel[7] = 0.13;\ngaussianKernel[8] = 0.11;\ngaussianKernel[9] = 0.08;\ngaussianKernel[10] = 0.06;\ngaussianKernel[11] = 0.03;\ngaussianKernel[12] = 0.02;\n@end\n@export clay.compositor.gaussian_blur\n#define SHADER_NAME gaussian_blur\nuniform sampler2D texture;varying vec2 v_Texcoord;\nuniform float blurSize : 2.0;\nuniform vec2 textureSize : [512.0, 512.0];\nuniform float blurDir : 0.0;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main (void)\n{\n @import clay.compositor.kernel.gaussian_9\n vec2 off = blurSize / textureSize;\n off *= vec2(1.0 - blurDir, blurDir);\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n for (int i = 0; i < 9; i++) {\n float w = gaussianKernel[i];\n vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));\n sum += texel * w;\n weightAll += w;\n }\n gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));\n}\n@end\n"},function(e,t,r){"use strict";t["a"]="\n@export clay.compositor.lut\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform sampler2D lookup;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n float blueColor = tex.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec4 newColor1 = texture2D(lookup, texPos1);\n vec4 newColor2 = texture2D(lookup, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.output\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = tex.rgb;\n#ifdef OUTPUT_ALPHA\n gl_FragColor.a = tex.a;\n#else\n gl_FragColor.a = 1.0;\n#endif\n gl_FragColor = encodeHDR(gl_FragColor);\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.bright\nuniform sampler2D texture;\nuniform float threshold : 1;\nuniform float scale : 1.0;\nuniform vec2 textureSize: [512, 512];\nvarying vec2 v_Texcoord;\nconst vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvec4 median(vec4 a, vec4 b, vec4 c)\n{\n return a + b + c - min(min(a, b), c) - max(max(a, b), c);\n}\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n#ifdef ANTI_FLICKER\n vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);\n vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));\n vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));\n vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));\n vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));\n texel = median(median(texel, s1, s2), s3, s4);\n#endif\n float lum = dot(texel.rgb , lumWeight);\n vec4 color;\n if (lum > threshold && texel.a > 0.0)\n {\n color = vec4(texel.rgb * scale, texel.a * scale);\n }\n else\n {\n color = vec4(0.0);\n }\n gl_FragColor = encodeHDR(color);\n}\n@end\n"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.downsample\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nfloat brightness(vec3 c)\n{\n return max(max(c.r, c.g), c.b);\n}\n@import clay.util.clamp_sample\nvoid main()\n{\n vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;\n#ifdef ANTI_FLICKER\n vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;\n vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;\n vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;\n vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;\n float s1w = 1.0 / (brightness(s1) + 1.0);\n float s2w = 1.0 / (brightness(s2) + 1.0);\n float s3w = 1.0 / (brightness(s3) + 1.0);\n float s4w = 1.0 / (brightness(s4) + 1.0);\n float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);\n vec4 color = vec4(\n (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,\n 1.0\n );\n#else\n vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n color *= 0.25;\n#endif\n gl_FragColor = encodeHDR(color);\n}\n@end"},function(e,t,r){"use strict";t["a"]="\n@export clay.compositor.upsample\n#define HIGH_QUALITY\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nuniform float sampleScale: 0.5;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main()\n{\n#ifdef HIGH_QUALITY\n vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n gl_FragColor = encodeHDR(s / 16.0);\n#else\n vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n gl_FragColor = encodeHDR(s / 4.0);\n#endif\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.hdr.composite\n#define TONEMAPPING\nuniform sampler2D texture;\n#ifdef BLOOM_ENABLED\nuniform sampler2D bloom;\n#endif\n#ifdef LENSFLARE_ENABLED\nuniform sampler2D lensflare;\nuniform sampler2D lensdirt;\n#endif\n#ifdef LUM_ENABLED\nuniform sampler2D lum;\n#endif\n#ifdef LUT_ENABLED\nuniform sampler2D lut;\n#endif\n#ifdef COLOR_CORRECTION\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float saturation : 1.0;\n#endif\n#ifdef VIGNETTE\nuniform float vignetteDarkness: 1.0;\nuniform float vignetteOffset: 1.0;\n#endif\nuniform float exposure : 1.0;\nuniform float bloomIntensity : 0.25;\nuniform float lensflareIntensity : 1;\nvarying vec2 v_Texcoord;\n@import clay.util.srgb\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nfloat eyeAdaption(float fLum)\n{\n return mix(0.2, fLum, 0.5);\n}\n#ifdef LUT_ENABLED\nvec3 lutTransform(vec3 color) {\n float blueColor = color.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec4 newColor1 = texture2D(lut, texPos1);\n vec4 newColor2 = texture2D(lut, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n return newColor.rgb;\n}\n#endif\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = vec4(0.0);\n vec4 originalTexel = vec4(0.0);\n#ifdef TEXTURE_ENABLED\n texel = decodeHDR(texture2D(texture, v_Texcoord));\n originalTexel = texel;\n#endif\n#ifdef BLOOM_ENABLED\n vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));\n texel.rgb += bloomTexel.rgb * bloomIntensity;\n texel.a += bloomTexel.a * bloomIntensity;\n#endif\n#ifdef LENSFLARE_ENABLED\n texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;\n#endif\n texel.a = min(texel.a, 1.0);\n#ifdef LUM_ENABLED\n float fLum = texture2D(lum, vec2(0.5, 0.5)).r;\n float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));\n float exposureBias = adaptedLumDest * exposure;\n#else\n float exposureBias = exposure;\n#endif\n#ifdef TONEMAPPING\n texel.rgb *= exposureBias;\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n texel = linearTosRGB(texel);\n#ifdef LUT_ENABLED\n texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));\n#endif\n#ifdef COLOR_CORRECTION\n texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);\n texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));\n texel.rgb = mix(vec3(lum), texel.rgb, saturation);\n#endif\n#ifdef VIGNETTE\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);\n texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));\n#endif\n gl_FragColor = encodeHDR(texel);\n#ifdef DEBUG\n #if DEBUG == 1\n gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));\n #elif DEBUG == 2\n gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);\n #elif DEBUG == 3\n gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));\n #endif\n#endif\n if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {\n gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));\n }\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.blend\n#define SHADER_NAME blend\n#ifdef TEXTURE1_ENABLED\nuniform sampler2D texture1;\nuniform float weight1 : 1.0;\n#endif\n#ifdef TEXTURE2_ENABLED\nuniform sampler2D texture2;\nuniform float weight2 : 1.0;\n#endif\n#ifdef TEXTURE3_ENABLED\nuniform sampler2D texture3;\nuniform float weight3 : 1.0;\n#endif\n#ifdef TEXTURE4_ENABLED\nuniform sampler2D texture4;\nuniform float weight4 : 1.0;\n#endif\n#ifdef TEXTURE5_ENABLED\nuniform sampler2D texture5;\nuniform float weight5 : 1.0;\n#endif\n#ifdef TEXTURE6_ENABLED\nuniform sampler2D texture6;\nuniform float weight6 : 1.0;\n#endif\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = vec4(0.0);\n#ifdef TEXTURE1_ENABLED\n tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;\n#endif\n#ifdef TEXTURE2_ENABLED\n tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;\n#endif\n#ifdef TEXTURE3_ENABLED\n tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;\n#endif\n#ifdef TEXTURE4_ENABLED\n tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;\n#endif\n#ifdef TEXTURE5_ENABLED\n tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;\n#endif\n#ifdef TEXTURE6_ENABLED\n tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;\n#endif\n gl_FragColor = encodeHDR(tex);\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.fxaa\nuniform sampler2D texture;\nuniform vec4 viewport : VIEWPORT;\nvarying vec2 v_Texcoord;\n#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\n@import clay.util.rgbm\nvoid main()\n{\n vec2 resolution = 1.0 / viewport.zw;\n vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;\n vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );\n vec3 rgbM = rgbaM.xyz;\n float opacity = rgbaM.w;\n vec3 luma = vec3( 0.299, 0.587, 0.114 );\n float lumaNW = dot( rgbNW, luma );\n float lumaNE = dot( rgbNE, luma );\n float lumaSW = dot( rgbSW, luma );\n float lumaSE = dot( rgbSE, luma );\n float lumaM = dot( rgbM, luma );\n float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n vec2 dir;\n dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n dir * rcpDirMin)) * resolution;\n vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA *= 0.5;\n vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;\n rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;\n rgbB *= 0.25;\n rgbB += rgbA * 0.5;\n float lumaB = dot( rgbB, luma );\n if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )\n {\n gl_FragColor = vec4( rgbA, opacity );\n }\n else {\n gl_FragColor = vec4( rgbB, opacity );\n }\n}\n@end"},function(e,t,r){"use strict";var a=r(0);var u=r.n(a);t["a"]={getFilledRegions:function(e,t){var r=(e||[]).slice();var a;if(typeof t==="string"){t=u.a.getMap(t);a=t&&t.geoJson}else{if(t&&t.features){a=t}}if(!a){if(true){console.error("Map "+t+" not exists. You can download map file on http://echarts.baidu.com/download-map.html");if(!a.features){console.error("Invalid GeoJSON for map3D")}}return[]}var i={};var n=a.features;for(var o=0;o<r.length;o++){i[r[o].name]=r[o]}for(var o=0;o<n.length;o++){var s=n[o].properties.name;if(!i[s]){r.push({name:s})}}return r},defaultOption:{show:true,zlevel:-10,map:"",left:0,top:0,width:"100%",height:"100%",boxWidth:100,boxHeight:10,boxDepth:"auto",regionHeight:3,environment:"auto",groundPlane:{show:false,color:"#aaa"},shading:"lambert",light:{main:{alpha:40,beta:30}},viewControl:{alpha:40,beta:0,distance:100,orthographicSize:60,minAlpha:5,minBeta:-80,maxBeta:80},label:{show:false,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:true}}}}},function(e,t,r){"use strict";function u(e,t,r){var a=e[t];e[t]=e[r];e[r]=a}function f(e,t,r,a,i){var n=r;var o=e[t];u(e,t,a);for(var s=r;s<a;s++){if(i(e[s],o)<0){u(e,s,n);n++}}u(e,a,n);return n}function c(e,t,r,a){if(r<a){var i=Math.floor((r+a)/2);var n=f(e,i,r,a,t);c(e,t,r,n-1);c(e,t,n+1,a)}}function a(){this._parts=[]}a.prototype.step=function(e,t,r){var a=e.length;if(r===0){this._parts=[];this._sorted=false;var i=Math.floor(a/2);this._parts.push({pivot:i,left:0,right:a-1});this._currentSortPartIdx=0}if(this._sorted){return}var n=this._parts;if(n.length===0){this._sorted=true;return true}else if(n.length<512){for(var o=0;o<n.length;o++){n[o].pivot=f(e,n[o].pivot,n[o].left,n[o].right,t)}var s=[];for(var o=0;o<n.length;o++){var u=n[o].left;var l=n[o].pivot-1;if(l>u){s.push({pivot:Math.floor((l+u)/2),left:u,right:l})}var u=n[o].pivot+1;var l=n[o].right;if(l>u){s.push({pivot:Math.floor((l+u)/2),left:u,right:l})}}n=this._parts=s}else{for(var o=0;o<Math.floor(n.length/10);o++){var h=n.length-1-this._currentSortPartIdx;c(e,t,n[h].left,n[h].right);this._currentSortPartIdx++;if(this._currentSortPartIdx===n.length){this._sorted=true;return true}}}return false};a.sort=c;t["a"]=a},function(e,t,r){"use strict";var a=r(99);var i=r(0);var o=r.n(i);var n=r(47);var l=r.n(n);var s=r(22);var u=r(2);function h(e,t){var r=e.getBoxLayoutParams();var a=l.a.getLayoutRect(r,{width:t.getWidth(),height:t.getHeight()});a.y=t.getHeight()-a.y-a.height;this.viewGL.setViewport(a.x,a.y,a.width,a.height,t.getDevicePixelRatio());var i=this.getGeoBoundingRect();var n=i.width/i.height*(e.get("aspectScale")||.75);var o=e.get("boxWidth");var s=e.get("boxDepth");var u=e.get("boxHeight");if(u==null){u=5}if(isNaN(o)&&isNaN(s)){o=100}if(isNaN(s)){s=o/n}else if(isNaN(o)){o=s/n}this.setSize(o,u,s);this.regionHeight=e.get("regionHeight");if(this.altitudeAxis){this.altitudeAxis.setExtent(0,Math.max(u-this.regionHeight,0))}}function f(e,t){var n=[Infinity,-Infinity];e.eachSeries(function(e){if(e.coordinateSystem!==this){return}if(e.type==="series.map3D"){return}var t=e.getData();var r=e.coordDimToDataDim("alt");var a=r&&r[0];if(a){var i=t.getDataExtent(a,true);n[0]=Math.min(n[0],i[0]);n[1]=Math.max(n[1],i[1])}},this);if(n&&isFinite(n[1]-n[0])){var r=o.a.helper.createScale(n,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new o.a.Axis("altitude",r);this.resize(this.model,t)}}if(true){var c=function(e){console.error("Map "+e+" not exists. You can download map file on http://echarts.baidu.com/download-map.html")}}var d=0;var v={dimensions:a["a"].prototype.dimensions,create:function(r,a){var i=[];if(!o.a.getMap){throw new Error("geo3D component depends on geo component")}function n(e,t){var r=v.createGeo3D(e);e.__viewGL=e.__viewGL||new s["a"];r.viewGL=e.__viewGL;e.coordinateSystem=r;r.model=e;i.push(r);r.resize=h;r.resize(e,a);r.update=f}r.eachComponent("geo3D",function(e,t){n(e,t)});r.eachSeriesByType("map3D",function(e,t){var r=e.get("coordinateSystem");if(r==null){r="geo3D"}if(r==="geo3D"){n(e,t)}});r.eachSeries(function(e){if(e.get("coordinateSystem")==="geo3D"){if(e.type==="series.map3D"){return}var t=e.getReferringComponents("geo3D")[0];if(!t){t=r.getComponent("geo3D")}if(!t){throw new Error('geo "'+u["a"].firstNotNull(e.get("geo3DIndex"),e.get("geo3DId"),0)+'" not found')}e.coordinateSystem=t.coordinateSystem}});return i},createGeo3D:function(e){var t=e.get("map");var r;if(typeof t==="string"){r=t;t=o.a.getMap(t)}else{if(t&&t.features){t={geoJson:t}}}if(true){if(!t){c(t)}if(!t.geoJson.features){throw new Error("Invalid GeoJSON for map3D")}}if(r==null){r="GEO_ANONYMOUS_"+d++}return new a["a"](r+d++,r,t&&t.geoJson,t&&t.specialAreas,e.get("nameMap"))}};o.a.registerCoordinateSystem("geo3D",v);t["a"]=v},function(e,t,r){"use strict";var a=r(0);var l=r.n(a);var i=r(6);var n=r(205);var o=r.n(n);var s=r(206);var u=r.n(s);var h=i["a"].vec3;var f=i["a"].mat4;var c=[o.a,u.a];function d(e,t,r,a,i){this.name=e;this.map=t;this.regionHeight=0;this.regions=[];this._nameCoordMap={};this.loadGeoJson(r,a,i);this.transform=f.identity(new Float64Array(16));this.invTransform=f.identity(new Float64Array(16));this.extrudeY=true;this.altitudeAxis}d.prototype={constructor:d,type:"geo3D",dimensions:["lng","lat","alt"],containPoint:function(){},loadGeoJson:function(e,t,r){var a=l.a.parseGeoJSON||l.a.parseGeoJson;try{this.regions=e?a(e):[]}catch(e){throw"Invalid geoJson format\n"+e}t=t||{};r=r||{};var i=this.regions;var n={};for(var o=0;o<i.length;o++){var s=i[o].name;s=r[s]||s;i[o].name=s;n[s]=i[o];this.addGeoCoord(s,i[o].center);var u=t[s];if(u){i[o].transformTo(u.left,u.top,u.width,u.height)}}this._regionsMap=n;this._geoRect=null;c.forEach(function(e){e(this)},this)},getGeoBoundingRect:function(){if(this._geoRect){return this._geoRect}var e;var t=this.regions;for(var r=0;r<t.length;r++){var a=t[r].getBoundingRect();e=e||a.clone();e.union(a)}return this._geoRect=e||new l.a.graphic.BoundingRect(0,0,0,0)},addGeoCoord:function(e,t){this._nameCoordMap[e]=t},getRegion:function(e){return this._regionsMap[e]},getRegionByCoord:function(e){var t=this.regions;for(var r=0;r<t.length;r++){if(t[r].contain(e)){return t[r]}}},setSize:function(e,t,r){this.size=[e,t,r];var a=this.getGeoBoundingRect();var i=e/a.width;var n=-r/a.height;var o=-e/2-a.x*i;var s=r/2-a.y*n;var u=this.extrudeY?[o,0,s]:[o,s,0];var l=this.extrudeY?[i,1,n]:[i,n,1];var h=this.transform;f.identity(h);f.translate(h,h,u);f.scale(h,h,l);f.invert(this.invTransform,h)},dataToPoint:function(e,t){t=t||[];var r=this.extrudeY?1:2;var a=this.extrudeY?2:1;var i=e[2];if(isNaN(i)){i=0}t[0]=e[0];t[a]=e[1];if(this.altitudeAxis){t[r]=this.altitudeAxis.dataToCoord(i)}else{t[r]=0}t[r]+=this.regionHeight;h.transformMat4(t,t,this.transform);return t},pointToData:function(e,t){}};t["a"]=d},function(e,t,r){"use strict";var a=r(6);var d=a["a"].mat4;var v=512;var p=.6435011087932844;var l=Math.PI;var m=1/10;function i(){this.width=0;this.height=0;this.altitudeScale=1;this.boxHeight="auto";this.altitudeExtent;this.bearing=0;this.pitch=0;this.center=[0,0];this._origin;this.zoom=0;this._initialZoom;this.maxPitch=60;this.zoomOffset=0}i.prototype={constructor:i,dimensions:["lng","lat","alt"],containPoint:function(){},setCameraOption:function(e){this.bearing=e.bearing;this.pitch=e.pitch;this.center=e.center;this.zoom=e.zoom;if(!this._origin){this._origin=this.projectOnTileWithScale(this.center,v)}if(this._initialZoom==null){this._initialZoom=this.zoom}this.updateTransform()},updateTransform:function(){if(!this.height){return}var e=.5/Math.tan(p/2)*this.height*m;var t=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI;var r=p/2;var a=Math.PI/2+t;var i=Math.sin(r)*e/Math.sin(Math.PI-a-r);var n=Math.cos(Math.PI/2-t)*i+e;var o=n*1.1;if(this.pitch>50){o=1e3}var s=[];d.perspective(s,p,this.width/this.height,1,o);this.viewGL.camera.projectionMatrix.setArray(s);this.viewGL.camera.decomposeProjectionMatrix();var s=d.identity([]);var u=this.dataToPoint(this.center);d.scale(s,s,[1,-1,1]);d.translate(s,s,[0,0,-e]);d.rotateX(s,s,t);d.rotateZ(s,s,-this.bearing/180*Math.PI);d.translate(s,s,[-u[0]*this.getScale()*m,-u[1]*this.getScale()*m,0]);this.viewGL.camera.viewMatrix.array=s;var l=[];d.invert(l,s);this.viewGL.camera.worldTransform.array=l;this.viewGL.camera.decomposeWorldTransform();var h=v*this.getScale();var f;if(this.altitudeExtent&&!isNaN(this.boxHeight)){var c=this.altitudeExtent[1]-this.altitudeExtent[0];f=this.boxHeight/c*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)}else{f=h/(2*Math.PI*6378e3*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*m}this.viewGL.rootNode.scale.set(this.getScale()*m,this.getScale()*m,f)},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(e,t){return this.projectOnTileWithScale(e,this.getScale()*v,t)},projectOnTileWithScale:function(e,t,r){var a=e[0];var i=e[1];var n=a*l/180;var o=i*l/180;var s=t*(n+l)/(2*l);var u=t*(l-Math.log(Math.tan(l/4+o*.5)))/(2*l);r=r||[];r[0]=s;r[1]=u;return r},unprojectFromTile:function(e,t){return this.unprojectOnTileWithScale(e,this.getScale()*v,t)},unprojectOnTileWithScale:function(e,t,r){var a=e[0];var i=e[1];var n=a/t*(2*l)-l;var o=2*(Math.atan(Math.exp(l-i/t*(2*l)))-l/4);r=r||[];r[0]=n*180/l;r[1]=o*180/l;return r},dataToPoint:function(e,t){t=this.projectOnTileWithScale(e,v,t);t[0]-=this._origin[0];t[1]-=this._origin[1];t[2]=!isNaN(e[2])?e[2]:0;if(!isNaN(e[2])){t[2]=e[2];if(this.altitudeExtent){t[2]-=this.altitudeExtent[0]}}return t}};t["a"]=i},function(e,t,r){"use strict";var l=r(2);var h=r(1);var f=r(22);t["a"]=function(n,o,e){function s(e,t){var r=t.getWidth();var a=t.getHeight();var i=t.getDevicePixelRatio();this.viewGL.setViewport(0,0,r,a,i);this.width=r;this.height=a;this.altitudeScale=e.get("altitudeScale");this.boxHeight=e.get("boxHeight")}function u(e,t){if(this.model.get("boxHeight")==="auto"){return}var i=[Infinity,-Infinity];e.eachSeries(function(e){if(e.coordinateSystem!==this){return}var t=e.getData();var r=e.coordDimToDataDim("alt")[0];if(r){var a=t.getDataExtent(r,true);i[0]=Math.min(i[0],a[0]);i[1]=Math.max(i[1],a[1])}},this);if(i&&isFinite(i[1]-i[0])){this.altitudeExtent=i}}return{dimensions:o.prototype.dimensions,create:function(r,a){var i=[];r.eachComponent(n,function(e){var t=e.__viewGL;if(!t){t=e.__viewGL=new f["a"];t.setRootNode(new h["a"].Node)}var r=new o;r.viewGL=e.__viewGL;r.resize=s;r.resize(e,a);i.push(r);e.coordinateSystem=r;r.model=e;r.update=u});r.eachSeries(function(e){if(e.get("coordinateSystem")===n){var t=e.getReferringComponents(n)[0];if(!t){t=r.getComponent(n)}if(!t){throw new Error(n+' "'+l["a"].firstNotNull(e.get(n+"Index"),e.get(n+"Id"),0)+'" not found')}e.coordinateSystem=t.coordinateSystem}});e&&e(i,r,a);return i}}}},function(e,t,r){"use strict";t["a"]="\n@export ecgl.displayShadow.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_WorldPosition;\n\nvarying vec3 v_Normal;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n\n@end\n\n\n@export ecgl.displayShadow.fragment\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform float roughness: 0.2;\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.ssaoMap.header\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n float shadow = 1.0;\n\n @import ecgl.common.ssaoMap.main\n\n#if defined(DIRECTIONAL_LIGHT_COUNT) && defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n for (int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++) {\n shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);\n }\n#endif\n\n shadow *= 0.5 + ao * 0.5;\n shadow = clamp(shadow, 0.0, 1.0);\n\n gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);\n}\n\n@end"},function(e,t,r){"use strict";var a=r(84);var i=r.n(a);var n=r(83);var o=r.n(n);function s(e){this.viewGL=e}s.prototype.reset=function(e,t){this._updateCamera(t.getWidth(),t.getHeight(),t.getDevicePixelRatio());this._viewTransform=i.a.create();this.updateTransform(e,t)};s.prototype.updateTransform=function(e,t){var r=e.coordinateSystem;if(r.getRoamTransform){i.a.invert(this._viewTransform,r.getRoamTransform());this._setCameraTransform(this._viewTransform);t.getZr().refresh()}};s.prototype.dataToPoint=function(e,t,r){r=e.dataToPoint(t,null,r);var a=this._viewTransform;if(a){o.a.applyTransform(r,r,a)}};s.prototype.removeTransformInPoint=function(e){if(this._viewTransform){o.a.applyTransform(e,e,this._viewTransform)}return e};s.prototype.getZoom=function(){if(this._viewTransform){var e=this._viewTransform;return 1/Math.max(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]))}return 1};s.prototype._setCameraTransform=function(e){var t=this.viewGL.camera;t.position.set(e[4],e[5],0);t.scale.set(Math.sqrt(e[0]*e[0]+e[1]*e[1]),Math.sqrt(e[2]*e[2]+e[3]*e[3]),1)};s.prototype._updateCamera=function(e,t,r){this.viewGL.setViewport(0,0,e,t,r);var a=this.viewGL.camera;a.left=a.top=0;a.bottom=t;a.right=e;a.near=0;a.far=100};t["a"]=s},function(e,a,t){(function(e){var t;if(typeof window!=="undefined"){t=window.__DEV__}else if(typeof e!=="undefined"){t=e.__DEV__}if(typeof t==="undefined"){t=true}var r=t;a.__DEV__=r}).call(a,t(68))},function(e,t,r){"use strict";var a=r(15);var i=r(0);var n=r.n(i);var o=r(38);var s=r(6);var M=s["a"].vec2;var u=[[0,0],[1,1]];var l=a["a"].extend(function(){return{segmentScale:4,dynamic:true,useNativeLine:true,attributes:{position:new a["a"].Attribute("position","float",2,"POSITION"),normal:new a["a"].Attribute("normal","float",2),offset:new a["a"].Attribute("offset","float",1),color:new a["a"].Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0;this._itemVertexOffsets=[]},setVertexCount:function(e){var t=this.attributes;if(this.vertexCount!==e){t.position.init(e);t.color.init(e);if(!this.useNativeLine){t.offset.init(e);t.normal.init(e)}if(e>65535){if(this.indices instanceof Uint16Array){this.indices=new Uint32Array(this.indices)}}else{if(this.indices instanceof Uint32Array){this.indices=new Uint16Array(this.indices)}}}},setTriangleCount:function(e){if(this.triangleCount!==e){if(e===0){this.indices=null}else{this.indices=this.vertexCount>65535?new Uint32Array(e*3):new Uint16Array(e*3)}}},_getCubicCurveApproxStep:function(e,t,r,a){var i=M.dist(e,t)+M.dist(r,t)+M.dist(a,r);var n=1/(i+1)*this.segmentScale;return n},getCubicCurveVertexCount:function(e,t,r,a){var i=this._getCubicCurveApproxStep(e,t,r,a);var n=Math.ceil(1/i);if(!this.useNativeLine){return n*2+2}else{return n*2}},getCubicCurveTriangleCount:function(e,t,r,a){var i=this._getCubicCurveApproxStep(e,t,r,a);var n=Math.ceil(1/i);if(!this.useNativeLine){return n*2}else{return 0}},getLineVertexCount:function(){return this.getPolylineVertexCount(u)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(u)},getPolylineVertexCount:function(e){var t;if(typeof e==="number"){t=e}else{var r=typeof e[0]!=="number";t=r?e.length:e.length/2}return!this.useNativeLine?(t-1)*2+2:(t-1)*2},getPolylineTriangleCount:function(e){var t;if(typeof e==="number"){t=e}else{var r=typeof e[0]!=="number";t=r?e.length:e.length/2}return!this.useNativeLine?(t-1)*2:0},addCubicCurve:function(e,t,r,a,i,n){if(n==null){n=1}var o=e[0],s=e[1];var u=t[0],l=t[1];var h=r[0],f=r[1];var c=a[0],d=a[1];var v=this._getCubicCurveApproxStep(e,t,r,a);var p=v*v;var m=p*v;var g=3*v;var _=3*p;var y=6*p;var x=6*m;var T=o-u*2+h;var b=s-l*2+f;var w=(u-h)*3-o+c;var E=(l-f)*3-s+d;var S=o;var A=s;var M=(u-o)*g+T*_+w*m;var C=(l-s)*g+b*_+E*m;var L=T*y+w*x;var D=b*y+E*x;var N=w*x;var I=E*x;var R=0;var P=0;var O=Math.ceil(1/v);var F=new Float32Array((O+1)*3);var F=[];var B=0;for(var P=0;P<O+1;P++){F[B++]=S;F[B++]=A;S+=M;A+=C;M+=L;C+=D;L+=N;D+=I;R+=v;if(R>1){S=M>0?Math.min(S,c):Math.max(S,c);A=C>0?Math.min(A,d):Math.max(A,d)}}this.addPolyline(F,i,n)},addLine:function(e,t,r,a){this.addPolyline([e,t],r,a)},addPolyline:function(){var x=M.create();var T=M.create();var b=M.create();var w=M.create();var E=[],S=[],A=[];return function(e,t,r,a,i){if(!e.length){return}var n=typeof e[0]!=="number";if(i==null){i=n?e.length:e.length/2}if(i<2){return}if(a==null){a=0}if(r==null){r=1}this._itemVertexOffsets.push(this._vertexOffset);var o=n?typeof t[0]!=="number":t.length/4===i;var s=this.attributes.position;var u=this.attributes.color;var l=this.attributes.offset;var h=this.attributes.normal;var f=this.indices;var c=this._vertexOffset;var d;for(var v=0;v<i;v++){if(n){E=e[v+a];if(o){d=t[v+a]}else{d=t}}else{var p=v*2+a;E=E||[];E[0]=e[p];E[1]=e[p+1];if(o){var m=v*4+a;d=d||[];d[0]=t[m];d[1]=t[m+1];d[2]=t[m+2];d[3]=t[m+3]}else{d=t}}if(!this.useNativeLine){var g;if(v<i-1){if(n){M.copy(S,e[v+1])}else{var p=(v+1)*2+a;S=S||[];S[0]=e[p];S[1]=e[p+1]}if(v>0){M.sub(x,E,A);M.sub(T,S,E);M.normalize(x,x);M.normalize(T,T);M.add(w,x,T);M.normalize(w,w);var _=r/2*Math.min(1/M.dot(x,w),2);b[0]=-w[1];b[1]=w[0];g=_}else{M.sub(x,S,E);M.normalize(x,x);b[0]=-x[1];b[1]=x[0];g=r/2}}else{M.sub(x,E,A);M.normalize(x,x);b[0]=-x[1];b[1]=x[0];g=r/2}h.set(c,b);h.set(c+1,b);l.set(c,g);l.set(c+1,-g);M.copy(A,E);s.set(c,E);s.set(c+1,E);u.set(c,d);u.set(c+1,d);c+=2}else{if(v>1){s.copy(c,c-1);u.copy(c,c-1);c++}}if(!this.useNativeLine){if(v>0){var y=this._faceOffset*3;var f=this.indices;f[y]=c-4;f[y+1]=c-3;f[y+2]=c-2;f[y+3]=c-3;f[y+4]=c-1;f[y+5]=c-2;this._faceOffset+=2}}else{u.set(c,d);s.set(c,E);c++}}this._vertexOffset=c}}(),setItemColor:function(e,t){var r=this._itemVertexOffsets[e];var a=e<this._itemVertexOffsets.length-1?this._itemVertexOffsets[e+1]:this._vertexOffset;for(var i=r;i<a;i++){this.attributes.color.set(i,t)}this.dirty("color")}});n.a.util.defaults(l.prototype,o["a"]);t["a"]=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(107);var i=r(154);var n=r(201);var o=r(207);var s=r(213);var u=r(219);var l=r(225);var h=r(232);var f=r(236);var c=r(243);var d=r(249);var v=r(252);var p=r(256);var m=r(259);var g=r(262);var _=r(275);var y=r(281)},function(e,t,r){"use strict";var a=r(0);var f=r.n(a);var i=r(108);var c=r(109);var n=r(153);var o=r(1);var s={version:"1.1.1",dependencies:{echarts:"4.1.0",claygl:"1.2.1"}};var u=s.dependencies;function l(e){throw new Error(e+" version is too old, needs "+u[e]+" or higher")}function h(e,t){if(e.replace(".","")-0<u[t].replace(".","")-0){l(t)}console.log("Loaded "+t+", version "+e)}h(i["a"],"claygl");h(f.a.version,"echarts");function d(e){this._layers={};this._zr=e}d.prototype.update=function(o,s){var n=this;var u=s.getZr();if(!u.getWidth()||!u.getHeight()){console.warn("Dom has no width or height");return}function l(e){var t;if(e.coordinateSystem&&e.coordinateSystem.model){t=e.get("zlevel")}else{t=e.get("zlevel")}var r=n._layers;var a=r[t];if(!a){a=r[t]=new c["a"]("gl-"+t,u);if(u.painter.isSingleCanvas()){a.virtual=true;var i=new f.a.graphic.Image({z:1e4,style:{image:a.renderer.canvas},silent:true});a.__hostImage=i;u.add(i)}u.painter.insertLayer(t,a)}if(a.__hostImage){a.__hostImage.setStyle({width:a.renderer.getWidth(),height:a.renderer.getHeight()})}return a}function h(e,t){if(e){e.traverse(function(e){if(e.isRenderable&&e.isRenderable()){e.ignorePicking=e.$ignorePicking!=null?e.$ignorePicking:t}})}}for(var e in this._layers){this._layers[e].removeViewsAll()}o.eachComponent(function(e,t){if(e!=="series"){var r=s.getViewOfComponentModel(t);var a=t.coordinateSystem;if(r.__ecgl__){var i;if(a){if(!a.viewGL){console.error("Can't find viewGL in coordinateSystem of component "+t.id);return}i=a.viewGL}else{if(!t.viewGL){console.error("Can't find viewGL of component "+t.id);return}i=a.viewGL}var i=a.viewGL;var n=l(t);n.addView(i);r.afterRender&&r.afterRender(t,o,s,n);h(r.groupGL,t.get("silent"))}}});o.eachSeries(function(e){var t=s.getViewOfSeriesModel(e);var r=e.coordinateSystem;if(t.__ecgl__){if(r&&!r.viewGL&&!t.viewGL){console.error("Can't find viewGL of series "+t.id);return}var a=r&&r.viewGL||t.viewGL;var i=l(e);i.addView(a);t.afterRender&&t.afterRender(e,o,s,i);h(t.groupGL,e.get("silent"))}})};var v=f.a.init;f.a.init=function(){var e=v.apply(this,arguments);e.getZr().painter.getRenderedCanvas=function(e){e=e||{};if(this._singleCanvas){return this._layers[0].dom}var t=document.createElement("canvas");var r=e.pixelRatio||this.dpr;t.width=this.getWidth()*r;t.height=this.getHeight()*r;var s=t.getContext("2d");s.dpr=r;s.clearRect(0,0,t.width,t.height);if(e.backgroundColor){s.fillStyle=e.backgroundColor;s.fillRect(0,0,t.width,t.height)}var a=this.storage.getDisplayList(true);var i={};var n;var u=this;function o(e,t){var r=u._zlevelList;if(e==null){e=-Infinity}var a;for(var i=0;i<r.length;i++){var n=r[i];var o=u._layers[n];if(!o.__builtin__&&n>e&&n<t){a=o;break}}if(a&&a.renderToCanvas){s.save();a.renderToCanvas(s);s.restore()}}var l={ctx:s};for(var h=0;h<a.length;h++){var f=a[h];if(f.zlevel!==n){o(n,f.zlevel);n=f.zlevel}this._doPaintEl(f,l,true,i)}o(n,Infinity);return t};return e};f.a.registerPostUpdate(function(e,t){var r=t.getZr();var a=r.__egl=r.__egl||new d(r);a.update(e,t)});f.a.registerPreprocessor(n["a"]);f.a.graphicGL=o["a"];var p=d},function(e,t,r){"use strict";t["a"]="1.2.1"},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(52);var o=r(117);var c=r(4);var s=r(1);var u=r(53);var l=r(80);var h=r.n(l);var f=function(e,t){this.id=e;this.zr=t;try{this.renderer=new n["a"]({clearBit:0,devicePixelRatio:t.painter.dpr,preserveDrawingBuffer:true,premultipliedAlpha:true});this.renderer.resize(t.painter.getWidth(),t.painter.getHeight())}catch(e){this.renderer=null;this.dom=document.createElement("div");this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;";this.dom.className="ecgl-nowebgl";this.dom.innerHTML="Sorry, your browser does not support WebGL";console.error(e);return}this.onglobalout=this.onglobalout.bind(this);t.on("globalout",this.onglobalout);this.dom=this.renderer.canvas;var r=this.dom.style;r.position="absolute";r.left="0";r.top="0";this.views=[];this._picking=new o["a"]({renderer:this.renderer});this._viewsToDispose=[];this._accumulatingId=0;this._zrEventProxy=new i.a.graphic.Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:true});this._backgroundColor=null};f.prototype.addView=function(e){if(e.layer===this){return}var t=this._viewsToDispose.indexOf(e);if(t>=0){this._viewsToDispose.splice(t,1)}this.views.push(e);e.layer=this;var r=this.zr;e.scene.traverse(function(e){e.__zr=r;if(e.addAnimatorsToZr){e.addAnimatorsToZr(r)}})};function d(e){var t=e.__zr;e.__zr=null;if(t&&e.removeAnimatorsFromZr){e.removeAnimatorsFromZr(t)}}f.prototype.removeView=function(e){if(e.layer!==this){return}var t=this.views.indexOf(e);if(t>=0){this.views.splice(t,1);e.scene.traverse(d,this);e.layer=null;this._viewsToDispose.push(e)}};f.prototype.removeViewsAll=function(){this.views.forEach(function(e){e.scene.traverse(d,this);e.layer=null;this._viewsToDispose.push(e)},this);this.views.length=0};f.prototype.resize=function(e,t){var r=this.renderer;r.resize(e,t)};f.prototype.clear=function(){var e=this.renderer.gl;var t=this._backgroundColor||[0,0,0,0];e.clearColor(t[0],t[1],t[2],t[3]);e.depthMask(true);e.colorMask(true,true,true,true);e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT)};f.prototype.clearDepth=function(){var e=this.renderer.gl;e.clear(e.DEPTH_BUFFER_BIT)};f.prototype.clearColor=function(){var e=this.renderer.gl;e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT)};f.prototype.needsRefresh=function(){this.zr.refresh()};f.prototype.refresh=function(e){this._backgroundColor=e?s["a"].parseColor(e):[0,0,0,0];this.renderer.clearColor=this._backgroundColor;for(var t=0;t<this.views.length;t++){this.views[t].prepareRender(this.renderer)}this._doRender(false);this._trackAndClean();for(var t=0;t<this._viewsToDispose.length;t++){this._viewsToDispose[t].dispose(this.renderer)}this._viewsToDispose.length=0;this._startAccumulating()};f.prototype.renderToCanvas=function(e){this._startAccumulating(true);e.drawImage(this.dom,0,0,e.canvas.width,e.canvas.height)};f.prototype._doRender=function(e){this.clear();this.renderer.saveViewport();for(var t=0;t<this.views.length;t++){this.views[t].render(this.renderer,e)}this.renderer.restoreViewport()};f.prototype._stopAccumulating=function(){this._accumulatingId=0;clearTimeout(this._accumulatingTimeout)};var v=1;f.prototype._startAccumulating=function(a){var i=this;this._stopAccumulating();var n=false;for(var e=0;e<this.views.length;e++){n=this.views[e].needsAccumulate()||n}if(!n){return}function o(e){if(!i._accumulatingId||e!==i._accumulatingId){return}var t=true;for(var r=0;r<i.views.length;r++){t=i.views[r].isAccumulateFinished()&&n}if(!t){i._doRender(true);if(a){o(e)}else{h()(function(){o(e)})}}}this._accumulatingId=v++;if(a){o(i._accumulatingId)}else{this._accumulatingTimeout=setTimeout(function(){o(i._accumulatingId)},50)}};f.prototype._trackAndClean=function(){var e=[];var t=[];if(this._textureList){p(this._textureList);p(this._geometriesList)}for(var r=0;r<this.views.length;r++){_(this.views[r].scene,e,t)}if(this._textureList){m(this.renderer,this._textureList);m(this.renderer,this._geometriesList)}this._textureList=e;this._geometriesList=t};function p(e){for(var t=0;t<e.length;t++){e[t].__used__=0}}function m(e,t){for(var r=0;r<t.length;r++){if(!t[r].__used__){t[r].dispose(e)}}}function g(e,t){e.__used__=e.__used__||0;e.__used__++;if(e.__used__===1){t.push(e)}}function _(e,u,l){var h;var f;e.traverse(function(e){if(e.isRenderable()){var t=e.geometry;var r=e.material;if(r!==h){var a=r.getTextureUniforms();for(var i=0;i<a.length;i++){var n=a[i];var o=r.uniforms[n].value;if(!o){continue}if(o instanceof c["a"]){g(o,u)}else if(o instanceof Array){for(var s=0;s<o.length;s++){if(o[s]instanceof c["a"]){g(o[s],u)}}}}}if(t!==f){g(t,l)}h=r;f=t}});for(var t=0;t<e.lights.length;t++){if(e.lights[t].cubemap){g(e.lights[t].cubemap,u)}}}f.prototype.dispose=function(){this._stopAccumulating();this.renderer.disposeScene(this.scene);this.zr.off("globalout",this.onglobalout)};f.prototype.onmousedown=function(e){if(e.target&&e.target.__isGLToZRProxy){return}e=e.event;var t=this.pickObject(e.offsetX,e.offsetY);if(t){this._dispatchEvent("mousedown",e,t);this._dispatchDataEvent("mousedown",e,t)}this._downX=e.offsetX;this._downY=e.offsetY};f.prototype.onmousemove=function(e){if(e.target&&e.target.__isGLToZRProxy){return}e=e.event;var t=this.pickObject(e.offsetX,e.offsetY);var r=t&&t.target;var a=this._hovered;this._hovered=t;if(a&&r!==a.target){a.relatedTarget=r;this._dispatchEvent("mouseout",e,a);this.zr.setCursorStyle("default")}this._dispatchEvent("mousemove",e,t);if(t){this.zr.setCursorStyle("pointer");if(!a||r!==a.target){this._dispatchEvent("mouseover",e,t)}}this._dispatchDataEvent("mousemove",e,t)};f.prototype.onmouseup=function(e){if(e.target&&e.target.__isGLToZRProxy){return}e=e.event;var t=this.pickObject(e.offsetX,e.offsetY);if(t){this._dispatchEvent("mouseup",e,t);this._dispatchDataEvent("mouseup",e,t)}this._upX=e.offsetX;this._upY=e.offsetY};f.prototype.onclick=f.prototype.dblclick=function(e){if(e.target&&e.target.__isGLToZRProxy){return}var t=this._upX-this._downX;var r=this._upY-this._downY;if(Math.sqrt(t*t+r*r)>20){return}e=e.event;var a=this.pickObject(e.offsetX,e.offsetY);if(a){this._dispatchEvent(e.type,e,a);this._dispatchDataEvent(e.type,e,a)}var i=this._clickToSetFocusPoint(e);if(i){var n=i.view.setDOFFocusOnPoint(i.distance);if(n){this.zr.refresh()}}};f.prototype._clickToSetFocusPoint=function(e){var t=this.renderer;var r=t.viewport;for(var a=this.views.length-1;a>=0;a--){var i=this.views[a];if(i.hasDOF()&&i.containPoint(e.offsetX,e.offsetY)){this._picking.scene=i.scene;this._picking.camera=i.camera;t.viewport=i.viewport;var n=this._picking.pick(e.offsetX,e.offsetY,true);if(n){n.view=i;return n}}}t.viewport=r};f.prototype.onglobalout=function(e){var t=this._hovered;if(t){this._dispatchEvent("mouseout",e,{target:t.target})}};f.prototype.pickObject=function(e,t){var r=[];var a=this.renderer;var i=a.viewport;for(var n=0;n<this.views.length;n++){var o=this.views[n];if(o.containPoint(e,t)){this._picking.scene=o.scene;this._picking.camera=o.camera;a.viewport=o.viewport;this._picking.pickAll(e,t,r)}}a.viewport=i;r.sort(function(e,t){return e.distance-t.distance});return r[0]};f.prototype._dispatchEvent=function(e,t,r){if(!r){r={}}var a=r.target;r.cancelBubble=false;r.event=t;r.type=e;r.offsetX=t.offsetX;r.offsetY=t.offsetY;while(a){a.trigger(e,r);a=a.getParent();if(r.cancelBubble){break}}this._dispatchToView(e,r)};f.prototype._dispatchDataEvent=function(e,t,r){var a=r&&r.target;var i=a&&a.dataIndex;var n=a&&a.seriesIndex;var o=a&&a.eventData;var s=false;var u=this._zrEventProxy;u.position=[t.offsetX,t.offsetY];u.update();var l={target:u};if(e==="mousemove"){if(i!=null){if(i!==this._lastDataIndex){if(parseInt(this._lastDataIndex,10)>=0){u.dataIndex=this._lastDataIndex;u.seriesIndex=this._lastSeriesIndex;this.zr.handler.dispatchToElement(l,"mouseout",t)}s=true}}else if(o!=null){if(o!==this._lastEventData){if(this._lastEventData!=null){u.eventData=this._lastEventData;this.zr.handler.dispatchToElement(l,"mouseout",t)}s=true}}this._lastEventData=o;this._lastDataIndex=i;this._lastSeriesIndex=n}u.eventData=o;u.dataIndex=i;u.seriesIndex=n;if(o!=null||parseInt(i,10)>=0&&parseInt(n,10)>=0){this.zr.handler.dispatchToElement(l,e,t);if(s){this.zr.handler.dispatchToElement(l,"mouseover",t)}}};f.prototype._dispatchToView=function(e,t){for(var r=0;r<this.views.length;r++){if(this.views[r].containPoint(t.offsetX,t.offsetY)){this.views[r].trigger(e,t)}}};i.a.util.extend(f.prototype,u["a"]);t["a"]=f},function(e,t,r){"use strict";function a(a,e,t){if(typeof e=="object"){t=e;e=null}var i=this;var n;if(!(a instanceof Function)){n=[];for(var r in a){if(a.hasOwnProperty(r)){n.push(r)}}}var o=function(e){i.apply(this,arguments);if(a instanceof Function){u(this,a.call(this,e))}else{l(this,a,n)}if(this.constructor===o){var t=o.__initializers__;for(var r=0;r<t.length;r++){t[r].apply(this,arguments)}}};o.__super__=i;if(!i.__initializers__){o.__initializers__=[]}else{o.__initializers__=i.__initializers__.slice()}if(e){o.__initializers__.push(e)}var s=function(){};s.prototype=i.prototype;o.prototype=new s;o.prototype.constructor=o;u(o.prototype,t);o.extend=i.extend;o.derive=i.extend;return o}function u(e,t){if(!t){return}for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}}function l(e,t,r){for(var a=0;a<r.length;a++){var i=r[a];e[i]=t[i]}}t["a"]={extend:a,derive:a}},function(e,t,r){"use strict";var s=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB"];var u=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];function a(r){var a={};var t={};for(var e=0;e<s.length;e++){var i=s[e];o(i)}for(var e=0;e<u.length;e++){var n=u[e];t[n]=r.getParameter(r[n])}this.getExtension=function(e){if(!(e in a)){o(e)}return a[e]};this.getParameter=function(e){return t[e]};this.getMaxJointNumber=function(){return 15};function o(e){var t=r.getExtension(e);if(!t){t=r.getExtension("MOZ_"+e)}if(!t){t=r.getExtension("WEBKIT_"+e)}a[e]=t}}t["a"]=a},function(e,t,r){"use strict";function a(r){var t=new XMLHttpRequest;t.open("get",r.url);t.responseType=r.responseType||"text";if(r.onprogress){t.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total;r.onprogress(t,e.loaded,e.total)}else{r.onprogress(null)}}}t.onload=function(e){if(t.status>=400){r.onerror&&r.onerror()}else{r.onload&&r.onload(t.response)}};if(r.onerror){t.onerror=r.onerror}t.send(null)}t["a"]={get:a}},function(e,t,r){"use strict";var a=r(69);var h={};var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(e){e=Math.round(e);return e<0?0:e>255?255:e}function i(e){e=Math.round(e);return e<0?0:e>360?360:e}function d(e){return e<0?0:e>1?1:e}function v(e){if(e.length&&e.charAt(e.length-1)==="%"){return c(parseFloat(e)/100*255)}return c(parseInt(e,10))}function p(e){if(e.length&&e.charAt(e.length-1)==="%"){return d(parseFloat(e)/100)}return d(parseFloat(e))}function s(e,t,r){if(r<0){r+=1}else if(r>1){r-=1}if(r*6<1){return e+(t-e)*r*6}if(r*2<1){return t}if(r*3<2){return e+(t-e)*(2/3-r)*6}return e}function m(e,t,r){return e+(t-e)*r}function g(e,t,r,a,i){e[0]=t;e[1]=r;e[2]=a;e[3]=i;return e}function _(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}var y=new a["a"](20);var n=null;function x(e,t){if(n){_(n,t)}n=y.put(e,n||t.slice())}h.parse=function(e,t){if(!e){return}t=t||[];var r=y.get(e);if(r){return _(t,r)}e=e+"";var a=e.replace(/ /g,"").toLowerCase();if(a in f){_(t,f[a]);x(e,t);return t}if(a.charAt(0)==="#"){if(a.length===4){var i=parseInt(a.substr(1),16);if(!(i>=0&&i<=4095)){g(t,0,0,0,1);return}g(t,(i&3840)>>4|(i&3840)>>8,i&240|(i&240)>>4,i&15|(i&15)<<4,1);x(e,t);return t}else if(a.length===7){var i=parseInt(a.substr(1),16);if(!(i>=0&&i<=16777215)){g(t,0,0,0,1);return}g(t,(i&16711680)>>16,(i&65280)>>8,i&255,1);x(e,t);return t}return}var n=a.indexOf("("),o=a.indexOf(")");if(n!==-1&&o+1===a.length){var s=a.substr(0,n);var u=a.substr(n+1,o-(n+1)).split(",");var l=1;switch(s){case"rgba":if(u.length!==4){g(t,0,0,0,1);return}l=p(u.pop());case"rgb":if(u.length!==3){g(t,0,0,0,1);return}g(t,v(u[0]),v(u[1]),v(u[2]),l);x(e,t);return t;case"hsla":if(u.length!==4){g(t,0,0,0,1);return}u[3]=p(u[3]);T(u,t);x(e,t);return t;case"hsl":if(u.length!==3){g(t,0,0,0,1);return}T(u,t);x(e,t);return t;default:return}}g(t,0,0,0,1);return};h.parseToFloat=function(e,t){t=h.parse(e,t);if(!t){return}t[0]/=255;t[1]/=255;t[2]/=255;return t};function T(e,t){var r=(parseFloat(e[0])%360+360)%360/360;var a=p(e[1]);var i=p(e[2]);var n=i<=.5?i*(a+1):i+a-i*a;var o=i*2-n;t=t||[];g(t,c(s(o,n,r+1/3)*255),c(s(o,n,r)*255),c(s(o,n,r-1/3)*255),1);if(e.length===4){t[3]=e[3]}return t}function o(e){if(!e){return}var t=e[0]/255;var r=e[1]/255;var a=e[2]/255;var i=Math.min(t,r,a);var n=Math.max(t,r,a);var o=n-i;var s=(n+i)/2;var u;var l;if(o===0){u=0;l=0}else{if(s<.5){l=o/(n+i)}else{l=o/(2-n-i)}var h=((n-t)/6+o/2)/o;var f=((n-r)/6+o/2)/o;var c=((n-a)/6+o/2)/o;if(t===n){u=c-f}else if(r===n){u=1/3+h-c}else if(a===n){u=2/3+f-h}if(u<0){u+=1}if(u>1){u-=1}}var d=[u*360,l,s];if(e[3]!=null){d.push(e[3])}return d}h.lift=function(e,t){var r=h.parse(e);if(r){for(var a=0;a<3;a++){if(t<0){r[a]=r[a]*(1-t)|0}else{r[a]=(255-r[a])*t+r[a]|0}}return h.stringify(r,r.length===4?"rgba":"rgb")}};h.toHex=function(e){var t=h.parse(e);if(t){return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}};h.fastLerp=function(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}r=r||[];var a=e*(t.length-1);var i=Math.floor(a);var n=Math.ceil(a);var o=t[i];var s=t[n];var u=a-i;r[0]=c(m(o[0],s[0],u));r[1]=c(m(o[1],s[1],u));r[2]=c(m(o[2],s[2],u));r[3]=d(m(o[3],s[3],u));return r};h.fastMapToColor=h.fastLerp;h.lerp=function(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}var a=e*(t.length-1);var i=Math.floor(a);var n=Math.ceil(a);var o=h.parse(t[i]);var s=h.parse(t[n]);var u=a-i;var l=h.stringify([c(m(o[0],s[0],u)),c(m(o[1],s[1],u)),c(m(o[2],s[2],u)),d(m(o[3],s[3],u))],"rgba");return r?{color:l,leftIndex:i,rightIndex:n,value:a}:l};h.mapToColor=h.lerp;h.modifyHSL=function(e,t,r,a){e=h.parse(e);if(e){e=o(e);t!=null&&(e[0]=i(t));r!=null&&(e[1]=p(r));a!=null&&(e[2]=p(a));return h.stringify(T(e),"rgba")}};h.modifyAlpha=function(e,t){e=h.parse(e);if(e&&t!=null){e[3]=d(t);return h.stringify(e,"rgba")}};h.stringify=function(e,t){if(!e||!e.length){return}var r=e[0]+","+e[1]+","+e[2];if(t==="rgba"||t==="hsva"||t==="hsla"){r+=","+e[3]}return t+"("+r+")"};t["a"]=h},function(e,t,r){"use strict";var o=function(){this.head=null;this.tail=null;this._length=0};o.prototype.insert=function(e){var t=new o.Entry(e);this.insertEntry(t);return t};o.prototype.insertAt=function(e,t){if(e<0){return}var r=this.head;var a=0;while(r&&a!=e){r=r.next;a++}if(r){var i=new o.Entry(t);var n=r.prev;if(!n){this.head=i}else{n.next=i;i.prev=n}i.next=r;r.prev=i}else{this.insert(t)}};o.prototype.insertBeforeEntry=function(e,t){var r=new o.Entry(e);var a=t.prev;if(!a){this.head=r}else{a.next=r;r.prev=a}r.next=t;t.prev=r;this._length++};o.prototype.insertEntry=function(e){if(!this.head){this.head=this.tail=e}else{this.tail.next=e;e.prev=this.tail;this.tail=e}this._length++};o.prototype.remove=function(e){var t=e.prev;var r=e.next;if(t){t.next=r}else{this.head=r}if(r){r.prev=t}else{this.tail=t}e.next=e.prev=null;this._length--};o.prototype.removeAt=function(e){if(e<0){return}var t=this.head;var r=0;while(t&&r!=e){t=t.next;r++}if(t){this.remove(t);return t.value}};o.prototype.getHead=function(){if(this.head){return this.head.value}};o.prototype.getTail=function(){if(this.tail){return this.tail.value}};o.prototype.getAt=function(e){if(e<0){return}var t=this.head;var r=0;while(t&&r!=e){t=t.next;r++}return t.value};o.prototype.indexOf=function(e){var t=this.head;var r=0;while(t){if(t.value===e){return r}t=t.next;r++}};o.prototype.length=function(){return this._length};o.prototype.isEmpty=function(){return this._length===0};o.prototype.forEach=function(e,t){var r=this.head;var a=0;var i=typeof t!="undefined";while(r){if(i){e.call(t,r.value,a)}else{e(r.value,a)}r=r.next;a++}};o.prototype.clear=function(){this.tail=this.head=null;this._length=0};o.Entry=function(e){this.value=e;this.next=null;this.prev=null};t["a"]=o},function(e,t,r){"use strict";var T=r(116);var i=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;function b(e,o,t){function r(e,t,r,a){var i="";if(isNaN(t)){if(t in o){t=o[t]}else{t=s[t]}}if(isNaN(r)){if(r in o){r=o[r]}else{r=s[r]}}for(var n=parseInt(t);n<parseInt(r);n++){i+="{"+a.replace(/float\s*\(\s*_idx_\s*\)/g,n.toFixed(1)).replace(/_idx_/g,n)+"}"}return i}var s={};for(var a in t){s[a+"_COUNT"]=t[a]}return e.replace(i,r)}function w(e,t,r){var a=[];if(t){for(var i in t){var n=t[i];if(n>0){a.push("#define "+i.toUpperCase()+"_COUNT "+n)}}}if(r){for(var o=0;o<r.length;o++){var s=r[o];a.push("#define "+s.toUpperCase()+"_ENABLED")}}for(var s in e){var u=e[s];if(u===null){a.push("#define "+s)}else{a.push("#define "+s+" "+u.toString())}}return a.join("\n")}function E(e){var t=[];for(var r=0;r<e.length;r++){t.push("#extension GL_"+e[r]+" : enable")}return t.join("\n")}function S(e){return["precision",e,"float"].join(" ")+";\n"+["precision",e,"int"].join(" ")+";\n"+["precision",e,"sampler2D"].join(" ")+";\n"}function a(e){this._renderer=e;this._cache={}}a.prototype.getProgram=function(e,t,r){var a=this._cache;var i=e.isSkinnedMesh&&e.isSkinnedMesh();var n="s"+t.shader.shaderID+"m"+t.getProgramKey();if(r){n+="se"+r.getProgramKey(e.lightGroup)}if(i){n+=","+e.joints.length}var o=a[n];if(o){return o}var s=r?r.getLightsNumbers(e.lightGroup):{};var u=this._renderer;var l=u.gl;var h=t.getEnabledTextures();var f="";if(i){var c={SKINNING:null,JOINT_COUNT:e.joints.length};if(e.joints.length>u.getMaxJointNumber()){c.USE_SKIN_MATRICES_TEXTURE=null}f="\n"+w(c)+"\n"}var d=f+w(t.vertexDefines,s,h);var v=f+w(t.fragmentDefines,s,h);var p=d+"\n"+t.shader.vertex;var m=["OES_standard_derivatives","EXT_shader_texture_lod"].filter(function(e){return u.getGLExtension(e)!=null});if(m.indexOf("EXT_shader_texture_lod")>=0){v+="\n#define SUPPORT_TEXTURE_LOD"}if(m.indexOf("OES_standard_derivatives")>=0){v+="\n#define SUPPORT_STANDARD_DERIVATIVES"}var g=E(m)+"\n"+S(t.precision)+"\n"+v+"\n"+t.shader.fragment;var _=b(p,t.vertexDefines,s);var y=b(g,t.fragmentDefines,s);var o=new T["a"];o.uniformSemantics=t.shader.uniformSemantics;o.attributes=t.shader.attributes;var x=o.buildProgram(l,t.shader,_,y);o.__error=x;a[n]=o;return o};t["a"]=a},function(e,t,r){"use strict";var f=r(14);var a=r(7);var c=1;var d=2;var v=3;var p={};function i(e){var t=e.split("\n");for(var r=0,a=t.length;r<a;r++){t[r]=r+1+": "+t[r]}return t.join("\n")}function m(e,t,r){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){return[e.getShaderInfoLog(t),i(r)].join("\n")}}var g=new f["a"].Float32Array(16);var n=a["a"].extend({uniformSemantics:{},attributes:{}},function(){this._locations={};this._textureSlot=0;this._program=null},{bind:function(e){this._textureSlot=0;e.gl.useProgram(this._program)},hasUniform:function(e){var t=this._locations[e];return t!==null&&t!==undefined},useTextureSlot:function(e,t,r){if(t){e.gl.activeTexture(e.gl.TEXTURE0+r);if(t.isRenderable()){t.bind(e)}else{t.unbind(e)}}},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(e){this._textureSlot=e||0},takeCurrentTextureSlot:function(e,t){var r=this._textureSlot;this.useTextureSlot(e,t,r);this._textureSlot++;return r},setUniform:function(e,t,r,a){var i=this._locations;var n=i[r];if(n===null||n===undefined){return false}switch(t){case"m4":if(!(a instanceof Float32Array)){for(var o=0;o<a.length;o++){g[o]=a[o]}a=g}e.uniformMatrix4fv(n,false,a);break;case"2i":e.uniform2i(n,a[0],a[1]);break;case"2f":e.uniform2f(n,a[0],a[1]);break;case"3i":e.uniform3i(n,a[0],a[1],a[2]);break;case"3f":e.uniform3f(n,a[0],a[1],a[2]);break;case"4i":e.uniform4i(n,a[0],a[1],a[2],a[3]);break;case"4f":e.uniform4f(n,a[0],a[1],a[2],a[3]);break;case"1i":e.uniform1i(n,a);break;case"1f":e.uniform1f(n,a);break;case"1fv":e.uniform1fv(n,a);break;case"1iv":e.uniform1iv(n,a);break;case"2iv":e.uniform2iv(n,a);break;case"2fv":e.uniform2fv(n,a);break;case"3iv":e.uniform3iv(n,a);break;case"3fv":e.uniform3fv(n,a);break;case"4iv":e.uniform4iv(n,a);break;case"4fv":e.uniform4fv(n,a);break;case"m2":case"m2v":e.uniformMatrix2fv(n,false,a);break;case"m3":case"m3v":e.uniformMatrix3fv(n,false,a);break;case"m4v":if(Array.isArray(a)&&Array.isArray(a[0])){var s=new f["a"].Float32Array(a.length*16);var u=0;for(var o=0;o<a.length;o++){var l=a[o];for(var h=0;h<16;h++){s[u++]=l[h]}}e.uniformMatrix4fv(n,false,s)}else{e.uniformMatrix4fv(n,false,a)}break}return true},setUniformOfSemantic:function(e,t,r){var a=this.uniformSemantics[t];if(a){return this.setUniform(e,a.type,a.symbol,r)}return false},enableAttributes:function(e,t,r){var a=e.gl;var i=this._program;var n=this._locations;var o;if(r){o=r.__enabledAttributeList}else{o=p[e.__uid__]}if(!o){if(r){o=r.__enabledAttributeList=[]}else{o=p[e.__uid__]=[]}}var s=[];for(var u=0;u<t.length;u++){var l=t[u];if(!this.attributes[l]){s[u]=-1;continue}var h=n[l];if(h==null){h=a.getAttribLocation(i,l);if(h===-1){s[u]=-1;continue}n[l]=h}s[u]=h;if(!o[h]){o[h]=c}else{o[h]=d}}for(var u=0;u<o.length;u++){switch(o[u]){case c:a.enableVertexAttribArray(u);o[u]=v;break;case d:o[u]=v;break;case v:a.disableVertexAttribArray(u);o[u]=0;break}}return s},buildProgram:function(e,t,r,a){var i=e.createShader(e.VERTEX_SHADER);var n=e.createProgram();e.shaderSource(i,r);e.compileShader(i);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,a);e.compileShader(o);var s=m(e,i,r);if(s){return s}s=m(e,o,a);if(s){return s}e.attachShader(n,i);e.attachShader(n,o);if(t.attributeSemantics["POSITION"]){e.bindAttribLocation(n,0,t.attributeSemantics["POSITION"].symbol)}else{var u=Object.keys(this.attributes);e.bindAttribLocation(n,0,u[0])}e.linkProgram(n);if(!e.getProgramParameter(n,e.LINK_STATUS)){return"Could not link program\n"+e.getProgramInfoLog(n)}for(var l=0;l<t.uniforms.length;l++){var h=t.uniforms[l];this._locations[h]=e.getUniformLocation(n,h)}e.deleteShader(i);e.deleteShader(o);this._program=n;this.vertexCode=r;this.fragmentCode=a}});t["a"]=n},function(e,t,r){"use strict";var a=r(7);var i=r(54);var n=r(26);var N=r(3);var I=r(9);var o=r(72);var R=r(11);var P=r(12);var O=a["a"].extend({scene:null,camera:null,renderer:null},function(){this._ray=new i["a"];this._ndc=new n["a"]},{pick:function(e,t,r){var a=this.pickAll(e,t,[],r);return a[0]||null},pickAll:function(e,t,r,a){this.renderer.screenToNDC(e,t,this._ndc);this.camera.castRay(this._ndc,this._ray);r=r||[];this._intersectNode(this.scene,r,a||false);r.sort(this._intersectionCompareFunc);return r},_intersectNode:function(e,t,r){if(e instanceof o["a"]&&e.isRenderable()){if((!e.ignorePicking||r)&&(e.mode===R["a"].TRIANGLES&&e.geometry.isUseIndices()||e.geometry.pickByRay||e.geometry.pick)){this._intersectRenderable(e,t)}}for(var a=0;a<e._children.length;a++){this._intersectNode(e._children[a],t,r)}},_intersectRenderable:function(){var A=new N["a"];var M=new N["a"];var C=new N["a"];var L=new i["a"];var D=new I["a"];return function(e,t){var r=e.isSkinnedMesh();L.copy(this._ray);I["a"].invert(D,e.worldTransform);if(!r){L.applyTransform(D)}var a=e.geometry;var i=r?e.skeleton.boundingBox:a.boundingBox;if(i&&!L.intersectBoundingBox(i)){return}if(a.pick){a.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,e,t);return}else if(a.pickByRay){a.pickByRay(L,e,t);return}var n=e.cullFace===R["a"].BACK&&e.frontFace===R["a"].CCW||e.cullFace===R["a"].FRONT&&e.frontFace===R["a"].CW;var o;var s=a.indices;var u=a.attributes.position;var l=a.attributes.weight;var h=a.attributes.joint;var f;var c=[];if(!u||!u.value||!s){return}if(r){f=e.skeleton.getSubSkinMatrices(e.__uid__,e.joints);for(var d=0;d<e.joints.length;d++){c[d]=c[d]||[];for(var v=0;v<16;v++){c[d][v]=f[d*16+v]}}var p=[];var m=[];var g=[];var _=[];var y=[];var x=a.attributes.skinnedPosition;if(!x||!x.value){a.createAttribute("skinnedPosition","f",3);x=a.attributes.skinnedPosition;x.init(a.vertexCount)}for(var d=0;d<a.vertexCount;d++){u.get(d,p);l.get(d,m);h.get(d,g);m[3]=1-m[0]-m[1]-m[2];P["a"].set(_,0,0,0);for(var v=0;v<4;v++){if(g[v]>=0&&m[v]>1e-4){P["a"].transformMat4(y,p,c[g[v]]);P["a"].scaleAndAdd(_,_,y,m[v])}}x.set(d,_)}}for(var d=0;d<s.length;d+=3){var T=s[d];var b=s[d+1];var w=s[d+2];var E=r?a.attributes.skinnedPosition:u;E.get(T,A.array);E.get(b,M.array);E.get(w,C.array);if(n){o=L.intersectTriangle(A,M,C,e.culling)}else{o=L.intersectTriangle(A,C,M,e.culling)}if(o){var S=new N["a"];if(!r){N["a"].transformMat4(S,o,e.worldTransform)}else{N["a"].copy(S,o)}t.push(new O.Intersection(o,S,e,[T,b,w],d/3,N["a"].dist(S,this._ray.origin)))}}}}(),_intersectionCompareFunc:function(e,t){return e.distance-t.distance}});O.Intersection=function(e,t,r,a,i,n){this.point=e;this.pointWorld=t;this.target=r;this.triangle=a;this.triangleIndex=i;this.distance=n};t["a"]=O},function(e,t,r){"use strict";var a=r(7);var g=r(11);var i=r(57);var s=r(14);function u(e){return{byte:s["a"].Int8Array,ubyte:s["a"].Uint8Array,short:s["a"].Int16Array,ushort:s["a"].Uint16Array}[e]||s["a"].Float32Array}function _(e){return"attr_"+e}function n(e,t,r,a){this.name=e;this.type=t;this.size=r;this.semantic=a||"";this.value=null;switch(r){case 1:this.get=function(e){return this.value[e]};this.set=function(e,t){this.value[e]=t};this.copy=function(e,t){this.value[e]=this.value[e]};break;case 2:this.get=function(e,t){var r=this.value;t[0]=r[e*2];t[1]=r[e*2+1];return t};this.set=function(e,t){var r=this.value;r[e*2]=t[0];r[e*2+1]=t[1]};this.copy=function(e,t){var r=this.value;t*=2;e*=2;r[e]=r[t];r[e+1]=r[t+1]};break;case 3:this.get=function(e,t){var r=e*3;var a=this.value;t[0]=a[r];t[1]=a[r+1];t[2]=a[r+2];return t};this.set=function(e,t){var r=e*3;var a=this.value;a[r]=t[0];a[r+1]=t[1];a[r+2]=t[2]};this.copy=function(e,t){var r=this.value;t*=3;e*=3;r[e]=r[t];r[e+1]=r[t+1];r[e+2]=r[t+2]};break;case 4:this.get=function(e,t){var r=this.value;var a=e*4;t[0]=r[a];t[1]=r[a+1];t[2]=r[a+2];t[3]=r[a+3];return t};this.set=function(e,t){var r=this.value;var a=e*4;r[a]=t[0];r[a+1]=t[1];r[a+2]=t[2];r[a+3]=t[3]};this.copy=function(e,t){var r=this.value;t*=4;e*=4;r[e]=r[t];r[e+1]=r[t+1];r[e+2]=r[t+2];r[e+3]=r[t+3]}}}n.prototype.init=function(e){if(!this.value||this.value.length!=e*this.size){var t=u(this.type);this.value=new t(e*this.size)}};n.prototype.fromArray=function(e){var t=u(this.type);var r;if(e[0]&&e[0].length){var a=0;var i=this.size;r=new t(e.length*i);for(var n=0;n<e.length;n++){for(var o=0;o<i;o++){r[a++]=e[n][o]}}}else{r=new t(e)}this.value=r};n.prototype.clone=function(e){var t=new n(this.name,this.type,this.size,this.semantic);if(e){console.warn("todo")}return t};function y(e,t,r,a,i){this.name=e;this.type=t;this.buffer=r;this.size=a;this.semantic=i;this.symbol="";this.needsRemove=false}function x(e){this.buffer=e;this.count=0}var o=a["a"].extend(function(){return{attributes:{},indices:null,dynamic:true,_enabledAttributes:null,__used:0}},function(){this._cache=new i["a"];this._attributeList=Object.keys(this.attributes);this.__vaoCache={}},{mainAttribute:"",pick:null,pickByRay:null,dirty:function(){var e=this.getEnabledAttributes();for(var t=0;t<e.length;t++){this.dirtyAttribute(e[t])}this.dirtyIndices();this._enabledAttributes=null;this._cache.dirty("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(e){this._cache.dirtyAll(_(e));this._cache.dirtyAll("attributes")},getTriangleIndices:function(e,t){if(e<this.triangleCount&&e>=0){if(!t){t=[]}var r=this.indices;t[0]=r[e*3];t[1]=r[e*3+1];t[2]=r[e*3+2];return t}},setTriangleIndices:function(e,t){var r=this.indices;r[e*3]=t[0];r[e*3+1]=t[1];r[e*3+2]=t[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(e){var t;var r=this.vertexCount>65535?s["a"].Uint32Array:s["a"].Uint16Array;if(e[0]&&e[0].length){var a=0;var i=3;t=new r(e.length*i);for(var n=0;n<e.length;n++){for(var o=0;o<i;o++){t[a++]=e[n][o]}}}else{t=new r(e)}this.indices=t},createAttribute:function(e,t,r,a){var i=new n(e,t,r,a);if(this.attributes[e]){this.removeAttribute(e)}this.attributes[e]=i;this._attributeList.push(e);return i},removeAttribute:function(e){var t=this._attributeList;var r=t.indexOf(e);if(r>=0){t.splice(r,1);delete this.attributes[e];return true}return false},getAttribute:function(e){return this.attributes[e]},getEnabledAttributes:function(){var e=this._enabledAttributes;var t=this._attributeList;if(e){return e}var r=[];var a=this.vertexCount;for(var i=0;i<t.length;i++){var n=t[i];var o=this.attributes[n];if(o.value){if(o.value.length===a*o.size){r.push(n)}}}this._enabledAttributes=r;return r},getBufferChunks:function(e){var t=this._cache;t.use(e.__uid__);var r=t.isDirty("attributes");var a=t.isDirty("indices");if(r||a){this._updateBuffer(e.gl,r,a);var i=this.getEnabledAttributes();for(var n=0;n<i.length;n++){t.fresh(_(i[n]))}t.fresh("attributes");t.fresh("indices")}t.fresh("any");return t.get("chunks")},_updateBuffer:function(e,t,r){var a=this._cache;var i=a.get("chunks");var n=false;if(!i){i=[];i[0]={attributeBuffers:[],indicesBuffer:null};a.put("chunks",i);n=true}var o=i[0];var s=o.attributeBuffers;var u=o.indicesBuffer;if(t||n){var l=this.getEnabledAttributes();var h={};if(!n){for(var f=0;f<s.length;f++){h[s[f].name]=s[f]}}for(var c=0;c<l.length;c++){var d=l[c];var v=this.attributes[d];var p;if(!n){p=h[d]}var m;if(p){m=p.buffer}else{m=e.createBuffer()}if(a.isDirty(_(d))){e.bindBuffer(e.ARRAY_BUFFER,m);e.bufferData(e.ARRAY_BUFFER,v.value,this.dynamic?g["a"].DYNAMIC_DRAW:g["a"].STATIC_DRAW)}s[c]=new y(d,v.type,m,v.size,v.semantic)}for(var f=c;f<s.length;f++){e.deleteBuffer(s[f].buffer)}s.length=c}if(this.isUseIndices()&&(r||n)){if(!u){u=new x(e.createBuffer());o.indicesBuffer=u}u.count=this.indices.length;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u.buffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?g["a"].DYNAMIC_DRAW:g["a"].STATIC_DRAW)}},dispose:function(e){var t=this._cache;t.use(e.__uid__);var r=t.get("chunks");if(r){for(var a=0;a<r.length;a++){var i=r[a];for(var n=0;n<i.attributeBuffers.length;n++){var o=i.attributeBuffers[n];e.gl.deleteBuffer(o.buffer)}if(i.indicesBuffer){e.gl.deleteBuffer(i.indicesBuffer.buffer)}}}if(this.__vaoCache){var s=e.getGLExtension("OES_vertex_array_object");for(var u in this.__vaoCache){var l=this.__vaoCache[u].vao;if(l){s.deleteVertexArrayOES(l)}}}this.__vaoCache={};t.deleteContext(e.__uid__)}});if(Object.defineProperty){Object.defineProperty(o.prototype,"vertexCount",{enumerable:false,get:function(){var e=this.attributes[this.mainAttribute];if(!e){e=this.attributes[this._attributeList[0]]}if(!e||!e.value){return 0}return e.value.length/e.size}});Object.defineProperty(o.prototype,"triangleCount",{enumerable:false,get:function(){var e=this.indices;if(!e){return 0}else{return e.length/3}}})}o.STATIC_DRAW=g["a"].STATIC_DRAW;o.DYNAMIC_DRAW=g["a"].DYNAMIC_DRAW;o.STREAM_DRAW=g["a"].STREAM_DRAW;o.AttributeBuffer=y;o.IndicesBuffer=x;o.Attribute=n;t["a"]=o},function(e,t,r){"use strict";var a=r(120);var i="uniform vec3 ";var n="uniform float ";var o="@export clay.header.";var s="@end";var u=":unconfigurable;";t["a"]=[o+"directional_light",i+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+u,i+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+u,s,o+"ambient_light",i+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+u,s,o+"ambient_sh_light",i+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+u,i+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+u,a["a"],s,o+"ambient_cubemap_light",i+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+u,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+u,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+u,s,o+"point_light",i+"pointLightPosition[POINT_LIGHT_COUNT]"+u,n+"pointLightRange[POINT_LIGHT_COUNT]"+u,i+"pointLightColor[POINT_LIGHT_COUNT]"+u,s,o+"spot_light",i+"spotLightPosition[SPOT_LIGHT_COUNT]"+u,i+"spotLightDirection[SPOT_LIGHT_COUNT]"+u,n+"spotLightRange[SPOT_LIGHT_COUNT]"+u,n+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+u,n+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+u,n+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+u,i+"spotLightColor[SPOT_LIGHT_COUNT]"+u,s].join("\n")},function(e,t,r){"use strict";t["a"]="vec3 calcAmbientSHLight(int idx, vec3 N) {\n int offset = 9 * idx;\n return ambientSHLightCoefficients[0]\n + ambientSHLightCoefficients[1] * N.x\n + ambientSHLightCoefficients[2] * N.y\n + ambientSHLightCoefficients[3] * N.z\n + ambientSHLightCoefficients[4] * N.x * N.z\n + ambientSHLightCoefficients[5] * N.z * N.y\n + ambientSHLightCoefficients[6] * N.y * N.x\n + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\n + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);\n}"},function(e,t,r){"use strict";t["a"]="@export clay.skybox.vertex\n#define SHADER_NAME skybox\nuniform mat4 world : WORLD;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nvarying vec3 v_WorldPosition;\nvoid main()\n{\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end\n@export clay.skybox.fragment\n#define PI 3.1415926\nuniform mat4 viewInverse : VIEWINVERSE;\n#ifdef EQUIRECTANGULAR\nuniform sampler2D environmentMap;\n#else\nuniform samplerCube environmentMap;\n#endif\nuniform float lod: 0.0;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\n@import clay.util.srgb\n@import clay.util.ACES\nvoid main()\n{\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n#ifdef EQUIRECTANGULAR\n float phi = acos(V.y);\n float theta = atan(-V.x, V.z) + PI * 0.5;\n vec2 uv = vec2(theta / 2.0 / PI, phi / PI);\n vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));\n#else\n #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)\n vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));\n #else\n vec4 texel = decodeHDR(textureCube(environmentMap, V));\n #endif\n#endif\n#ifdef SRGB_DECODE\n texel = sRGBToLinear(texel);\n#endif\n#ifdef TONEMAPPING\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n#ifdef SRGB_ENCODE\n texel = linearTosRGB(texel);\n#endif\n gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));\n}\n@end"},function(e,t,r){"use strict";var T=r(4);var b=r(5);var a=r(27);var w=542327876;var i=1;var n=2;var o=4;var s=8;var u=4096;var E=131072;var l=524288;var h=8388608;var f=8;var c=4194304;var d=4096;var S=512;var v=1024;var p=2048;var m=4096;var g=8192;var _=16384;var y=32768;var x=2097152;var A=1;var M=2;var C=4;var L=64;var D=512;var N=131072;function I(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function R(e){return String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)}var P=31;var O=I("DXT1");var F=I("DXT3");var B=I("DXT5");var U=0;var z=1;var G=2;var H=3;var V=4;var k=7;var W=20;var j=21;var X=27;var q=28;var Z=29;var Y=30;var K={parse:function(e,t){var r=new Int32Array(e,0,P);if(r[U]!==w){return null}if(!r(W)&C){return null}var a=r(j);var i=r[V];var n=r[H];var o=r[q]&S;var s=r[G]&E;var u,l;switch(a){case O:u=8;l=T["a"].COMPRESSED_RGB_S3TC_DXT1_EXT;break;case F:u=16;l=T["a"].COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case B:u=16;l=T["a"].COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var h=r[z]+4;var f=o?6:1;var c=1;if(s){c=Math.max(1,r[k])}var d=[];for(var v=0;v<f;v++){var p=i;var m=n;d[v]=new b["a"]({width:p,height:m,format:l});var g=[];for(var _=0;_<c;_++){var y=Math.max(4,p)/4*Math.max(4,m)/4*u;var x=new Uint8Array(e,h,y);h+=y;p*=.5;m*=.5;g[_]=x}d[v].pixels=g[0];if(s){d[v].mipmaps=g}}if(t){t.width=d[0].width;t.height=d[0].height;t.format=d[0].format;t.pixels=d[0].pixels;t.mipmaps=d[0].mipmaps}else{return d[0]}}};t["a"]=K},function(e,t,r){"use strict";var _=r(4);var y=r(5);var x=String.fromCharCode;var u=8;var l=32767;function T(e,t,r,a){if(e[3]>0){var i=Math.pow(2,e[3]-128-8+a);t[r+0]=e[0]*i;t[r+1]=e[1]*i;t[r+2]=e[2]*i}else{t[r+0]=0;t[r+1]=0;t[r+2]=0}t[r+3]=1;return t}function b(e,t,r){var a="";for(var i=t;i<r;i++){a+=x(e[i])}return a}function h(e,t){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3]}function f(e,t,r,a){var i=0,n=0,o=a;while(o>0){e[n][0]=t[r++];e[n][1]=t[r++];e[n][2]=t[r++];e[n][3]=t[r++];if(e[n][0]===1&&e[n][1]===1&&e[n][2]===1){for(var s=e[n][3]<<i>>>0;s>0;s--){h(e[n-1],e[n]);n++;o--}i+=8}else{n++;o--;i=0}}return r}function w(e,t,r,a){if(a<u|a>l){return f(e,t,r,a)}var i=t[r++];if(i!=2){return f(e,t,r-1,a)}e[0][1]=t[r++];e[0][2]=t[r++];i=t[r++];if((e[0][2]<<8>>>0|i)>>>0!==a){return null}for(var i=0;i<4;i++){for(var n=0;n<a;){var o=t[r++];if(o>128){o=(o&127)>>>0;var s=t[r++];while(o--){e[n++][i]=s}}else{while(o--){e[n++][i]=t[r++]}}}}return r}var a={parseRGBE:function(e,t,r){if(r==null){r=0}var a=new Uint8Array(e);var i=a.length;if(b(a,0,2)!=="#?"){return}for(var n=2;n<i;n++){if(x(a[n])==="\n"&&x(a[n+1])==="\n"){break}}if(n>=i){return}n+=2;var o="";for(;n<i;n++){var s=x(a[n]);if(s==="\n"){break}o+=s}var u=o.split(" ");var l=parseInt(u[1]);var h=parseInt(u[3]);if(!h||!l){return}var f=n+1;var c=[];for(var d=0;d<h;d++){c[d]=[];for(var v=0;v<4;v++){c[d][v]=0}}var p=new Float32Array(h*l*4);var m=0;for(var g=0;g<l;g++){var f=w(c,a,f,h);if(!f){return null}for(var d=0;d<h;d++){T(c[d],p,m,r);m+=4}}if(!t){t=new y["a"]}t.width=h;t.height=l;t.pixels=p;t.type=_["a"].FLOAT;return t},parseRGBEFromPNG:function(e){}};t["a"]=a},function(e,t,r){"use strict";var a=r(5);var w=r(3);var E=r(26);var i=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","contextmenu"];function n(e){return"_on"+e}var o=function(e){var t=this;this._texture=new a["a"]({anisotropic:32,flipY:false,surface:this,dispose:function(e){t.dispose();a["a"].prototype.dispose.call(this,e)}});i.forEach(function(r){this[n(r)]=function(t){if(!t.triangle){return}this._meshes.forEach(function(e){this.dispatchEvent(r,e,t.triangle,t.point)},this)}},this);this._meshes=[];if(e){this.setECharts(e)}this.onupdate=null};o.prototype={constructor:o,getTexture:function(){return this._texture},setECharts:function(e){this._chart=e;var t=e.getDom();if(!(t instanceof HTMLCanvasElement)){console.error("ECharts must init on canvas if it is used as texture.");t=document.createElement("canvas")}else{var r=this;var a=e.getZr();var i=a.__oldRefreshImmediately||a.refreshImmediately;a.refreshImmediately=function(){i.call(this);r._texture.dirty();r.onupdate&&r.onupdate()};a.__oldRefreshImmediately=i}this._texture.image=t;this._texture.dirty();this.onupdate&&this.onupdate()},dispatchEvent:function(){var p=new w["a"];var m=new w["a"];var g=new w["a"];var _=new E["a"];var y=new E["a"];var x=new E["a"];var T=new E["a"];var b=new w["a"];return function(e,t,r,a){var i=t.geometry;var n=i.attributes.position;var o=i.attributes.texcoord0;var s=w["a"].dot;var u=w["a"].cross;n.get(r[0],p.array);n.get(r[1],m.array);n.get(r[2],g.array);o.get(r[0],_.array);o.get(r[1],y.array);o.get(r[2],x.array);u(b,m,g);var l=s(p,b);var h=s(a,b)/l;u(b,g,p);var f=s(a,b)/l;u(b,p,m);var c=s(a,b)/l;E["a"].scale(T,_,h);E["a"].scaleAndAdd(T,T,y,f);E["a"].scaleAndAdd(T,T,x,c);var d=T.x*this._chart.getWidth();var v=T.y*this._chart.getHeight();this._chart.getZr().handler.dispatch(e,{zrX:d,zrY:v})}}(),attachToMesh:function(t){if(this._meshes.indexOf(t)>=0){return}i.forEach(function(e){t.on(e,this[n(e)],this)},this);this._meshes.push(t)},detachFromMesh:function(t){var e=this._meshes.indexOf(t);if(e>=0){this._meshes.splice(e,1)}i.forEach(function(e){t.off(e,this[n(e)])},this)},dispose:function(){this._meshes.forEach(function(e){this.detachFromMesh(e)},this)}};t["a"]=o},function(e,t,r){"use strict";var a=r(24);var i=r(77);var n=a["a"].extend({cubemap:null,castShadow:false,_normalDistribution:null,_brdfLookup:null},{type:"AMBIENT_CUBEMAP_LIGHT",prefilter:function(e,t){if(!e.getGLExtension("EXT_shader_texture_lod")){console.warn("Device not support textureCubeLodEXT");return}if(!this._brdfLookup){this._normalDistribution=i["a"].generateNormalDistribution();this._brdfLookup=i["a"].integrateBRDF(e,this._normalDistribution)}var r=this.cubemap;if(r.__prefiltered){return}var a=i["a"].prefilterEnvironmentMap(e,r,{encodeRGBM:true,width:t,height:t},this._normalDistribution,this._brdfLookup);this.cubemap=a.environmentMap;this.cubemap.__prefiltered=true;r.dispose(e)},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}},ambientCubemapLightCubemap:{type:"t",value:function(e){return e.cubemap}},ambientCubemapLightBRDFLookup:{type:"t",value:function(e){return e._brdfLookup}}}});t["a"]=n},function(e,t,r){"use strict";t["a"]="\n@export clay.compositor.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n v_Texcoord = texcoord;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end"},function(e,t,r){"use strict";t["a"]="#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform sampler2D normalDistribution;\nuniform vec2 viewportSize : [512, 256];\nconst vec3 N = vec3(0.0, 0.0, 1.0);\nconst float fSampleNumber = float(SAMPLE_NUMBER);\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nfloat G_Smith(float roughness, float NoV, float NoL) {\n float k = roughness * roughness / 2.0;\n float G1V = NoV / (NoV * (1.0 - k) + k);\n float G1L = NoL / (NoL * (1.0 - k) + k);\n return G1L * G1V;\n}\nvoid main() {\n vec2 uv = gl_FragCoord.xy / viewportSize;\n float NoV = uv.x;\n float roughness = uv.y;\n vec3 V;\n V.x = sqrt(1.0 - NoV * NoV);\n V.y = 0.0;\n V.z = NoV;\n float A = 0.0;\n float B = 0.0;\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(L.z, 0.0, 1.0);\n float NoH = clamp(H.z, 0.0, 1.0);\n float VoH = clamp(dot(V, H), 0.0, 1.0);\n if (NoL > 0.0) {\n float G = G_Smith(roughness, NoV, NoL);\n float G_Vis = G * VoH / (NoH * NoV);\n float Fc = pow(1.0 - VoH, 5.0);\n A += (1.0 - Fc) * G_Vis;\n B += Fc * G_Vis;\n }\n }\n gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);\n}\n"},function(e,t,r){"use strict";t["a"]="#define SHADER_NAME prefilter\n#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform mat4 viewInverse : VIEWINVERSE;\nuniform samplerCube environmentMap;\nuniform sampler2D normalDistribution;\nuniform float roughness : 0.5;\nvarying vec2 v_Texcoord;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvoid main() {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n vec3 N = V;\n vec3 prefilteredColor = vec3(0.0);\n float totalWeight = 0.0;\n float fMaxSampleNumber = float(SAMPLE_NUMBER);\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(dot(N, L), 0.0, 1.0);\n if (NoL > 0.0) {\n prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;\n totalWeight += NoL;\n }\n }\n gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));\n}\n"},function(e,t,r){"use strict";var a=r(24);var i=r(14);var n=a["a"].extend({castShadow:false,coefficients:[]},function(){this._coefficientsTmpArr=new i["a"].Float32Array(9*3)},{type:"AMBIENT_SH_LIGHT",uniformTemplates:{ambientSHLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}},ambientSHLightCoefficients:{type:"3f",value:function(e){var t=e._coefficientsTmpArr;for(var r=0;r<e.coefficients.length;r++){t[r]=e.coefficients[r]}return t}}}});t["a"]=n},function(e,t,r){"use strict";var v=r(4);var p=r(10);var m=r(5);var u=r(16);var y=r(14);var g=r(42);var _=r(75);var x=r(62);var T=r(36);var b=r(12);var l=r(131);var a={};var w=["px","nx","py","ny","pz","nz"];function i(e,t){var r=new m["a"]({width:9,height:1,type:v["a"].FLOAT});var a=new u["a"]({fragment:l["a"]});a.material.define("fragment","TEXTURE_SIZE",t.width);a.setUniform("environmentMap",t);var i=new p["a"];i.attach(r);a.render(e,i);i.bind(e);var n=new y["a"].Float32Array(9*4);e.gl.readPixels(0,0,9,1,v["a"].RGBA,v["a"].FLOAT,n);var o=new y["a"].Float32Array(9*3);for(var s=0;s<9;s++){o[s*3]=n[s*4];o[s*3+1]=n[s*4+1];o[s*3+2]=n[s*4+2]}i.unbind(e);i.dispose(e);a.dispose(e);return o}function E(e,t){var r=e[0];var a=e[1];var i=e[2];if(t===0){return 1}else if(t===1){return r}else if(t===2){return a}else if(t===3){return i}else if(t===4){return r*i}else if(t===5){return a*i}else if(t===6){return r*a}else if(t===7){return 3*i*i-1}else{return r*r-a*a}}var S={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};function A(e,t,r,a){var i=new y["a"].Float32Array(9*3);var n=b["a"].create();var o=b["a"].create();var s=b["a"].create();for(var u=0;u<9;u++){var l=b["a"].create();for(var h=0;h<w.length;h++){var f=t[w[h]];var c=b["a"].create();var d=0;var v=0;var p=S[w[h]];for(var m=0;m<a;m++){for(var g=0;g<r;g++){n[0]=g/(r-1)*2-1;n[1]=m/(a-1)*2-1;n[2]=-1;b["a"].normalize(n,n);s[0]=n[p[0]]*p[3];s[1]=n[p[1]]*p[4];s[2]=n[p[2]]*p[5];o[0]=f[v++]/255;o[1]=f[v++]/255;o[2]=f[v++]/255;var _=f[v++]/255*8.12;o[0]*=_;o[1]*=_;o[2]*=_;b["a"].scaleAndAdd(c,c,o,E(s,u)*-n[2]);d+=-n[2]}}b["a"].scaleAndAdd(l,l,c,1/d)}i[u*3]=l[0]/6;i[u*3+1]=l[1]/6;i[u*3+2]=l[2]/6}return i}a.projectEnvironmentMap=function(e,t,r){r=r||{};r.lod=r.lod||0;var a;var i=new T["a"];var n=64;if(t.textureType==="texture2D"){a=new _["a"]({scene:i,environmentMap:t})}else{n=t.image&&t.image.px?t.image.px.width:t.width;a=new g["a"]({scene:i,environmentMap:t})}var o=Math.ceil(n/Math.pow(2,r.lod));var s=Math.ceil(n/Math.pow(2,r.lod));var u=new m["a"]({width:o,height:s});var l=new p["a"];a.material.define("fragment","RGBM_ENCODE");if(r.decodeRGBM){a.material.define("fragment","RGBM_DECODE")}a.material.set("lod",r.lod);var h=new x["a"]({texture:u});var f={};for(var c=0;c<w.length;c++){f[w[c]]=new Uint8Array(o*s*4);var d=h.getCamera(w[c]);d.fov=90;l.attach(u);l.bind(e);e.render(i,d);e.gl.readPixels(0,0,o,s,v["a"].RGBA,v["a"].UNSIGNED_BYTE,f[w[c]]);l.unbind(e)}a.dispose(e);l.dispose(e);u.dispose(e);return A(e,f,o,s)};t["a"]=a},function(e,t,r){"use strict";t["a"]="uniform samplerCube environmentMap;\nvarying vec2 v_Texcoord;\n#define TEXTURE_SIZE 16\nmat3 front = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 1.0, 0.0,\n 0.0, 0.0, 1.0\n);\nmat3 back = mat3(\n -1.0, 0.0, 0.0,\n 0.0, 1.0, 0.0,\n 0.0, 0.0, -1.0\n);\nmat3 left = mat3(\n 0.0, 0.0, -1.0,\n 0.0, 1.0, 0.0,\n 1.0, 0.0, 0.0\n);\nmat3 right = mat3(\n 0.0, 0.0, 1.0,\n 0.0, 1.0, 0.0,\n -1.0, 0.0, 0.0\n);\nmat3 up = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 0.0, 1.0,\n 0.0, -1.0, 0.0\n);\nmat3 down = mat3(\n 1.0, 0.0, 0.0,\n 0.0, 0.0, -1.0,\n 0.0, 1.0, 0.0\n);\nfloat harmonics(vec3 normal){\n int index = int(gl_FragCoord.x);\n float x = normal.x;\n float y = normal.y;\n float z = normal.z;\n if(index==0){\n return 1.0;\n }\n else if(index==1){\n return x;\n }\n else if(index==2){\n return y;\n }\n else if(index==3){\n return z;\n }\n else if(index==4){\n return x*z;\n }\n else if(index==5){\n return y*z;\n }\n else if(index==6){\n return x*y;\n }\n else if(index==7){\n return 3.0*z*z - 1.0;\n }\n else{\n return x*x - y*y;\n }\n}\nvec3 sampleSide(mat3 rot)\n{\n vec3 result = vec3(0.0);\n float divider = 0.0;\n for (int i = 0; i < TEXTURE_SIZE * TEXTURE_SIZE; i++) {\n float x = mod(float(i), float(TEXTURE_SIZE));\n float y = float(i / TEXTURE_SIZE);\n vec2 sidecoord = ((vec2(x, y) + vec2(0.5, 0.5)) / vec2(TEXTURE_SIZE)) * 2.0 - 1.0;\n vec3 normal = normalize(vec3(sidecoord, -1.0));\n vec3 fetchNormal = rot * normal;\n vec3 texel = textureCube(environmentMap, fetchNormal).rgb;\n result += harmonics(fetchNormal) * texel * -normal.z;\n divider += -normal.z;\n }\n return result / divider;\n}\nvoid main()\n{\n vec3 result = (\n sampleSide(front) +\n sampleSide(back) +\n sampleSide(left) +\n sampleSide(right) +\n sampleSide(up) +\n sampleSide(down)\n ) / 6.0;\n gl_FragColor = vec4(result, 1.0);\n}"},function(e,t,r){"use strict";var a=r(15);var D=r(18);var i=a["a"].extend({dynamic:false,widthSegments:40,heightSegments:20,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var e=this.heightSegments;var t=this.widthSegments;var r=this.attributes.position;var a=this.attributes.texcoord0;var i=this.attributes.normal;var n=(t+1)*(e+1);r.init(n);a.init(n);i.init(n);var o=n>65535?Uint32Array:Uint16Array;var s=this.indices=new o(t*e*6);var u,l,h,f,c,d,v;var p=this.radius;var m=this.phiStart;var g=this.phiLength;var _=this.thetaStart;var y=this.thetaLength;var p=this.radius;var x=[];var T=[];var b=0;var w=1/p;for(v=0;v<=e;v++){for(d=0;d<=t;d++){f=d/t;c=v/e;u=-p*Math.cos(m+f*g)*Math.sin(_+c*y);l=p*Math.cos(_+c*y);h=p*Math.sin(m+f*g)*Math.sin(_+c*y);x[0]=u;x[1]=l;x[2]=h;T[0]=f;T[1]=c;r.set(b,x);a.set(b,T);x[0]*=w;x[1]*=w;x[2]*=w;i.set(b,x);b++}}var E,S,A,M;var C=t+1;var L=0;for(v=0;v<e;v++){for(d=0;d<t;d++){S=v*C+d;E=v*C+d+1;M=(v+1)*C+d+1;A=(v+1)*C+d;s[L++]=E;s[L++]=S;s[L++]=M;s[L++]=S;s[L++]=A;s[L++]=M}}this.boundingBox=new D["a"];this.boundingBox.max.set(p,p,p);this.boundingBox.min.set(-p,-p,-p)}});t["a"]=i},function(e,t,r){"use strict";var a=r(24);var i=a["a"].extend({castShadow:false},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}}});t["a"]=i},function(e,t,r){"use strict";var a=r(24);var i=r(3);var n=a["a"].extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(e){e.__dir=e.__dir||new i["a"];return e.__dir.copy(e.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=a["a"].prototype.clone.call(this);e.shadowBias=this.shadowBias;e.shadowSlopeScale=this.shadowSlopeScale;return e}});t["a"]=n},function(e,t,r){"use strict";var a=r(24);var i=a["a"].extend({range:100,castShadow:false},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(e){return e.getWorldPosition().array}},pointLightRange:{type:"1f",value:function(e){return e.range}},pointLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=a["a"].prototype.clone.call(this);e.range=this.range;return e}});t["a"]=i},function(e,t,r){"use strict";var a=r(24);var i=r(3);var n=a["a"].extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(e){return e.getWorldPosition().array}},spotLightRange:{type:"1f",value:function(e){return e.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(e){return Math.cos(e.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(e){return Math.cos(e.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(e){return e.falloffFactor}},spotLightDirection:{type:"3f",value:function(e){e.__dir=e.__dir||new i["a"];return e.__dir.copy(e.worldTransform.z).negate().array}},spotLightColor:{type:"3f",value:function(e){var t=e.color;var r=e.intensity;return[t[0]*r,t[1]*r,t[2]*r]}}},clone:function(){var e=a["a"].prototype.clone.call(this);e.range=this.range;e.umbraAngle=this.umbraAngle;e.penumbraAngle=this.penumbraAngle;e.falloffFactor=this.falloffFactor;e.shadowBias=this.shadowBias;e.shadowSlopeScale=this.shadowSlopeScale;return e}});t["a"]=n},function(e,t,r){"use strict";var n=r(33);var a=function(e,t,r,a){e=e||0;t=t||0;r=r||0;a=a||0;this.array=n["a"].fromValues(e,t,r,a);this._dirty=true};a.prototype={constructor:a,add:function(e){n["a"].add(this.array,this.array,e.array);this._dirty=true;return this},set:function(e,t,r,a){this.array[0]=e;this.array[1]=t;this.array[2]=r;this.array[3]=a;this._dirty=true;return this},setArray:function(e){this.array[0]=e[0];this.array[1]=e[1];this.array[2]=e[2];this.array[3]=e[3];this._dirty=true;return this},clone:function(){return new a(this.x,this.y,this.z,this.w)},copy:function(e){n["a"].copy(this.array,e.array);this._dirty=true;return this},dist:function(e){return n["a"].dist(this.array,e.array)},distance:function(e){return n["a"].distance(this.array,e.array)},div:function(e){n["a"].div(this.array,this.array,e.array);this._dirty=true;return this},divide:function(e){n["a"].divide(this.array,this.array,e.array);this._dirty=true;return this},dot:function(e){return n["a"].dot(this.array,e.array)},len:function(){return n["a"].len(this.array)},length:function(){return n["a"].length(this.array)},lerp:function(e,t,r){n["a"].lerp(this.array,e.array,t.array,r);this._dirty=true;return this},min:function(e){n["a"].min(this.array,this.array,e.array);this._dirty=true;return this},max:function(e){n["a"].max(this.array,this.array,e.array);this._dirty=true;return this},mul:function(e){n["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},multiply:function(e){n["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},negate:function(){n["a"].negate(this.array,this.array);this._dirty=true;return this},normalize:function(){n["a"].normalize(this.array,this.array);this._dirty=true;return this},random:function(e){n["a"].random(this.array,e);this._dirty=true;return this},scale:function(e){n["a"].scale(this.array,this.array,e);this._dirty=true;return this},scaleAndAdd:function(e,t){n["a"].scaleAndAdd(this.array,this.array,e.array,t);this._dirty=true;return this},sqrDist:function(e){return n["a"].sqrDist(this.array,e.array)},squaredDistance:function(e){return n["a"].squaredDistance(this.array,e.array)},sqrLen:function(){return n["a"].sqrLen(this.array)},squaredLength:function(){return n["a"].squaredLength(this.array)},sub:function(e){n["a"].sub(this.array,this.array,e.array);this._dirty=true;return this},subtract:function(e){n["a"].subtract(this.array,this.array,e.array);this._dirty=true;return this},transformMat4:function(e){n["a"].transformMat4(this.array,this.array,e.array);this._dirty=true;return this},transformQuat:function(e){n["a"].transformQuat(this.array,this.array,e.array);this._dirty=true;return this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var i=Object.defineProperty;if(i){var o=a.prototype;i(o,"x",{get:function(){return this.array[0]},set:function(e){this.array[0]=e;this._dirty=true}});i(o,"y",{get:function(){return this.array[1]},set:function(e){this.array[1]=e;this._dirty=true}});i(o,"z",{get:function(){return this.array[2]},set:function(e){this.array[2]=e;this._dirty=true}});i(o,"w",{get:function(){return this.array[3]},set:function(e){this.array[3]=e;this._dirty=true}})}a.add=function(e,t,r){n["a"].add(e.array,t.array,r.array);e._dirty=true;return e};a.set=function(e,t,r,a,i){n["a"].set(e.array,t,r,a,i);e._dirty=true};a.copy=function(e,t){n["a"].copy(e.array,t.array);e._dirty=true;return e};a.dist=function(e,t){return n["a"].distance(e.array,t.array)};a.distance=a.dist;a.div=function(e,t,r){n["a"].divide(e.array,t.array,r.array);e._dirty=true;return e};a.divide=a.div;a.dot=function(e,t){return n["a"].dot(e.array,t.array)};a.len=function(e){return n["a"].length(e.array)};a.lerp=function(e,t,r,a){n["a"].lerp(e.array,t.array,r.array,a);e._dirty=true;return e};a.min=function(e,t,r){n["a"].min(e.array,t.array,r.array);e._dirty=true;return e};a.max=function(e,t,r){n["a"].max(e.array,t.array,r.array);e._dirty=true;return e};a.mul=function(e,t,r){n["a"].multiply(e.array,t.array,r.array);e._dirty=true;return e};a.multiply=a.mul;a.negate=function(e,t){n["a"].negate(e.array,t.array);e._dirty=true;return e};a.normalize=function(e,t){n["a"].normalize(e.array,t.array);e._dirty=true;return e};a.random=function(e,t){n["a"].random(e.array,t);e._dirty=true;return e};a.scale=function(e,t,r){n["a"].scale(e.array,t.array,r);e._dirty=true;return e};a.scaleAndAdd=function(e,t,r,a){n["a"].scaleAndAdd(e.array,t.array,r.array,a);e._dirty=true;return e};a.sqrDist=function(e,t){return n["a"].sqrDist(e.array,t.array)};a.squaredDistance=a.sqrDist;a.sqrLen=function(e){return n["a"].sqrLen(e.array)};a.squaredLength=a.sqrLen;a.sub=function(e,t,r){n["a"].subtract(e.array,t.array,r.array);e._dirty=true;return e};a.subtract=a.sub;a.transformMat4=function(e,t,r){n["a"].transformMat4(e.array,t.array,r.array);e._dirty=true;return e};a.transformQuat=function(e,t,r){n["a"].transformQuat(e.array,t.array,r.array);e._dirty=true;return e};t["a"]=a},function(e,t,r){"use strict";var a=r(78);var i=function(){this.array=a["a"].create();this._dirty=true};i.prototype={constructor:i,setArray:function(e){for(var t=0;t<this.array.length;t++){this.array[t]=e[t]}this._dirty=true;return this},clone:function(){return(new i).copy(this)},copy:function(e){a["a"].copy(this.array,e.array);this._dirty=true;return this},adjoint:function(){a["a"].adjoint(this.array,this.array);this._dirty=true;return this},determinant:function(){return a["a"].determinant(this.array)},identity:function(){a["a"].identity(this.array);this._dirty=true;return this},invert:function(){a["a"].invert(this.array,this.array);this._dirty=true;return this},mul:function(e){a["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},mulLeft:function(e){a["a"].mul(this.array,e.array,this.array);this._dirty=true;return this},multiply:function(e){a["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},multiplyLeft:function(e){a["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},rotate:function(e){a["a"].rotate(this.array,this.array,e);this._dirty=true;return this},scale:function(e){a["a"].scale(this.array,this.array,e.array);this._dirty=true;return this},transpose:function(){a["a"].transpose(this.array,this.array);this._dirty=true;return this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};i.adjoint=function(e,t){a["a"].adjoint(e.array,t.array);e._dirty=true;return e};i.copy=function(e,t){a["a"].copy(e.array,t.array);e._dirty=true;return e};i.determinant=function(e){return a["a"].determinant(e.array)};i.identity=function(e){a["a"].identity(e.array);e._dirty=true;return e};i.invert=function(e,t){a["a"].invert(e.array,t.array);e._dirty=true;return e};i.mul=function(e,t,r){a["a"].mul(e.array,t.array,r.array);e._dirty=true;return e};i.multiply=i.mul;i.rotate=function(e,t,r){a["a"].rotate(e.array,t.array,r);e._dirty=true;return e};i.scale=function(e,t,r){a["a"].scale(e.array,t.array,r.array);e._dirty=true;return e};i.transpose=function(e,t){a["a"].transpose(e.array,t.array);e._dirty=true;return e};t["a"]=i},function(e,t,r){"use strict";var a=r(79);var i=function(){this.array=a["a"].create();this._dirty=true};i.prototype={constructor:i,setArray:function(e){for(var t=0;t<this.array.length;t++){this.array[t]=e[t]}this._dirty=true;return this},clone:function(){return(new i).copy(this)},copy:function(e){a["a"].copy(this.array,e.array);this._dirty=true;return this},determinant:function(){return a["a"].determinant(this.array)},identity:function(){a["a"].identity(this.array);this._dirty=true;return this},invert:function(){a["a"].invert(this.array,this.array);this._dirty=true;return this},mul:function(e){a["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},mulLeft:function(e){a["a"].mul(this.array,e.array,this.array);this._dirty=true;return this},multiply:function(e){a["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},multiplyLeft:function(e){a["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},rotate:function(e){a["a"].rotate(this.array,this.array,e);this._dirty=true;return this},scale:function(e){a["a"].scale(this.array,this.array,e.array);this._dirty=true;return this},translate:function(e){a["a"].translate(this.array,this.array,e.array);this._dirty=true;return this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};i.copy=function(e,t){a["a"].copy(e.array,t.array);e._dirty=true;return e};i.determinant=function(e){return a["a"].determinant(e.array)};i.identity=function(e){a["a"].identity(e.array);e._dirty=true;return e};i.invert=function(e,t){a["a"].invert(e.array,t.array);e._dirty=true;return e};i.mul=function(e,t,r){a["a"].mul(e.array,t.array,r.array);e._dirty=true;return e};i.multiply=i.mul;i.rotate=function(e,t,r){a["a"].rotate(e.array,t.array,r);e._dirty=true;return e};i.scale=function(e,t,r){a["a"].scale(e.array,t.array,r.array);e._dirty=true;return e};i.translate=function(e,t,r){a["a"].translate(e.array,t.array,r.array);e._dirty=true;return e};t["a"]=i},function(e,t,r){"use strict";var a=r(34);var i=function(){this.array=a["a"].create();this._dirty=true};i.prototype={constructor:i,setArray:function(e){for(var t=0;t<this.array.length;t++){this.array[t]=e[t]}this._dirty=true;return this},adjoint:function(){a["a"].adjoint(this.array,this.array);this._dirty=true;return this},clone:function(){return(new i).copy(this)},copy:function(e){a["a"].copy(this.array,e.array);this._dirty=true;return this},determinant:function(){return a["a"].determinant(this.array)},fromMat2d:function(e){a["a"].fromMat2d(this.array,e.array);this._dirty=true;return this},fromMat4:function(e){a["a"].fromMat4(this.array,e.array);this._dirty=true;return this},fromQuat:function(e){a["a"].fromQuat(this.array,e.array);this._dirty=true;return this},identity:function(){a["a"].identity(this.array);this._dirty=true;return this},invert:function(){a["a"].invert(this.array,this.array);this._dirty=true;return this},mul:function(e){a["a"].mul(this.array,this.array,e.array);this._dirty=true;return this},mulLeft:function(e){a["a"].mul(this.array,e.array,this.array);this._dirty=true;return this},multiply:function(e){a["a"].multiply(this.array,this.array,e.array);this._dirty=true;return this},multiplyLeft:function(e){a["a"].multiply(this.array,e.array,this.array);this._dirty=true;return this},rotate:function(e){a["a"].rotate(this.array,this.array,e);this._dirty=true;return this},scale:function(e){a["a"].scale(this.array,this.array,e.array);this._dirty=true;return this},translate:function(e){a["a"].translate(this.array,this.array,e.array);this._dirty=true;return this},normalFromMat4:function(e){a["a"].normalFromMat4(this.array,e.array);this._dirty=true;return this},transpose:function(){a["a"].transpose(this.array,this.array);this._dirty=true;return this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};i.adjoint=function(e,t){a["a"].adjoint(e.array,t.array);e._dirty=true;return e};i.copy=function(e,t){a["a"].copy(e.array,t.array);e._dirty=true;return e};i.determinant=function(e){return a["a"].determinant(e.array)};i.identity=function(e){a["a"].identity(e.array);e._dirty=true;return e};i.invert=function(e,t){a["a"].invert(e.array,t.array);return e};i.mul=function(e,t,r){a["a"].mul(e.array,t.array,r.array);e._dirty=true;return e};i.multiply=i.mul;i.fromMat2d=function(e,t){a["a"].fromMat2d(e.array,t.array);e._dirty=true;return e};i.fromMat4=function(e,t){a["a"].fromMat4(e.array,t.array);e._dirty=true;return e};i.fromQuat=function(e,t){a["a"].fromQuat(e.array,t.array);e._dirty=true;return e};i.normalFromMat4=function(e,t){a["a"].normalFromMat4(e.array,t.array);e._dirty=true;return e};i.rotate=function(e,t,r){a["a"].rotate(e.array,t.array,r);e._dirty=true;return e};i.scale=function(e,t,r){a["a"].scale(e.array,t.array,r.array);e._dirty=true;return e};i.transpose=function(e,t){a["a"].transpose(e.array,t.array);e._dirty=true;return e};i.translate=function(e,t,r){a["a"].translate(e.array,t.array,r.array);e._dirty=true;return e};t["a"]=i},function(e,t,r){"use strict";var a=r(142);var f=r.n(a);var i={_animators:null,getAnimators:function(){this._animators=this._animators||[];return this._animators},animate:function(e,t){this._animators=this._animators||[];var r=this;var a;if(e){var i=e.split(".");var n=r;for(var o=0,s=i.length;o<s;o++){if(!n){continue}n=n[i[o]]}if(n){a=n}}else{a=r}if(a==null){throw new Error("Target "+e+" not exists")}var u=this._animators;var l=new f.a(a,t);var h=this;l.during(function(){if(h.__zr){h.__zr.refresh()}}).done(function(){var e=u.indexOf(l);if(e>=0){u.splice(e,1)}});u.push(l);if(this.__zr){this.__zr.animation.addAnimator(l)}return l},stopAnimation:function(e){this._animators=this._animators||[];var t=this._animators;var r=t.length;for(var a=0;a<r;a++){t[a].stop(e)}t.length=0;return this},addAnimatorsToZr:function(e){if(this._animators){for(var t=0;t<this._animators.length;t++){e.animation.addAnimator(this._animators[t])}}},removeAnimatorsFromZr:function(e){if(this._animators){for(var t=0;t<this._animators.length;t++){e.animation.removeAnimator(this._animators[t])}}}};t["a"]=i},function(e,t,r){var O=r(143);var F=r(145);var a=r(13);var B=a.isArrayLike;var l=Array.prototype.slice;function i(e,t){return e[t]}function n(e,t,r){e[t]=r}function U(e,t,r){return(t-e)*r+e}function z(e,t,r){return r>.5?t:e}function G(e,t,r,a,i){var n=e.length;if(i==1){for(var o=0;o<n;o++){a[o]=U(e[o],t[o],r)}}else{var s=n&&e[0].length;for(var o=0;o<n;o++){for(var u=0;u<s;u++){a[o][u]=U(e[o][u],t[o][u],r)}}}}function H(e,t,r){var a=e.length;var i=t.length;if(a!==i){var n=a>i;if(n){e.length=i}else{for(var o=a;o<i;o++){e.push(r===1?t[o]:l.call(t[o]))}}}var s=e[0]&&e[0].length;for(var o=0;o<e.length;o++){if(r===1){if(isNaN(e[o])){e[o]=t[o]}}else{for(var u=0;u<s;u++){if(isNaN(e[o][u])){e[o][u]=t[o][u]}}}}}function V(e,t,r){if(e===t){return true}var a=e.length;if(a!==t.length){return false}if(r===1){for(var i=0;i<a;i++){if(e[i]!==t[i]){return false}}}else{var n=e[0].length;for(var i=0;i<a;i++){for(var o=0;o<n;o++){if(e[i][o]!==t[i][o]){return false}}}}return true}function k(e,t,r,a,i,n,o,s,u){var l=e.length;if(u==1){for(var h=0;h<l;h++){s[h]=W(e[h],t[h],r[h],a[h],i,n,o)}}else{var f=e[0].length;for(var h=0;h<l;h++){for(var c=0;c<f;c++){s[h][c]=W(e[h][c],t[h][c],r[h][c],a[h][c],i,n,o)}}}}function W(e,t,r,a,i,n,o){var s=(r-e)*.5;var u=(a-t)*.5;return(2*(t-r)+s+u)*o+(-3*(t-r)-2*s-u)*n+s*i+t}function o(e){if(B(e)){var t=e.length;if(B(e[0])){var r=[];for(var a=0;a<t;a++){r.push(l.call(e[a]))}return r}return l.call(e)}return e}function j(e){e[0]=Math.floor(e[0]);e[1]=Math.floor(e[1]);e[2]=Math.floor(e[2]);return"rgba("+e.join(",")+")"}function X(e){var t=e[e.length-1].value;return B(t&&t[0])?2:1}function h(e,t,r,a,n,i){var o=e._getter;var s=e._setter;var u=t==="spline";var l=a.length;if(!l){return}var h=a[0].value;var f=B(h);var c=false;var d=false;var v=f?X(a):0;var p;a.sort(function(e,t){return e.time-t.time});p=a[l-1].time;var m=[];var g=[];var _=a[0].value;var y=true;for(var x=0;x<l;x++){m.push(a[x].time/p);var T=a[x].value;if(!(f&&V(T,_,v)||!f&&T===_)){y=false}_=T;if(typeof T=="string"){var b=F.parse(T);if(b){T=b;c=true}else{d=true}}g.push(T)}if(!i&&y){return}var w=g[l-1];for(var x=0;x<l-1;x++){if(f){H(g[x],w,v)}else{if(isNaN(g[x])&&!isNaN(w)&&!d&&!c){g[x]=w}}}f&&H(o(e._target,n),w,v);var E=0;var S=0;var A;var M;var C;var L;var D;var N;if(c){var I=[0,0,0,0]}var R=function(e,t){var r;if(t<0){r=0}else if(t<S){A=Math.min(E+1,l-1);for(r=A;r>=0;r--){if(m[r]<=t){break}}r=Math.min(r,l-2)}else{for(r=E;r<l;r++){if(m[r]>t){break}}r=Math.min(r-1,l-2)}E=r;S=t;var a=m[r+1]-m[r];if(a===0){return}else{M=(t-m[r])/a}if(u){L=g[r];C=g[r===0?r:r-1];D=g[r>l-2?l-1:r+1];N=g[r>l-3?l-1:r+2];if(f){k(C,L,D,N,M,M*M,M*M*M,o(e,n),v)}else{var i;if(c){i=k(C,L,D,N,M,M*M,M*M*M,I,1);i=j(I)}else if(d){return z(L,D,M)}else{i=W(C,L,D,N,M,M*M,M*M*M)}s(e,n,i)}}else{if(f){G(g[r],g[r+1],M,o(e,n),v)}else{var i;if(c){G(g[r],g[r+1],M,I,1);i=j(I)}else if(d){return z(g[r],g[r+1],M)}else{i=U(g[r],g[r+1],M)}s(e,n,i)}}};var P=new O({target:e._target,life:p,loop:e._loop,delay:e._delay,onframe:R,ondestroy:r});if(t&&t!=="spline"){P.easing=t}return P}var s=function(e,t,r,a){this._tracks={};this._target=e;this._loop=t||false;this._getter=r||i;this._setter=a||n;this._clipCount=0;this._delay=0;this._doneList=[];this._onframeList=[];this._clipList=[]};s.prototype={when:function(e,t){var r=this._tracks;for(var a in t){if(!t.hasOwnProperty(a)){continue}if(!r[a]){r[a]=[];var i=this._getter(this._target,a);if(i==null){continue}if(e!==0){r[a].push({time:0,value:o(i)})}}r[a].push({time:e,value:t[a]})}return this},during:function(e){this._onframeList.push(e);return this},pause:function(){for(var e=0;e<this._clipList.length;e++){this._clipList[e].pause()}this._paused=true},resume:function(){for(var e=0;e<this._clipList.length;e++){this._clipList[e].resume()}this._paused=false},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={};this._clipList.length=0;var e=this._doneList;var t=e.length;for(var r=0;r<t;r++){e[r].call(this)}},start:function(e,t){var a=this;var r=0;var i=function(){r--;if(!r){a._doneCallback()}};var n;for(var o in this._tracks){if(!this._tracks.hasOwnProperty(o)){continue}var s=h(this,e,i,this._tracks[o],o,t);if(s){this._clipList.push(s);r++;if(this.animation){this.animation.addClip(s)}n=s}}if(n){var u=n.onframe;n.onframe=function(e,t){u(e,t);for(var r=0;r<a._onframeList.length;r++){a._onframeList[r](e,t)}}}if(!r){this._doneCallback()}return this},stop:function(e){var t=this._clipList;var r=this.animation;for(var a=0;a<t.length;a++){var i=t[a];if(e){i.onframe(this._target,1)}r&&r.removeClip(i)}t.length=0},delay:function(e){this._delay=e;return this},done:function(e){if(e){this._doneList.push(e)}return this},getClips:function(){return this._clipList}};var u=s;e.exports=u},function(e,t,r){var o=r(144);function a(e){this._target=e.target;this._life=e.life||1e3;this._delay=e.delay||0;this._initialized=false;this.loop=e.loop==null?false:e.loop;this.gap=e.gap||0;this.easing=e.easing||"Linear";this.onframe=e.onframe;this.ondestroy=e.ondestroy;this.onrestart=e.onrestart;this._pausedTime=0;this._paused=false}a.prototype={constructor:a,step:function(e,t){if(!this._initialized){this._startTime=e+this._delay;this._initialized=true}if(this._paused){this._pausedTime+=t;return}var r=(e-this._startTime-this._pausedTime)/this._life;if(r<0){return}r=Math.min(r,1);var a=this.easing;var i=typeof a=="string"?o[a]:a;var n=typeof i==="function"?i(r):r;this.fire("frame",n);if(r==1){if(this.loop){this.restart(e);return"restart"}this._needsRemove=true;return"destroy"}return null},restart:function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap;this._pausedTime=0;this._needsRemove=false},fire:function(e,t){e="on"+e;if(this[e]){this[e](this._target,t)}},pause:function(){this._paused=true},resume:function(){this._paused=false}};var i=a;e.exports=i},function(e,t){var r={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){if((e*=2)<1){return.5*e*e*e}return.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){if((e*=2)<1){return.5*e*e*e*e}return-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){if((e*=2)<1){return.5*e*e*e*e*e}return.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return e===0?0:Math.pow(1024,e-1)},exponentialOut:function(e){return e===1?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){if(e===0){return 0}if(e===1){return 1}if((e*=2)<1){return.5*Math.pow(1024,e-1)}return.5*(-Math.pow(2,-10*(e-1))+2)},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){if((e*=2)<1){return-.5*(Math.sqrt(1-e*e)-1)}return.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t;var r=.1;var a=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=a/4}else{t=a*Math.asin(1/r)/(2*Math.PI)}return-(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a))},elasticOut:function(e){var t;var r=.1;var a=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=a/4}else{t=a*Math.asin(1/r)/(2*Math.PI)}return r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/a)+1},elasticInOut:function(e){var t;var r=.1;var a=.4;if(e===0){return 0}if(e===1){return 1}if(!r||r<1){r=1;t=a/4}else{t=a*Math.asin(1/r)/(2*Math.PI)}if((e*=2)<1){return-.5*(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a))}return r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a)*.5+1},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},backInOut:function(e){var t=1.70158*1.525;if((e*=2)<1){return.5*(e*e*((t+1)*e-t))}return.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-r.bounceOut(1-e)},bounceOut:function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.75}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}},bounceInOut:function(e){if(e<.5){return r.bounceIn(e*2)*.5}return r.bounceOut(e*2-1)*.5+.5}};var a=r;e.exports=a},function(e,t,r){var a=r(60);var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(e){e=Math.round(e);return e<0?0:e>255?255:e}function i(e){e=Math.round(e);return e<0?0:e>360?360:e}function c(e){return e<0?0:e>1?1:e}function d(e){if(e.length&&e.charAt(e.length-1)==="%"){return f(parseFloat(e)/100*255)}return f(parseInt(e,10))}function v(e){if(e.length&&e.charAt(e.length-1)==="%"){return c(parseFloat(e)/100)}return c(parseFloat(e))}function s(e,t,r){if(r<0){r+=1}else if(r>1){r-=1}if(r*6<1){return e+(t-e)*r*6}if(r*2<1){return t}if(r*3<2){return e+(t-e)*(2/3-r)*6}return e}function p(e,t,r){return e+(t-e)*r}function m(e,t,r,a,i){e[0]=t;e[1]=r;e[2]=a;e[3]=i;return e}function g(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}var _=new a(20);var n=null;function y(e,t){if(n){g(n,t)}n=_.put(e,n||t.slice())}function x(e,t){if(!e){return}t=t||[];var r=_.get(e);if(r){return g(t,r)}e=e+"";var a=e.replace(/ /g,"").toLowerCase();if(a in h){g(t,h[a]);y(e,t);return t}if(a.charAt(0)==="#"){if(a.length===4){var i=parseInt(a.substr(1),16);if(!(i>=0&&i<=4095)){m(t,0,0,0,1);return}m(t,(i&3840)>>4|(i&3840)>>8,i&240|(i&240)>>4,i&15|(i&15)<<4,1);y(e,t);return t}else if(a.length===7){var i=parseInt(a.substr(1),16);if(!(i>=0&&i<=16777215)){m(t,0,0,0,1);return}m(t,(i&16711680)>>16,(i&65280)>>8,i&255,1);y(e,t);return t}return}var n=a.indexOf("("),o=a.indexOf(")");if(n!==-1&&o+1===a.length){var s=a.substr(0,n);var u=a.substr(n+1,o-(n+1)).split(",");var l=1;switch(s){case"rgba":if(u.length!==4){m(t,0,0,0,1);return}l=v(u.pop());case"rgb":if(u.length!==3){m(t,0,0,0,1);return}m(t,d(u[0]),d(u[1]),d(u[2]),l);y(e,t);return t;case"hsla":if(u.length!==4){m(t,0,0,0,1);return}u[3]=v(u[3]);T(u,t);y(e,t);return t;case"hsl":if(u.length!==3){m(t,0,0,0,1);return}T(u,t);y(e,t);return t;default:return}}m(t,0,0,0,1);return}function T(e,t){var r=(parseFloat(e[0])%360+360)%360/360;var a=v(e[1]);var i=v(e[2]);var n=i<=.5?i*(a+1):i+a-i*a;var o=i*2-n;t=t||[];m(t,f(s(o,n,r+1/3)*255),f(s(o,n,r)*255),f(s(o,n,r-1/3)*255),1);if(e.length===4){t[3]=e[3]}return t}function o(e){if(!e){return}var t=e[0]/255;var r=e[1]/255;var a=e[2]/255;var i=Math.min(t,r,a);var n=Math.max(t,r,a);var o=n-i;var s=(n+i)/2;var u;var l;if(o===0){u=0;l=0}else{if(s<.5){l=o/(n+i)}else{l=o/(2-n-i)}var h=((n-t)/6+o/2)/o;var f=((n-r)/6+o/2)/o;var c=((n-a)/6+o/2)/o;if(t===n){u=c-f}else if(r===n){u=1/3+h-c}else if(a===n){u=2/3+f-h}if(u<0){u+=1}if(u>1){u-=1}}var d=[u*360,l,s];if(e[3]!=null){d.push(e[3])}return d}function u(e,t){var r=x(e);if(r){for(var a=0;a<3;a++){if(t<0){r[a]=r[a]*(1-t)|0}else{r[a]=(255-r[a])*t+r[a]|0}if(r[a]>255){r[a]=255}else if(e[a]<0){r[a]=0}}return C(r,r.length===4?"rgba":"rgb")}}function l(e){var t=x(e);if(t){return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}}function b(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}r=r||[];var a=e*(t.length-1);var i=Math.floor(a);var n=Math.ceil(a);var o=t[i];var s=t[n];var u=a-i;r[0]=f(p(o[0],s[0],u));r[1]=f(p(o[1],s[1],u));r[2]=f(p(o[2],s[2],u));r[3]=c(p(o[3],s[3],u));return r}var w=b;function E(e,t,r){if(!(t&&t.length)||!(e>=0&&e<=1)){return}var a=e*(t.length-1);var i=Math.floor(a);var n=Math.ceil(a);var o=x(t[i]);var s=x(t[n]);var u=a-i;var l=C([f(p(o[0],s[0],u)),f(p(o[1],s[1],u)),f(p(o[2],s[2],u)),c(p(o[3],s[3],u))],"rgba");return r?{color:l,leftIndex:i,rightIndex:n,value:a}:l}var S=E;function A(e,t,r,a){e=x(e);if(e){e=o(e);t!=null&&(e[0]=i(t));r!=null&&(e[1]=v(r));a!=null&&(e[2]=v(a));return C(T(e),"rgba")}}function M(e,t){e=x(e);if(e&&t!=null){e[3]=c(t);return C(e,"rgba")}}function C(e,t){if(!e||!e.length){return}var r=e[0]+","+e[1]+","+e[2];if(t==="rgba"||t==="hsva"||t==="hsla"){r+=","+e[3]}return t+"("+r+")"}t.parse=x;t.lift=u;t.toHex=l;t.fastLerp=b;t.fastMapToColor=w;t.lerp=E;t.mapToColor=S;t.modifyHSL=A;t.modifyAlpha=M;t.stringify=C},function(e,t,r){"use strict";t["a"]="\n@export clay.util.rand\nhighp float rand(vec2 uv) {\n const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);\n return fract(sin(sn) * c);\n}\n@end\n@export clay.util.calculate_attenuation\nuniform float attenuationFactor : 5.0;\nfloat lightAttenuation(float dist, float range)\n{\n float attenuation = 1.0;\n attenuation = dist*dist/(range*range+1.0);\n float att_s = attenuationFactor;\n attenuation = 1.0/(attenuation*att_s+1.0);\n att_s = 1.0/(att_s+1.0);\n attenuation = attenuation - att_s;\n attenuation /= 1.0 - att_s;\n return clamp(attenuation, 0.0, 1.0);\n}\n@end\n@export clay.util.edge_factor\n#ifdef SUPPORT_STANDARD_DERIVATIVES\nfloat edgeFactor(float width)\n{\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#else\nfloat edgeFactor(float width)\n{\n return 1.0;\n}\n#endif\n@end\n@export clay.util.encode_float\nvec4 encodeFloat(const in float depth)\n{\n const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n vec4 res = fract(depth * bitShifts);\n res -= res.xxyz * bit_mask;\n return res;\n}\n@end\n@export clay.util.decode_float\nfloat decodeFloat(const in vec4 color)\n{\n const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n return dot(color, bitShifts);\n}\n@end\n@export clay.util.float\n@import clay.util.encode_float\n@import clay.util.decode_float\n@end\n@export clay.util.rgbm_decode\nvec3 RGBMDecode(vec4 rgbm, float range) {\n return range * rgbm.rgb * rgbm.a;\n}\n@end\n@export clay.util.rgbm_encode\nvec4 RGBMEncode(vec3 color, float range) {\n if (dot(color, color) == 0.0) {\n return vec4(0.0);\n }\n vec4 rgbm;\n color /= range;\n rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);\n rgbm.a = ceil(rgbm.a * 255.0) / 255.0;\n rgbm.rgb = color / rgbm.a;\n return rgbm;\n}\n@end\n@export clay.util.rgbm\n@import clay.util.rgbm_decode\n@import clay.util.rgbm_encode\nvec4 decodeHDR(vec4 color)\n{\n#if defined(RGBM_DECODE) || defined(RGBM)\n return vec4(RGBMDecode(color, 8.12), 1.0);\n#else\n return color;\n#endif\n}\nvec4 encodeHDR(vec4 color)\n{\n#if defined(RGBM_ENCODE) || defined(RGBM)\n return RGBMEncode(color.xyz, 8.12);\n#else\n return color;\n#endif\n}\n@end\n@export clay.util.srgb\nvec4 sRGBToLinear(in vec4 value) {\n return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);\n}\nvec4 linearTosRGB(in vec4 value) {\n return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);\n}\n@end\n@export clay.chunk.skinning_header\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n#ifdef USE_SKIN_MATRICES_TEXTURE\nuniform sampler2D skinMatricesTexture : ignore;\nuniform float skinMatricesTextureSize: ignore;\nmat4 getSkinMatrix(sampler2D tex, float idx) {\n float j = idx * 4.0;\n float x = mod(j, skinMatricesTextureSize);\n float y = floor(j / skinMatricesTextureSize) + 0.5;\n vec2 scale = vec2(skinMatricesTextureSize);\n return mat4(\n texture2D(tex, vec2(x + 0.5, y) / scale),\n texture2D(tex, vec2(x + 1.5, y) / scale),\n texture2D(tex, vec2(x + 2.5, y) / scale),\n texture2D(tex, vec2(x + 3.5, y) / scale)\n );\n}\nmat4 getSkinMatrix(float idx) {\n return getSkinMatrix(skinMatricesTexture, idx);\n}\n#else\nuniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;\nmat4 getSkinMatrix(float idx) {\n return skinMatrix[int(idx)];\n}\n#endif\n#endif\n@end\n@export clay.chunk.skin_matrix\nmat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;\nif (weight.y > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.y) * weight.y;\n}\nif (weight.z > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.z) * weight.z;\n}\nfloat weightW = 1.0-weight.x-weight.y-weight.z;\nif (weightW > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.w) * weightW;\n}\n@end\n@export clay.util.parallax_correct\nvec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {\n vec3 first = (boxMax - pos) / dir;\n vec3 second = (boxMin - pos) / dir;\n vec3 further = max(first, second);\n float dist = min(further.x, min(further.y, further.z));\n vec3 fixedPos = pos + dir * dist;\n vec3 boxCenter = (boxMax + boxMin) * 0.5;\n return normalize(fixedPos - boxCenter);\n}\n@end\n@export clay.util.clamp_sample\nvec4 clampSample(const in sampler2D texture, const in vec2 coord)\n{\n#ifdef STEREO\n float eye = step(0.5, coord.x) * 0.5;\n vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));\n#else\n vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));\n#endif\n return texture2D(texture, coordClamped);\n}\n@end\n@export clay.util.ACES\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n@end"},function(e,t,r){"use strict";t["a"]="\n@export ecgl.common.transformUniforms\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n@end\n\n@export ecgl.common.attributes\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n@end\n\n@export ecgl.common.uv.header\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\nuniform vec2 detailUvRepeat : [1.0, 1.0];\nuniform vec2 detailUvOffset : [0.0, 0.0];\n\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n@export ecgl.common.uv.main\nv_Texcoord = texcoord * uvRepeat + uvOffset;\nv_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;\n@end\n\n@export ecgl.common.uv.fragmentHeader\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n\n@export ecgl.common.albedo.main\n\n vec4 albedoTexel = vec4(1.0);\n#ifdef DIFFUSEMAP_ENABLED\n albedoTexel = texture2D(diffuseMap, v_Texcoord);\n #ifdef SRGB_DECODE\n albedoTexel = sRGBToLinear(albedoTexel);\n #endif\n#endif\n\n#ifdef DETAILMAP_ENABLED\n vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);\n #ifdef SRGB_DECODE\n detailTexel = sRGBToLinear(detailTexel);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);\n albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexHeader\n\n#ifdef WIREFRAME_QUAD\nattribute vec4 barycentric;\nvarying vec4 v_Barycentric;\n#elif defined(WIREFRAME_TRIANGLE)\nattribute vec3 barycentric;\nvarying vec3 v_Barycentric;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n v_Barycentric = barycentric;\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentHeader\n\nuniform float wireframeLineWidth : 1;\nuniform vec4 wireframeLineColor: [0, 0, 0, 0.5];\n\n#ifdef WIREFRAME_QUAD\nvarying vec4 v_Barycentric;\nfloat edgeFactor () {\n vec4 d = fwidth(v_Barycentric);\n vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(min(a4.x, a4.y), a4.z), a4.w);\n}\n#elif defined(WIREFRAME_TRIANGLE)\nvarying vec3 v_Barycentric;\nfloat edgeFactor () {\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n if (wireframeLineWidth > 0.) {\n vec4 lineColor = wireframeLineColor;\n#ifdef SRGB_DECODE\n lineColor = sRGBToLinear(lineColor);\n#endif\n\n gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);\n }\n#endif\n@end\n\n\n\n\n@export ecgl.common.bumpMap.header\n\n#ifdef BUMPMAP_ENABLED\nuniform sampler2D bumpMap;\nuniform float bumpScale : 1.0;\n\n\nvec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\n{\n vec2 dSTdx = dFdx(v_Texcoord);\n vec2 dSTdy = dFdy(v_Texcoord);\n\n float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\n float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\n float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\n\n vec3 vSigmaX = dFdx(surfPos);\n vec3 vSigmaY = dFdy(surfPos);\n vec3 vN = surfNormal;\n\n vec3 R1 = cross(vSigmaY, vN);\n vec3 R2 = cross(vN, vSigmaX);\n\n float fDet = dot(vSigmaX, R1);\n\n vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\n return normalize(abs(fDet) * baseNormal - vGrad);\n\n}\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexHeader\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexMain\n\n#ifdef NORMALMAP_ENABLED\n if (dot(tangent, tangent) > 0.0) {\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n }\n#endif\n\n@end\n\n\n@export ecgl.common.normalMap.fragmentHeader\n\n#ifdef NORMALMAP_ENABLED\nuniform sampler2D normalMap;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.fragmentMain\n#ifdef NORMALMAP_ENABLED\n if (dot(v_Tangent, v_Tangent) > 0.0) {\n vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;\n if (dot(normalTexel, normalTexel) > 0.0) { N = normalTexel * 2.0 - 1.0;\n mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n N = normalize(tbn * N);\n }\n }\n#endif\n@end\n\n\n\n@export ecgl.common.vertexAnimation.header\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevNormal;\nuniform float percent;\n#endif\n\n@end\n\n@export ecgl.common.vertexAnimation.main\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n vec3 norm = mix(prevNormal, normal, percent);\n#else\n vec3 pos = position;\n vec3 norm = normal;\n#endif\n\n@end\n\n\n@export ecgl.common.ssaoMap.header\n#ifdef SSAOMAP_ENABLED\nuniform sampler2D ssaoMap;\nuniform vec4 viewport : VIEWPORT;\n#endif\n@end\n\n@export ecgl.common.ssaoMap.main\n float ao = 1.0;\n#ifdef SSAOMAP_ENABLED\n ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;\n#endif\n@end\n\n\n\n\n@export ecgl.common.diffuseLayer.header\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\nuniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];\nuniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.header\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\nuniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];\nuniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.layers.header\n@import ecgl.common.diffuseLayer.header\n@import ecgl.common.emissiveLayer.header\n@end\n\n@export ecgl.common.diffuseLayer.main\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_DIFFUSEMAP_COUNT; _idx_++) {{\n float intensity = layerDiffuseIntensity[_idx_];\n vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);\n albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;\n }}\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.main\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_EMISSIVEMAP_COUNT; _idx_++)\n {{\n vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n float intensity = layerEmissionIntensity[_idx_];\n gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;\n }}\n#endif\n\n@end\n"},function(e,t,r){"use strict";t["a"]="@export ecgl.color.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\n@import ecgl.common.uv.header\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position: POSITION;\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvoid main()\n{\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n @import ecgl.common.uv.main\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n@export ecgl.color.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.layers.header\n\n@import ecgl.common.uv.fragmentHeader\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n\n}\n@end"},function(e,t,r){"use strict";t["a"]="/**\n * http: */\n\n@export ecgl.lambert.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n\n@import ecgl.common.attributes\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.vertexAnimation.header\n\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n}\n\n@end\n\n\n@export ecgl.lambert.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n gl_FragColor *= sRGBToLinear(v_Color);\n #else\n gl_FragColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n diffuseColor += ambientLightColor[i] * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n vec3 lightColor = directionalLightColor[i];\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor.rgb *= diffuseColor;\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(e,t,r){"use strict";t["a"]="@export ecgl.realistic.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@import ecgl.common.vertexAnimation.header\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n\n\n@export ecgl.realistic.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n#define PI 3.14159265358979\n#define ROUGHNESS_CHANEL 0\n#define METALNESS_CHANEL 1\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\n\nuniform sampler2D detailMap;\nuniform sampler2D metalnessMap;\nuniform sampler2D roughnessMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform float metalness : 0.0;\nuniform float roughness : 0.5;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n@import clay.header.ambient_cubemap_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.normalMap.fragmentHeader\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import clay.util.rgbm\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n\nfloat D_Phong(float g, float ndh) {\n float a = pow(8192.0, g);\n return (a + 2.0) / 8.0 * pow(ndh, a);\n}\n\nvoid main()\n{\n vec4 albedoColor = color;\n\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n albedoColor *= sRGBToLinear(v_Color);\n #else\n albedoColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n albedoColor *= albedoTexel;\n\n float m = metalness;\n\n#ifdef METALNESSMAP_ENABLED\n float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];\n m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 baseColor = albedoColor.rgb;\n albedoColor.rgb = baseColor * (1.0 - m);\n vec3 specFactor = mix(vec3(0.04), baseColor, m);\n\n float g = 1.0 - roughness;\n\n#ifdef ROUGHNESSMAP_ENABLED\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 N = v_Normal;\n\n#ifdef DOUBLE_SIDED\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n@import ecgl.common.normalMap.fragmentMain\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseTerm = vec3(0.0);\n vec3 specularTerm = vec3(0.0);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n vec3 fresnelTerm = F_Schlick(ndv, specFactor);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;\n }}\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++)\n {{\n vec3 L = -directionalLightDirection[_idx_];\n vec3 lc = directionalLightColor[_idx_];\n\n vec3 H = normalize(L + V);\n float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[_idx_];\n }\n#endif\n\n vec3 li = lc * ndl * shadowContrib;\n\n diffuseTerm += li;\n specularTerm += li * fresnelTerm * D_Phong(g, ndh);\n }}\n#endif\n\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n vec3 L = reflect(-V, N);\n L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);\n float rough2 = clamp(1.0 - g, 0.0, 1.0);\n float bias2 = rough2 * 5.0;\n vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;\n vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;\n vec3 envTexel2;\n for(int _idx_ = 0; _idx_ < AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)\n {{\n envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);\n specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;\n }}\n#endif\n\n gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;\n gl_FragColor.a = albedoColor.a;\n\n#ifdef SRGB_ENCODE\n gl_FragColor = linearTosRGB(gl_FragColor);\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"},function(e,t,r){"use strict";t["a"]="@export ecgl.hatching.vertex\n\n@import ecgl.realistic.vertex\n\n@end\n\n\n@export ecgl.hatching.fragment\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform vec4 color : [0.0, 0.0, 0.0, 1.0];\nuniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nuniform sampler2D hatch1;\nuniform sampler2D hatch2;\nuniform sampler2D hatch3;\nuniform sampler2D hatch4;\nuniform sampler2D hatch5;\nuniform sampler2D hatch6;\n\nfloat shade(in float tone) {\n vec4 c = vec4(1. ,1., 1., 1.);\n float step = 1. / 6.;\n vec2 uv = v_DetailTexcoord;\n if (tone <= step / 2.0) {\n c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);\n }\n else if (tone <= step) {\n c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);\n }\n if(tone > step && tone <= 2. * step){\n c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));\n }\n if(tone > 2. * step && tone <= 3. * step){\n c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));\n }\n if(tone > 3. * step && tone <= 4. * step){\n c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));\n }\n if(tone > 4. * step && tone <= 5. * step){\n c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));\n }\n if(tone > 5. * step){\n c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));\n }\n\n return c.r;\n}\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n vec4 inkColor = sRGBToLinear(color);\n#else\n vec4 inkColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n inkColor *= sRGBToLinear(v_Color);\n #else\n inkColor *= v_Color;\n #endif\n#endif\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float tone = 0.0;\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n tone += dot(ambientLightColor[i], w) * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n float lightTone = dot(directionalLightColor[i], w);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n tone += lightTone * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));\n }\n@end\n"},function(e,t,r){"use strict";t["a"]="@export ecgl.sm.depth.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n v_ViewPosition = worldViewProjection * vec4(pos, 1.0);\n gl_Position = v_ViewPosition;\n\n v_Texcoord = texcoord;\n\n}\n@end\n\n\n\n@export ecgl.sm.depth.fragment\n\n@import clay.sm.depth.fragment\n\n@end"},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=["bar3D","line3D","map3D","scatter3D","surface","lines3D","scatterGL","scatter3D"];function o(e,t){if(e&&e[t]&&(e[t].normal||e[t].emphasis)){var r=e[t].normal;var a=e[t].emphasis;if(r){e[t]=r}if(a){e.emphasis=e.emphasis||{};e.emphasis[t]=a}}}function s(e){o(e,"itemStyle");o(e,"lineStyle");o(e,"areaStyle");o(e,"label")}function u(e){if(!e){return}if(!(e instanceof Array)){e=[e]}i.a.util.each(e,function(e){if(e.axisLabel){var t=e.axisLabel;i.a.util.extend(t,t.textStyle);t.textStyle=null}})}t["a"]=function(t){i.a.util.each(t.series,function(e){if(i.a.util.indexOf(n,e.type)>=0){s(e);if(e.coordinateSystem==="mapbox"){e.coordinateSystem="mapbox3D";t.mapbox3D=t.mapbox}}});u(t.xAxis3D);u(t.yAxis3D);u(t.zAxis3D);u(t.grid3D);o(t.geo3D)}},function(e,t,r){"use strict";var a=r(155);var i=r(159);var n=r(160);var o=r(167);var s=r(0);var u=r.n(s);u.a.registerAction({type:"grid3DChangeCamera",event:"grid3dcamerachanged",update:"series:updateCamera"},function(t,e){e.eachComponent({mainType:"grid3D",query:t},function(e){e.setView(t)})});u.a.registerAction({type:"grid3DShowAxisPointer",event:"grid3dshowaxispointer",update:"grid3D:showAxisPointer"},function(e,t){});u.a.registerAction({type:"grid3DHideAxisPointer",event:"grid3dhideaxispointer",update:"grid3D:hideAxisPointer"},function(e,t){})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(156);var o=i.a.extendComponentModel({type:"cartesian3DAxis",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid3D",index:this.option.gridIndex,id:this.option.gridId})[0]}});i.a.helper.mixinAxisModelCommonMethods(o);function s(e,t){return t.type||(t.data?"category":"value")}Object(n["a"])("x",o,s,{name:"X"});Object(n["a"])("y",o,s,{name:"Y"});Object(n["a"])("z",o,s,{name:"Z"})},function(e,t,r){"use strict";var a=r(0);var o=r.n(a);var s=r(157);var i=r(158);var u=r.n(i);var l=["value","category","time","log"];t["a"]=function(i,e,n,t){o.a.util.each(l,function(a){e.extend({type:i+"Axis3D."+a,__ordinalMeta:null,mergeDefaultAndTheme:function(e,t){var r=t.getTheme();o.a.util.merge(e,r.get(a+"Axis3D"));o.a.util.merge(e,this.getDefaultOption());e.type=n(i,e)},optionUpdated:function(){var e=this.option;if(e.type==="category"){this.__ordinalMeta=u.a.createByAxisModel(this)}},getCategories:function(){if(this.option.type==="category"){return this.__ordinalMeta.categories}},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:o.a.util.merge(o.a.util.clone(s["a"][a+"Axis3D"]),t||{},true)})});e.superClass.registerSubTypeDefaulter(i+"Axis3D",o.a.util.curry(n,i))}},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n={show:true,grid3DIndex:0,inverse:false,name:"",nameLocation:"middle",nameTextStyle:{fontSize:16},nameGap:20,axisPointer:{},axisLine:{},axisTick:{},axisLabel:{},splitArea:{}};var o=i.a.util.merge({boundaryGap:true,axisTick:{alignWithLabel:false,interval:"auto"},axisLabel:{interval:"auto"},axisPointer:{label:{show:false}}},n);var s=i.a.util.merge({boundaryGap:[0,0],splitNumber:5,axisPointer:{label:{}}},n);var u=i.a.util.defaults({scale:true,min:"dataMin",max:"dataMax"},s);var l=i.a.util.defaults({logBase:10},s);l.scale=true;t["a"]={categoryAxis3D:o,valueAxis3D:s,timeAxis3D:u,logAxis3D:l}},function(e,t,r){var a=r(13);var i=a.createHashMap;var n=a.isObject;var o=a.map;function s(e){this.categories=e.categories||[];this._needCollect=e.needCollect;this._deduplication=e.deduplication;this._map}s.createByAxisModel=function(e){var t=e.option;var r=t.data;var a=r&&o(r,h);return new s({categories:a,needCollect:!a,deduplication:t.dedplication!==false})};var u=s.prototype;u.getOrdinal=function(e){return l(this).get(e)};u.parseAndCollect=function(e){var t;var r=this._needCollect;if(typeof e!=="string"&&!r){return e}if(r&&!this._deduplication){t=this.categories.length;this.categories[t]=e;return t}var a=l(this);t=a.get(e);if(t==null){if(r){t=this.categories.length;this.categories[t]=e;a.set(e,t)}else{t=NaN}}return t};function l(e){return e._map||(e._map=i(e.categories))}function h(e){if(n(e)&&e.value!=null){return e.value}else{return e+""}}var f=s;e.exports=f},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(44);var o=r(28);var s=r(29);var u=i.a.extendComponentModel({type:"grid3D",dependencies:["xAxis3D","yAxis3D","zAxis3D"],defaultOption:{show:true,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",boxWidth:100,boxHeight:100,boxDepth:100,axisPointer:{show:true,lineStyle:{color:"rgba(0, 0, 0, 0.8)",width:1},label:{show:true,formatter:null,margin:8,textStyle:{fontSize:14,color:"#fff",backgroundColor:"rgba(0,0,0,0.5)",padding:3,borderRadius:3}}},axisLine:{show:true,lineStyle:{color:"#333",width:2,type:"solid"}},axisTick:{show:true,inside:false,length:3,lineStyle:{width:1}},axisLabel:{show:true,inside:false,rotate:0,margin:8,textStyle:{fontSize:12}},splitLine:{show:true,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:false,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}},light:{main:{alpha:30,beta:40},ambient:{intensity:.4}},viewControl:{alpha:20,beta:40,autoRotate:false,distance:200,minDistance:40,maxDistance:400}}});i.a.util.merge(u.prototype,n["a"]);i.a.util.merge(u.prototype,o["a"]);i.a.util.merge(u.prototype,s["a"]);var l=u},function(e,t,r){"use strict";var a=r(0);var S=r.n(a);var E=r(1);var s=r(45);var u=r(25);var A=r(2);var l=r(81);var h=r(30);var f=r(162);var c=r(164);var d=r(63);var i=r(46);var M=A["a"].firstNotNull;E["a"].Shader.import(i["a"]);["x","y","z"].forEach(function(e){S.a.extendComponentView({type:e+"Axis3D"})});var C={x:0,y:2,z:1};var n=S.a.extendComponentView({type:"grid3D",__ecgl__:true,init:function(e,t){var r=[["y","z","x",-1,"left"],["y","z","x",1,"right"],["x","y","z",-1,"bottom"],["x","y","z",1,"top"],["x","z","y",-1,"far"],["x","z","y",1,"near"]];var a=["x","y","z"];var i=new E["a"].Material({shader:E["a"].createShader("ecgl.color"),depthMask:false,transparent:true});var n=new E["a"].Material({shader:E["a"].createShader("ecgl.meshLines3D"),depthMask:false,transparent:true});i.define("fragment","DOUBLE_SIDED");i.define("both","VERTEX_COLOR");this.groupGL=new E["a"].Node;this._control=new s["a"]({zr:t.getZr()});this._control.init();this._faces=r.map(function(e){var t=new f["a"](e,n,i);this.groupGL.add(t.rootNode);return t},this);this._axes=a.map(function(e){var t=new c["a"](e,n);this.groupGL.add(t.rootNode);return t},this);var o=t.getDevicePixelRatio();this._axisLabelSurface=new l["a"]({width:256,height:256,devicePixelRatio:o});this._axisLabelSurface.onupdate=function(){t.getZr().refresh()};this._axisPointerLineMesh=new E["a"].Mesh({geometry:new u["a"]({useNativeLine:false}),material:n,castShadow:false,ignorePicking:true,renderOrder:3});this.groupGL.add(this._axisPointerLineMesh);this._axisPointerLabelsSurface=new l["a"]({width:128,height:128,devicePixelRatio:o});this._axisPointerLabelsMesh=new d["a"]({ignorePicking:true,renderOrder:4,castShadow:false});this._axisPointerLabelsMesh.material.set("textureAtlas",this._axisPointerLabelsSurface.getTexture());this.groupGL.add(this._axisPointerLabelsMesh);this._lightRoot=new E["a"].Node;this._sceneHelper=new h["a"];this._sceneHelper.initLight(this._lightRoot)},render:function(t,r,a){this._model=t;this._api=a;var e=t.coordinateSystem;e.viewGL.add(this._lightRoot);if(t.get("show")){e.viewGL.add(this.groupGL)}else{e.viewGL.remove(this.groupGL)}var i=this._control;i.setViewGL(e.viewGL);var n=t.getModel("viewControl");i.setFromViewControlModel(n,0);this._axisLabelSurface.clear();i.off("update");if(t.get("show")){this._faces.forEach(function(e){e.update(t,r,a)},this);this._axes.forEach(function(e){e.update(t,this._axisLabelSurface,a)},this)}i.on("update",this._onCameraChange.bind(this,t,a),this);this._sceneHelper.setScene(e.viewGL.scene);this._sceneHelper.updateLight(t);e.viewGL.setPostEffect(t.getModel("postEffect"),a);e.viewGL.setTemporalSuperSampling(t.getModel("temporalSuperSampling"));this._initMouseHandler(t)},afterRender:function(e,t,r,a){var i=a.renderer;this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r)},showAxisPointer:function(e,t,r,a){this._doShowAxisPointer();this._updateAxisPointer(a.value)},hideAxisPointer:function(e,t,r,a){this._doHideAxisPointer()},_initMouseHandler:function(e){var t=e.coordinateSystem;var r=t.viewGL;if(e.get("show")&&e.get("axisPointer.show")){r.on("mousemove",this._updateAxisPointerOnMousePosition,this)}else{r.off("mousemove",this._updateAxisPointerOnMousePosition)}},_updateAxisPointerOnMousePosition:function(e){if(e.target){return}var t=this._model;var r=t.coordinateSystem;var a=r.viewGL;var i=a.castRay(e.offsetX,e.offsetY,new E["a"].Ray);var n;for(var o=0;o<this._faces.length;o++){var s=this._faces[o];if(s.rootNode.invisible){continue}if(s.plane.normal.dot(a.camera.worldTransform.z)<0){s.plane.normal.negate()}var u=i.intersectPlane(s.plane);if(!u){continue}var l=r.getAxis(s.faceInfo[0]);var h=r.getAxis(s.faceInfo[1]);var f=C[s.faceInfo[0]];var c=C[s.faceInfo[1]];if(l.contain(u.array[f])&&h.contain(u.array[c])){n=u}}if(n){var d=r.pointToData(n.array,[],true);this._updateAxisPointer(d);this._doShowAxisPointer()}else{this._doHideAxisPointer()}},_onCameraChange:function(e,t){if(e.get("show")){this._updateFaceVisibility();this._updateAxisLinePosition()}var r=this._control;t.dispatchAction({type:"grid3DChangeCamera",alpha:r.getAlpha(),beta:r.getBeta(),distance:r.getDistance(),center:r.getCenter(),from:this.uid,grid3DId:e.id})},_updateFaceVisibility:function(){var e=this._control.getCamera();var t=new E["a"].Vector3;e.update();for(var r=0;r<this._faces.length/2;r++){var a=[];for(var i=0;i<2;i++){var n=this._faces[r*2+i];n.rootNode.getWorldPosition(t);t.transformMat4(e.viewMatrix);a[i]=t.z}var o=a[0]>a[1]?0:1;var s=this._faces[r*2+o];var u=this._faces[r*2+1-o];s.rootNode.invisible=true;u.rootNode.invisible=false}},_updateAxisLinePosition:function(){var e=this._model.coordinateSystem;var t=e.getAxis("x");var r=e.getAxis("y");var a=e.getAxis("z");var i=a.getExtentMax();var n=a.getExtentMin();var o=t.getExtentMin();var s=t.getExtentMax();var u=r.getExtentMax();var l=r.getExtentMin();var h=this._axes[0].rootNode;var f=this._axes[1].rootNode;var c=this._axes[2].rootNode;var d=this._faces;var v=d[4].rootNode.invisible?l:u;var p=d[2].rootNode.invisible?i:n;var m=d[0].rootNode.invisible?o:s;var g=d[2].rootNode.invisible?i:n;var _=d[0].rootNode.invisible?s:o;var y=d[4].rootNode.invisible?l:u;h.rotation.identity();f.rotation.identity();c.rotation.identity();if(d[4].rootNode.invisible){this._axes[0].flipped=true;h.rotation.rotateX(Math.PI)}if(d[0].rootNode.invisible){this._axes[1].flipped=true;f.rotation.rotateZ(Math.PI)}if(d[4].rootNode.invisible){this._axes[2].flipped=true;c.rotation.rotateY(Math.PI)}h.position.set(0,p,v);f.position.set(m,g,0);c.position.set(_,0,y);h.update();f.update();c.update();this._updateAxisLabelAlign()},_updateAxisLabelAlign:function(){var h=this._control.getCamera();var f=[new E["a"].Vector4,new E["a"].Vector4];var c=new E["a"].Vector4;this.groupGL.getWorldPosition(c);c.w=1;c.transformMat4(h.viewMatrix).transformMat4(h.projectionMatrix);c.x/=c.w;c.y/=c.w;this._axes.forEach(function(e){var t=e.axisLineCoords;var r=e.labelsMesh.geometry;for(var a=0;a<f.length;a++){f[a].setArray(t[a]);f[a].w=1;f[a].transformMat4(e.rootNode.worldTransform).transformMat4(h.viewMatrix).transformMat4(h.projectionMatrix);f[a].x/=f[a].w;f[a].y/=f[a].w}var i=f[1].x-f[0].x;var n=f[1].y-f[0].y;var o=(f[1].x+f[0].x)/2;var s=(f[1].y+f[0].y)/2;var u;var l;if(Math.abs(n/i)<.5){u="center";l=s>c.y?"bottom":"top"}else{l="middle";u=o>c.x?"left":"right"}e.setSpriteAlign(u,l,this._api)},this)},_doShowAxisPointer:function(){if(!this._axisPointerLineMesh.invisible){return}this._axisPointerLineMesh.invisible=false;this._axisPointerLabelsMesh.invisible=false;this._api.getZr().refresh()},_doHideAxisPointer:function(){if(this._axisPointerLineMesh.invisible){return}this._axisPointerLineMesh.invisible=true;this._axisPointerLabelsMesh.invisible=true;this._api.getZr().refresh()},_updateAxisPointer:function(e){var t=this._model.coordinateSystem;var r=t.dataToPoint(e);var a=this._axisPointerLineMesh;var i=a.geometry;var o=this._model.getModel("axisPointer");var n=this._api.getDevicePixelRatio();i.convertToDynamicArray(true);function s(e){return A["a"].firstNotNull(e.model.get("axisPointer.show"),o.get("show"))}function u(e){var t=e.model.getModel("axisPointer",o);var r=t.getModel("lineStyle");var a=E["a"].parseColor(r.get("color"));var i=M(r.get("width"),1);var n=M(r.get("opacity"),1);a[3]*=n;return{color:a,lineWidth:i}}for(var l=0;l<this._faces.length;l++){var h=this._faces[l];if(h.rootNode.invisible){continue}var f=h.faceInfo;var c=f[3]<0?t.getAxis(f[2]).getExtentMin():t.getAxis(f[2]).getExtentMax();var d=C[f[2]];for(var v=0;v<2;v++){var p=f[v];var m=f[1-v];var g=t.getAxis(p);var _=t.getAxis(m);if(!s(g)){continue}var y=[0,0,0];var x=[0,0,0];var T=C[p];var b=C[m];y[T]=x[T]=r[T];y[d]=x[d]=c;y[b]=_.getExtentMin();x[b]=_.getExtentMax();var w=u(g);i.addLine(y,x,w.color,w.lineWidth*n)}if(s(t.getAxis(f[2]))){var y=r.slice();var x=r.slice();x[d]=c;var w=u(t.getAxis(f[2]));i.addLine(y,x,w.color,w.lineWidth*n)}}i.convertToTypedArray();this._updateAxisPointerLabelsMesh(e);this._api.getZr().refresh()},_updateAxisPointerLabelsMesh:function(y){var e=this._model;var x=this._axisPointerLabelsMesh;var T=this._axisPointerLabelsSurface;var b=e.coordinateSystem;var w=e.getModel("axisPointer");x.geometry.convertToDynamicArray(true);T.clear();var E={x:"y",y:"x",z:"y"};this._axes.forEach(function(e,t){var r=b.getAxis(e.dim);var a=r.model;var i=a.getModel("axisPointer",w);var n=i.getModel("label");var o=i.get("lineStyle.color");if(!n.get("show")||!i.get("show")){return}var s=y[t];var u=n.get("formatter");var l=r.scale.getLabel(s);if(u!=null){l=u(l,y)}else{if(r.scale.type==="interval"||r.scale.type==="log"){var h=S.a.number.getPrecisionSafe(r.scale.getTicks()[0]);l=s.toFixed(h+2)}}var f=n.getModel("textStyle");var c=f.get("color");var d=new S.a.graphic.Text;S.a.graphic.setTextStyle(d.style,f,{text:l,textFill:c||o,textAlign:"left",textVerticalAlign:"top"});var v=T.add(d);var p=d.getBoundingRect();var m=this._api.getDevicePixelRatio();var g=e.rootNode.position.toArray();var _=C[E[e.dim]];g[_]+=(e.flipped?-1:1)*n.get("margin");g[C[e.dim]]=r.dataToCoord(y[t]);x.geometry.addSprite(g,[p.width*m,p.height*m],v,e.textAlign,e.textVerticalAlign)},this);T.getZr().refreshImmediately();x.material.set("uvScale",T.getCoordsScale());x.geometry.convertToTypedArray()},dispose:function(){this.groupGL.removeAll();this._control.dispose()}})},function(e,t,r){"use strict";var a=r(70);var i=r(12);var n=r(33);var o=r(78);var s=r(79);var u=r(34);var l=r(21);var h=r(55);t["a"]={vec2:a["a"],vec3:i["a"],vec4:n["a"],mat2:o["a"],mat2d:s["a"],mat3:u["a"],mat4:l["a"],quat:h["a"]}},function(e,t,r){"use strict";var a=r(0);var x=r.n(a);var T=r(1);var i=r(2);var n=r(25);var o=r(163);var b=i["a"].firstNotNull;var s={x:0,y:2,z:1};function u(e,t,r,a){var i=[0,0,0];var n=a<0?r.getExtentMin():r.getExtentMax();i[s[r.dim]]=n;e.position.setArray(i);e.rotation.identity();t.distance=-Math.abs(n);t.normal.set(0,0,0);if(r.dim==="x"){e.rotation.rotateY(a*Math.PI/2);t.normal.x=-a}else if(r.dim==="z"){e.rotation.rotateX(-a*Math.PI/2);t.normal.y=-a}else{if(a>0){e.rotation.rotateY(Math.PI)}t.normal.z=-a}}function l(e,t,r){this.rootNode=new T["a"].Node;var a=new T["a"].Mesh({geometry:new n["a"]({useNativeLine:false}),material:t,castShadow:false,ignorePicking:true,$ignorePicking:true,renderOrder:1});var i=new T["a"].Mesh({geometry:new o["a"],material:r,castShadow:false,culling:false,ignorePicking:true,$ignorePicking:true,renderOrder:0});this.rootNode.add(i);this.rootNode.add(a);this.faceInfo=e;this.plane=new T["a"].Plane;this.linesMesh=a;this.quadsMesh=i}l.prototype.update=function(e,t,r){var a=e.coordinateSystem;var i=[a.getAxis(this.faceInfo[0]),a.getAxis(this.faceInfo[1])];var n=this.linesMesh.geometry;var o=this.quadsMesh.geometry;n.convertToDynamicArray(true);o.convertToDynamicArray(true);this._updateSplitLines(n,i,e,r);this._udpateSplitAreas(o,i,e,r);n.convertToTypedArray();o.convertToTypedArray();var s=a.getAxis(this.faceInfo[2]);u(this.rootNode,this.plane,s,this.faceInfo[3])};l.prototype._updateSplitLines=function(m,g,_,e){var y=e.getDevicePixelRatio();g.forEach(function(e,t){var r=e.model;var a=g[1-t].getExtent();if(e.scale.isBlank()){return}var i=r.getModel("splitLine",_.getModel("splitLine"));if(i.get("show")){var n=i.getModel("lineStyle");var o=n.get("color");var s=b(n.get("opacity"),1);var u=b(n.get("width"),1);o=x.a.util.isArray(o)?o:[o];var l=e.getTicksCoords({tickModel:i});var h=0;for(var f=0;f<l.length;f++){var c=l[f].coord;var d=T["a"].parseColor(o[h%o.length]);d[3]*=s;var v=[0,0,0];var p=[0,0,0];v[t]=p[t]=c;v[1-t]=a[0];p[1-t]=a[1];m.addLine(v,p,d,u*y);h++}}})};l.prototype._udpateSplitAreas=function(g,_,y,e){_.forEach(function(e,t){var r=e.model;var a=_[1-t].getExtent();if(e.scale.isBlank()){return}var i=r.getModel("splitArea",y.getModel("splitArea"));if(i.get("show")){var n=i.getModel("areaStyle");var o=n.get("color");var s=b(n.get("opacity"),1);o=x.a.util.isArray(o)?o:[o];var u=e.getTicksCoords({tickModel:i,clamp:true});var l=0;var h=[0,0,0];var f=[0,0,0];for(var c=0;c<u.length;c++){var d=u[c].coord;var v=[0,0,0];var p=[0,0,0];v[t]=p[t]=d;v[1-t]=a[0];p[1-t]=a[1];if(c===0){h=v;f=p;continue}var m=T["a"].parseColor(o[l%o.length]);m[3]*=s;g.addQuad([h,v,p,f],m);h=v;f=p;l++}}})};t["a"]=l},function(e,t,r){"use strict";var a=r(15);var i=r(0);var n=r.n(i);var o=r(38);var s=r(6);var f=s["a"].vec3;var u=a["a"].extend(function(){return{segmentScale:1,useNativeLine:true,attributes:{position:new a["a"].Attribute("position","float",3,"POSITION"),normal:new a["a"].Attribute("normal","float",3,"NORMAL"),color:new a["a"].Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setQuadCount:function(e){var t=this.attributes;var r=this.getQuadVertexCount()*e;var a=this.getQuadTriangleCount()*e;if(this.vertexCount!==r){t.position.init(r);t.normal.init(r);t.color.init(r)}if(this.triangleCount!==a){this.indices=r>65535?new Uint32Array(a*3):new Uint16Array(a*3)}},getQuadVertexCount:function(){return 4},getQuadTriangleCount:function(){return 2},addQuad:function(){var s=f.create();var u=f.create();var l=f.create();var h=[0,3,1,3,2,1];return function(e,t){var r=this.attributes.position;var a=this.attributes.normal;var i=this.attributes.color;f.sub(s,e[1],e[0]);f.sub(u,e[2],e[1]);f.cross(l,s,u);f.normalize(l,l);for(var n=0;n<4;n++){r.set(this._vertexOffset+n,e[n]);i.set(this._vertexOffset+n,t);a.set(this._vertexOffset+n,l)}var o=this._faceOffset*3;for(var n=0;n<6;n++){this.indices[o+n]=h[n]+this._vertexOffset}this._vertexOffset+=4;this._faceOffset+=2}}()});n.a.util.defaults(u.prototype,o["a"]);t["a"]=u},function(e,t,r){"use strict";var a=r(0);var k=r.n(a);var W=r(1);var n=r(25);var i=r(2);var o=r(63);var j=i["a"].firstNotNull;var X={x:0,y:2,z:1};function s(e,t){var r=new W["a"].Mesh({geometry:new n["a"]({useNativeLine:false}),material:t,castShadow:false,ignorePicking:true,renderOrder:2});var a=new o["a"];a.material.depthMask=false;var i=new W["a"].Node;i.add(r);i.add(a);this.rootNode=i;this.dim=e;this.linesMesh=r;this.labelsMesh=a;this.axisLineCoords=null;this.labelElements=[]}var q={x:"y",y:"x",z:"y"};s.prototype.update=function(e,t,r){var a=e.coordinateSystem;var i=a.getAxis(this.dim);var n=this.linesMesh.geometry;var o=this.labelsMesh.geometry;n.convertToDynamicArray(true);o.convertToDynamicArray(true);var s=i.model;var u=i.getExtent();var l=r.getDevicePixelRatio();var h=s.getModel("axisLine",e.getModel("axisLine"));var f=s.getModel("axisTick",e.getModel("axisTick"));var c=s.getModel("axisLabel",e.getModel("axisLabel"));var d=h.get("lineStyle.color");if(h.get("show")){var v=h.getModel("lineStyle");var p=[0,0,0];var m=[0,0,0];var g=X[i.dim];p[g]=u[0];m[g]=u[1];this.axisLineCoords=[p,m];var _=W["a"].parseColor(d);var y=j(v.get("width"),1);var x=j(v.get("opacity"),1);_[3]*=x;n.addLine(p,m,_,y*l)}if(f.get("show")){var T=f.getModel("lineStyle");var b=W["a"].parseColor(j(T.get("color"),d));var y=j(T.get("width"),1);b[3]*=j(T.get("opacity"),1);var w=i.getTicksCoords();var E=f.get("length");for(var S=0;S<w.length;S++){var A=w[S].coord;var p=[0,0,0];var m=[0,0,0];var g=X[i.dim];var M=X[q[i.dim]];p[g]=m[g]=A;m[M]=E;n.addLine(p,m,b,y*l)}}this.labelElements=[];var l=r.getDevicePixelRatio();if(c.get("show")){var w=i.getTicksCoords();var C=s.get("data");var L=c.get("margin");var D=i.getViewLabels();for(var S=0;S<D.length;S++){var N=D[S].tickValue;var I=D[S].formattedLabel;var R=D[S].rawLabel;var A=i.dataToCoord(N);var P=[0,0,0];var g=X[i.dim];var M=X[q[i.dim]];P[g]=P[g]=A;P[M]=L;var O=c;if(C&&C[N]&&C[N].textStyle){O=new k.a.Model(C[N].textStyle,c,s.ecModel)}var F=j(O.get("color"),d);var B=new k.a.graphic.Text;k.a.graphic.setTextStyle(B.style,O,{text:I,textFill:typeof F==="function"?F(i.type==="category"?R:i.type==="value"?N+"":N,S):F,textVerticalAlign:"top",textAlign:"left"});var U=t.add(B);var z=B.getBoundingRect();o.addSprite(P,[z.width*l,z.height*l],U);this.labelElements.push(B)}}if(s.get("name")){var G=s.getModel("nameTextStyle");var P=[0,0,0];var g=X[i.dim];var M=X[q[i.dim]];var H=j(G.get("color"),d);var V=G.get("borderColor");var y=G.get("borderWidth");P[g]=P[g]=(u[0]+u[1])/2;P[M]=s.get("nameGap");var B=new k.a.graphic.Text;k.a.graphic.setTextStyle(B.style,G,{text:s.get("name"),textFill:H,textStroke:V,lineWidth:y});var U=t.add(B);var z=B.getBoundingRect();o.addSprite(P,[z.width*l,z.height*l],U);B.__idx=this.labelElements.length;this.nameLabelElement=B}this.labelsMesh.material.set("textureAtlas",t.getTexture());this.labelsMesh.material.set("uvScale",t.getCoordsScale());n.convertToTypedArray();o.convertToTypedArray()};s.prototype.setSpriteAlign=function(e,t,r){var a=r.getDevicePixelRatio();var i=this.labelsMesh.geometry;for(var n=0;n<this.labelElements.length;n++){var o=this.labelElements[n];var s=o.getBoundingRect();i.setSpriteAlign(n,[s.width*a,s.height*a],e,t)}var u=this.nameLabelElement;if(u){var s=u.getBoundingRect();i.setSpriteAlign(u.__idx,[s.width*a,s.height*a],e,t);i.dirty()}this.textAlign=e;this.textVerticalAlign=t};t["a"]=s},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(15);var o=r(38);var u=[0,1,2,0,2,3];var s=n["a"].extend(function(){return{attributes:{position:new n["a"].Attribute("position","float",3,"POSITION"),texcoord:new n["a"].Attribute("texcoord","float",2,"TEXCOORD_0"),offset:new n["a"].Attribute("offset","float",2),color:new n["a"].Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setSpriteCount:function(e){this._spriteCount=e;var t=e*4;var r=e*2;if(this.vertexCount!==t){this.attributes.position.init(t);this.attributes.offset.init(t);this.attributes.color.init(t)}if(this.triangleCount!==r){this.indices=t>65535?new Uint32Array(r*3):new Uint16Array(r*3)}},setSpriteAlign:function(e,t,r,a,i){if(r==null){r="left"}if(a==null){a="top"}var n,o,s,u;i=i||0;switch(r){case"left":n=i;s=t[0]+i;break;case"center":case"middle":n=-t[0]/2;s=t[0]/2;break;case"right":n=-t[0]-i;s=-i;break}switch(a){case"bottom":o=i;u=t[1]+i;break;case"middle":o=-t[1]/2;u=t[1]/2;break;case"top":o=-t[1]-i;u=-i;break}var l=e*4;var h=this.attributes.offset;h.set(l,[n,u]);h.set(l+1,[s,u]);h.set(l+2,[s,o]);h.set(l+3,[n,o])},addSprite:function(e,t,r,a,i,n){var o=this._vertexOffset;this.setSprite(this._vertexOffset/4,e,t,r,a,i,n);for(var s=0;s<u.length;s++){this.indices[this._faceOffset*3+s]=u[s]+o}this._faceOffset+=2;this._vertexOffset+=4;return o/4},setSprite:function(e,t,r,a,i,n,o){var s=e*4;var u=this.attributes;for(var l=0;l<4;l++){u.position.set(s+l,t)}var h=u.texcoord;h.set(s,[a[0][0],a[0][1]]);h.set(s+1,[a[1][0],a[0][1]]);h.set(s+2,[a[1][0],a[1][1]]);h.set(s+3,[a[0][0],a[1][1]]);this.setSpriteAlign(e,r,i,n,o)}});i.a.util.defaults(s.prototype,o["a"]);t["a"]=s},function(e,t,r){"use strict";t["a"]="@export ecgl.labels.vertex\n\nattribute vec3 position: POSITION;\nattribute vec2 texcoord: TEXCOORD_0;\nattribute vec2 offset;\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n vec4 proj = worldViewProjection * vec4(position, 1.0);\n\n vec2 screen = (proj.xy / abs(proj.w) + 1.0) * 0.5 * viewport.zw;\n\n screen += offset;\n\n proj.xy = (screen / viewport.zw - 0.5) * 2.0 * abs(proj.w);\n gl_Position = proj;\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n v_Texcoord = texcoord;\n}\n@end\n\n\n@export ecgl.labels.fragment\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\nuniform sampler2D textureAtlas;\nuniform vec2 uvScale: [1.0, 1.0];\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\nvarying float v_Miter;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n gl_FragColor = vec4(color, alpha) * texture2D(textureAtlas, v_Texcoord * uvScale);\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n}\n\n@end"},function(e,t,r){"use strict";var a=r(168);var l=r(170);var i=r(0);var h=r.n(i);var n=r(47);var s=r.n(n);var o=r(22);var u=r(2);function f(t,e){var r=t.getBoxLayoutParams();var a=s.a.getLayoutRect(r,{width:e.getWidth(),height:e.getHeight()});a.y=e.getHeight()-a.y-a.height;this.viewGL.setViewport(a.x,a.y,a.width,a.height,e.getDevicePixelRatio());var i=t.get("boxWidth");var n=t.get("boxHeight");var o=t.get("boxDepth");if(true){["x","y","z"].forEach(function(e){if(!this.getAxis(e)){throw new Error("Grid"+t.id+" don't have "+e+"Axis")}},this)}this.getAxis("x").setExtent(-i/2,i/2);this.getAxis("y").setExtent(o/2,-o/2);this.getAxis("z").setExtent(-n/2,n/2);this.size=[i,n,o]}function c(e,t){var u={};function a(e,t){u[e]=u[e]||[Infinity,-Infinity];u[e][0]=Math.min(t[0],u[e][0]);u[e][1]=Math.max(t[1],u[e][1])}e.eachSeries(function(e){if(e.coordinateSystem!==this){return}var r=e.getData();["x","y","z"].forEach(function(t){r.mapDimension(t,true).forEach(function(e){a(t,r.getDataExtent(e,true))})})},this);["xAxis3D","yAxis3D","zAxis3D"].forEach(function(s){e.eachComponent(s,function(e){var t=s.charAt(0);var r=e.getReferringComponents("grid3D")[0];var a=r.coordinateSystem;if(a!==this){return}var i=a.getAxis(t);if(i){if(true){console.warn("Can't have two %s in one grid3D",s)}return}var n=h.a.helper.createScale(u[t]||[Infinity,-Infinity],e);i=new l["a"](t,n);i.type=e.get("type");var o=i.type==="category";i.onBand=o&&e.get("boundaryGap");i.inverse=e.get("inverse");e.axis=i;i.model=e;i.getLabelModel=function(){return e.getModel("axisLabel",r.getModel("axisLabel"))};i.getTickModel=function(){return e.getModel("axisTick",r.getModel("axisTick"))};a.addAxis(i)},this)},this);this.resize(this.model,t)}var d={dimensions:a["a"].prototype.dimensions,create:function(i,e){var r=[];i.eachComponent("grid3D",function(e){e.__viewGL=e.__viewGL||new o["a"];var t=new a["a"];t.model=e;t.viewGL=e.__viewGL;e.coordinateSystem=t;r.push(t);t.resize=f;t.update=c});var t=["xAxis3D","yAxis3D","zAxis3D"];function n(r,a){return t.map(function(e){var t=r.getReferringComponents(e)[0];if(t==null){t=a.getComponent(e)}if(true){if(!t){throw new Error(e+' "'+u["a"].firstNotNull(r.get(e+"Index"),r.get(e+"Id"),0)+'" not found')}}return t})}i.eachSeries(function(e){if(e.get("coordinateSystem")!=="cartesian3D"){return}var r=e.getReferringComponents("grid3D")[0];if(r==null){var t=n(e,i);var r=t[0].getCoordSysModel();t.forEach(function(e){var t=e.getCoordSysModel();if(true){if(!t){throw new Error('grid3D "'+u["a"].firstNotNull(e.get("gridIndex"),e.get("gridId"),0)+'" not found')}if(t!==r){throw new Error("xAxis3D, yAxis3D, zAxis3D must use the same grid")}}})}var a=r.coordinateSystem;e.coordinateSystem=a});return r}};h.a.registerCoordinateSystem("grid3D",d);var v=d},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(169);var o=r.n(n);function s(e){o.a.call(this,e);this.size=[0,0,0]}s.prototype={constructor:s,type:"cartesian3D",dimensions:["x","y","z"],model:null,containPoint:function(e){return this.getAxis("x").contain(e[0])&&this.getAxis("y").contain(e[2])&&this.getAxis("z").contain(e[1])},containData:function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])&&this.getAxis("z").containData(e[2])},dataToPoint:function(e,t,r){t=t||[];t[0]=this.getAxis("x").dataToCoord(e[0],r);t[2]=this.getAxis("y").dataToCoord(e[1],r);t[1]=this.getAxis("z").dataToCoord(e[2],r);return t},pointToData:function(e,t,r){t=t||[];t[0]=this.getAxis("x").coordToData(e[0],r);t[1]=this.getAxis("y").coordToData(e[2],r);t[2]=this.getAxis("z").coordToData(e[1],r);return t}};i.a.util.inherits(s,o.a);t["a"]=s},function(e,t,r){var a=r(13);function i(e){return this._axes[e]}var n=function(e){this._axes={};this._dimList=[];this.name=e||""};n.prototype={constructor:n,type:"cartesian",getAxis:function(e){return this._axes[e]},getAxes:function(){return a.map(this._dimList,i,this)},getAxesByScale:function(t){t=t.toLowerCase();return a.filter(this.getAxes(),function(e){return e.scale.type===t})},addAxis:function(e){var t=e.dim;this._axes[t]=e;this._dimList.push(t)},dataToCoord:function(e){return this._dataCoordConvert(e,"dataToCoord")},coordToData:function(e){return this._dataCoordConvert(e,"coordToData")},_dataCoordConvert:function(e,t){var r=this._dimList;var a=e instanceof Array?[]:{};for(var i=0;i<r.length;i++){var n=r[i];var o=this._axes[n];a[n]=o[t](e[n])}return a}};var o=n;e.exports=o},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);function n(e,t,r){i.a.Axis.call(this,e,t,r)}n.prototype={constructor:n,getExtentMin:function(){var e=this._extent;return Math.min(e[0],e[1])},getExtentMax:function(){var e=this._extent;return Math.max(e[0],e[1])},calculateCategoryInterval:function(){return Math.floor(this.scale.count()/8)}};i.a.util.inherits(n,i.a.Axis);t["a"]=n},function(e,t,r){var h=r(13);var a=r(172);var c=r(85);function i(e){if(isNaN(e)){return"-"}e=(e+"").split(".");return e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:"")}function n(e,t){e=(e||"").toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()});if(t&&e){e=e.charAt(0).toUpperCase()+e.slice(1)}return e}var o=h.normalizeCssArray;var s=/([&<>"'])/g;var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function f(e){return e==null?"":(e+"").replace(s,function(e,t){return u[t]})}var d=["a","b","c","d","e","f","g"];var v=function(e,t){return"{"+e+(t==null?"":t)+"}"};function l(e,t,r){if(!h.isArray(t)){t=[t]}var a=t.length;if(!a){return""}var i=t[0].$vars||[];for(var n=0;n<i.length;n++){var o=d[n];e=e.replace(v(o),v(o,0))}for(var s=0;s<a;s++){for(var u=0;u<i.length;u++){var l=t[s][i[u]];e=e.replace(v(d[u],s),r?f(l):l)}}return e}function p(r,e,a){h.each(e,function(e,t){r=r.replace("{"+t+"}",a?f(e):e)});return r}function m(e,t){e=h.isString(e)?{color:e,extraCssText:t}:e||{};var r=e.color;var a=e.type;var t=e.extraCssText;if(!r){return""}return a==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;'+"border-radius:4px;width:4px;height:4px;background-color:"+f(r)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:5px;'+"border-radius:10px;width:10px;height:10px;background-color:"+f(r)+";"+(t||"")+'"></span>'}function g(e,t){e+="";return"0000".substr(0,t-e.length)+e}function _(e,t,r){if(e==="week"||e==="month"||e==="quarter"||e==="half-year"||e==="year"){e="MM-dd\nyyyy"}var a=c.parseDate(t);var i=r?"UTC":"";var n=a["get"+i+"FullYear"]();var o=a["get"+i+"Month"]()+1;var s=a["get"+i+"Date"]();var u=a["get"+i+"Hours"]();var l=a["get"+i+"Minutes"]();var h=a["get"+i+"Seconds"]();var f=a["get"+i+"Milliseconds"]();e=e.replace("MM",g(o,2)).replace("M",o).replace("yyyy",n).replace("yy",n%100).replace("dd",g(s,2)).replace("d",s).replace("hh",g(u,2)).replace("h",u).replace("mm",g(l,2)).replace("m",l).replace("ss",g(h,2)).replace("s",h).replace("SSS",g(f,3));return e}function y(e){return e?e.charAt(0).toUpperCase()+e.substr(1):e}var x=a.truncateText;var T=a.getBoundingRect;t.addCommas=i;t.toCamelCase=n;t.normalizeCssArray=o;t.encodeHTML=f;t.formatTpl=l;t.formatTplSimple=p;t.getTooltipMarker=m;t.formatTime=_;t.capitalFirst=y;t.truncateText=x;t.getTextRect=T},function(e,t,r){var c=r(82);var N=r(173);var a=r(13);var i=a.getContext;var l=a.extend;var I=a.retrieve2;var R=a.retrieve3;var n=a.trim;var s={};var u=0;var h=5e3;var P=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;var f="12px sans-serif";var o={};function d(e,t){o[e]=t}function O(e,t){t=t||f;var r=e+":"+t;if(s[r]){return s[r]}var a=(e+"").split("\n");var i=0;for(var n=0,o=a.length;n<o;n++){i=Math.max(w(a[n],t).width,i)}if(u>h){u=0;s={}}u++;s[r]=i;return i}function v(e,t,r,a,i,n,o){return n?m(e,t,r,a,i,n,o):p(e,t,r,a,i,o)}function p(e,t,r,a,i,n){var o=E(e,t,i,n);var s=O(e,t);if(i){s+=i[1]+i[3]}var u=o.outerHeight;var l=g(0,s,r);var h=_(0,u,a);var f=new c(l,h,s,u);f.lineHeight=o.lineHeight;return f}function m(e,t,r,a,i,n,o){var s=S(e,{rich:n,truncate:o,font:t,textAlign:r,textPadding:i});var u=s.outerWidth;var l=s.outerHeight;var h=g(0,u,r);var f=_(0,l,a);return new c(h,f,u,l)}function g(e,t,r){if(r==="right"){e-=t}else if(r==="center"){e-=t/2}return e}function _(e,t,r){if(r==="middle"){e-=t/2}else if(r==="bottom"){e-=t}return e}function y(e,t,r){var a=t.x;var i=t.y;var n=t.height;var o=t.width;var s=n/2;var u="left";var l="top";switch(e){case"left":a-=r;i+=s;u="right";l="middle";break;case"right":a+=r+o;i+=s;l="middle";break;case"top":a+=o/2;i-=r;u="center";l="bottom";break;case"bottom":a+=o/2;i+=n+r;u="center";break;case"inside":a+=o/2;i+=s;u="center";l="middle";break;case"insideLeft":a+=r;i+=s;l="middle";break;case"insideRight":a+=o-r;i+=s;u="right";l="middle";break;case"insideTop":a+=o/2;i+=r;u="center";break;case"insideBottom":a+=o/2;i+=n-r;u="center";l="bottom";break;case"insideTopLeft":a+=r;i+=r;break;case"insideTopRight":a+=o-r;i+=r;u="right";break;case"insideBottomLeft":a+=r;i+=n-r;l="bottom";break;case"insideBottomRight":a+=o-r;i+=n-r;u="right";l="bottom";break}return{x:a,y:i,textAlign:u,textVerticalAlign:l}}function F(e,t,r,a,i){if(!t){return""}var n=(e+"").split("\n");i=x(t,r,a,i);for(var o=0,s=n.length;o<s;o++){n[o]=T(n[o],i)}return n.join("\n")}function x(e,t,r,a){a=l({},a);a.font=t;var r=I(r,"...");a.maxIterations=I(a.maxIterations,2);var i=a.minChar=I(a.minChar,0);a.cnCharWidth=O("",t);var n=a.ascCharWidth=O("a",t);a.placeholder=I(a.placeholder,"");var o=e=Math.max(0,e-1);for(var s=0;s<i&&o>=n;s++){o-=n}var u=O(r);if(u>o){r="";u=0}o=e-u;a.ellipsis=r;a.ellipsisWidth=u;a.contentWidth=o;a.containerWidth=e;return a}function T(e,t){var r=t.containerWidth;var a=t.font;var i=t.contentWidth;if(!r){return""}var n=O(e,a);if(n<=r){return e}for(var o=0;;o++){if(n<=i||o>=t.maxIterations){e+=t.ellipsis;break}var s=o===0?b(e,i,t.ascCharWidth,t.cnCharWidth):n>0?Math.floor(e.length*i/n):0;e=e.substr(0,s);n=O(e,a)}if(e===""){e=t.placeholder}return e}function b(e,t,r,a){var i=0;var n=0;for(var o=e.length;n<o&&i<t;n++){var s=e.charCodeAt(n);i+=0<=s&&s<=127?r:a}return n}function B(e){return O("",e)}function w(e,t){return o.measureText(e,t)}o.measureText=function(e,t){var r=i();r.font=t||f;return r.measureText(e)};function E(e,t,r,a){e!=null&&(e+="");var i=B(t);var n=e?e.split("\n"):[];var o=n.length*i;var s=o;if(r){s+=r[0]+r[2]}if(e&&a){var u=a.outerHeight;var l=a.outerWidth;if(u!=null&&s>u){e="";n=[]}else if(l!=null){var h=x(l-(r?r[1]+r[3]:0),t,a.ellipsis,{minChar:a.minChar,placeholder:a.placeholder});for(var f=0,c=n.length;f<c;f++){n[f]=T(n[f],h)}}}return{lines:n,height:o,outerHeight:s,lineHeight:i}}function S(e,t){var r={lines:[],width:0,height:0};e!=null&&(e+="");if(!e){return r}var a=P.lastIndex=0;var i;while((i=P.exec(e))!=null){var n=i.index;if(n>a){U(r,e.substring(a,n))}U(r,i[2],i[1]);a=P.lastIndex}if(a<e.length){U(r,e.substring(a,e.length))}var o=r.lines;var s=0;var u=0;var l=[];var h=t.textPadding;var f=t.truncate;var c=f&&f.outerWidth;var d=f&&f.outerHeight;if(h){c!=null&&(c-=h[1]+h[3]);d!=null&&(d-=h[0]+h[2])}for(var v=0;v<o.length;v++){var p=o[v];var m=0;var g=0;for(var _=0;_<p.tokens.length;_++){var y=p.tokens[_];var x=y.styleName&&t.rich[y.styleName]||{};var T=y.textPadding=x.textPadding;var b=y.font=x.font||t.font;var w=y.textHeight=I(x.textHeight,B(b));T&&(w+=T[0]+T[2]);y.height=w;y.lineHeight=R(x.textLineHeight,t.textLineHeight,w);y.textAlign=x&&x.textAlign||t.textAlign;y.textVerticalAlign=x&&x.textVerticalAlign||"middle";if(d!=null&&s+y.lineHeight>d){return{lines:[],width:0,height:0}}y.textWidth=O(y.text,b);var E=x.textWidth;var S=E==null||E==="auto";if(typeof E==="string"&&E.charAt(E.length-1)==="%"){y.percentWidth=E;l.push(y);E=0}else{if(S){E=y.textWidth;var A=x.textBackgroundColor;var M=A&&A.image;if(M){M=N.findExistImage(M);if(N.isImageReady(M)){E=Math.max(E,M.width*w/M.height)}}}var C=T?T[1]+T[3]:0;E+=C;var L=c!=null?c-g:null;if(L!=null&&L<E){if(!S||L<C){y.text="";y.textWidth=E=0}else{y.text=F(y.text,L-C,b,f.ellipsis,{minChar:f.minChar});y.textWidth=O(y.text,b);E=y.textWidth+C}}}g+=y.width=E;x&&(m=Math.max(m,y.lineHeight))}p.width=g;p.lineHeight=m;s+=m;u=Math.max(u,g)}r.outerWidth=r.width=I(t.textWidth,u);r.outerHeight=r.height=I(t.textHeight,s);if(h){r.outerWidth+=h[1]+h[3];r.outerHeight+=h[0]+h[2]}for(var v=0;v<l.length;v++){var y=l[v];var D=y.percentWidth;y.width=parseInt(D,10)/100*u}return r}function U(e,t,r){var a=t==="";var i=t.split("\n");var n=e.lines;for(var o=0;o<i.length;o++){var s=i[o];var u={styleName:r,text:s,isLineHolder:!s&&!a};if(!o){var l=(n[n.length-1]||(n[0]={tokens:[]})).tokens;var h=l.length;h===1&&l[0].isLineHolder?l[0]=u:(s||!h||a)&&l.push(u)}else{n.push({tokens:[u]})}}}function A(e){var t=(e.fontSize||e.fontFamily)&&[e.fontStyle,e.fontWeight,(e.fontSize||12)+"px",e.fontFamily||"sans-serif"].join(" ");return t&&n(t)||e.textFont||e.font}t.DEFAULT_FONT=f;t.$override=d;t.getWidth=O;t.getBoundingRect=v;t.adjustTextX=g;t.adjustTextY=_;t.adjustTextPositionOnRect=y;t.truncateText=F;t.getLineHeight=B;t.measureText=w;t.parsePlainText=E;t.parseRichText=S;t.makeFont=A},function(e,t,r){var a=r(60);var s=new a(50);function i(e){if(typeof e==="string"){var t=s.get(e);return t&&t.image}else{return e}}function n(e,t,r,a,i){if(!e){return t}else if(typeof e==="string"){if(t&&t.__zrImageSrc===e||!r){return t}var n=s.get(e);var o={hostEl:r,cb:a,cbPayload:i};if(n){t=n.image;!l(t)&&n.pending.push(o)}else{!t&&(t=new Image);t.onload=u;s.put(e,t.__cachedImgObj={image:t,pending:[o]});t.src=t.__zrImageSrc=e}return t}else{return e}}function u(){var e=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t];var a=r.cb;a&&a(this,r.cbPayload);r.hostEl.dirty()}e.pending.length=0}function l(e){return e&&e.width&&e.height}t.findExistImage=i;t.createOrUpdateImage=n;t.isImageReady=l},function(e,t,r){"use strict";var a=r(7);var n=r(11);var _=r(3);var y=r(18);var i=r(59);var z=r(9);var G=r(52);var o=r(8);var s=r(19);var u=r(10);var l=r(4);var h=r(5);var f=r(27);var H=r(41);var c=r(37);var d=r(16);var v=r(86);var V=r(21);var p=r(175);var x=["px","nx","py","ny","pz","nz"];o["a"]["import"](p["a"]);function k(e,t,r){if(r==="alphaMap"){return e.material.get("diffuseMap")}else if(r==="alphaCutoff"){if(e.material.isDefined("fragment","ALPHA_TEST")&&e.material.get("diffuseMap")){var a=e.material.get("alphaCutoff");return a||0}return 0}else{return t.get(r)}}function W(e,t){var r=e.material;var a=t.material;return r.get("diffuseMap")!==a.get("diffuseMap")||(r.get("alphaCutoff")||0)!==(a.get("alphaCutoff")||0)}var j=a["a"].extend(function(){return{softShadow:j.PCF,shadowBlur:1,lightFrustumBias:"auto",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:"highp",_lastRenderNotCastShadow:false,_frameBuffer:new u["a"],_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new v["a"]}},function(){this._gaussianPassH=new d["a"]({fragment:o["a"].source("clay.compositor.gaussian_blur")});this._gaussianPassV=new d["a"]({fragment:o["a"].source("clay.compositor.gaussian_blur")});this._gaussianPassH.setUniform("blurSize",this.shadowBlur);this._gaussianPassH.setUniform("blurDir",0);this._gaussianPassV.setUniform("blurSize",this.shadowBlur);this._gaussianPassV.setUniform("blurDir",1);this._outputDepthPass=new d["a"]({fragment:o["a"].source("clay.sm.debug_depth")})},{render:function(e,t,r,a){if(!r){r=t.getMainCamera()}this.trigger("beforerender",this,e,t,r);this._renderShadowPass(e,t,r,a);this.trigger("afterrender",this,e,t,r)},renderDebug:function(e,t){e.saveClear();var r=e.viewport;var a=0,i=0;var n=t||r.width/4;var o=n;if(this.softShadow===j.VSM){this._outputDepthPass.material.define("fragment","USE_VSM")}else{this._outputDepthPass.material.undefine("fragment","USE_VSM")}for(var s in this._textures){var u=this._textures[s];e.setViewport(a,i,n*u.width/u.height,o);this._outputDepthPass.setUniform("depthMap",u);this._outputDepthPass.render(e);a+=n*u.width/u.height}e.setViewport(r);e.restoreClear()},_updateReceivers:function(e,t){if(t.receiveShadow){this._receivers.push(t);t.material.set("shadowEnabled",1);t.material.set("pcfKernel",this.kernelPCF)}else{t.material.set("shadowEnabled",0)}if(this.softShadow===j.VSM){t.material.define("fragment","USE_VSM");t.material.undefine("fragment","PCF_KERNEL_SIZE")}else{t.material.undefine("fragment","USE_VSM");var r=this.kernelPCF;if(r&&r.length){t.material.define("fragment","PCF_KERNEL_SIZE",r.length/2)}else{t.material.undefine("fragment","PCF_KERNEL_SIZE")}}},_update:function(t,e){var r=this;e.traverse(function(e){if(e.isRenderable()){r._updateReceivers(t,e)}});for(var a=0;a<e.lights.length;a++){var i=e.lights[a];if(i.castShadow&&!i.invisible){this._lightsCastShadow.push(i)}}},_renderShadowPass:function(e,t,r,a){for(var i in this._shadowMapNumber){this._shadowMapNumber[i]=0}this._lightsCastShadow.length=0;this._receivers.length=0;var n=e.gl;if(!a){t.update()}if(r){r.update()}t.updateLights();this._update(e,t);if(!this._lightsCastShadow.length&&this._lastRenderNotCastShadow){return}this._lastRenderNotCastShadow=this._lightsCastShadow===0;n.enable(n.DEPTH_TEST);n.depthMask(true);n.disable(n.BLEND);n.clearColor(1,1,1,1);var o=[];var s=[];var u=[];var l=[];var h=[];var f=[];var c;for(var d=0;d<this._lightsCastShadow.length;d++){var v=this._lightsCastShadow[d];if(v.type==="DIRECTIONAL_LIGHT"){if(c){console.warn("Only one direectional light supported with shadow cascade");continue}if(v.shadowCascade>4){console.warn("Support at most 4 cascade");continue}if(v.shadowCascade>1){c=v}this.renderDirectionalLightShadow(e,t,r,v,h,l,u)}else if(v.type==="SPOT_LIGHT"){this.renderSpotLightShadow(e,t,v,s,o)}else if(v.type==="POINT_LIGHT"){this.renderPointLightShadow(e,t,v,f)}this._shadowMapNumber[v.type]++}for(var p in this._shadowMapNumber){var m=this._shadowMapNumber[p];var g=p+"_SHADOWMAP_COUNT";for(var d=0;d<this._receivers.length;d++){var _=this._receivers[d];var y=_.material;if(y.fragmentDefines[g]!==m){if(m>0){y.define("fragment",g,m)}else if(y.isDefined("fragment",g)){y.undefine("fragment",g)}}}}for(var d=0;d<this._receivers.length;d++){var _=this._receivers[d];var y=_.material;if(c){y.define("fragment","SHADOW_CASCADE",c.shadowCascade)}else{y.undefine("fragment","SHADOW_CASCADE")}}var x=t.shadowUniforms;function T(e){return e.height}if(u.length>0){var b=u.map(T);x.directionalLightShadowMaps={value:u,type:"tv"};x.directionalLightMatrices={value:l,type:"m4v"};x.directionalLightShadowMapSizes={value:b,type:"1fv"};if(c){var w=h.slice();var E=h.slice();w.pop();E.shift();w.reverse();E.reverse();l.reverse();x.shadowCascadeClipsNear={value:w,type:"1fv"};x.shadowCascadeClipsFar={value:E,type:"1fv"}}}if(o.length>0){var S=o.map(T);var x=t.shadowUniforms;x.spotLightShadowMaps={value:o,type:"tv"};x.spotLightMatrices={value:s,type:"m4v"};x.spotLightShadowMapSizes={value:S,type:"1fv"}}if(f.length>0){x.pointLightShadowMaps={value:f,type:"tv"}}},renderDirectionalLightShadow:function(){var I=new i["a"];var R=new z["a"];var P=new y["a"];var O=new z["a"];var F=new z["a"];var B=new z["a"];var U=new z["a"];return function(e,t,r,a,i,n,o){var s=this._getDepthMaterial(a);var u={getMaterial:function(e){return e.shadowDepthMaterial||s},isMaterialChanged:W,getUniform:k,ifRender:function(e){return e.castShadow},sortCompare:G["a"].opaqueSortCompare};if(!t.viewBoundingBoxLastFrame.isFinite()){var l=t.getBoundingBox();t.viewBoundingBoxLastFrame.copy(l).applyTransform(r.viewMatrix)}var h=Math.min(-t.viewBoundingBoxLastFrame.min.z,r.far);var f=Math.max(-t.viewBoundingBoxLastFrame.max.z,r.near);var c=this._getDirectionalLightCamera(a,t,r);var d=B.array;U.copy(c.projectionMatrix);V["a"].invert(F.array,c.worldTransform.array);V["a"].multiply(F.array,F.array,r.worldTransform.array);V["a"].multiply(d,U.array,F.array);var v=[];var p=r instanceof H["a"];var m=(r.near+r.far)/(r.near-r.far);var g=2*r.near*r.far/(r.near-r.far);for(var _=0;_<=a.shadowCascade;_++){var y=f*Math.pow(h/f,_/a.shadowCascade);var x=f+(h-f)*_/a.shadowCascade;var T=y*a.cascadeSplitLogFactor+x*(1-a.cascadeSplitLogFactor);v.push(T);i.push(-(-T*m+g)/-T)}var b=this._getTexture(a,a.shadowCascade);o.push(b);var w=e.viewport;var E=e.gl;this._frameBuffer.attach(b);this._frameBuffer.bind(e);E.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT);for(var _=0;_<a.shadowCascade;_++){var S=v[_];var A=v[_+1];if(p){V["a"].perspective(R.array,r.fov/180*Math.PI,r.aspect,S,A)}else{V["a"].ortho(R.array,r.left,r.right,r.bottom,r.top,S,A)}I.setFromProjection(R);I.getTransformedBoundingBox(P,F);P.applyProjection(U);var M=P.min.array;var C=P.max.array;M[0]=Math.max(M[0],-1);M[1]=Math.max(M[1],-1);C[0]=Math.min(C[0],1);C[1]=Math.min(C[1],1);O.ortho(M[0],C[0],M[1],C[1],1,-1);c.projectionMatrix.multiplyLeft(O);var L=a.shadowResolution||512;e.setViewport((a.shadowCascade-_-1)*L,0,L,L,1);var D=t.updateRenderList(c);e.renderPass(D.opaque,c,u);if(this.softShadow===j.VSM){this._gaussianFilter(e,b,b.width)}var N=new z["a"];N.copy(c.viewMatrix).multiplyLeft(c.projectionMatrix);n.push(N.array);c.projectionMatrix.copy(U)}this._frameBuffer.unbind(e);e.setViewport(w)}}(),renderSpotLightShadow:function(e,t,r,a,i){var n=this._getTexture(r);var o=this._getSpotLightCamera(r);var s=e.gl;this._frameBuffer.attach(n);this._frameBuffer.bind(e);s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var u=this._getDepthMaterial(r);var l={getMaterial:function(e){return e.shadowDepthMaterial||u},isMaterialChanged:W,getUniform:k,ifRender:function(e){return e.castShadow},sortCompare:G["a"].opaqueSortCompare};var h=t.updateRenderList(o);e.renderPass(h.opaque,o,l);this._frameBuffer.unbind(e);if(this.softShadow===j.VSM){this._gaussianFilter(e,n,n.width)}var f=new z["a"];f.copy(o.worldTransform).invert().multiplyLeft(o.projectionMatrix);i.push(n);a.push(f.array)},renderPointLightShadow:function(e,t,r,a){var i=this._getTexture(r);var n=e.gl;a.push(i);var o=this._getDepthMaterial(r);var s={getMaterial:function(e){return e.shadowDepthMaterial||o},getUniform:k,sortCompare:G["a"].opaqueSortCompare};var h={px:[],py:[],pz:[],nx:[],ny:[],nz:[]};var f=new y["a"];var c=r.getWorldPosition().array;var d=new y["a"];var u=r.range;d.min.setArray(c);d.max.setArray(c);var l=new _["a"](u,u,u);d.max.add(l);d.min.sub(l);var v={px:false,py:false,pz:false,nx:false,ny:false,nz:false};t.traverse(function(e){if(e.isRenderable()&&e.castShadow){var t=e.geometry;if(!t.boundingBox){for(var r=0;r<x.length;r++){h[x[r]].push(e)}return}f.transformFrom(t.boundingBox,e.worldTransform);if(!f.intersectBoundingBox(d)){return}f.updateVertices();for(var r=0;r<x.length;r++){v[x[r]]=false}for(var r=0;r<8;r++){var a=f.vertices[r];var i=a[0]-c[0];var n=a[1]-c[1];var o=a[2]-c[2];var s=Math.abs(i);var u=Math.abs(n);var l=Math.abs(o);if(s>u){if(s>l){v[i>0?"px":"nx"]=true}else{v[o>0?"pz":"nz"]=true}}else{if(u>l){v[n>0?"py":"ny"]=true}else{v[o>0?"pz":"nz"]=true}}}for(var r=0;r<x.length;r++){if(v[x[r]]){h[x[r]].push(e)}}}});for(var p=0;p<6;p++){var m=x[p];var g=this._getPointLightCamera(r,m);this._frameBuffer.attach(i,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+p);this._frameBuffer.bind(e);n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);e.renderPass(h[m],g,s)}this._frameBuffer.unbind(e)},_getDepthMaterial:function(e){var t=this._lightMaterials[e.__uid__];var r=e.type==="POINT_LIGHT";if(!t){var a=r?"clay.sm.distance.":"clay.sm.depth.";t=new s["a"]({precision:this.precision,shader:new o["a"](o["a"].source(a+"vertex"),o["a"].source(a+"fragment"))});this._lightMaterials[e.__uid__]=t}if(e.shadowSlopeScale!=null){t.setUniform("slopeScale",e.shadowSlopeScale)}if(e.shadowBias!=null){t.setUniform("bias",e.shadowBias)}if(this.softShadow===j.VSM){t.define("fragment","USE_VSM")}else{t.undefine("fragment","USE_VSM")}if(r){t.set("lightPosition",e.getWorldPosition().array);t.set("range",e.range)}return t},_gaussianFilter:function(e,t,r){var a={width:r,height:r,type:l["a"].FLOAT};var i=this._texturePool.get(a);this._frameBuffer.attach(i);this._frameBuffer.bind(e);this._gaussianPassH.setUniform("texture",t);this._gaussianPassH.setUniform("textureWidth",r);this._gaussianPassH.render(e);this._frameBuffer.attach(t);this._gaussianPassV.setUniform("texture",i);this._gaussianPassV.setUniform("textureHeight",r);this._gaussianPassV.render(e);this._frameBuffer.unbind(e);this._texturePool.put(i)},_getTexture:function(e,t){var r=e.__uid__;var a=this._textures[r];var i=e.shadowResolution||512;t=t||1;if(!a){if(e.type==="POINT_LIGHT"){a=new f["a"]}else{a=new h["a"]}a.width=i*t;a.height=i;if(this.softShadow===j.VSM){a.type=l["a"].FLOAT;a.anisotropic=4}else{a.minFilter=n["a"].NEAREST;a.magFilter=n["a"].NEAREST;a.useMipmap=false}this._textures[r]=a}return a},_getPointLightCamera:function(e,t){if(!this._lightCameras.point){this._lightCameras.point={px:new H["a"],nx:new H["a"],py:new H["a"],ny:new H["a"],pz:new H["a"],nz:new H["a"]}}var r=this._lightCameras.point[t];r.far=e.range;r.fov=90;r.position.set(0,0,0);switch(t){case"px":r.lookAt(_["a"].POSITIVE_X,_["a"].NEGATIVE_Y);break;case"nx":r.lookAt(_["a"].NEGATIVE_X,_["a"].NEGATIVE_Y);break;case"py":r.lookAt(_["a"].POSITIVE_Y,_["a"].POSITIVE_Z);break;case"ny":r.lookAt(_["a"].NEGATIVE_Y,_["a"].NEGATIVE_Z);break;case"pz":r.lookAt(_["a"].POSITIVE_Z,_["a"].NEGATIVE_Y);break;case"nz":r.lookAt(_["a"].NEGATIVE_Z,_["a"].NEGATIVE_Y);break}e.getWorldPosition(r.position);r.update();return r},_getDirectionalLightCamera:function(){var o=new z["a"];var s=new y["a"];var u=new y["a"];return function(e,t,r){if(!this._lightCameras.directional){this._lightCameras.directional=new c["a"]}var a=this._lightCameras.directional;s.copy(t.viewBoundingBoxLastFrame);s.intersection(r.frustum.boundingBox);a.position.copy(s.min).add(s.max).scale(.5).transformMat4(r.worldTransform);a.rotation.copy(e.rotation);a.scale.copy(e.scale);a.updateWorldTransform();z["a"].invert(o,a.worldTransform);z["a"].multiply(o,o,r.worldTransform);u.copy(s).applyTransform(o);var i=u.min.array;var n=u.max.array;a.position.set((i[0]+n[0])/2,(i[1]+n[1])/2,n[2]).transformMat4(a.worldTransform);a.near=0;a.far=-i[2]+n[2];if(isNaN(this.lightFrustumBias)){a.far*=4}else{a.far+=this.lightFrustumBias}a.left=i[0];a.right=n[0];a.top=n[1];a.bottom=i[1];a.update(true);return a}}(),_getSpotLightCamera:function(e){if(!this._lightCameras.spot){this._lightCameras.spot=new H["a"]}var t=this._lightCameras.spot;t.fov=e.penumbraAngle*2;t.far=e.range;t.worldTransform.copy(e.worldTransform);t.updateProjectionMatrix();V["a"].invert(t.viewMatrix.array,t.worldTransform.array);return t},dispose:function(e){var t=e.gl||e;if(this._frameBuffer){this._frameBuffer.dispose(t)}for(var r in this._textures){this._textures[r].dispose(t)}this._texturePool.clear(e.gl);this._depthMaterials={};this._distanceMaterials={};this._textures={};this._lightCameras={};this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0};this._meshMaterials={};for(var a=0;a<this._receivers.length;a++){var i=this._receivers[a];if(i.material){var n=i.material;n.undefine("fragment","POINT_LIGHT_SHADOW_COUNT");n.undefine("fragment","DIRECTIONAL_LIGHT_SHADOW_COUNT");n.undefine("fragment","AMBIENT_LIGHT_SHADOW_COUNT");n.set("shadowEnabled",0)}}this._receivers=[];this._lightsCastShadow=[]}});j.VSM=1;j.PCF=2;t["a"]=j},function(e,t,r){"use strict";t["a"]="@export clay.sm.depth.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n@import clay.chunk.skinning_header\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nvoid main(){\n vec3 skinnedPosition = position;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n#endif\n v_ViewPosition = worldViewProjection * vec4(skinnedPosition, 1.0);\n gl_Position = v_ViewPosition;\n v_Texcoord = texcoord;\n}\n@end\n@export clay.sm.depth.fragment\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nuniform float bias : 0.001;\nuniform float slopeScale : 1.0;\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\n@import clay.util.encode_float\nvoid main(){\n float depth = v_ViewPosition.z / v_ViewPosition.w;\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n#ifdef USE_VSM\n depth = depth * 0.5 + 0.5;\n float moment1 = depth;\n float moment2 = depth * depth;\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n moment2 += 0.25*(dx*dx+dy*dy);\n gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\n#else\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;\n gl_FragColor = encodeFloat(depth * 0.5 + 0.5);\n#endif\n}\n@end\n@export clay.sm.debug_depth\nuniform sampler2D depthMap;\nvarying vec2 v_Texcoord;\n@import clay.util.decode_float\nvoid main() {\n vec4 tex = texture2D(depthMap, v_Texcoord);\n#ifdef USE_VSM\n gl_FragColor = vec4(tex.rgb, 1.0);\n#else\n float depth = decodeFloat(tex);\n gl_FragColor = vec4(depth, depth, depth, 1.0);\n#endif\n}\n@end\n@export clay.sm.distance.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 world : WORLD;\nattribute vec3 position : POSITION;\n@import clay.chunk.skinning_header\nvarying vec3 v_WorldPosition;\nvoid main (){\n vec3 skinnedPosition = position;\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n#endif\n gl_Position = worldViewProjection * vec4(skinnedPosition , 1.0);\n v_WorldPosition = (world * vec4(skinnedPosition, 1.0)).xyz;\n}\n@end\n@export clay.sm.distance.fragment\nuniform vec3 lightPosition;\nuniform float range : 100;\nvarying vec3 v_WorldPosition;\n@import clay.util.encode_float\nvoid main(){\n float dist = distance(lightPosition, v_WorldPosition);\n#ifdef USE_VSM\n gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);\n#else\n dist = dist / range;\n gl_FragColor = encodeFloat(dist);\n#endif\n}\n@end\n@export clay.plugin.shadow_map_common\n@import clay.util.decode_float\nfloat tapShadowMap(sampler2D map, vec2 uv, float z){\n vec4 tex = texture2D(map, uv);\n return step(z, decodeFloat(tex) * 2.0 - 1.0);\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {\n float shadowContrib = tapShadowMap(map, uv, z);\n vec2 offset = vec2(1.0 / textureSize) * scale;\n#ifdef PCF_KERNEL_SIZE\n for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{\n shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);\n }}\n return shadowContrib / float(PCF_KERNEL_SIZE + 1);\n#else\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);\n return shadowContrib / 9.0;\n#endif\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize) {\n return pcf(map, uv, z, textureSize, vec2(1.0));\n}\nfloat chebyshevUpperBound(vec2 moments, float z){\n float p = 0.0;\n z = z * 0.5 + 0.5;\n if (z <= moments.x) {\n p = 1.0;\n }\n float variance = moments.y - moments.x * moments.x;\n variance = max(variance, 0.0000001);\n float mD = moments.x - z;\n float pMax = variance / (variance + mD * mD);\n pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);\n return max(p, pMax);\n}\nfloat computeShadowContrib(\n sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset\n) {\n vec4 posInLightSpace = lightVPM * vec4(position, 1.0);\n posInLightSpace.xyz /= posInLightSpace.w;\n float z = posInLightSpace.z;\n if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&\n all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){\n vec2 uv = (posInLightSpace.xy+1.0) / 2.0;\n #ifdef USE_VSM\n vec2 moments = texture2D(map, uv * scale + offset).xy;\n return chebyshevUpperBound(moments, z);\n #else\n return pcf(map, uv * scale + offset, z, textureSize, scale);\n #endif\n }\n return 1.0;\n}\nfloat computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {\n return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));\n}\nfloat computeShadowContribOmni(samplerCube map, vec3 direction, float range)\n{\n float dist = length(direction);\n vec4 shadowTex = textureCube(map, direction);\n#ifdef USE_VSM\n vec2 moments = shadowTex.xy;\n float variance = moments.y - moments.x * moments.x;\n float mD = moments.x - dist;\n float p = variance / (variance + mD * mD);\n if(moments.x + 0.001 < dist){\n return clamp(p, 0.0, 1.0);\n }else{\n return 1.0;\n }\n#else\n return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);\n#endif\n}\n@end\n@export clay.plugin.compute_shadow_map\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)\n#ifdef SPOT_LIGHT_SHADOWMAP_COUNT\nuniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT\n#if defined(SHADOW_CASCADE)\nuniform sampler2D directionalLightShadowMaps[1]:unconfigurable;\nuniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;\nuniform float directionalLightShadowMapSizes[1]:unconfigurable;\nuniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;\nuniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;\n#else\nuniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#endif\n#ifdef POINT_LIGHT_SHADOWMAP_COUNT\nuniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\nuniform bool shadowEnabled : true;\n#ifdef PCF_KERNEL_SIZE\nuniform vec2 pcfKernel[PCF_KERNEL_SIZE];\n#endif\n@import clay.plugin.shadow_map_common\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,\n spotLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n#ifdef SHADOW_CASCADE\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n / (gl_DepthRange.far - gl_DepthRange.near);\n float shadowContrib;\n shadowContribs[0] = 1.0;\n for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{\n if (\n depth >= shadowCascadeClipsNear[_idx_] &&\n depth <= shadowCascadeClipsFar[_idx_]\n ) {\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[0],\n vec2(1.0 / float(SHADOW_CASCADE), 1.0),\n vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)\n );\n shadowContribs[0] = shadowContrib;\n }\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#else\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n#if defined(POINT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){\n vec3 lightPosition;\n vec3 direction;\n for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n lightPosition = pointLightPosition[_idx_];\n direction = position - lightPosition;\n shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);\n }}\n for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n@end"},function(e,t,r){"use strict";var a=r(8);var i=r(5);var n=r(4);var o=r(10);var s=r(177);var u=r(189);var l=r(191);var c=r(193);var h=r(1);var f=r(194);var d=r(196);var v=r(9);var p=r(197);var m=r(87);var g=r(88);var _=r(89);var y=r(90);var x=r(91);var T=r(92);var b=r(93);var w=r(94);var E=r(95);var S=r(198);var A=r(199);a["a"]["import"](m["a"]);a["a"]["import"](g["a"]);a["a"]["import"](_["a"]);a["a"]["import"](y["a"]);a["a"]["import"](x["a"]);a["a"]["import"](T["a"]);a["a"]["import"](b["a"]);a["a"]["import"](w["a"]);a["a"]["import"](E["a"]);a["a"]["import"](S["a"]);a["a"]["import"](A["a"]);var M={color:{parameters:{width:function(e){return e.getWidth()},height:function(e){return e.getHeight()}}}};var C=["composite","FXAA"];function L(){this._sourceTexture=new i["a"]({type:n["a"].HALF_FLOAT});this._depthTexture=new i["a"]({format:n["a"].DEPTH_COMPONENT,type:n["a"].UNSIGNED_INT});this._framebuffer=new o["a"];this._framebuffer.attach(this._sourceTexture);this._framebuffer.attach(this._depthTexture,o["a"].DEPTH_ATTACHMENT);this._normalPass=new f["a"];this._compositor=Object(s["a"])(p["a"]);var e=this._compositor.getNodeByName("source");e.texture=this._sourceTexture;var t=this._compositor.getNodeByName("coc");this._sourceNode=e;this._cocNode=t;this._compositeNode=this._compositor.getNodeByName("composite");this._fxaaNode=this._compositor.getNodeByName("FXAA");this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map(function(e){return this._compositor.getNodeByName(e)},this);this._dofBlurKernel=0;this._dofBlurKernelSize=new Float32Array(0);this._finalNodesChain=C.map(function(e){return this._compositor.getNodeByName(e)},this);var r={normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()};this._ssaoPass=new u["a"](r);this._ssrPass=new l["a"](r);this._edgePass=new d["a"](r)}L.prototype.resize=function(e,t,r){r=r||1;var e=e*r;var t=t*r;var a=this._sourceTexture;var i=this._depthTexture;a.width=e;a.height=t;i.width=e;i.height=t};L.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR};L.prototype._getPrevNode=function(e){var t=C.indexOf(e.name)-1;var r=this._finalNodesChain[t];while(r&&!this._compositor.getNodeByName(r.name)){t-=1;r=this._finalNodesChain[t]}return r};L.prototype._getNextNode=function(e){var t=C.indexOf(e.name)+1;var r=this._finalNodesChain[t];while(r&&!this._compositor.getNodeByName(r.name)){t+=1;r=this._finalNodesChain[t]}return r};L.prototype._addChainNode=function(e){var t=this._getPrevNode(e);var r=this._getNextNode(e);if(!t){return}t.outputs=M;e.inputs.texture=t.name;if(r){e.outputs=M;r.inputs.texture=e.name}else{e.outputs=null}this._compositor.addNode(e)};L.prototype._removeChainNode=function(e){var t=this._getPrevNode(e);var r=this._getNextNode(e);if(!t){return}if(r){t.outputs=M;r.inputs.texture=t.name}else{t.outputs=null}this._compositor.removeNode(e)};L.prototype.updateNormal=function(e,t,r,a){if(this._ifRenderNormalPass()){this._normalPass.update(e,t,r)}};L.prototype.updateSSAO=function(e,t,r,a){this._ssaoPass.update(e,r,a)};L.prototype.enableSSAO=function(){this._enableSSAO=true};L.prototype.disableSSAO=function(){this._enableSSAO=false};L.prototype.enableSSR=function(){this._enableSSR=true};L.prototype.disableSSR=function(){this._enableSSR=false};L.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()};L.prototype.getSourceFrameBuffer=function(){return this._framebuffer};L.prototype.getSourceTexture=function(){return this._sourceTexture};L.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)};L.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)};L.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite";this._compositor.dirty()};L.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null;this._compositor.dirty()};L.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite";this._compositor.dirty()};L.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source";this._compositor.dirty()};L.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION");this._enableColorCorrection=true};L.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION");this._enableColorCorrection=false};L.prototype.enableEdge=function(){this._enableEdge=true};L.prototype.disableEdge=function(){this._enableEdge=false};L.prototype.setBloomIntensity=function(e){this._compositeNode.setParameter("bloomIntensity",e)};L.prototype.setSSAOParameter=function(e,t){switch(e){case"quality":var r={low:6,medium:12,high:32,ultra:62}[t]||12;this._ssaoPass.setParameter("kernelSize",r);break;case"radius":this._ssaoPass.setParameter(e,t);this._ssaoPass.setParameter("bias",t/200);break;case"intensity":this._ssaoPass.setParameter(e,t);break;default:if(true){console.warn("Unkown SSAO parameter "+e)}}};L.prototype.setDOFParameter=function(e,t){switch(e){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(e,t);break;case"blurRadius":for(var r=0;r<this._dofBlurNodes.length;r++){this._dofBlurNodes[r].setParameter("blurRadius",t)}break;case"quality":var a={low:4,medium:8,high:16,ultra:32}[t]||8;this._dofBlurKernelSize=a;for(var r=0;r<this._dofBlurNodes.length;r++){this._dofBlurNodes[r].pass.material.define("POISSON_KERNEL_SIZE",a)}this._dofBlurKernel=new Float32Array(a*2);break;default:if(true){console.warn("Unkown DOF parameter "+e)}}};L.prototype.setSSRParameter=function(e,t){if(t==null){return}switch(e){case"quality":var r={low:10,medium:15,high:30,ultra:80}[t]||20;var a={low:32,medium:16,high:8,ultra:4}[t]||16;this._ssrPass.setParameter("maxIteration",r);this._ssrPass.setParameter("pixelStride",a);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-t,1),0));break;case"physical":this.setPhysicallyCorrectSSR(t);break;default:console.warn("Unkown SSR parameter "+e)}};L.prototype.setPhysicallyCorrectSSR=function(e){this._ssrPass.setPhysicallyCorrect(e)};L.prototype.setEdgeColor=function(e){var t=h["a"].parseColor(e);this._edgePass.setParameter("edgeColor",t)};L.prototype.setExposure=function(e){this._compositeNode.setParameter("exposure",Math.pow(2,e))};L.prototype.setColorLookupTexture=function(e,t){this._compositeNode.pass.material.setTextureImage("lut",this._enableColorCorrection?e:"none",t,{minFilter:h["a"].Texture.NEAREST,magFilter:h["a"].Texture.NEAREST,flipY:false})};L.prototype.setColorCorrection=function(e,t){this._compositeNode.setParameter(e,t)};L.prototype.isSSREnabled=function(){return this._enableSSR};L.prototype.composite=function(e,t,r,a,i){var n=this._sourceTexture;var o=n;if(this._enableEdge){this._edgePass.update(e,r,n,i);n=o=this._edgePass.getTargetTexture()}if(this._enableSSR){this._ssrPass.update(e,r,n,i);o=this._ssrPass.getTargetTexture();this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null)}this._sourceNode.texture=o;this._cocNode.setParameter("depth",this._depthTexture);var s=this._dofBlurKernel;var u=this._dofBlurKernelSize;var l=Math.floor(c["a"].length/2/u);var h=i%l;for(var f=0;f<u*2;f++){s[f]=c["a"][f+h*u*2]}for(var f=0;f<this._dofBlurNodes.length;f++){this._dofBlurNodes[f].setParameter("percent",i/30);this._dofBlurNodes[f].setParameter("poissonKernel",s)}this._cocNode.setParameter("zNear",r.near);this._cocNode.setParameter("zFar",r.far);this._compositor.render(e,a)};L.prototype.dispose=function(e){this._sourceTexture.dispose(e);this._depthTexture.dispose(e);this._framebuffer.dispose(e);this._compositor.dispose(e);this._normalPass.dispose(e);this._ssaoPass.dispose(e)};t["a"]=L},function(e,t,r){"use strict";var a=r(178);t["a"]=a["a"]},function(e,t,r){"use strict";var h=r(23);var a=r(179);var d=r(181);var v=r(182);var p=r(183);var m=r(8);var n=r(4);var f=r(5);var c=r(27);var i=r(184);Object(i["a"])(m["a"]);var g=/^#source\((.*?)\)/;function o(n,o){var s=new a["a"];o=o||{};var u={textures:{},parameters:{}};var t=function(e,t){for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];var i=l(a,u,o);if(i){s.addNode(i)}}};for(var e in n.parameters){var r=n.parameters[e];u.parameters[e]=_(r)}y(n,u,o,function(e){u.textures=e;t()});return s}function l(e,t,r){var a=e.type||"filter";var i;var n;var o;if(a==="filter"){var s=e.shader.trim();var u=g.exec(s);if(u){i=m["a"].source(u[1].trim())}else if(s.charAt(0)==="#"){i=t.shaders[s.substr(1)]}if(!i){i=s}if(!i){return}}if(e.inputs){n={};for(var l in e.inputs){if(typeof e.inputs[l]==="string"){n[l]=e.inputs[l]}else{n[l]={node:e.inputs[l].node,pin:e.inputs[l].pin}}}}if(e.outputs){o={};for(var l in e.outputs){var h=e.outputs[l];o[l]={};if(h.attachment!=null){o[l].attachment=h.attachment}if(h.keepLastFrame!=null){o[l].keepLastFrame=h.keepLastFrame}if(h.outputLastFrame!=null){o[l].outputLastFrame=h.outputLastFrame}if(h.parameters){o[l].parameters=_(h.parameters)}}}var f;if(a==="scene"){f=new d["a"]({name:e.name,scene:r.scene,camera:r.camera,outputs:o})}else if(a==="texture"){f=new v["a"]({name:e.name,outputs:o})}else{f=new p["a"]({name:e.name,shader:i,inputs:n,outputs:o})}if(f){if(e.parameters){for(var l in e.parameters){var c=e.parameters[l];if(typeof c==="string"){c=c.trim();if(c.charAt(0)==="#"){c=t.textures[c.substr(1)]}else{f.on("beforerender",x(l,b(c)))}}f.setParameter(l,c)}}if(e.defines&&f.pass){for(var l in e.defines){var c=e.defines[l];f.pass.material.define("fragment",l,c)}}}return f}function s(e,t){return e}function u(e,t){return t}function _(r){var a={};if(!r){return a}["type","minFilter","magFilter","wrapS","wrapT","flipY","useMipmap"].forEach(function(e){var t=r[e];if(t!=null){if(typeof t==="string"){t=n["a"][t]}a[e]=t}});var i=r.scale||1;["width","height"].forEach(function(e){if(r[e]!=null){var t=r[e];if(typeof t==="string"){t=t.trim();a[e]=T(e,b(t),i)}else{a[e]=t}}});if(!a.width){a.width=s}if(!a.height){a.height=u}if(r.useMipmap!=null){a.useMipmap=r.useMipmap}return a}function y(e,t,r,n){if(!e.textures){n({});return}var o={};var s=0;var u=false;var l=r.textureRootPath;h["a"].each(e.textures,function(e,t){var r;var a=e.path;var i=_(e.parameters);if(Array.isArray(a)&&a.length===6){if(l){a=a.map(function(e){return h["a"].relative2absolute(e,l)})}r=new c["a"](i)}else if(typeof a==="string"){if(l){a=h["a"].relative2absolute(a,l)}r=new f["a"](i)}else{return}r.load(a);s++;r.once("success",function(){o[t]=r;s--;if(s===0){n(o);u=true}})});if(s===0&&!u){n(o)}}function x(n,o){return function(e){var t=e.getDevicePixelRatio();var r=e.getWidth();var a=e.getHeight();var i=o(r,a,t);this.setParameter(n,i)}}function T(e,i,n){n=n||1;return function(e){var t=e.getDevicePixelRatio();var r=e.getWidth()*n;var a=e.getHeight()*n;return i(r,a,t)}}function b(e){var t=/^expr\((.*)\)$/.exec(e);if(t){try{var r=new Function("width","height","dpr","return "+t[1]);r(1,1);return r}catch(e){throw new Error("Invalid expression.")}}}t["a"]=o},function(e,t,r){"use strict";var a=r(180);var i=r(86);var n=r(10);var o=a["a"].extend(function(){return{_outputs:[],_texturePool:new i["a"],_frameBuffer:new n["a"]({depthBuffer:false})}},{addNode:function(e){a["a"].prototype.addNode.call(this,e);e._compositor=this},render:function(e,t){if(this._dirty){this.update();this._dirty=false;this._outputs.length=0;for(var r=0;r<this.nodes.length;r++){if(!this.nodes[r].outputs){this._outputs.push(this.nodes[r])}}}for(var r=0;r<this.nodes.length;r++){this.nodes[r].beforeFrame()}for(var r=0;r<this._outputs.length;r++){this._outputs[r].updateReference()}for(var r=0;r<this._outputs.length;r++){this._outputs[r].render(e,t)}for(var r=0;r<this.nodes.length;r++){this.nodes[r].afterFrame()}},allocateTexture:function(e){return this._texturePool.get(e)},releaseTexture:function(e){this._texturePool.put(e)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(e){this._texturePool.clear(e)}});t["a"]=o},function(e,t,r){"use strict";var a=r(7);var n=r(48);var i=a["a"].extend(function(){return{nodes:[]}},{dirty:function(){this._dirty=true},addNode:function(e){if(this.nodes.indexOf(e)>=0){return}this.nodes.push(e);this._dirty=true},removeNode:function(e){if(typeof e==="string"){e=this.getNodeByName(e)}var t=this.nodes.indexOf(e);if(t>=0){this.nodes.splice(t,1);this._dirty=true}},getNodeByName:function(e){for(var t=0;t<this.nodes.length;t++){if(this.nodes[t].name===e){return this.nodes[t]}}},update:function(){for(var e=0;e<this.nodes.length;e++){this.nodes[e].clear()}for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];if(!t.inputs){continue}for(var r in t.inputs){if(!t.inputs[r]){continue}if(t.pass&&!t.pass.material.isUniformEnabled(r)){console.warn("Pin "+t.name+"."+r+" not used.");continue}var a=t.inputs[r];var i=this.findPin(a);if(i){t.link(r,i.node,i.pin)}else{if(typeof a==="string"){console.warn("Node "+a+" not exist")}else{console.warn("Pin of "+a.node+"."+a.pin+" not exist")}}}}},findPin:function(e){var t;if(typeof e==="string"||e instanceof n["a"]){e={node:e}}if(typeof e.node==="string"){for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r];if(a.name===e.node){t=a}}}else{t=e.node}if(t){var i=e.pin;if(!i){if(t.outputs){i=Object.keys(t.outputs)[0]}}if(t.outputs[i]){return{node:t,pin:i}}}}});t["a"]=i},function(e,t,r){"use strict";var a=r(48);var f=r(11);var i=r(10);var n=a["a"].extend({name:"scene",scene:null,camera:null,autoUpdateScene:true,preZ:false},function(){this.frameBuffer=new i["a"]},{render:function(e){this._rendering=true;var t=e.gl;this.trigger("beforerender");var r;if(!this.outputs){r=e.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ)}else{var a=this.frameBuffer;for(var i in this.outputs){var n=this.updateParameter(i,e);var o=this.outputs[i];var s=this._compositor.allocateTexture(n);this._outputTextures[i]=s;var u=o.attachment||t.COLOR_ATTACHMENT0;if(typeof u=="string"){u=t[u]}a.attach(s,u)}a.bind(e);var l=e.getGLExtension("EXT_draw_buffers");if(l){var h=[];for(var u in this.outputs){u=parseInt(u);if(u>=t.COLOR_ATTACHMENT0&&u<=t.COLOR_ATTACHMENT0+8){h.push(u)}}l.drawBuffersEXT(h)}e.saveClear();e.clearBit=f["a"].DEPTH_BUFFER_BIT|f["a"].COLOR_BUFFER_BIT;r=e.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);e.restoreClear();a.unbind(e)}this.trigger("afterrender",r);this._rendering=false;this._rendered=true}});t["a"]=n},function(e,t,r){"use strict";var a=r(48);var i=a["a"].extend(function(){return{texture:null,outputs:{color:{}}}},function(){},{getOutput:function(e,t){return this.texture},beforeFrame:function(){},afterFrame:function(){}});t["a"]=i},function(e,t,r){"use strict";var a=r(16);var i=r(48);var n=i["a"].extend(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:false,_rendered:false,_compositor:null}},function(){var e=new a["a"]({fragment:this.shader});this.pass=e},{render:function(e,t){this.trigger("beforerender",e);this._rendering=true;var r=e.gl;for(var a in this.inputLinks){var i=this.inputLinks[a];var n=i.node.getOutput(e,i.pin);this.pass.setUniform(a,n)}if(!this.outputs){this.pass.outputs=null;this._compositor.getFrameBuffer().unbind(e);this.pass.render(e,t)}else{this.pass.outputs={};var o={};for(var s in this.outputs){var u=this.updateParameter(s,e);if(isNaN(u.width)){this.updateParameter(s,e)}var l=this.outputs[s];var h=this._compositor.allocateTexture(u);this._outputTextures[s]=h;var f=l.attachment||r.COLOR_ATTACHMENT0;if(typeof f==="string"){f=r[f]}o[f]=h}this._compositor.getFrameBuffer().bind(e);for(var f in o){this._compositor.getFrameBuffer().attach(o[f],f)}this.pass.render(e);this._compositor.getFrameBuffer().updateMipmap(e)}for(var a in this.inputLinks){var i=this.inputLinks[a];i.node.removeReference(i.pin)}this._rendering=false;this._rendered=true;this.trigger("afterrender",e)},updateParameter:function(e,t){var r=this.outputs[e];var a=r.parameters;var i=r._parametersCopy;if(!i){i=r._parametersCopy={}}if(a){for(var n in a){if(n!=="width"&&n!=="height"){i[n]=a[n]}}}var o,s;if(a.width instanceof Function){o=a.width.call(this,t)}else{o=a.width}if(a.height instanceof Function){s=a.height.call(this,t)}else{s=a.height}o=Math.ceil(o);s=Math.ceil(s);if(i.width!==o||i.height!==s){if(this._outputTextures[e]){this._outputTextures[e].dispose(t)}}i.width=o;i.height=s;return i},setParameter:function(e,t){this.pass.setUniform(e,t)},getParameter:function(e){return this.pass.getUniform(e)},setParameters:function(e){for(var t in e){this.setParameter(t,e[t])}},define:function(e,t){this.pass.material.define("fragment",e,t)},undefine:function(e){this.pass.material.undefine("fragment",e)},removeReference:function(e){this._outputReferences[e]--;if(this._outputReferences[e]===0){var t=this.outputs[e];if(t.keepLastFrame){if(this._prevOutputTextures[e]){this._compositor.releaseTexture(this._prevOutputTextures[e])}this._prevOutputTextures[e]=this._outputTextures[e]}else{this._compositor.releaseTexture(this._outputTextures[e])}}},clear:function(){i["a"].prototype.clear.call(this);this.pass.material.disableTexturesAll()}});t["a"]=n},function(e,t,r){"use strict";t["a"]=m;var a=r(185);var i=r(87);var n=r(186);var o=r(88);var s=r(187);var u=r(89);var l=r(90);var h=r(91);var f=r(92);var c=r(93);var d=r(188);var v=r(94);var p=r(95);function m(e){e["import"](a["a"]);e["import"](i["a"]);e["import"](n["a"]);e["import"](o["a"]);e["import"](s["a"]);e["import"](u["a"]);e["import"](l["a"]);e["import"](h["a"]);e["import"](f["a"]);e["import"](c["a"]);e["import"](d["a"]);e["import"](v["a"]);e["import"](p["a"])}},function(e,t,r){"use strict";t["a"]="@export clay.compositor.coloradjust\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float exposure : 0.0;\nuniform float gamma : 1.0;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\n color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n float luminance = dot( color, w );\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.brightness\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = tex.rgb + vec3(brightness);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.contrast\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float contrast : 1.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.exposure\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float exposure : 0.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb * pow(2.0, exposure);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.gamma\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float gamma : 1.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = pow(tex.rgb, vec3(gamma));\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.saturation\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb;\n float luminance = dot(color, w);\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.hdr.log_lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n float luminance = dot(tex.rgb, w);\n luminance = log(luminance + 0.001);\n gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));\n}\n@end\n@export clay.compositor.hdr.lum_adaption\nvarying vec2 v_Texcoord;\nuniform sampler2D adaptedLum;\nuniform sampler2D currentLum;\nuniform float frameTime : 0.02;\n@import clay.util.rgbm\nvoid main()\n{\n float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;\n float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);\n fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));\n gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));\n}\n@end\n@export clay.compositor.lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord );\n float luminance = dot(tex.rgb, w);\n gl_FragColor = vec4(vec3(luminance), 1.0);\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.vignette\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float darkness: 1;\nuniform float offset: 1;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = texel.rgb;\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);\n gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));\n}\n@end"},function(e,t,r){"use strict";t["a"]="@export clay.compositor.lensflare\n#define SAMPLE_NUMBER 8\nuniform sampler2D texture;\nuniform sampler2D lenscolor;\nuniform vec2 textureSize : [512, 512];\nuniform float dispersal : 0.3;\nuniform float haloWidth : 0.4;\nuniform float distortion : 1.0;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvec4 textureDistorted(\n in vec2 texcoord,\n in vec2 direction,\n in vec3 distortion\n) {\n return vec4(\n decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,\n 1.0\n );\n}\nvoid main()\n{\n vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;\n vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;\n vec2 haloVec = normalize(ghostVec) * haloWidth;\n vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);\n vec4 result = vec4(0.0);\n for (int i = 0; i < SAMPLE_NUMBER; i++)\n {\n vec2 offset = fract(texcoord + ghostVec * float(i));\n float weight = length(vec2(0.5) - offset) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n }\n result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));\n float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n vec2 offset = fract(texcoord + haloVec);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n gl_FragColor = result;\n}\n@end"},function(e,t,r){"use strict";var c=r(9);var o=r(3);var a=r(5);var i=r(4);var n=r(16);var s=r(8);var u=r(10);var f=r(49);var l=r(190);s["a"].import(l["a"]);function h(e){var t=new Uint8Array(e*e*4);var r=0;var a=new o["a"];for(var i=0;i<e;i++){for(var n=0;n<e;n++){a.set(Math.random()*2-1,Math.random()*2-1,0).normalize();t[r++]=(a.x*.5+.5)*255;t[r++]=(a.y*.5+.5)*255;t[r++]=0;t[r++]=255}}return t}function d(e){return new a["a"]({pixels:h(e),wrapS:i["a"].REPEAT,wrapT:i["a"].REPEAT,width:e,height:e})}function v(e,t,r){var a=new Float32Array(e*3);t=t||0;for(var i=0;i<e;i++){var n=Object(f["a"])(i+t,2)*(r?1:2)*Math.PI;var o=Object(f["a"])(i+t,3)*Math.PI;var s=Math.random();var u=Math.cos(n)*Math.sin(o)*s;var l=Math.cos(o)*s;var h=Math.sin(n)*Math.sin(o)*s;a[i*3]=u;a[i*3+1]=l;a[i*3+2]=h}return a}function p(e){e=e||{};this._ssaoPass=new n["a"]({fragment:s["a"].source("ecgl.ssao.estimate")});this._blurPass=new n["a"]({fragment:s["a"].source("ecgl.ssao.blur")});this._framebuffer=new u["a"]({depthBuffer:false});this._ssaoTexture=new a["a"];this._blurTexture=new a["a"];this._blurTexture2=new a["a"];this._depthTex=e.depthTexture;this._normalTex=e.normalTexture;this.setNoiseSize(4);this.setKernelSize(e.kernelSize||12);if(e.radius!=null){this.setParameter("radius",e.radius)}if(e.power!=null){this.setParameter("power",e.power)}if(!this._normalTex){this._ssaoPass.material.disableTexture("normalTex");this._blurPass.material.disableTexture("normalTex")}if(!this._depthTex){this._blurPass.material.disableTexture("depthTex")}this._blurPass.material.setUniform("normalTex",this._normalTex);this._blurPass.material.setUniform("depthTex",this._depthTex)}p.prototype.setDepthTexture=function(e){this._depthTex=e};p.prototype.setNormalTexture=function(e){this._normalTex=e;this._ssaoPass.material[e?"enableTexture":"disableTexture"]("normalTex");this.setKernelSize(this._kernelSize)};p.prototype.update=function(e,t,r){var a=e.getWidth();var i=e.getHeight();var n=this._ssaoPass;var o=this._blurPass;n.setUniform("kernel",this._kernels[r%this._kernels.length]);n.setUniform("depthTex",this._depthTex);if(this._normalTex!=null){n.setUniform("normalTex",this._normalTex)}n.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);var s=new c["a"];c["a"].transpose(s,t.worldTransform);n.setUniform("projection",t.projectionMatrix.array);n.setUniform("projectionInv",t.invProjectionMatrix.array);n.setUniform("viewInverseTranspose",s.array);var u=this._ssaoTexture;var l=this._blurTexture;var h=this._blurTexture2;u.width=a/2;u.height=i/2;l.width=a;l.height=i;h.width=a;h.height=i;this._framebuffer.attach(u);this._framebuffer.bind(e);e.gl.clearColor(1,1,1,1);e.gl.clear(e.gl.COLOR_BUFFER_BIT);n.render(e);o.setUniform("textureSize",[a/2,i/2]);o.setUniform("projection",t.projectionMatrix.array);this._framebuffer.attach(l);o.setUniform("direction",0);o.setUniform("ssaoTexture",u);o.render(e);this._framebuffer.attach(h);o.setUniform("textureSize",[a,i]);o.setUniform("direction",1);o.setUniform("ssaoTexture",l);o.render(e);this._framebuffer.unbind(e);var f=e.clearColor;e.gl.clearColor(f[0],f[1],f[2],f[3])};p.prototype.getTargetTexture=function(){return this._blurTexture2};p.prototype.setParameter=function(e,t){if(e==="noiseTexSize"){this.setNoiseSize(t)}else if(e==="kernelSize"){this.setKernelSize(t)}else if(e==="intensity"){this._ssaoPass.material.set("intensity",t)}else{this._ssaoPass.setUniform(e,t)}};p.prototype.setKernelSize=function(e){this._kernelSize=e;this._ssaoPass.material.define("fragment","KERNEL_SIZE",e);this._kernels=this._kernels||[];for(var t=0;t<30;t++){this._kernels[t]=v(e,t*e,!!this._normalTex)}};p.prototype.setNoiseSize=function(e){var t=this._ssaoPass.getUniform("noiseTex");if(!t){t=d(e);this._ssaoPass.setUniform("noiseTex",d(e))}else{t.data=h(e);t.width=t.height=e;t.dirty()}this._ssaoPass.setUniform("noiseTexSize",[e,e])};p.prototype.dispose=function(e){this._blurTexture.dispose(e);this._ssaoTexture.dispose(e);this._blurTexture2.dispose(e)};t["a"]=p},function(e,t,r){"use strict";t["a"]="@export ecgl.ssao.estimate\n\nuniform sampler2D depthTex;\n\nuniform sampler2D normalTex;\n\nuniform sampler2D noiseTex;\n\nuniform vec2 depthTexSize;\n\nuniform vec2 noiseTexSize;\n\nuniform mat4 projection;\n\nuniform mat4 projectionInv;\n\nuniform mat4 viewInverseTranspose;\n\nuniform vec3 kernel[KERNEL_SIZE];\n\nuniform float radius : 1;\n\nuniform float power : 1;\n\nuniform float bias: 1e-2;\n\nuniform float intensity: 1.0;\n\nvarying vec2 v_Texcoord;\n\nfloat ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {\n float occlusion = 0.0;\n\n for (int i = 0; i < KERNEL_SIZE; i++) {\n vec3 samplePos = kernel[i];\n#ifdef NORMALTEX_ENABLED\n samplePos = kernelBasis * samplePos;\n#endif\n samplePos = samplePos * radius + originPos;\n\n vec4 texCoord = projection * vec4(samplePos, 1.0);\n texCoord.xy /= texCoord.w;\n\n vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);\n\n float sampleDepth = depthTexel.r * 2.0 - 1.0;\n if (projection[3][3] == 0.0) {\n sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);\n }\n else {\n sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];\n }\n \n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));\n occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);\n }\n#ifdef NORMALTEX_ENABLED\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\n#else\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\n#endif\n return pow(occlusion, power);\n}\n\nvoid main()\n{\n\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\n\n#ifdef NORMALTEX_ENABLED\n vec4 tex = texture2D(normalTex, v_Texcoord);\n if (dot(tex.rgb, tex.rgb) == 0.0) {\n gl_FragColor = vec4(1.0);\n return;\n }\n vec3 N = tex.rgb * 2.0 - 1.0;\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\n\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n vec3 T = normalize(rvec - N * dot(rvec, N));\n vec3 BT = normalize(cross(N, T));\n mat3 kernelBasis = mat3(T, BT, N);\n#else\n if (depthTexel.r > 0.99999) {\n gl_FragColor = vec4(1.0);\n return;\n }\n mat3 kernelBasis;\n#endif\n\n float z = depthTexel.r * 2.0 - 1.0;\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n\n vec3 position = p4.xyz / p4.w;\n\n float ao = ssaoEstimator(position, kernelBasis);\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n gl_FragColor = vec4(vec3(ao), 1.0);\n}\n\n@end\n\n\n@export ecgl.ssao.blur\n#define SHADER_NAME SSAO_BLUR\n\nuniform sampler2D ssaoTexture;\n\n#ifdef NORMALTEX_ENABLED\nuniform sampler2D normalTex;\n#endif\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\nuniform int direction: 0.0;\n\n#ifdef DEPTHTEX_ENABLED\nuniform sampler2D depthTex;\nuniform mat4 projection;\nuniform float depthRange : 0.5;\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n#endif\n\nvoid main()\n{\n float kernel[5];\n kernel[0] = 0.122581;\n kernel[1] = 0.233062;\n kernel[2] = 0.288713;\n kernel[3] = 0.233062;\n kernel[4] = 0.122581;\n\n vec2 off = vec2(0.0);\n if (direction == 0) {\n off[0] = blurSize / textureSize.x;\n }\n else {\n off[1] = blurSize / textureSize.y;\n }\n\n vec2 coord = v_Texcoord;\n\n float sum = 0.0;\n float weightAll = 0.0;\n\n#ifdef NORMALTEX_ENABLED\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\n#endif\n#if defined(DEPTHTEX_ENABLED)\n float centerDepth = getLinearDepth(v_Texcoord);\n#endif\n\n for (int i = 0; i < 5; i++) {\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\n\n float w = kernel[i];\n#ifdef NORMALTEX_ENABLED\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n#endif\n#ifdef DEPTHTEX_ENABLED\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n#endif\n\n weightAll += w;\n sum += texture2D(ssaoTexture, coord).r * w;\n }\n\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\n}\n\n@end\n"},function(e,t,r){"use strict";var _=r(9);var a=r(3);var i=r(5);var n=r(4);var o=r(16);var s=r(8);var u=r(10);var l=r(49);var h=r(77);var f=r(192);s["a"].import(f["a"]);function c(e){e=e||{};this._ssrPass=new o["a"]({fragment:s["a"].source("ecgl.ssr.main"),clearColor:[0,0,0,0]});this._blurPass1=new o["a"]({fragment:s["a"].source("ecgl.ssr.blur"),clearColor:[0,0,0,0]});this._blurPass2=new o["a"]({fragment:s["a"].source("ecgl.ssr.blur"),clearColor:[0,0,0,0]});this._blendPass=new o["a"]({fragment:s["a"].source("clay.compositor.blend")});this._blendPass.material.disableTexturesAll();this._blendPass.material.enableTexture(["texture1","texture2"]);this._ssrPass.setUniform("gBufferTexture1",e.normalTexture);this._ssrPass.setUniform("gBufferTexture2",e.depthTexture);this._blurPass1.setUniform("gBufferTexture1",e.normalTexture);this._blurPass1.setUniform("gBufferTexture2",e.depthTexture);this._blurPass2.setUniform("gBufferTexture1",e.normalTexture);this._blurPass2.setUniform("gBufferTexture2",e.depthTexture);this._blurPass2.material.define("fragment","VERTICAL");this._blurPass2.material.define("fragment","BLEND");this._ssrTexture=new i["a"]({type:n["a"].HALF_FLOAT});this._texture2=new i["a"]({type:n["a"].HALF_FLOAT});this._texture3=new i["a"]({type:n["a"].HALF_FLOAT});this._prevTexture=new i["a"]({type:n["a"].HALF_FLOAT});this._currentTexture=new i["a"]({type:n["a"].HALF_FLOAT});this._frameBuffer=new u["a"]({depthBuffer:false});this._normalDistribution=null;this._totalSamples=256;this._samplePerFrame=4;this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame);this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples);this._downScale=1}c.prototype.setAmbientCubemap=function(e,t){this._ssrPass.material.set("specularCubemap",e);this._ssrPass.material.set("specularIntensity",t);var r=e&&t;this._ssrPass.material[r?"enableTexture":"disableTexture"]("specularCubemap")};c.prototype.update=function(e,t,r,a){var i=e.getWidth();var n=e.getHeight();var o=this._ssrTexture;var s=this._texture2;var u=this._texture3;o.width=this._prevTexture.width=this._currentTexture.width=i/this._downScale;o.height=this._prevTexture.height=this._currentTexture.height=n/this._downScale;s.width=u.width=i;s.height=u.height=n;var l=this._frameBuffer;var h=this._ssrPass;var f=this._blurPass1;var c=this._blurPass2;var d=this._blendPass;var v=new _["a"];var p=new _["a"];_["a"].transpose(v,t.worldTransform);_["a"].transpose(p,t.viewMatrix);h.setUniform("sourceTexture",r);h.setUniform("projection",t.projectionMatrix.array);h.setUniform("projectionInv",t.invProjectionMatrix.array);h.setUniform("toViewSpace",v.array);h.setUniform("toWorldSpace",p.array);h.setUniform("nearZ",t.near);var m=a/this._totalSamples*this._samplePerFrame;h.setUniform("jitterOffset",m);h.setUniform("sampleOffset",a*this._samplePerFrame);f.setUniform("textureSize",[o.width,o.height]);c.setUniform("textureSize",[i,n]);c.setUniform("sourceTexture",r);f.setUniform("projection",t.projectionMatrix.array);c.setUniform("projection",t.projectionMatrix.array);l.attach(o);l.bind(e);h.render(e);if(this._physicallyCorrect){l.attach(this._currentTexture);d.setUniform("texture1",this._prevTexture);d.setUniform("texture2",o);d.material.set({weight1:a>=1?.95:0,weight2:a>=1?.05:1});d.render(e)}l.attach(s);f.setUniform("texture",this._physicallyCorrect?this._currentTexture:o);f.render(e);l.attach(u);c.setUniform("texture",s);c.render(e);l.unbind(e);if(this._physicallyCorrect){var g=this._prevTexture;this._prevTexture=this._currentTexture;this._currentTexture=g}};c.prototype.getTargetTexture=function(){return this._texture3};c.prototype.setParameter=function(e,t){if(e==="maxIteration"){this._ssrPass.material.define("fragment","MAX_ITERATION",t)}else{this._ssrPass.setUniform(e,t)}};c.prototype.setPhysicallyCorrect=function(e){if(e){if(!this._normalDistribution){this._normalDistribution=h["a"].generateNormalDistribution(64,this._totalSamples)}this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT");this._ssrPass.material.set("normalDistribution",this._normalDistribution);this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])}else{this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT")}this._physicallyCorrect=e};c.prototype.setSSAOTexture=function(e){var t=this._blurPass2;if(e){t.material.enableTexture("ssaoTex");t.material.set("ssaoTex",e)}else{t.material.disableTexture("ssaoTex")}};c.prototype.isFinished=function(e){if(this._physicallyCorrect){return e>this._totalSamples/this._samplePerFrame}else{return true}};c.prototype.dispose=function(e){this._ssrTexture.dispose(e);this._texture2.dispose(e);this._texture3.dispose(e);this._prevTexture.dispose(e);this._currentTexture.dispose(e);this._frameBuffer.dispose(e)};t["a"]=c},function(e,t,r){"use strict";t["a"]="@export ecgl.ssr.main\n\n#define SHADER_NAME SSR\n#define MAX_ITERATION 20;\n#define SAMPLE_PER_FRAME 5;\n#define TOTAL_SAMPLES 128;\n\nuniform sampler2D sourceTexture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform sampler2D gBufferTexture3;\nuniform samplerCube specularCubemap;\nuniform float specularIntensity: 1;\n\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 toViewSpace;\nuniform mat4 toWorldSpace;\n\nuniform float maxRayDistance: 200;\n\nuniform float pixelStride: 16;\nuniform float pixelStrideZCutoff: 50; \nuniform float screenEdgeFadeStart: 0.9; \nuniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; \nuniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;\n\nuniform float nearZ;\nuniform vec2 viewportSize : VIEWPORT_SIZE;\n\nuniform float jitterOffset: 0;\n\nvarying vec2 v_Texcoord;\n\n#ifdef DEPTH_DECODE\n@import clay.util.decode_float\n#endif\n\n#ifdef PHYSICALLY_CORRECT\nuniform sampler2D normalDistribution;\nuniform float sampleOffset: 0;\nuniform vec2 normalDistributionSize;\n\nvec3 transformNormal(vec3 H, vec3 N) {\n vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\n return transformNormal(H, N);\n}\nfloat G_Smith(float g, float ndv, float ndl) {\n float roughness = 1.0 - g;\n float k = roughness * roughness / 2.0;\n float G1V = ndv / (ndv * (1.0 - k) + k);\n float G1L = ndl / (ndl * (1.0 - k) + k);\n return G1L * G1V;\n}\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n#endif\n\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\n{\n vec4 depthTexel = texture2D(depthTexture, uv);\n return depthTexel.r * 2.0 - 1.0;\n}\n\nfloat linearDepth(float depth)\n{\n if (projection[3][3] == 0.0) {\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n }\n else {\n return (depth - projection[3][2]) / projection[2][2];\n }\n}\n\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\n{\n if (rayZFar > rayZNear)\n {\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n }\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n}\n\n\nbool traceScreenSpaceRay(\n vec3 rayOrigin, vec3 rayDir, float jitter,\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\n)\n{\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\n vec4 H1 = projection * vec4(rayEnd, 1.0);\n\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n vec2 delta = P1 - P0;\n\n bool permute = false;\n if (abs(delta.x) < abs(delta.y)) {\n permute = true;\n delta = delta.yx;\n P0 = P0.yx;\n P1 = P1.yx;\n }\n float stepDir = sign(delta.x);\n float invdx = stepDir / delta.x;\n\n vec3 dQ = (Q1 - Q0) * invdx;\n float dk = (k1 - k0) * invdx;\n\n vec2 dP = vec2(stepDir, delta.y * invdx);\n\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n float pixStride = 1.0 + strideScaler * pixelStride;\n\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n vec4 pqk = vec4(P0, Q0.z, k0);\n vec4 dPQK = vec4(dP, dQ.z, dk);\n\n pqk += dPQK * jitter;\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n float rayZNear;\n\n bool intersect = false;\n\n vec2 texelSize = 1.0 / viewportSize;\n\n iterationCount = 0.0;\n\n for (int i = 0; i < MAX_ITERATION; i++)\n {\n pqk += dPQK;\n\n rayZNear = rayZFar;\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n hitPixel = permute ? pqk.yx : pqk.xy;\n hitPixel *= texelSize;\n\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n iterationCount += 1.0;\n\n dPQK *= 1.2;\n\n if (intersect) {\n break;\n }\n }\n\n Q0.xy += dQ.xy * iterationCount;\n Q0.z = pqk.z;\n hitPoint = Q0 / pqk.w;\n\n return intersect;\n}\n\nfloat calculateAlpha(\n float iterationCount, float reflectivity,\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\n)\n{\n float alpha = clamp(reflectivity, 0.0, 1.0);\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n float _eyeFadeStart = eyeFadeStart;\n float _eyeFadeEnd = eyeFadeEnd;\n if (_eyeFadeStart > _eyeFadeEnd) {\n float tmp = _eyeFadeEnd;\n _eyeFadeEnd = _eyeFadeStart;\n _eyeFadeStart = tmp;\n }\n\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n return alpha;\n}\n\n@import clay.util.rand\n\n@import clay.util.rgbm\n\nvoid main()\n{\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\n\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n discard;\n }\n\n float g = normalAndGloss.a;\n#if !defined(PHYSICALLY_CORRECT)\n if (g <= minGlossiness) {\n discard;\n }\n#endif\n\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\n vec4 pos = projectionInv * projectedPos;\n vec3 rayOrigin = pos.xyz / pos.w;\n vec3 V = -normalize(rayOrigin);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n float iterationCount;\n float jitter = rand(fract(v_Texcoord + jitterOffset));\n\n#ifdef PHYSICALLY_CORRECT\n vec4 color = vec4(vec3(0.0), 1.0);\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\n vec3 albedo = albedoMetalness.rgb;\n float m = albedoMetalness.a;\n vec3 diffuseColor = albedo * (1.0 - m);\n vec3 spec = mix(vec3(0.04), albedo, m);\n\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\n\n for (int i = 0; i < SAMPLE_PER_FRAME; i++) {\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\n vec3 rayDir = normalize(reflect(-V, H));\n#else\n vec3 rayDir = normalize(reflect(-V, N));\n#endif\n vec2 hitPixel;\n vec3 hitPoint;\n\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n float dist = distance(rayOrigin, hitPoint);\n\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\n#ifdef PHYSICALLY_CORRECT\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\n float vdh = clamp(dot(V, H), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n vec3 litTexel = vec3(0.0);\n if (dot(hitNormal, rayDir) < 0.0 && intersect) {\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\n\n }\n else {\n #ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\n#endif\n }\n color.rgb += ndl * litTexel * (\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\n );\n }\n color.rgb /= float(SAMPLE_PER_FRAME);\n#else\n #if !defined(SPECULARCUBEMAP_ENABLED)\n if (dot(hitNormal, rayDir) >= 0.0) {\n discard;\n }\n if (!intersect) {\n discard;\n }\n#endif\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\n vec4 color = texture2D(sourceTexture, hitPixel);\n color.rgb *= alpha;\n\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n alpha = alpha * (intersect ? 1.0 : 0.0);\n float bias = (1.0 -g) * 5.0;\n color.rgb += (1.0 - alpha)\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\n * specularIntensity;\n#endif\n\n#endif\n\n gl_FragColor = encodeHDR(color);\n}\n@end\n\n@export ecgl.ssr.blur\n\nuniform sampler2D texture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\n#ifdef BLEND\n #ifdef SSAOTEX_ENABLED\nuniform sampler2D ssaoTex;\n #endif\nuniform sampler2D sourceTexture;\n#endif\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n\n@import clay.util.rgbm\n\n\nvoid main()\n{\n @import clay.compositor.kernel.gaussian_9\n\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\n float g = centerNTexel.a;\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\n#ifdef VERTICAL\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\n#else\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\n#endif\n\n vec2 coord = v_Texcoord;\n\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\n float cD = getLinearDepth(v_Texcoord);\n for (int i = 0; i < 9; i++) {\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\n float w = gaussianKernel[i]\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\n\n weightAll += w;\n sum += decodeHDR(texture2D(texture, coord)) * w;\n }\n\n#ifdef BLEND\n float aoFactor = 1.0;\n #ifdef SSAOTEX_ENABLED\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\n #endif\n gl_FragColor = encodeHDR(\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\n );\n#else\n gl_FragColor = encodeHDR(sum / weightAll);\n#endif\n}\n\n@end"},function(e,t,r){"use strict";t["a"]=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925]},function(e,t,r){"use strict";var a=r(5);var i=r(4);var n=r(8);var o=r(10);var s=r(19);var u=r(16);var l=r(61);var h=r(195);n["a"].import(h["a"]);function S(e,t,r,a,i){var n=e.gl;t.setUniform(n,"1i",r,i);n.activeTexture(n.TEXTURE0+i);if(a.isRenderable()){a.bind(e)}else{a.unbind(e)}}function f(m,g,_,y,e){var x;var T;var b;var w;var E=m.gl;return function(e,t,r){if(w&&w.material===e.material){return}var a=e.material;var i=e.__program;var n=a.get("roughness");if(n==null){n=1}var o=a.get("normalMap")||g;var s=a.get("roughnessMap");var u=a.get("bumpMap");var l=a.get("uvRepeat");var h=a.get("uvOffset");var f=a.get("detailUvRepeat");var c=a.get("detailUvOffset");var d=!!u&&a.isTextureEnabled("bumpMap");var v=!!s&&a.isTextureEnabled("roughnessMap");var p=a.isDefined("fragment","DOUBLE_SIDED");u=u||_;s=s||y;if(r!==t){t.set("normalMap",o);t.set("bumpMap",u);t.set("roughnessMap",s);t.set("useBumpMap",d);t.set("useRoughnessMap",v);t.set("doubleSide",p);l!=null&&t.set("uvRepeat",l);h!=null&&t.set("uvOffset",h);f!=null&&t.set("detailUvRepeat",f);c!=null&&t.set("detailUvOffset",c);t.set("roughness",n)}else{i.setUniform(E,"1f","roughness",n);if(x!==o){S(m,i,"normalMap",o,0)}if(T!==u&&u){S(m,i,"bumpMap",u,1)}if(b!==s&&s){S(m,i,"roughnessMap",s,2)}if(l!=null){i.setUniform(E,"2f","uvRepeat",l)}if(h!=null){i.setUniform(E,"2f","uvOffset",h)}if(f!=null){i.setUniform(E,"2f","detailUvRepeat",f)}if(c!=null){i.setUniform(E,"2f","detailUvOffset",c)}i.setUniform(E,"1i","useBumpMap",+d);i.setUniform(E,"1i","useRoughnessMap",+v);i.setUniform(E,"1i","doubleSide",+p)}x=o;T=u;b=s;w=e}}function c(e){e=e||{};this._depthTex=new a["a"]({format:i["a"].DEPTH_COMPONENT,type:i["a"].UNSIGNED_INT});this._normalTex=new a["a"]({type:i["a"].HALF_FLOAT});this._framebuffer=new o["a"];this._framebuffer.attach(this._normalTex);this._framebuffer.attach(this._depthTex,o["a"].DEPTH_ATTACHMENT);this._normalMaterial=new s["a"]({shader:new n["a"](n["a"].source("ecgl.normal.vertex"),n["a"].source("ecgl.normal.fragment"))});this._normalMaterial.enableTexture(["normalMap","bumpMap","roughnessMap"]);this._defaultNormalMap=l["a"].createBlank("#000");this._defaultBumpMap=l["a"].createBlank("#000");this._defaultRoughessMap=l["a"].createBlank("#000");this._debugPass=new u["a"]({fragment:n["a"].source("clay.compositor.output")});this._debugPass.setUniform("texture",this._normalTex);this._debugPass.material.undefine("fragment","OUTPUT_ALPHA")}c.prototype.getDepthTexture=function(){return this._depthTex};c.prototype.getNormalTexture=function(){return this._normalTex};c.prototype.update=function(e,t,r){var a=e.getWidth();var i=e.getHeight();var n=this._depthTex;var o=this._normalTex;var s=this._normalMaterial;n.width=a;n.height=i;o.width=a;o.height=i;var u=t.getRenderList(r).opaque;this._framebuffer.bind(e);e.gl.clearColor(0,0,0,0);e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT);e.gl.disable(e.gl.BLEND);e.renderPass(u,r,{getMaterial:function(){return s},ifRender:function(e){return e.renderNormal},beforeRender:f(e,this._defaultNormalMap,this._defaultBumpMap,this._defaultRoughessMap,this._normalMaterial),sort:e.opaqueSortCompare});this._framebuffer.unbind(e)};c.prototype.renderDebug=function(e){this._debugPass.render(e)};c.prototype.dispose=function(e){this._depthTex.dispose(e);this._normalTex.dispose(e)};t["a"]=c},function(e,t,r){"use strict";t["a"]="@export ecgl.normal.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n@import ecgl.common.normalMap.vertexHeader\n\n@import ecgl.common.vertexAnimation.header\n\nvoid main()\n{\n\n @import ecgl.common.vertexAnimation.main\n\n @import ecgl.common.uv.main\n\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n @import ecgl.common.normalMap.vertexMain\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n}\n\n\n@end\n\n\n@export ecgl.normal.fragment\n\n#define ROUGHNESS_CHANEL 0\n\nuniform bool useBumpMap;\nuniform bool useRoughnessMap;\nuniform bool doubleSide;\nuniform float roughness;\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n@import ecgl.common.normalMap.fragmentHeader\n@import ecgl.common.bumpMap.header\n\nuniform sampler2D roughnessMap;\n\nvoid main()\n{\n vec3 N = v_Normal;\n \n bool flipNormal = false;\n if (doubleSide) {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n flipNormal = true;\n }\n }\n\n @import ecgl.common.normalMap.fragmentMain\n\n if (useBumpMap) {\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n }\n\n float g = 1.0 - roughness;\n\n if (useRoughnessMap) {\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n }\n\n if (flipNormal) {\n N = -N;\n }\n\n gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;\n gl_FragColor.a = g;\n}\n@end"},function(e,t,r){"use strict";var a=r(9);var i=r(3);var n=r(5);var o=r(4);var s=r(16);var u=r(8);var l=r(10);function h(e){e=e||{};this._edgePass=new s["a"]({fragment:u["a"].source("ecgl.edge")});this._edgePass.setUniform("normalTexture",e.normalTexture);this._edgePass.setUniform("depthTexture",e.depthTexture);this._targetTexture=new n["a"]({type:o["a"].HALF_FLOAT});this._frameBuffer=new l["a"];this._frameBuffer.attach(this._targetTexture)}h.prototype.update=function(e,t,r,a){var i=e.getWidth();var n=e.getHeight();var o=this._targetTexture;o.width=i;o.height=n;var s=this._frameBuffer;s.bind(e);this._edgePass.setUniform("projectionInv",t.invProjectionMatrix.array);this._edgePass.setUniform("textureSize",[i,n]);this._edgePass.setUniform("texture",r);this._edgePass.render(e);s.unbind(e)};h.prototype.getTargetTexture=function(){return this._targetTexture};h.prototype.setParameter=function(e,t){this._edgePass.setUniform(e,t)};h.prototype.dispose=function(e){this._targetTexture.dispose(e);this._frameBuffer.dispose(e)};t["a"]=h},function(e,t,r){"use strict";t["a"]={type:"compositor",nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]}},function(e,t,r){"use strict";t["a"]="@export ecgl.dof.coc\n\nuniform sampler2D depth;\n\nuniform float zNear: 0.1;\nuniform float zFar: 2000;\n\nuniform float focalDistance: 3;\nuniform float focalRange: 1;\nuniform float focalLength: 30;\nuniform float fstop: 2.8;\n\nvarying vec2 v_Texcoord;\n\n@import clay.util.encode_float\n\nvoid main()\n{\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\n\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\n\n float aperture = focalLength / fstop;\n\n float coc;\n\n float uppper = focalDistance + focalRange;\n float lower = focalDistance - focalRange;\n if (dist <= uppper && dist >= lower) {\n coc = 0.5;\n }\n else {\n float focalAdjusted = dist > uppper ? uppper : lower;\n\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\n\n if (dist < lower) {\n coc = -coc;\n }\n coc = coc * 0.5 + 0.5;\n }\n\n gl_FragColor = encodeFloat(coc);\n}\n@end\n\n\n@export ecgl.dof.composite\n\n#define DEBUG 0\n\nuniform sampler2D original;\nuniform sampler2D blurred;\nuniform sampler2D nearfield;\nuniform sampler2D coc;\nuniform sampler2D nearcoc;\nvarying vec2 v_Texcoord;\n\n@import clay.util.rgbm\n@import clay.util.float\n\nvoid main()\n{\n vec4 blurredColor = texture2D(blurred, v_Texcoord);\n vec4 originalColor = texture2D(original, v_Texcoord);\n\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\n\n fCoc = abs(fCoc * 2.0 - 1.0);\n\n float weight = smoothstep(0.0, 1.0, fCoc);\n \n#ifdef NEARFIELD_ENABLED\n vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\n\n gl_FragColor = encodeHDR(\n mix(\n nearfieldColor, mix(originalColor, blurredColor, weight),\n pow(1.0 - fNearCoc, 4.0)\n )\n );\n#else\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\n#endif\n\n}\n\n@end\n\n\n\n@export ecgl.dof.diskBlur\n\n#define POISSON_KERNEL_SIZE 16;\n\nuniform sampler2D texture;\nuniform sampler2D coc;\nvarying vec2 v_Texcoord;\n\nuniform float blurRadius : 10.0;\nuniform vec2 textureSize : [512.0, 512.0];\n\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\n\nuniform float percent;\n\nfloat nrand(const in vec2 n) {\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n@import clay.util.rgbm\n@import clay.util.float\n\n\nvoid main()\n{\n vec2 offset = blurRadius / textureSize;\n\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\n float cosa = cos(rnd);\n float sina = sin(rnd);\n vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\n#endif\n\n#ifdef BLUR_COC\n float cocSum = 0.0;\n#else\n vec4 color = vec4(0.0);\n#endif\n\n\n float weightSum = 0.0;\n\n for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {\n vec2 ofs = poissonKernel[i];\n\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\n\n vec2 uv = v_Texcoord + ofs * offset;\n vec4 texel = texture2D(texture, uv);\n\n float w = 1.0;\n#ifdef BLUR_COC\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\n#else\n texel = texel;\n #if !defined(BLUR_NEARFIELD)\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\n w *= abs(fCoc);\n #endif\n texel.rgb *= texel.a;\n color += texel * w;\n#endif\n\n weightSum += w;\n }\n\n#ifdef BLUR_COC\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\n#else\n color /= weightSum;\n color.rgb /= (color.a + 0.0001);\n gl_FragColor = color;\n#endif\n}\n\n@end"},function(e,t,r){"use strict";t["a"]="@export ecgl.edge\n\nuniform sampler2D texture;\n\nuniform sampler2D normalTexture;\nuniform sampler2D depthTexture;\n\nuniform mat4 projectionInv;\n\nuniform vec2 textureSize;\n\nuniform vec4 edgeColor: [0,0,0,0.8];\n\nvarying vec2 v_Texcoord;\n\nvec3 packColor(vec2 coord) {\n float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;\n vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * p;\n\n return vec3(\n texture2D(normalTexture, coord).rg,\n -p4.z / p4.w / 5.0\n );\n}\n\nvoid main() {\n vec2 cc = v_Texcoord;\n vec3 center = packColor(cc);\n\n float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;\n float dx = size / textureSize.x;\n float dy = size / textureSize.y;\n\n vec2 coord;\n vec3 topLeft = packColor(cc+vec2(-dx, -dy));\n vec3 top = packColor(cc+vec2(0.0, -dy));\n vec3 topRight = packColor(cc+vec2(dx, -dy));\n vec3 left = packColor(cc+vec2(-dx, 0.0));\n vec3 right = packColor(cc+vec2(dx, 0.0));\n vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\n vec3 bottom = packColor(cc+vec2(0.0, dy));\n vec3 bottomRight = packColor(cc+vec2(dx, dy));\n\n vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n float edge = sqrt(dot(h, h) + dot(v, v));\n\n edge = smoothstep(0.8, 1.0, edge);\n\n gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\n}\n@end"},function(e,t,r){"use strict";var i=r(49);var n=r(16);var o=r(10);var s=r(5);var u=r(8);var l=r(9);function a(e){var t=[];for(var r=0;r<30;r++){t.push([Object(i["a"])(r,2),Object(i["a"])(r,3)])}this._haltonSequence=t;this._frame=0;this._sourceTex=new s["a"];this._sourceFb=new o["a"];this._sourceFb.attach(this._sourceTex);this._prevFrameTex=new s["a"];this._outputTex=new s["a"];var a=this._blendPass=new n["a"]({fragment:u["a"].source("clay.compositor.blend")});a.material.disableTexturesAll();a.material.enableTexture(["texture1","texture2"]);this._blendFb=new o["a"]({depthBuffer:false});this._outputPass=new n["a"]({fragment:u["a"].source("clay.compositor.output"),blendWithPrevious:true});this._outputPass.material.define("fragment","OUTPUT_ALPHA");this._outputPass.material.blend=function(e){e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}}a.prototype={constructor:a,jitterProjection:function(e,t){var r=e.viewport;var a=r.devicePixelRatio||e.getDevicePixelRatio();var i=r.width*a;var n=r.height*a;var o=this._haltonSequence[this._frame%this._haltonSequence.length];var s=new l["a"];s.array[12]=(o[0]*2-1)/i;s.array[13]=(o[1]*2-1)/n;l["a"].mul(t.projectionMatrix,s,t.projectionMatrix);l["a"].invert(t.invProjectionMatrix,t.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(e,t){this._prevFrameTex.width=e;this._prevFrameTex.height=t;this._outputTex.width=e;this._outputTex.height=t;this._sourceTex.width=e;this._sourceTex.height=t;this._prevFrameTex.dirty();this._outputTex.dirty();this._sourceTex.dirty()},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(e,t,r){var a=this._blendPass;if(this._frame===0){a.setUniform("weight1",0);a.setUniform("weight2",1)}else{a.setUniform("weight1",.9);a.setUniform("weight2",.1)}a.setUniform("texture1",this._prevFrameTex);a.setUniform("texture2",t||this._sourceTex);this._blendFb.attach(this._outputTex);this._blendFb.bind(e);a.render(e);this._blendFb.unbind(e);if(!r){this._outputPass.setUniform("texture",this._outputTex);this._outputPass.render(e)}var i=this._prevFrameTex;this._prevFrameTex=this._outputTex;this._outputTex=i;this._frame++},dispose:function(e){this._sourceFb.dispose(e);this._blendFb.dispose(e);this._prevFrameTex.dispose(e);this._outputTex.dispose(e);this._sourceTex.dispose(e);this._outputPass.dispose(e);this._blendPass.dispose(e)}};t["a"]=a},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(202);var o=r(203);var s=r(98);i.a.registerAction({type:"geo3DChangeCamera",event:"geo3dcamerachanged",update:"series:updateCamera"},function(t,e){e.eachComponent({mainType:"geo3D",query:t},function(e){e.setView(t)})})},function(e,t,r){"use strict";var a=r(0);var n=r.n(a);var i=r(44);var o=r(28);var s=r(29);var u=r(31);var l=r(96);var h=n.a.extendComponentModel({type:"geo3D",layoutMode:"box",coordinateSystem:null,optionUpdated:function(){var e=this.option;e.regions=this.getFilledRegions(e.regions,e.map);var t=n.a.helper.completeDimensions(["value"],e.data,{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")});var a=new n.a.List(t,this);a.initData(e.regions);var i={};a.each(function(e){var t=a.getName(e);var r=a.getItemModel(e);i[t]=r});this._regionModelMap=i;this._data=a},getData:function(){return this._data},getRegionModel:function(e){var t=this.getData().getName(e);return this._regionModelMap[t]||new n.a.Model(null,this)},getRegionPolygonCoords:function(e){var t=this.getData().getName(e);var r=this.coordinateSystem.getRegion(t);return r?r.geometries:[]},getFormattedLabel:function(e,t){var r=this._data.getName(e);var a=this.getRegionModel(r);var i=a.get(t==="normal"?["label","formatter"]:["emphasis","label","formatter"]);if(i==null){i=a.get(["label","formatter"])}var n={name:r};if(typeof i==="function"){n.status=t;return i(n)}else if(typeof i==="string"){var o=n.seriesName;return i.replace("{a}",o!=null?o:"")}else{return r}},defaultOption:{regions:[]}});n.a.util.merge(h.prototype,l["a"]);n.a.util.merge(h.prototype,i["a"]);n.a.util.merge(h.prototype,o["a"]);n.a.util.merge(h.prototype,s["a"]);n.a.util.merge(h.prototype,u["a"]);var f=h},function(e,t,r){"use strict";var a=r(64);var i=r(0);var n=r.n(i);var o=r(1);var s=r(45);var u=r(30);var l=n.a.extendComponentView({type:"geo3D",__ecgl__:true,init:function(e,t){this._geo3DBuilder=new a["a"](t);this.groupGL=new o["a"].Node;this._lightRoot=new o["a"].Node;this._sceneHelper=new u["a"](this._lightRoot);this._sceneHelper.initLight(this._lightRoot);this._control=new s["a"]({zr:t.getZr()});this._control.init()},render:function(e,t,r){this.groupGL.add(this._geo3DBuilder.rootNode);var a=e.coordinateSystem;if(!a||!a.viewGL){return}a.viewGL.add(this._lightRoot);if(e.get("show")){a.viewGL.add(this.groupGL)}else{a.viewGL.remove(this.groupGL)}var i=this._control;i.setViewGL(a.viewGL);var n=e.getModel("viewControl");i.setFromViewControlModel(n,0);this._sceneHelper.setScene(a.viewGL.scene);this._sceneHelper.updateLight(e);a.viewGL.setPostEffect(e.getModel("postEffect"),r);a.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));this._geo3DBuilder.update(e,t,r,0,e.getData().count());var o=a.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(e){if(e.material){e.material[o]("fragment","SRGB_DECODE")}});i.off("update");i.on("update",function(){r.dispatchAction({type:"geo3DChangeCamera",alpha:i.getAlpha(),beta:i.getBeta(),distance:i.getDistance(),center:i.getCenter(),from:this.uid,geo3DId:e.id})});i.update()},afterRender:function(e,t,r,a){var i=a.renderer;this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r)},dispose:function(){this._control.dispose()}})},function(e,t,r){"use strict";t["a"]=a;function a(e,t,r){r=r||2;var a=t&&t.length,i=a?t[0]*r:e.length,n=p(e,0,i,r,true),o=[];if(!n)return o;var s,u,l,h,f,c,d;if(a)n=g(e,t,n,r);if(e.length>80*r){s=l=e[0];u=h=e[1];for(var v=r;v<i;v+=r){f=e[v];c=e[v+1];if(f<s)s=f;if(c<u)u=c;if(f>l)l=f;if(c>h)h=c}d=Math.max(l-s,h-u)}m(n,o,r,s,u,d);return o}function p(e,t,r,a,i){var n,o;if(i===N(e,t,r,a)>0){for(n=t;n<r;n+=a)o=C(n,e[n],e[n+1],o)}else{for(n=r-a;n>=t;n-=a)o=C(n,e[n],e[n+1],o)}if(o&&s(o,o.next)){L(o);o=o.next}return o}function h(e,t){if(!e)return e;if(!t)t=e;var r=e,a;do{a=false;if(!r.steiner&&(s(r,r.next)||E(r.prev,r,r.next)===0)){L(r);r=t=r.prev;if(r===r.next)return null;a=true}else{r=r.next}}while(a||r!==t);return t}function m(e,t,r,a,i,n,o){if(!e)return;if(!o&&n)x(e,a,i,n);var s=e,u,l;while(e.prev!==e.next){u=e.prev;l=e.next;if(n?c(e,a,i,n):f(e)){t.push(u.i/r);t.push(e.i/r);t.push(l.i/r);L(e);e=l.next;s=l.next;continue}e=l;if(e===s){if(!o){m(h(e),t,r,a,i,n,1)}else if(o===1){e=d(e,t,r);m(e,t,r,a,i,n,2)}else if(o===2){v(e,t,r,a,i,n)}break}}}function f(e){var t=e.prev,r=e,a=e.next;if(E(t,r,a)>=0)return false;var i=e.next.next;while(i!==e.prev){if(w(t.x,t.y,r.x,r.y,a.x,a.y,i.x,i.y)&&E(i.prev,i,i.next)>=0)return false;i=i.next}return true}function c(e,t,r,a){var i=e.prev,n=e,o=e.next;if(E(i,n,o)>=0)return false;var s=i.x<n.x?i.x<o.x?i.x:o.x:n.x<o.x?n.x:o.x,u=i.y<n.y?i.y<o.y?i.y:o.y:n.y<o.y?n.y:o.y,l=i.x>n.x?i.x>o.x?i.x:o.x:n.x>o.x?n.x:o.x,h=i.y>n.y?i.y>o.y?i.y:o.y:n.y>o.y?n.y:o.y;var f=T(s,u,t,r,a),c=T(l,h,t,r,a);var d=e.nextZ;while(d&&d.z<=c){if(d!==e.prev&&d!==e.next&&w(i.x,i.y,n.x,n.y,o.x,o.y,d.x,d.y)&&E(d.prev,d,d.next)>=0)return false;d=d.nextZ}d=e.prevZ;while(d&&d.z>=f){if(d!==e.prev&&d!==e.next&&w(i.x,i.y,n.x,n.y,o.x,o.y,d.x,d.y)&&E(d.prev,d,d.next)>=0)return false;d=d.prevZ}return true}function d(e,t,r){var a=e;do{var i=a.prev,n=a.next.next;if(!s(i,n)&&o(i,a,a.next,n)&&S(i,n)&&S(n,i)){t.push(i.i/r);t.push(a.i/r);t.push(n.i/r);L(a);L(a.next);a=e=n}a=a.next}while(a!==e);return a}function v(e,t,r,a,i,n){var o=e;do{var s=o.next.next;while(s!==o.prev){if(o.i!==s.i&&l(o,s)){var u=M(o,s);o=h(o,o.next);u=h(u,u.next);m(o,t,r,a,i,n);m(u,t,r,a,i,n);return}s=s.next}o=o.next}while(o!==e)}function g(e,t,r,a){var i=[],n,o,s,u,l;for(n=0,o=t.length;n<o;n++){s=t[n]*a;u=n<o-1?t[n+1]*a:e.length;l=p(e,s,u,a,false);if(l===l.next)l.steiner=true;i.push(b(l))}i.sort(_);for(n=0;n<i.length;n++){y(i[n],r);r=h(r,r.next)}return r}function _(e,t){return e.x-t.x}function y(e,t){t=i(e,t);if(t){var r=M(t,e);h(r,r.next)}}function i(e,t){var r=t,a=e.x,i=e.y,n=-Infinity,o;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=a&&s>n){n=s;if(s===a){if(i===r.y)return r;if(i===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(a===n)return o.prev;var u=o,l=o.x,h=o.y,f=Infinity,c;r=o.next;while(r!==u){if(a>=r.x&&r.x>=l&&a!==r.x&&w(i<h?a:n,i,l,h,i<h?n:a,i,r.x,r.y)){c=Math.abs(i-r.y)/(a-r.x);if((c<f||c===f&&r.x>o.x)&&S(r,e)){o=r;f=c}}r=r.next}return o}function x(e,t,r,a){var i=e;do{if(i.z===null)i.z=T(i.x,i.y,t,r,a);i.prevZ=i.prev;i.nextZ=i.next;i=i.next}while(i!==e);i.prevZ.nextZ=null;i.prevZ=null;n(i)}function n(e){var t,r,a,i,n,o,s,u,l=1;do{r=e;e=null;n=null;o=0;while(r){o++;a=r;s=0;for(t=0;t<l;t++){s++;a=a.nextZ;if(!a)break}u=l;while(s>0||u>0&&a){if(s!==0&&(u===0||!a||r.z<=a.z)){i=r;r=r.nextZ;s--}else{i=a;a=a.nextZ;u--}if(n)n.nextZ=i;else e=i;i.prevZ=n;n=i}r=a}n.nextZ=null;l*=2}while(o>1);return e}function T(e,t,r,a,i){e=32767*(e-r)/i;t=32767*(t-a)/i;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;return e|t<<1}function b(e){var t=e,r=e;do{if(t.x<r.x)r=t;t=t.next}while(t!==e);return r}function w(e,t,r,a,i,n,o,s){return(i-o)*(t-s)-(e-o)*(n-s)>=0&&(e-o)*(a-s)-(r-o)*(t-s)>=0&&(r-o)*(n-s)-(i-o)*(a-s)>=0}function l(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!u(e,t)&&S(e,t)&&S(t,e)&&A(e,t)}function E(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function s(e,t){return e.x===t.x&&e.y===t.y}function o(e,t,r,a){if(s(e,t)&&s(r,a)||s(e,a)&&s(r,t))return true;return E(e,t,r)>0!==E(e,t,a)>0&&E(r,a,e)>0!==E(r,a,t)>0}function u(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&o(r,r.next,e,t))return true;r=r.next}while(r!==e);return false}function S(e,t){return E(e.prev,e,e.next)<0?E(e,t,e.next)>=0&&E(e,e.prev,t)>=0:E(e,t,e.prev)<0||E(e,e.next,t)<0}function A(e,t){var r=e,a=false,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{if(r.y>n!==r.next.y>n&&r.next.y!==r.y&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x)a=!a;r=r.next}while(r!==e);return a}function M(e,t){var r=new D(e.i,e.x,e.y),a=new D(t.i,t.x,t.y),i=e.next,n=t.prev;e.next=t;t.prev=e;r.next=i;i.prev=r;a.next=r;r.prev=a;n.next=a;a.prev=n;return a}function C(e,t,r,a){var i=new D(e,t,r);if(!a){i.prev=i;i.next=i}else{i.next=a.next;i.prev=a;a.next.prev=i;a.next=i}return i}function L(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function D(e,t,r){this.i=e;this.x=t;this.y=r;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}a.deviation=function(e,t,r,a){var i=t&&t.length;var n=i?t[0]*r:e.length;var o=Math.abs(N(e,0,n,r));if(i){for(var s=0,u=t.length;s<u;s++){var l=t[s]*r;var h=s<u-1?t[s+1]*r:e.length;o-=Math.abs(N(e,l,h,r))}}var f=0;for(s=0;s<a.length;s+=3){var c=a[s]*r;var d=a[s+1]*r;var v=a[s+2]*r;f+=Math.abs((e[c]-e[v])*(e[d+1]-e[c+1])-(e[c]-e[d])*(e[v+1]-e[c+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function N(e,t,r,a){var i=0;for(var n=t,o=r-a;n<r;n+=a){i+=(e[o]-e[n])*(e[n+1]+e[o+1]);o=n}return i}},function(e,t,r){var a=r(13);var i={"":[32,80],"":[0,-10],"":[10,5],"":[-10,10],"":[5,5]};function n(e){a.each(e.regions,function(e){var t=i[e.name];if(t){var r=e.center;r[0]+=t[0]/10.5;r[1]+=-t[1]/(10.5/.75)}})}e.exports=n},function(e,t,r){var a=r(13);var i={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};function n(e){a.each(e.regions,function(e){var t=i[e.name];if(t){var r=e.center;r[0]=t[0];r[1]=t[1]}})}e.exports=n},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(208);var o=r(209);var s=r(211);i.a.registerAction({type:"globeChangeCamera",event:"globecamerachanged",update:"series:updateCamera"},function(t,e){e.eachComponent({mainType:"globe",query:t},function(e){e.setView(t)})});i.a.registerAction({type:"globeUpdateDisplacment",event:"globedisplacementupdated",update:"update"},function(e,t){})},function(e,t,r){"use strict";var a=r(0);var o=r.n(a);var i=r(44);var n=r(28);var s=r(29);var u=r(31);function l(e,t){e.id=e.id||e.name||t+""}var h=o.a.extendComponentModel({type:"globe",layoutMode:"box",coordinateSystem:null,init:function(){h.superApply(this,"init",arguments);o.a.util.each(this.option.layers,function(e,t){o.a.util.merge(e,this.defaultLayerOption);l(e,t)},this)},mergeOption:function(e){var t=this.option.layers;this.option.layers=null;h.superApply(this,"mergeOption",arguments);function r(e){return o.a.util.reduce(e,function(e,t,r){l(t,r);e[t.id]=t;return e},{})}if(t&&t.length){var a=r(e.layers);var i=r(t);for(var n in a){if(i[n]){o.a.util.merge(i[n],a[n],true)}else{t.push(e.layers[n])}}this.option.layers=t}o.a.util.each(this.option.layers,function(e){o.a.util.merge(e,this.defaultLayerOption)},this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:true,type:"overlay"},defaultOption:{show:true,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",baseColor:"#fff",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,displacementQuality:"medium",globeRadius:100,globeOuterRadius:150,shading:"lambert",light:{main:{time:""}},viewControl:{autoRotate:true,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(e,t,r){this.displacementData=e;this.displacementWidth=t;this.displacementHeight=r},getDisplacementTexture:function(){return this.get("displacementTexture")||this.get("heightTexture")},getDisplacemenScale:function(){var e=this.getDisplacementTexture();var t=this.get("displacementScale");if(!e||e==="none"){t=0}return t},hasDisplacement:function(){return this.getDisplacemenScale()>0},_displacementChanged:true,_displacementScale:0,updateDisplacementHash:function(){var e=this.getDisplacementTexture();var t=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==e||this._displacementScale!==t;this._displacementTexture=e;this._displacementScale=t},isDisplacementChanged:function(){return this._displacementChanged}});o.a.util.merge(h.prototype,i["a"]);o.a.util.merge(h.prototype,n["a"]);o.a.util.merge(h.prototype,s["a"]);o.a.util.merge(h.prototype,u["a"]);var f=h},function(e,t,r){"use strict";var a=r(0);var y=r.n(a);var x=r(1);var i=r(45);var n=r(30);var s=r(210);var T=r(2);var o=y.a.extendComponentView({type:"globe",__ecgl__:true,_displacementScale:0,init:function(e,t){this.groupGL=new x["a"].Node;this._sphereGeometry=new x["a"].SphereGeometry({widthSegments:200,heightSegments:100,dynamic:true});this._overlayGeometry=new x["a"].SphereGeometry({widthSegments:80,heightSegments:40});this._planeGeometry=new x["a"].PlaneGeometry;this._earthMesh=new x["a"].Mesh({renderNormal:true});this._lightRoot=new x["a"].Node;this._sceneHelper=new n["a"];this._sceneHelper.initLight(this._lightRoot);this.groupGL.add(this._earthMesh);this._control=new i["a"]({zr:t.getZr()});this._control.init();this._layerMeshes={}},render:function(e,t,r){var a=e.coordinateSystem;var i=e.get("shading");a.viewGL.add(this._lightRoot);if(e.get("show")){a.viewGL.add(this.groupGL)}else{a.viewGL.remove(this.groupGL)}this._sceneHelper.setScene(a.viewGL.scene);a.viewGL.setPostEffect(e.getModel("postEffect"),r);a.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));var n=this._earthMesh;n.geometry=this._sphereGeometry;var o="ecgl."+i;if(!n.material||n.material.shader.name!==o){n.material=x["a"].createMaterial(o)}x["a"].setMaterialFromModel(i,n.material,e,r);["roughnessMap","metalnessMap","detailMap","normalMap"].forEach(function(e){var t=n.material.get(e);if(t){t.flipY=false}});n.material.set("color",x["a"].parseColor(e.get("baseColor")));var s=a.radius*.99;n.scale.set(s,s,s);var u=n.material.setTextureImage("diffuseMap",e.get("baseTexture"),r,{flipY:false,anisotropic:8});if(u&&u.surface){u.surface.attachToMesh(n)}var l=n.material.setTextureImage("bumpMap",e.get("heightTexture"),r,{flipY:false,anisotropic:8});if(l&&l.surface){l.surface.attachToMesh(n)}n.material[e.get("postEffect.enable")?"define":"undefine"]("fragment","SRGB_DECODE");this._updateLight(e,r);this._displaceVertices(e,r);this._updateViewControl(e,r);this._updateLayers(e,r)},afterRender:function(e,t,r,a){var i=a.renderer;this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r)},_updateLayers:function(e,c){var d=e.coordinateSystem;var t=e.get("layers");var v=d.radius;var p=[];var m=[];var g=[];var _=[];y.a.util.each(t,function(e){var t=new y.a.Model(e);var r=t.get("type");var a=x["a"].loadTexture(t.get("texture"),c,{flipY:false,anisotropic:8});if(a.surface){a.surface.attachToMesh(this._earthMesh)}if(r==="blend"){var i=t.get("blendTo");var n=T["a"].firstNotNull(t.get("intensity"),1);if(i==="emission"){g.push(a);_.push(n)}else{p.push(a);m.push(n)}}else{var o=t.get("id");var s=this._layerMeshes[o];if(!s){s=this._layerMeshes[o]=new x["a"].Mesh({geometry:this._overlayGeometry,castShadow:false,ignorePicking:true})}var u=t.get("shading");if(u==="lambert"){s.material=s.__lambertMaterial||new x["a"].Material({autoUpdateTextureStatus:false,shader:x["a"].createShader("ecgl.lambert"),transparent:true,depthMask:false});s.__lambertMaterial=s.material}else{s.material=s.__colorMaterial||new x["a"].Material({autoUpdateTextureStatus:false,shader:x["a"].createShader("ecgl.color"),transparent:true,depthMask:false});s.__colorMaterial=s.material}s.material.enableTexture("diffuseMap");var l=t.get("distance");var h=v+(l==null?d.radius/100:l);s.scale.set(h,h,h);v=h;var f=this._blankTexture||(this._blankTexture=x["a"].createBlankTexture("rgba(255, 255, 255, 0)"));s.material.set("diffuseMap",f);x["a"].loadTexture(t.get("texture"),c,{flipY:false,anisotropic:8},function(e){if(e.surface){e.surface.attachToMesh(s)}s.material.set("diffuseMap",e);c.getZr().refresh()});t.get("show")?this.groupGL.add(s):this.groupGL.remove(s)}},this);var r=this._earthMesh.material;r.define("fragment","LAYER_DIFFUSEMAP_COUNT",p.length);r.define("fragment","LAYER_EMISSIVEMAP_COUNT",g.length);r.set("layerDiffuseMap",p);r.set("layerDiffuseIntensity",m);r.set("layerEmissiveMap",g);r.set("layerEmissionIntensity",_);var a=e.getModel("debug.wireframe");if(a.get("show")){r.define("both","WIREFRAME_TRIANGLE");var i=x["a"].parseColor(a.get("lineStyle.color")||"rgba(0,0,0,0.5)");var n=T["a"].firstNotNull(a.get("lineStyle.width"),1);r.set("wireframeLineWidth",n);r.set("wireframeLineColor",i)}else{r.undefine("both","WIREFRAME_TRIANGLE")}},_updateViewControl:function(e,t){var r=e.coordinateSystem;var a=e.getModel("viewControl");var i=r.viewGL.camera;var n=this;function o(){return{type:"globeChangeCamera",alpha:s.getAlpha(),beta:s.getBeta(),distance:s.getDistance()-r.radius,center:s.getCenter(),from:n.uid,globeId:e.id}}var s=this._control;s.setViewGL(r.viewGL);var u=a.get("targetCoord");var l,h;if(u!=null){h=u[0]+90;l=u[1]}s.setFromViewControlModel(a,{baseDistance:r.radius,alpha:l,beta:h});s.off("update");s.on("update",function(){t.dispatchAction(o())})},_displaceVertices:function(e,t){var r=e.get("displacementQuality");var a=e.get("debug.wireframe.show");var i=e.coordinateSystem;if(!e.isDisplacementChanged()&&r===this._displacementQuality&&a===this._showDebugWireframe){return}this._displacementQuality=r;this._showDebugWireframe=a;var n=this._sphereGeometry;var o={low:100,medium:200,high:400,ultra:800}[r]||200;var s=o/2;if(n.widthSegments!==o||a){n.widthSegments=o;n.heightSegments=s;n.build()}this._doDisplaceVertices(n,i);if(a){n.generateBarycentric()}},_doDisplaceVertices:function(e,t){var r=e.attributes.position.value;var a=e.attributes.texcoord0.value;var i=e.__originalPosition;if(!i||i.length!==r.length){i=new Float32Array(r.length);i.set(r);e.__originalPosition=i}var n=t.displacementWidth;var o=t.displacementHeight;var s=t.displacementData;for(var u=0;u<e.vertexCount;u++){var l=u*3;var h=u*2;var f=i[l+1];var c=i[l+2];var d=i[l+3];var v=a[h++];var p=a[h++];var m=Math.round(v*(n-1));var g=Math.round(p*(o-1));var _=g*n+m;var y=s?s[_]:0;r[l+1]=f+f*y;r[l+2]=c+c*y;r[l+3]=d+d*y}e.generateVertexNormals();e.dirty();e.updateBoundingBox()},_updateLight:function(e,t){var r=this._earthMesh;this._sceneHelper.updateLight(e);var a=this._sceneHelper.mainLight;var i=e.get("light.main.time")||new Date;var n=s["a"].getPosition(y.a.number.parseDate(i),0,0);var o=Math.cos(n.altitude);a.position.y=-o*Math.cos(n.azimuth);a.position.x=Math.sin(n.altitude);a.position.z=o*Math.sin(n.azimuth);a.lookAt(r.getWorldPosition())},dispose:function(e,t){this.groupGL.removeAll();this._control.dispose()}})},function(e,t,r){"use strict";var a=Math.PI,i=Math.sin,n=Math.cos,o=Math.tan,s=Math.asin,u=Math.atan2,l=a/180;var h=1e3*60*60*24,f=2440588,c=2451545;function d(e){return e.valueOf()/h-.5+f}function v(e){return d(e)-c}var p=l*23.4397;function m(e,t){return u(i(e)*n(p)-o(t)*i(p),n(e))}function g(e,t){return s(i(t)*n(p)+n(t)*i(p)*i(e))}function _(e,t,r){return u(i(e),n(e)*i(t)-o(r)*n(t))}function y(e,t,r){return s(i(t)*i(r)+n(t)*n(r)*n(e))}function x(e,t){return l*(280.16+360.9856235*e)-t}function T(e){return l*(357.5291+.98560028*e)}function b(e){var t=l*(1.9148*i(e)+.02*i(2*e)+3e-4*i(3*e)),r=l*102.9372;return e+t+r+a}function w(e){var t=T(e),r=b(t);return{dec:g(r,0),ra:m(r,0)}}var E={};E.getPosition=function(e,t,r){var a=l*-r,i=l*t,n=v(e),o=w(n),s=x(n,a)-o.ra;return{azimuth:_(s,i,o.dec),altitude:y(s,i,o.dec)}};t["a"]=E},function(e,t,r){"use strict";var i=r(212);var a=r(0);var o=r.n(a);var n=r(47);var s=r.n(n);var u=r(22);var l=r(2);var h=r(1);function f(e,t){var r=document.createElement("canvas");var a=r.getContext("2d");var i=e.width;var n=e.height;r.width=i;r.height=n;a.drawImage(e,0,0,i,n);var o=a.getImageData(0,0,i,n).data;var s=new Float32Array(o.length/4);for(var u=0;u<o.length/4;u++){var l=o[u*4];s[u]=l/255*t}return{data:s,width:i,height:n}}function c(e,t){var r=e.getBoxLayoutParams();var a=s.a.getLayoutRect(r,{width:t.getWidth(),height:t.getHeight()});a.y=t.getHeight()-a.y-a.height;this.viewGL.setViewport(a.x,a.y,a.width,a.height,t.getDevicePixelRatio());this.radius=e.get("globeRadius");var i=e.get("globeOuterRadius");if(this.altitudeAxis){this.altitudeAxis.setExtent(0,i-this.radius)}}function d(e,t){var n=[Infinity,-Infinity];e.eachSeries(function(e){if(e.coordinateSystem!==this){return}var t=e.getData();var r=e.coordDimToDataDim("alt");var a=r&&r[0];if(a){var i=t.getDataExtent(a,true);n[0]=Math.min(n[0],i[0]);n[1]=Math.max(n[1],i[1])}},this);if(n&&isFinite(n[1]-n[0])){var r=o.a.helper.createScale(n,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new o.a.Axis("altitude",r);this.resize(this.model,t)}}var v={dimensions:i["a"].prototype.dimensions,create:function(a,o){var r=[];a.eachComponent("globe",function(e){e.__viewGL=e.__viewGL||new u["a"];var t=new i["a"];t.viewGL=e.__viewGL;e.coordinateSystem=t;t.model=e;r.push(t);t.resize=c;t.resize(e,o);t.update=d});a.eachSeries(function(e){if(e.get("coordinateSystem")==="globe"){var t=e.getReferringComponents("globe")[0];if(!t){t=a.getComponent("globe")}if(!t){throw new Error('globe "'+l["a"].firstNotNull(e.get("globe3DIndex"),e.get("globe3DId"),0)+'" not found')}var r=t.coordinateSystem;e.coordinateSystem=r}});a.eachComponent("globe",function(a,e){var t=a.coordinateSystem;var r=a.getDisplacementTexture();var i=a.getDisplacemenScale();if(a.isDisplacementChanged()){if(a.hasDisplacement()){var n=true;h["a"].loadTexture(r,o,function(e){var t=e.image;var r=f(t,i);a.setDisplacementData(r.data,r.width,r.height);if(!n){o.dispatchAction({type:"globeUpdateDisplacment"})}});n=false}else{t.setDisplacementData(null,0,0)}t.setDisplacementData(a.displacementData,a.displacementWidth,a.displacementHeight)}});return r}};o.a.registerCoordinateSystem("globe",v);var p=v},function(e,t,r){"use strict";var a=r(6);var h=a["a"].vec3;function i(e){this.radius=e;this.viewGL=null;this.altitudeAxis;this.displacementData=null;this.displacementWidth;this.displacementHeight}i.prototype={constructor:i,dimensions:["lng","lat","alt"],type:"globe",containPoint:function(){},setDisplacementData:function(e,t,r){this.displacementData=e;this.displacementWidth=t;this.displacementHeight=r},_getDisplacementScale:function(e,t){var r=(e+180)/360*(this.displacementWidth-1);var a=(90-t)/180*(this.displacementHeight-1);var i=Math.round(r)+Math.round(a)*this.displacementWidth;return this.displacementData[i]},dataToPoint:function(e,t){var r=e[0];var a=e[1];var i=e[2]||0;var n=this.radius;if(this.displacementData){n*=1+this._getDisplacementScale(r,a)}if(this.altitudeAxis){n+=this.altitudeAxis.dataToCoord(i)}r=r*Math.PI/180;a=a*Math.PI/180;var o=Math.cos(a)*n;t=t||[];t[0]=-o*Math.cos(r+Math.PI);t[1]=Math.sin(a)*n;t[2]=o*Math.sin(r+Math.PI);return t},pointToData:function(e,t){var r=e[0];var a=e[1];var i=e[2];var n=h.len(e);r/=n;a/=n;i/=n;var o=Math.asin(a);var s=Math.atan2(i,-r);if(s<0){s=Math.PI*2+s}var u=o*180/Math.PI;var l=s*180/Math.PI-180;t=t||[];t[0]=l;t[1]=u;t[2]=n-this.radius;if(this.altitudeAxis){t[2]=this.altitudeAxis.coordToData(t[2])}return t}};t["a"]=i},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(214);var o=r(216);var s=r(217);i.a.registerAction({type:"mapbox3DChangeCamera",event:"mapbox3dcamerachanged",update:"mapbox3D:updateCamera"},function(t,e){e.eachComponent({mainType:"mapbox3D",query:t},function(e){e.setMapboxCameraOption(t)})})},function(e,t,r){"use strict";var a=r(215);var i=r(0);var n=r.n(i);var o=r(101);var s=Object(o["a"])("mapbox3D",a["a"],function(e){e.forEach(function(e){e.setCameraOption(e.model.getMapboxCameraOption())})});n.a.registerCoordinateSystem("mapbox3D",s);var u=s},function(e,t,r){"use strict";var a=r(100);function i(){a["a"].apply(this,arguments)}i.prototype=new a["a"];i.prototype.constructor=i;i.prototype.type="mapbox3D";t["a"]=i},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(28);var o=r(29);var s=["zoom","center","pitch","bearing"];var u=i.a.extendComponentModel({type:"mapbox3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,style:"mapbox://styles/mapbox/light-v9",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMapboxCameraOption:function(){var r=this;return s.reduce(function(e,t){e[t]=r.get(t);return e},{})},setMapboxCameraOption:function(t){if(t!=null){s.forEach(function(e){if(t[e]!=null){this.option[e]=t[e]}},this)}},getMapbox:function(){return this._mapbox},setMapbox:function(e){this._mapbox=e}});i.a.util.merge(u.prototype,n["a"]);i.a.util.merge(u.prototype,o["a"]);var l=u},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(218);var o=r(30);var u=r(1);var s=r(102);u["a"].Shader.import(s["a"]);var l=512;var h=i.a.extendComponentView({type:"mapbox3D",__ecgl__:true,init:function(e,t){var r=t.getZr();this._zrLayer=new n["a"]("mapbox3D",r);r.painter.insertLayer(-1e3,this._zrLayer);this._lightRoot=new u["a"].Node;this._sceneHelper=new o["a"](this._lightRoot);this._sceneHelper.initLight(this._lightRoot);var a=this._zrLayer.getMapbox();var i=this._dispatchInteractAction.bind(this,t,a);["zoom","rotate","drag","pitch","rotate","move"].forEach(function(e){a.on(e,i)});this._groundMesh=new u["a"].Mesh({geometry:new u["a"].PlaneGeometry,material:new u["a"].Material({shader:new u["a"].Shader({vertex:u["a"].Shader.source("ecgl.displayShadow.vertex"),fragment:u["a"].Shader.source("ecgl.displayShadow.fragment")}),depthMask:false}),renderOrder:-100,culling:false,castShadow:false,$ignorePicking:true,renderNormal:true})},render:function(e,t,r){var a=this._zrLayer.getMapbox();var i=e.get("style");var n=JSON.stringify(i);if(n!==this._oldStyleStr){if(i){a.setStyle(i)}}this._oldStyleStr=n;a.setCenter(e.get("center"));a.setZoom(e.get("zoom"));a.setPitch(e.get("pitch"));a.setBearing(e.get("bearing"));e.setMapbox(a);var o=e.coordinateSystem;o.viewGL.scene.add(this._lightRoot);o.viewGL.add(this._groundMesh);this._updateGroundMesh();this._sceneHelper.setScene(o.viewGL.scene);this._sceneHelper.updateLight(e);o.viewGL.setPostEffect(e.getModel("postEffect"),r);o.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));this._mapbox3DModel=e},afterRender:function(e,t,r,a){var i=a.renderer;this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r);e.coordinateSystem.viewGL.scene.traverse(function(e){if(e.material){e.material.define("fragment","NORMAL_UP_AXIS",2);e.material.define("fragment","NORMAL_FRONT_AXIS",1)}})},updateCamera:function(e,t,r,a){e.coordinateSystem.setCameraOption(a);this._updateGroundMesh();r.getZr().refresh()},_dispatchInteractAction:function(e,t,r){e.dispatchAction({type:"mapbox3DChangeCamera",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),mapbox3DId:this._mapbox3DModel&&this._mapbox3DModel.id})},_updateGroundMesh:function(){if(this._mapbox3DModel){var e=this._mapbox3DModel.coordinateSystem;var t=e.dataToPoint(e.center);this._groundMesh.position.set(t[0],t[1],-.001);var r=new u["a"].Plane(new u["a"].Vector3(0,0,1),0);var a=e.viewGL.camera.castRay(new u["a"].Vector2(-1,-1));var i=e.viewGL.camera.castRay(new u["a"].Vector2(1,1));var n=a.intersectPlane(r);var o=i.intersectPlane(r);var s=n.dist(o)/e.viewGL.rootNode.scale.x;this._groundMesh.scale.set(s,s,1)}},dispose:function(e,t){if(this._zrLayer){this._zrLayer.dispose()}t.getZr().painter.delLayer(-1e3)}})},function(e,t,r){"use strict";function a(e,t){this.id=e;this.zr=t;this.dom=document.createElement("div");this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;";if(!mapboxgl){throw new Error("Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/")}this._mapbox=new mapboxgl.Map({container:this.dom});this._initEvents()}a.prototype.resize=function(){this._mapbox.resize()};a.prototype.getMapbox=function(){return this._mapbox};a.prototype.clear=function(){};a.prototype.refresh=function(){this._mapbox.resize()};var n=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel"];a.prototype._initEvents=function(){var i=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(e){e.preventDefault();return false}};n.forEach(function(e){this._handlers[e]=function(e){var t={};for(var r in e){t[r]=e[r]}t.bubbles=false;var a=new e.constructor(e.type,t);i.dispatchEvent(a)};this.zr.dom.addEventListener(e,this._handlers[e])},this);this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};a.prototype.dispose=function(){n.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this)};t["a"]=a},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(220);var o=r(222);var s=r(223);i.a.registerAction({type:"maptalks3DChangeCamera",event:"maptalks3dcamerachanged",update:"maptalks3D:updateCamera"},function(t,e){e.eachComponent({mainType:"maptalks3D",query:t},function(e){e.setMaptalksCameraOption(t)})})},function(e,t,r){"use strict";var a=r(221);var i=r(0);var n=r.n(i);var o=r(101);var s=Object(o["a"])("maptalks3D",a["a"],function(e){e.forEach(function(e){e.setCameraOption(e.model.getMaptalksCameraOption())})});n.a.registerCoordinateSystem("maptalks3D",s);var u=s},function(e,t,r){"use strict";var a=r(100);function i(){a["a"].apply(this,arguments);this.maxPitch=85;this.zoomOffset=1}i.prototype=new a["a"];i.prototype.constructor=i;i.prototype.type="maptalks3D";t["a"]=i},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(28);var o=r(29);var s=["zoom","center","pitch","bearing"];var u=i.a.extendComponentModel({type:"maptalks3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMaptalksCameraOption:function(){var r=this;return s.reduce(function(e,t){e[t]=r.get(t);return e},{})},setMaptalksCameraOption:function(t){if(t!=null){s.forEach(function(e){if(t[e]!=null){this.option[e]=t[e]}},this)}},getMaptalks:function(){return this._maptalks},setMaptalks:function(e){this._maptalks=e}});i.a.util.merge(u.prototype,n["a"]);i.a.util.merge(u.prototype,o["a"]);var l=u},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(224);var o=r(30);var u=r(1);var s=r(102);u["a"].Shader.import(s["a"]);var l=i.a.extendComponentView({type:"maptalks3D",__ecgl__:true,init:function(e,t){this._groundMesh=new u["a"].Mesh({geometry:new u["a"].PlaneGeometry,material:new u["a"].Material({shader:new u["a"].Shader({vertex:u["a"].Shader.source("ecgl.displayShadow.vertex"),fragment:u["a"].Shader.source("ecgl.displayShadow.fragment")}),depthMask:false}),renderOrder:-100,culling:false,castShadow:false,$ignorePicking:true,renderNormal:true})},_initMaptalksLayer:function(e,t){var r=t.getZr();this._zrLayer=new n["a"]("maptalks3D",r,e.get("center"),e.get("zoom"));r.painter.insertLayer(-1e3,this._zrLayer);this._lightRoot=new u["a"].Node;this._sceneHelper=new o["a"](this._lightRoot);this._sceneHelper.initLight(this._lightRoot);var a=this._zrLayer.getMaptalks();var i=this._dispatchInteractAction.bind(this,t,a);["zoomend","zooming","zoomstart","dragrotating","pitch","pitchend","movestart","moving","moveend","resize","touchstart","touchmove","touchend"].forEach(function(e){a.on(e,i)})},render:function(e,t,r){if(!this._zrLayer){this._initMaptalksLayer(e,r)}var a=this._zrLayer.getMaptalks();var i=e.get("urlTemplate");var n=a.getBaseLayer();if(i!==this._oldUrlTemplate){if(!n){n=new maptalks.TileLayer("maptalks-echarts-gl-baselayer",{urlTemplate:i,subdomains:["a","b","c"],attribution:e.get("attribution")});a.setBaseLayer(n)}else{n.setOptions({urlTemplate:i,attribution:e.get("attribution")})}}this._oldUrlTemplate=i;a.setCenter(e.get("center"));a.setZoom(e.get("zoom"),{animation:false});a.setPitch(e.get("pitch"));a.setBearing(e.get("bearing"));e.setMaptalks(a);var o=e.coordinateSystem;o.viewGL.scene.add(this._lightRoot);o.viewGL.add(this._groundMesh);this._updateGroundMesh();this._sceneHelper.setScene(o.viewGL.scene);this._sceneHelper.updateLight(e);o.viewGL.setPostEffect(e.getModel("postEffect"),r);o.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));this._maptalks3DModel=e},afterRender:function(e,t,r,a){var i=a.renderer;this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r);e.coordinateSystem.viewGL.scene.traverse(function(e){if(e.material){e.material.define("fragment","NORMAL_UP_AXIS",2);e.material.define("fragment","NORMAL_FRONT_AXIS",1)}})},updateCamera:function(e,t,r,a){e.coordinateSystem.setCameraOption(a);this._updateGroundMesh();r.getZr().refresh()},_dispatchInteractAction:function(e,t,r){e.dispatchAction({type:"maptalks3DChangeCamera",pitch:t.getPitch(),zoom:t.getZoom(),center:t.getCenter().toArray(),bearing:t.getBearing(),maptalks3DId:this._maptalks3DModel&&this._maptalks3DModel.id})},_updateGroundMesh:function(){if(this._maptalks3DModel){var e=this._maptalks3DModel.coordinateSystem;var t=e.dataToPoint(e.center);this._groundMesh.position.set(t[0],t[1],-.001);var r=new u["a"].Plane(new u["a"].Vector3(0,0,1),0);var a=e.viewGL.camera.castRay(new u["a"].Vector2(-1,-1));var i=e.viewGL.camera.castRay(new u["a"].Vector2(1,1));var n=a.intersectPlane(r);var o=i.intersectPlane(r);var s=n.dist(o)/e.viewGL.rootNode.scale.x;this._groundMesh.scale.set(s,s,1)}},dispose:function(e,t){if(this._zrLayer){this._zrLayer.dispose()}t.getZr().painter.delLayer(-1e3)}})},function(e,t,r){"use strict";function a(e,t,r,a){this.id=e;this.zr=t;this.dom=document.createElement("div");this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;";if(!maptalks){throw new Error("Maptalks library must be included. See https://maptalks.org")}this._maptalks=new maptalks.Map(this.dom,{center:r,zoom:a,fog:false});this._initEvents()}a.prototype.resize=function(){this._maptalks.checkSize()};a.prototype.getMaptalks=function(){return this._maptalks};a.prototype.clear=function(){};a.prototype.refresh=function(){this._maptalks.checkSize()};var i=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","touchcancel"];a.prototype._initEvents=function(){var n=this.dom;this._handlers=this._handlers||{contextmenu:function(e){e.preventDefault();return false}};i.forEach(function(i){this._handlers[i]=function(e){var t={};for(var r in e){t[r]=e[r]}t.bubbles=false;var a=new e.constructor(e.type,t);if(i==="mousewheel"||i==="DOMMouseScroll"){n.dispatchEvent(a)}else{n.firstElementChild.dispatchEvent(a)}};this.zr.dom.addEventListener(i,this._handlers[i])},this);this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)};a.prototype.dispose=function(){i.forEach(function(e){this.zr.dom.removeEventListener(e,this._handlers[e])},this);this._maptalks.remove()};t["a"]=a},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(226);var o=r(229);var s=r(231);var u=r(17);i.a.registerVisual(Object(u["a"])("bar3D"));i.a.registerProcessor(function(e,t){e.eachSeriesByType("bar3d",function(e){var t=e.getData();t.filterSelf(function(e){return t.hasValue(e)})})})},function(e,t,r){"use strict";var a=r(0);var g=r.n(a);var i=r(3);var n=r(6);var o=r(227);var _=r(228);var m=n["a"].vec3;var s=g.a.helper.dataStack.isDimensionStacked;function u(t,f){var c=t.getData();var d=t.get("minHeight")||0;var v=t.get("barSize");var e=["lng","lat","alt"].map(function(e){return t.coordDimToDataDim(e)[0]});if(v==null){var r=f.radius*Math.PI;var a=Object(_["a"])(c,e[0],e[1]);v=[r/Math.sqrt(c.count()/a),r/Math.sqrt(c.count()/a)]}else if(!g.a.util.isArray(v)){v=[v,v]}var p=y(c,e);c.each(e,function(e,t,r,a){var i=c.get(p.dimension,a);var n=p.isStacked?i-r:f.altitudeAxis.scale.getExtent()[0];var o=Math.max(f.altitudeAxis.dataToCoord(r),d);var s=f.dataToPoint([e,t,n]);var u=f.dataToPoint([e,t,i]);var l=m.sub([],u,s);m.normalize(l,l);var h=[v[0],o,v[1]];c.setItemLayout(a,[s,l,h])});c.setLayout("orient",i["a"].UP.array)}function l(t,l){var h=t.getData();var f=t.get("barSize");var c=t.get("minHeight")||0;var e=["lng","lat","alt"].map(function(e){return t.coordDimToDataDim(e)[0]});if(f==null){var r=Math.min(l.size[0],l.size[2]);var a=Object(_["a"])(h,e[0],e[1]);f=[r/Math.sqrt(h.count()/a),r/Math.sqrt(h.count()/a)]}else if(!g.a.util.isArray(f)){f=[f,f]}var d=[0,1,0];var v=y(h,e);h.each(e,function(e,t,r,a){var i=h.get(v.dimension,a);var n=v.isStacked?i-r:l.altitudeAxis.scale.getExtent()[0];var o=Math.max(l.altitudeAxis.dataToCoord(r),c);var s=l.dataToPoint([e,t,n]);var u=[f[0],o,f[1]];h.setItemLayout(a,[s,d,u])});h.setLayout("orient",[1,0,0])}function h(e,h){var f=e.getData();var t=e.coordDimToDataDim("lng")[0];var r=e.coordDimToDataDim("lat")[0];var a=e.coordDimToDataDim("alt")[0];var c=e.get("barSize");var d=e.get("minHeight")||0;if(c==null){var i=f.getDataExtent(t);var n=f.getDataExtent(r);var o=h.dataToPoint([i[0],n[0]]);var s=h.dataToPoint([i[1],n[1]]);var u=Math.min(Math.abs(o[0]-s[0]),Math.abs(o[1]-s[1]))||1;var l=Object(_["a"])(f,t,r);c=[u/Math.sqrt(f.count()/l),u/Math.sqrt(f.count()/l)]}else{if(!g.a.util.isArray(c)){c=[c,c]}c[0]/=h.getScale()/16;c[1]/=h.getScale()/16}var v=[0,0,1];var p=[t,r,a];var m=y(f,p);f.each(p,function(e,t,r,a){var i=f.get(m.dimension,a);var n=m.isStacked?i-r:0;var o=h.dataToPoint([e,t,n]);var s=h.dataToPoint([e,t,i]);var u=Math.max(s[2]-o[2],d);var l=[c[0],u,c[1]];f.setItemLayout(a,[o,v,l])});f.setLayout("orient",[1,0,0])}function y(e,t){var r=s(e,t[2]);return{dimension:r?e.getCalculationInfo("stackResultDimension"):t[2],isStacked:r}}g.a.registerLayout(function(e,t){e.eachSeriesByType("bar3D",function(e){var t=e.coordinateSystem;var r=t&&t.type;if(r==="globe"){u(e,t)}else if(r==="cartesian3D"){Object(o["a"])(e,t)}else if(r==="geo3D"){l(e,t)}else if(r==="mapbox3D"||r==="maptalks3D"){h(e,t)}else{if(true){if(!t){throw new Error("bar3D doesn't have coordinate system.")}else{throw new Error("bar3D doesn't support coordinate system "+t.type)}}}})})},function(e,t,r){"use strict";var a=r(0);var s=r.n(a);var i=r(6);var _=i["a"].vec3;var u=s.a.helper.dataStack.isDimensionStacked;function l(e){var t=e[0];var r=e[1];return!(t>0&&r>0||t<0&&r<0)}function n(t,f){var c=t.getData();var d=t.get("barSize");if(d==null){var e=f.size;var r;var a;var i=f.getAxis("x");var n=f.getAxis("y");if(i.type==="category"){r=i.getBandWidth()*.7}else{r=Math.round(e[0]/Math.sqrt(c.count()))*.6}if(n.type==="category"){a=n.getBandWidth()*.7}else{a=Math.round(e[1]/Math.sqrt(c.count()))*.6}d=[r,a]}else if(!s.a.util.isArray(d)){d=[d,d]}var v=f.getAxis("z").scale.getExtent();var p=l(v);var o=["x","y","z"].map(function(e){return t.coordDimToDataDim(e)[0]});var m=u(c,o[2]);var g=m?c.getCalculationInfo("stackResultDimension"):o[2];c.each(o,function(e,t,r,a){var i=c.get(g,a);var n=m?i-r:p?0:v[0];var o=f.dataToPoint([e,t,n]);var s=f.dataToPoint([e,t,i]);var u=_.dist(o,s);var l=[0,s[1]<o[1]?-1:1,0];if(Math.abs(u)===0){u=.1}var h=[d[0],u,d[1]];c.setItemLayout(a,[o,l,h])});c.setLayout("orient",[1,0,0])}t["a"]=n},function(e,t,r){"use strict";t["a"]=function(e,t,r){var a=e.getDataExtent(t);var i=e.getDataExtent(r);var n=a[1]-a[0]||a[0];var o=i[1]-i[0]||i[0];var s=50;var u=new Uint8Array(s*s);for(var l=0;l<e.count();l++){var h=e.get(t,l);var f=e.get(r,l);var c=Math.floor((h-a[0])/n*(s-1));var d=Math.floor((f-i[0])/o*(s-1));var v=d*s+c;u[v]=u[v]||1}var p=0;for(var l=0;l<u.length;l++){if(u[l]){p++}}return p/u.length}},function(e,t,r){"use strict";var a=r(0);var l=r.n(a);var _=r(1);var u=r(2);var h=r(32);var o=r(230);var i=r(66);var n=r(6);var f=n["a"].vec3;var s=l.a.extendChartView({type:"bar3D",__ecgl__:true,init:function(e,t){this.groupGL=new _["a"].Node;this._api=t;this._labelsBuilder=new i["a"](256,256,t);var s=this;this._labelsBuilder.getLabelPosition=function(e,t,r){if(s._data){var a=s._data.getItemLayout(e);var i=a[0];var n=a[1];var o=a[2][1];return f.scaleAndAdd([],i,n,r+o)}else{return[0,0]}};this._labelsBuilder.getMesh().renderOrder=100},render:function(e,t,r){var a=this._prevBarMesh;this._prevBarMesh=this._barMesh;this._barMesh=a;if(!this._barMesh){this._barMesh=new _["a"].Mesh({geometry:new o["a"],shadowDepthMaterial:new _["a"].Material({shader:new _["a"].Shader(_["a"].Shader.source("ecgl.sm.depth.vertex"),_["a"].Shader.source("ecgl.sm.depth.fragment"))}),culling:e.coordinateSystem.type==="cartesian3D",renderOrder:10,renderNormal:true})}this.groupGL.remove(this._prevBarMesh);this.groupGL.add(this._barMesh);this.groupGL.add(this._labelsBuilder.getMesh());var i=e.coordinateSystem;this._doRender(e,r);if(i&&i.viewGL){i.viewGL.add(this.groupGL);var n=i.viewGL.isLinearSpace()?"define":"undefine";this._barMesh.material[n]("fragment","SRGB_DECODE")}this._data=e.getData();this._labelsBuilder.updateData(this._data);this._labelsBuilder.updateLabels();this._updateAnimation(e)},_updateAnimation:function(e){_["a"].updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevBarMesh,this._barMesh,e)},_doRender:function(e,t){var o=e.getData();var r=e.get("shading");var a=r!=="color";var s=this;var i=this._barMesh;var n="ecgl."+r;if(!i.material||i.material.shader.name!==n){i.material=_["a"].createMaterial(n,["VERTEX_COLOR"])}_["a"].setMaterialFromModel(r,i.material,e,t);i.geometry.enableNormal=a;i.geometry.resetOffset();var u=e.get("bevelSize");var l=e.get("bevelSmoothness");i.geometry.bevelSegments=l;i.geometry.bevelSize=u;var h=[];var f=new Float32Array(o.count()*4);var c=0;var d=0;var v=false;o.each(function(e){if(!o.hasValue(e)){return}var t=o.getItemVisual(e,"color");var r=o.getItemVisual(e,"opacity");if(r==null){r=1}_["a"].parseColor(t,h);h[3]*=r;f[c++]=h[0];f[c++]=h[1];f[c++]=h[2];f[c++]=h[3];if(h[3]>0){d++;if(h[3]<.99){v=true}}});i.geometry.setBarCount(d);var p=o.getLayout("orient");var m=this._barIndexOfData=new Int32Array(o.count());var d=0;o.each(function(e){if(!o.hasValue(e)){m[e]=-1;return}var t=o.getItemLayout(e);var r=t[0];var a=t[1];var i=t[2];var n=e*4;h[0]=f[n++];h[1]=f[n++];h[2]=f[n++];h[3]=f[n++];if(h[3]>0){s._barMesh.geometry.addBar(r,a,p,i,h,e);m[e]=d++}});i.geometry.dirty();i.geometry.updateBoundingBox();var g=i.material;g.transparent=v;g.depthMask=!v;i.geometry.sortTriangles=v;this._initHandler(e,t)},_initHandler:function(e,r){var a=e.getData();var i=this._barMesh;var n=e.coordinateSystem.type==="cartesian3D";i.seriesIndex=e.seriesIndex;var o=-1;i.off("mousemove");i.off("mouseout");i.on("mousemove",function(e){var t=i.geometry.getDataIndexOfVertex(e.triangle[0]);if(t!==o){this._downplay(o);this._highlight(t);this._labelsBuilder.updateLabels([t]);if(n){r.dispatchAction({type:"grid3DShowAxisPointer",value:[a.get("x",t),a.get("y",t),a.get("z",t,true)]})}}o=t;i.dataIndex=t},this);i.on("mouseout",function(e){this._downplay(o);this._labelsBuilder.updateLabels();o=-1;i.dataIndex=-1;if(n){r.dispatchAction({type:"grid3DHideAxisPointer"})}},this)},_highlight:function(e){var t=this._data;if(!t){return}var r=this._barIndexOfData[e];if(r<0){return}var a=t.getItemModel(e);var i=a.getModel("emphasis.itemStyle");var n=i.get("color");var o=i.get("opacity");if(n==null){var s=t.getItemVisual(e,"color");n=l.a.color.lift(s,-.4)}if(o==null){o=t.getItemVisual(e,"opacity")}var u=_["a"].parseColor(n);u[3]*=o;this._barMesh.geometry.setColor(r,u);this._api.getZr().refresh()},_downplay:function(e){var t=this._data;if(!t){return}var r=this._barIndexOfData[e];if(r<0){return}var a=t.getItemVisual(e,"color");var i=t.getItemVisual(e,"opacity");var n=_["a"].parseColor(a);n[3]*=i;this._barMesh.geometry.setColor(r,n);this._api.getZr().refresh()},highlight:function(e,t,r,a){this._toggleStatus("highlight",e,t,r,a)},downplay:function(e,t,r,a){this._toggleStatus("downplay",e,t,r,a)},_toggleStatus:function(t,e,r,a,i){var n=e.getData();var o=u["a"].queryDataIndex(n,i);var s=this;if(o!=null){l.a.util.each(h["a"].normalizeToArray(o),function(e){t==="highlight"?this._highlight(e):this._downplay(e)},this)}else{n.each(function(e){t==="highlight"?s._highlight(e):s._downplay(e)})}},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(38);var o=r(65);var s=r(15);var u=r(6);var O=u["a"].vec3;var l=u["a"].mat3;var h=s["a"].extend(function(){return{attributes:{position:new s["a"].Attribute("position","float",3,"POSITION"),normal:new s["a"].Attribute("normal","float",3,"NORMAL"),color:new s["a"].Attribute("color","float",4,"COLOR"),prevPosition:new s["a"].Attribute("prevPosition","float",3),prevNormal:new s["a"].Attribute("prevNormal","float",3)},dynamic:true,enableNormal:false,bevelSize:1,bevelSegments:0,_dataIndices:null,_vertexOffset:0,_triangleOffset:0}},{resetOffset:function(){this._vertexOffset=0;this._triangleOffset=0},setBarCount:function(e){var t=this.enableNormal;var r=this.getBarVertexCount()*e;var a=this.getBarTriangleCount()*e;if(this.vertexCount!==r){this.attributes.position.init(r);if(t){this.attributes.normal.init(r)}else{this.attributes.normal.value=null}this.attributes.color.init(r)}if(this.triangleCount!==a){this.indices=r>65535?new Uint32Array(a*3):new Uint16Array(a*3);this._dataIndices=new Uint32Array(r)}},getBarVertexCount:function(){var e=this.bevelSize>0?this.bevelSegments:0;return e>0?this._getBevelBarVertexCount(e):this.enableNormal?24:8},getBarTriangleCount:function(){var e=this.bevelSize>0?this.bevelSegments:0;return e>0?this._getBevelBarTriangleCount(e):12},_getBevelBarVertexCount:function(e){return(e+1)*4*(e+1)*2},_getBevelBarTriangleCount:function(e){var t=e*4+3;var r=e*2+1;return(t+1)*r*2+4},setColor:function(e,t){var r=this.getBarVertexCount();var a=r*e;var i=r*(e+1);for(var n=a;n<i;n++){this.attributes.color.set(n,t)}this.dirtyAttribute("color")},getDataIndexOfVertex:function(e){return this._dataIndices?this._dataIndices[e]:null},addBar:function(){var e=O.create;var p=O.scaleAndAdd;var m=e();var g=e();var _=e();var y=e();var x=e();var T=e();var b=e();var w=[];var E=[];for(var t=0;t<8;t++){w[t]=e()}var S=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[3,2,1,0],[0,4,7,3],[1,2,6,5]];var A=[0,1,2,0,2,3];var M=[];for(var t=0;t<S.length;t++){var r=S[t];for(var a=0;a<2;a++){var i=[];for(var n=0;n<3;n++){i.push(r[A[a*3+n]])}M.push(i)}}return function(e,t,r,a,i,n){var o=this._vertexOffset;if(this.bevelSize>0&&this.bevelSegments>0){this._addBevelBar(e,t,r,a,this.bevelSize,this.bevelSegments,i)}else{O.copy(_,t);O.normalize(_,_);O.cross(y,r,_);O.normalize(y,y);O.cross(g,_,y);O.normalize(y,y);O.negate(x,g);O.negate(T,_);O.negate(b,y);p(w[0],e,g,a[0]/2);p(w[0],w[0],y,a[2]/2);p(w[1],e,g,a[0]/2);p(w[1],w[1],b,a[2]/2);p(w[2],e,x,a[0]/2);p(w[2],w[2],b,a[2]/2);p(w[3],e,x,a[0]/2);p(w[3],w[3],y,a[2]/2);p(m,e,_,a[1]);p(w[4],m,g,a[0]/2);p(w[4],w[4],y,a[2]/2);p(w[5],m,g,a[0]/2);p(w[5],w[5],b,a[2]/2);p(w[6],m,x,a[0]/2);p(w[6],w[6],b,a[2]/2);p(w[7],m,x,a[0]/2);p(w[7],w[7],y,a[2]/2);var s=this.attributes;if(this.enableNormal){E[0]=g;E[1]=x;E[2]=_;E[3]=T;E[4]=y;E[5]=b;var u=this._vertexOffset;for(var l=0;l<S.length;l++){var h=this._triangleOffset*3;for(var f=0;f<6;f++){this.indices[h++]=u+A[f]}u+=4;this._triangleOffset+=2}for(var l=0;l<S.length;l++){var c=E[l];for(var f=0;f<4;f++){var d=S[l][f];s.position.set(this._vertexOffset,w[d]);s.normal.set(this._vertexOffset,c);s.color.set(this._vertexOffset++,i)}}}else{for(var l=0;l<M.length;l++){var h=this._triangleOffset*3;for(var f=0;f<3;f++){this.indices[h+f]=M[l][f]+this._vertexOffset}this._triangleOffset++}for(var l=0;l<w.length;l++){s.position.set(this._vertexOffset,w[l]);s.color.set(this._vertexOffset++,i)}}}var v=this._vertexOffset;for(var l=o;l<v;l++){this._dataIndices[l]=n}}}(),_addBevelBar:function(){var M=O.create();var C=O.create();var L=O.create();var D=l.create();var N=[];var I=[1,-1,-1,1];var R=[1,1,-1,-1];var P=[2,0];return function(e,t,r,a,i,n,o){O.copy(C,t);O.normalize(C,C);O.cross(L,r,C);O.normalize(L,L);O.cross(M,C,L);O.normalize(L,L);D[0]=M[0];D[1]=M[1];D[2]=M[2];D[3]=C[0];D[4]=C[1];D[5]=C[2];D[6]=L[0];D[7]=L[1];D[8]=L[2];i=Math.min(a[0],a[2])/2*i;for(var s=0;s<3;s++){N[s]=Math.max(a[s]-i*2,0)}var u=(a[0]-N[0])/2;var l=(a[1]-N[1])/2;var h=(a[2]-N[2])/2;var f=[];var c=[];var d=this._vertexOffset;var v=[];for(var s=0;s<2;s++){v[s]=v[s]=[];for(var p=0;p<=n;p++){for(var m=0;m<4;m++){if(p===0&&s===0||s===1&&p===n){v[s].push(d)}for(var g=0;g<=n;g++){var _=g/n*Math.PI/2+Math.PI/2*m;var y=p/n*Math.PI/2+Math.PI/2*s;c[0]=u*Math.cos(_)*Math.sin(y);c[1]=l*Math.cos(y);c[2]=h*Math.sin(_)*Math.sin(y);f[0]=c[0]+I[m]*N[0]/2;f[1]=c[1]+l+P[s]*N[1]/2;f[2]=c[2]+R[m]*N[2]/2;if(!(Math.abs(u-l)<1e-6&&Math.abs(l-h)<1e-6)){c[0]/=u*u;c[1]/=l*l;c[2]/=h*h}O.normalize(c,c);O.transformMat3(f,f,D);O.transformMat3(c,c,D);O.add(f,f,e);this.attributes.position.set(d,f);if(this.enableNormal){this.attributes.normal.set(d,c)}this.attributes.color.set(d,o);d++}}}}var x=n*4+3;var T=n*2+1;var b=x+1;for(var m=0;m<T;m++){for(var s=0;s<=x;s++){var w=m*b+s+this._vertexOffset;var E=m*b+(s+1)%b+this._vertexOffset;var S=(m+1)*b+(s+1)%b+this._vertexOffset;var A=(m+1)*b+s+this._vertexOffset;this.setTriangleIndices(this._triangleOffset++,[S,w,E]);this.setTriangleIndices(this._triangleOffset++,[S,A,w])}}this.setTriangleIndices(this._triangleOffset++,[v[0][0],v[0][2],v[0][1]]);this.setTriangleIndices(this._triangleOffset++,[v[0][0],v[0][3],v[0][2]]);this.setTriangleIndices(this._triangleOffset++,[v[1][0],v[1][1],v[1][2]]);this.setTriangleIndices(this._triangleOffset++,[v[1][0],v[1][2],v[1][3]]);this._vertexOffset=d}}()});i.a.util.defaults(h.prototype,n["a"]);i.a.util.defaults(h.prototype,o["a"]);t["a"]=h},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(31);var o=r(32);var s=r(39);var u=r(50);var l=i.a.extendSeriesModel({type:"series.bar3D",dependencies:["globe"],visualColorAccessPath:"itemStyle.color",getInitialData:function(e,t){return Object(u["a"])(this)},getFormattedLabel:function(e,t,r,a){var i=o["a"].getFormattedLabel(this,e,t,r,a);if(i==null){i=this.getData().get("z",e)}return i},formatTooltip:function(e){return Object(s["a"])(this,e)},defaultOption:{coordinateSystem:"cartesian3D",globeIndex:0,grid3DIndex:0,zlevel:-10,bevelSize:0,bevelSmoothness:2,onGridPlane:"xy",shading:"color",minHeight:0,itemStyle:{opacity:1},label:{show:false,distance:2,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},emphasis:{label:{show:true}},animationDurationUpdate:500}});i.a.util.merge(l.prototype,n["a"]);var h=l},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(233);var o=r(234);var s=r(51);var u=r.n(s);var l=r(17);i.a.registerVisual(u()("line3D","circle",null));i.a.registerVisual(Object(l["a"])("line3D"));i.a.registerLayout(function(e,t){e.eachSeriesByType("line3D",function(t){var e=t.getData();var i=t.coordinateSystem;if(i){if(i.type!=="cartesian3D"){if(true){console.error("line3D needs cartesian3D coordinateSystem")}return}var n=new Float32Array(e.count()*3);var o=[];var s=[];var r=i.dimensions;var a=r.map(function(e){return t.coordDimToDataDim(e)[0]});if(i){e.each(a,function(e,t,r,a){o[0]=e;o[1]=t;o[2]=r;i.dataToPoint(o,s);n[a*3]=s[0];n[a*3+1]=s[1];n[a*3+2]=s[2]})}e.setLayout("points",n)}})})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(39);var o=r(50);var s=i.a.extendSeriesModel({type:"series.line3D",dependencies:["grid3D"],visualColorAccessPath:"lineStyle.color",getInitialData:function(e,t){return Object(o["a"])(this)},formatTooltip:function(e){return Object(n["a"])(this,e)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,lineStyle:{width:2},animationDurationUpdate:500}});var u=s},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var f=r(1);var c=r(2);var o=r(25);var l=r(9);var w=r(3);var n=r(235);var E=r.n(n);var s=r(6);var u=r(46);var h=s["a"].vec3;f["a"].Shader.import(u["a"]);var d=i.a.extendChartView({type:"line3D",__ecgl__:true,init:function(e,t){this.groupGL=new f["a"].Node;this._api=t},render:function(e,t,r){var a=this._prevLine3DMesh;this._prevLine3DMesh=this._line3DMesh;this._line3DMesh=a;if(!this._line3DMesh){this._line3DMesh=new f["a"].Mesh({geometry:new o["a"]({useNativeLine:false,sortTriangles:true}),material:new f["a"].Material({shader:f["a"].createShader("ecgl.meshLines3D")}),renderOrder:10});this._line3DMesh.geometry.pick=this._pick.bind(this)}this.groupGL.remove(this._prevLine3DMesh);this.groupGL.add(this._line3DMesh);var i=e.coordinateSystem;if(i&&i.viewGL){i.viewGL.add(this.groupGL);var n=i.viewGL.isLinearSpace()?"define":"undefine";this._line3DMesh.material[n]("fragment","SRGB_DECODE")}this._doRender(e,r);this._data=e.getData();this._camera=i.viewGL.camera;this.updateCamera();this._updateAnimation(e)},updateCamera:function(){this._updateNDCPosition()},_doRender:function(e,t){var a=e.getData();var r=this._line3DMesh;r.geometry.resetOffset();var i=a.getLayout("points");var n=[];var o=new Float32Array(i.length/3*4);var s=0;var u=false;a.each(function(e){var t=a.getItemVisual(e,"color");var r=a.getItemVisual(e,"opacity");if(r==null){r=1}f["a"].parseColor(t,n);n[3]*=r;o[s++]=n[0];o[s++]=n[1];o[s++]=n[2];o[s++]=n[3];if(n[3]<.99){u=true}});r.geometry.setVertexCount(r.geometry.getPolylineVertexCount(i));r.geometry.setTriangleCount(r.geometry.getPolylineTriangleCount(i));r.geometry.addPolyline(i,o,c["a"].firstNotNull(e.get("lineStyle.width"),1));r.geometry.dirty();r.geometry.updateBoundingBox();var l=r.material;l.transparent=u;l.depthMask=!u;var h=e.getModel("debug.wireframe");if(h.get("show")){r.geometry.createAttribute("barycentric","float",3);r.geometry.generateBarycentric();r.material.set("both","WIREFRAME_TRIANGLE");r.material.set("wireframeLineColor",f["a"].parseColor(h.get("lineStyle.color")||"rgba(0,0,0,0.5)"));r.material.set("wireframeLineWidth",c["a"].firstNotNull(h.get("lineStyle.width"),1))}else{r.material.set("both","WIREFRAME_TRIANGLE")}this._points=i;this._initHandler(e,t)},_updateAnimation:function(e){f["a"].updateVertexAnimation([["prevPosition","position"],["prevPositionPrev","positionPrev"],["prevPositionNext","positionNext"]],this._prevLine3DMesh,this._line3DMesh,e)},_initHandler:function(e,a){var i=e.getData();var n=e.coordinateSystem;var o=this._line3DMesh;var s=-1;o.seriesIndex=e.seriesIndex;o.off("mousemove");o.off("mouseout");o.on("mousemove",function(e){var t=n.pointToData(e.point.array);var r=i.indicesOfNearest("x",t[0])[0];if(r!==s){a.dispatchAction({type:"grid3DShowAxisPointer",value:[i.get("x",r),i.get("y",r),i.get("z",r)]});o.dataIndex=r}s=r},this);o.on("mouseout",function(e){s=-1;o.dataIndex=-1;a.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateNDCPosition:function(){var e=new l["a"];var t=this._camera;l["a"].multiply(e,t.projectionMatrix,t.viewMatrix);var r=this._positionNDC;var a=this._points;var i=a.length/3;if(!r||r.length/2!==i){r=this._positionNDC=new Float32Array(i*2)}var n=[];for(var o=0;o<i;o++){var s=o*3;var u=o*2;n[0]=a[s];n[1]=a[s+1];n[2]=a[s+2];n[3]=1;h.transformMat4(n,n,e.array);r[u]=n[0]/n[3];r[u+1]=n[1]/n[3]}},_pick:function(e,t,r,a,i,n){var o=this._positionNDC;var s=this._data.hostModel;var u=s.get("lineStyle.width");var l=-1;var h=r.viewport.width;var f=r.viewport.height;var c=h*.5;var d=f*.5;e=(e+1)*c;t=(t+1)*d;for(var v=1;v<o.length/2;v++){var p=(o[(v-1)*2]+1)*c;var m=(o[(v-1)*2+1]+1)*d;var g=(o[v*2]+1)*c;var _=(o[v*2+1]+1)*d;if(E.a.containStroke(p,m,g,_,u,e,t)){var y=(p-e)*(p-e)+(m-t)*(m-t);var x=(g-e)*(g-e)+(_-t)*(_-t);l=y<x?v-1:v}}if(l>=0){var T=l*3;var b=new w["a"](this._points[T],this._points[T+1],this._points[T+2]);n.push({dataIndex:l,point:b,pointWorld:b.clone(),target:this._line3DMesh,distance:this._camera.getWorldPosition().dist(b)})}},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(e,t){function r(e,t,r,a,i,n,o){if(i===0){return false}var s=i;var u=0;var l=e;if(o>t+s&&o>a+s||o<t-s&&o<a-s||n>e+s&&n>r+s||n<e-s&&n<r-s){return false}if(e!==r){u=(t-a)/(e-r);l=(e*a-r*t)/(e-r)}else{return Math.abs(n-e)<=s/2}var h=u*n-o+l;var f=h*h/(u*u+1);return f<=s/2*s/2}t.containStroke=r},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(237);var o=r(238);var s=r(51);var u=r.n(s);var l=r(17);i.a.registerVisual(u()("scatter3D","circle",null));i.a.registerVisual(Object(l["a"])("scatter3D"));i.a.registerLayout({seriesType:"scatter3D",reset:function(t){var n=t.coordinateSystem;if(n){var e=n.dimensions;if(e.length<3){if(true){console.error("scatter3D needs 3D coordinateSystem")}return}var o=e.map(function(e){return t.coordDimToDataDim(e)[0]});var s=[];var u=[];return{progress:function(e,t){var r=new Float32Array((e.end-e.start)*3);for(var a=e.start;a<e.end;a++){var i=(a-e.start)*3;s[0]=t.get(o[0],a);s[1]=t.get(o[1],a);s[2]=t.get(o[2],a);n.dataToPoint(s,u);r[i]=u[0];r[i+1]=u[1];r[i+2]=u[2]}t.setLayout("points",r)}}}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var s=r(32);var n=r(39);var o=r(50);i.a.extendSeriesModel({type:"series.scatter3D",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",getInitialData:function(e,t){return Object(o["a"])(this)},getFormattedLabel:function(e,t,r,a){var i=s["a"].getFormattedLabel(this,e,t,r,a);if(i==null){var n=this.getData();var o=n.dimensions[n.dimensions.length-1];i=n.get(o,e)}return i},formatTooltip:function(e){return Object(n["a"])(this,e)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,progressive:1e5,progressiveThreshold:1e5,grid3DIndex:0,globeIndex:0,symbol:"circle",symbolSize:10,blendMode:"source-over",label:{show:false,position:"right",distance:5,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},itemStyle:{opacity:.8},emphasis:{label:{show:true}},animationDurationUpdate:500}})},function(e,t,r){"use strict";var a=r(0);var u=r.n(a);var i=r(1);var l=r(2);var h=r(32);var n=r(67);u.a.extendChartView({type:"scatter3D",__ecgl__:true,init:function(e,t){this.groupGL=new i["a"].Node;this._pointsBuilderList=[];this._currentStep=0},render:function(e,t,r){this.groupGL.removeAll();if(!e.getData().count()){return}var a=e.coordinateSystem;if(a&&a.viewGL){a.viewGL.add(this.groupGL);this._camera=a.viewGL.camera;var i=this._pointsBuilderList[0];if(!i){i=this._pointsBuilderList[0]=new n["a"](false,r)}this._pointsBuilderList.length=1;this.groupGL.add(i.rootNode);i.update(e,t,r);i.updateView(a.viewGL.camera)}else{if(true){throw new Error("Invalid coordinate system")}}},incrementalPrepareRender:function(e,t,r){var a=e.coordinateSystem;if(a&&a.viewGL){a.viewGL.add(this.groupGL);this._camera=a.viewGL.camera}else{if(true){throw new Error("Invalid coordinate system")}}this.groupGL.removeAll();this._currentStep=0},incrementalRender:function(e,t,r,a){if(e.end<=e.start){return}var i=this._pointsBuilderList[this._currentStep];if(!i){i=new n["a"](false,a);this._pointsBuilderList[this._currentStep]=i}this.groupGL.add(i.rootNode);i.update(t,r,a,e.start,e.end);i.updateView(t.coordinateSystem.viewGL.camera);this._currentStep++},updateCamera:function(){this._pointsBuilderList.forEach(function(e){e.updateView(this._camera)},this)},highlight:function(e,t,r,a){this._toggleStatus("highlight",e,t,r,a)},downplay:function(e,t,r,a){this._toggleStatus("downplay",e,t,r,a)},_toggleStatus:function(e,t,r,a,i){var n=t.getData();var o=l["a"].queryDataIndex(n,i);var s=e==="highlight";if(o!=null){u.a.util.each(h["a"].normalizeToArray(o),function(e){for(var t=0;t<this._pointsBuilderList.length;t++){var r=this._pointsBuilderList[t];s?r.highlight(n,e):r.downplay(n,e)}},this)}else{n.each(function(e){for(var t=0;t<this._pointsBuilderList.length;t++){var r=this._pointsBuilderList[t];s?r.highlight(n,e):r.downplay(n,e)}})}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var h=r.n(a);function o(e,t,r){var t=t||document.createElement("canvas");t.width=e;t.height=e;var a=t.getContext("2d");r&&r(a);return t}function s(e,t,r,a){if(!h.a.util.isArray(t)){t=[t,t]}var i=f.getMarginByStyle(r,a);var n=t[0]+i.left+i.right;var o=t[1]+i.top+i.bottom;var s=h.a.helper.createSymbol(e,0,0,t[0],t[1]);var u=Math.max(n,o);s.position=[i.left,i.top];if(n>o){s.position[1]+=(u-o)/2}else{s.position[0]+=(u-n)/2}var l=s.getBoundingRect();s.position[0]-=l.x;s.position[1]-=l.y;s.setStyle(r);s.update();s.__size=u;return s}function n(e,d,v){var p=d.width;var m=d.height;var t=e.canvas.width;var r=e.canvas.height;var g=p/t;var _=m/r;function y(e){return e<128?1:-1}function a(e,t){var r=Infinity;e=Math.floor(e*g);t=Math.floor(t*_);var a=t*p+e;var i=d.data[a*4];var n=y(i);for(var o=Math.max(t-v,0);o<Math.min(t+v,m);o++){for(var s=Math.max(e-v,0);s<Math.min(e+v,p);s++){var a=o*p+s;var u=d.data[a*4];var l=y(u);var h=s-e;var f=o-t;if(n!==l){var c=h*h+f*f;if(c<r){r=c}}}}return n*Math.sqrt(r)}var i=e.createImageData(t,r);for(var n=0;n<r;n++){for(var o=0;o<t;o++){var s=a(o,n);var u=s/v*.5+.5;var l=(n*t+o)*4;i.data[l++]=(1-u)*255;i.data[l++]=(1-u)*255;i.data[l++]=(1-u)*255;i.data[l++]=255}}return i}var f={getMarginByStyle:function(e){var t=e.minMargin||0;var r=0;if(e.stroke&&e.stroke!=="none"){r=e.lineWidth==null?1:e.lineWidth}var a=e.shadowBlur||0;var i=e.shadowOffsetX||0;var n=e.shadowOffsetY||0;var o={};o.left=Math.max(r/2,-i+a,t);o.right=Math.max(r/2,i+a,t);o.top=Math.max(r/2,-n+a,t);o.bottom=Math.max(r/2,n+a,t);return o},createSymbolSprite:function(e,t,r,a){var i=s(e,t,r);var n=f.getMarginByStyle(r);return{image:o(i.__size,a,function(e){i.brush(e)}),margin:n}},createSDFFromCanvas:function(a,e,i,t){return o(e,t,function(e){var t=a.getContext("2d");var r=t.getImageData(0,0,a.width,a.height);e.putImageData(n(e,r,i),0,0)})},createSimpleSprite:function(a,e){return o(a,e,function(e){var t=a/2;e.beginPath();e.arc(t,t,60,0,Math.PI*2,false);e.closePath();var r=e.createRadialGradient(t,t,0,t,t,t);r.addColorStop(0,"rgba(255, 255, 255, 1)");r.addColorStop(.5,"rgba(255, 255, 255, 0.5)");r.addColorStop(1,"rgba(255, 255, 255, 0)");e.fillStyle=r;e.fill()})}};t["a"]=f},function(e,t,r){"use strict";var _=r(1);var a=r(241);var i=r(0);var n=r.n(i);var o=r(6);var s=r(242);var u=o["a"].vec4;_["a"].Shader.import(s["a"]);var l=_["a"].Mesh.extend(function(){var e=new _["a"].Geometry({dynamic:true,attributes:{color:new _["a"].Geometry.Attribute("color","float",4,"COLOR"),position:new _["a"].Geometry.Attribute("position","float",3,"POSITION"),size:new _["a"].Geometry.Attribute("size","float",1),prevPosition:new _["a"].Geometry.Attribute("prevPosition","float",3),prevSize:new _["a"].Geometry.Attribute("prevSize","float",1)}});n.a.util.extend(e,a["a"]);var t=new _["a"].Material({shader:_["a"].createShader("ecgl.sdfSprite"),transparent:true,depthMask:false});t.enableTexture("sprite");t.define("both","VERTEX_COLOR");t.define("both","VERTEX_SIZE");var r=new _["a"].Texture2D({image:document.createElement("canvas"),flipY:false});t.set("sprite",r);e.pick=this._pick.bind(this);return{geometry:e,material:t,mode:_["a"].Mesh.POINTS,sizeScale:1}},{_pick:function(e,t,r,a,i,n){var o=this._positionNDC;if(!o){return}var s=r.viewport;var u=2/s.width;var l=2/s.height;for(var h=this.geometry.vertexCount-1;h>=0;h--){var f;if(!this.geometry.indices){f=h}else{f=this.geometry.indices[h]}var c=o[f*2];var d=o[f*2+1];var v=this.geometry.attributes.size.get(f)/this.sizeScale;var p=v/2;if(e>c-p*u&&e<c+p*u&&t>d-p*l&&t<d+p*l){var m=new _["a"].Vector3;var g=new _["a"].Vector3;this.geometry.attributes.position.get(f,m.array);_["a"].Vector3.transformMat4(g,m,this.worldTransform);n.push({vertexIndex:f,point:m,pointWorld:g,target:this,distance:g.distance(a.getWorldPosition())})}}},updateNDCPosition:function(e,t,r){var a=this._positionNDC;var i=this.geometry;if(!a||a.length/2!==i.vertexCount){a=this._positionNDC=new Float32Array(i.vertexCount*2)}var n=u.create();for(var o=0;o<i.vertexCount;o++){i.attributes.position.get(o,n);n[3]=1;u.transformMat4(n,n,e.array);u.scale(n,n,1/n[3]);a[o*2]=n[0];a[o*2+1]=n[1]}}});t["a"]=l},function(e,t,r){"use strict";var i=r(97);var a=r(6);var l=a["a"].vec3;t["a"]={needsSortVertices:function(){return this.sortVertices},needsSortVerticesProgressively:function(){return this.needsSortVertices()&&this.vertexCount>=2e4},doSortVertices:function(e,t){var r=this.indices;var a=l.create();if(!r){r=this.indices=this.vertexCount>65535?new Uint32Array(this.vertexCount):new Uint16Array(this.vertexCount);for(var i=0;i<r.length;i++){r[i]=i}}if(t===0){var n=this.attributes.position;var e=e.array;var o=0;if(!this._zList||this._zList.length!==this.vertexCount){this._zList=new Float32Array(this.vertexCount)}var s;for(var i=0;i<this.vertexCount;i++){n.get(i,a);var u=l.sqrDist(a,e);if(isNaN(u)){u=1e7;o++}if(i===0){s=u;u=0}else{u=u-s}this._zList[i]=u}this._noneCount=o}if(this.vertexCount<2e4){if(t===0){this._simpleSort(this._noneCount/this.vertexCount>.05)}}else{for(var i=0;i<3;i++){this._progressiveQuickSort(t*3+i)}}this.dirtyIndices()},_simpleSort:function(e){var r=this._zList;var t=this.indices;function a(e,t){return r[t]-r[e]}if(e){Array.prototype.sort.call(t,a)}else{i["a"].sort(t,a,0,t.length-1)}},_progressiveQuickSort:function(e){var r=this._zList;var t=this.indices;this._quickSort=this._quickSort||new i["a"];this._quickSort.step(t,function(e,t){return r[t]-r[e]},e)}}},function(e,t,r){"use strict";t["a"]="@export ecgl.sdfSprite.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform float elapsedTime : 0;\n\nattribute vec3 position : POSITION;\n\n#ifdef VERTEX_SIZE\nattribute float size;\n#else\nuniform float u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_FillColor: COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute float prevSize;\nuniform float percent : 1.0;\n#endif\n\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvarying float v_Size;\n\nvoid main()\n{\n\n#ifdef POSITIONTEXTURE_ENABLED\n gl_Position = worldViewProjection * vec4(texture2D(positionTexture, position.xy).xy, -10.0, 1.0);\n#else\n\n #ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n #else\n vec3 pos = position;\n #endif\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n#endif\n\n#ifdef VERTEX_SIZE\n#ifdef VERTEX_ANIMATION\n v_Size = mix(prevSize, size, percent);\n#else\n v_Size = size;\n#endif\n#else\n v_Size = u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\n v_Color = a_FillColor;\n #endif\n\n gl_PointSize = v_Size;\n}\n\n@end\n\n@export ecgl.sdfSprite.fragment\n\nuniform vec4 color: [1, 1, 1, 1];\nuniform vec4 strokeColor: [1, 1, 1, 1];\nuniform float smoothing: 0.07;\n\nuniform float lineWidth: 0.0;\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\nvarying float v_Size;\n\nuniform sampler2D sprite;\n\n@import clay.util.srgb\n\nvoid main()\n{\n gl_FragColor = color;\n\n vec4 _strokeColor = strokeColor;\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n #endif\n\n#ifdef SPRITE_ENABLED\n float d = texture2D(sprite, gl_PointCoord).r;\n gl_FragColor.a *= smoothstep(0.5 - smoothing, 0.5 + smoothing, d);\n\n if (lineWidth > 0.0) {\n float sLineWidth = lineWidth / 2.0;\n\n float outlineMaxValue0 = 0.5 + sLineWidth;\n float outlineMaxValue1 = 0.5 + sLineWidth + smoothing;\n float outlineMinValue0 = 0.5 - sLineWidth - smoothing;\n float outlineMinValue1 = 0.5 - sLineWidth;\n\n if (d <= outlineMaxValue1 && d >= outlineMinValue0) {\n float a = _strokeColor.a;\n if (d <= outlineMinValue1) {\n a = a * smoothstep(outlineMinValue0, outlineMinValue1, d);\n }\n else {\n a = a * smoothstep(outlineMaxValue1, outlineMaxValue0, d);\n }\n gl_FragColor.rgb = mix(gl_FragColor.rgb * gl_FragColor.a, _strokeColor.rgb, a);\n gl_FragColor.a = gl_FragColor.a * (1.0 - a) + a;\n }\n }\n#endif\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(gl_FragColor);\n#endif\n}\n@end"},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(244);var o=r(245);var s=r(248);var u=r(17);i.a.registerVisual(Object(u["a"])("lines3D"));i.a.registerAction({type:"lines3DPauseEffect",event:"lines3deffectpaused",update:"series.lines3D:pauseEffect"},function(){});i.a.registerAction({type:"lines3DResumeEffect",event:"lines3deffectresumed",update:"series.lines3D:resumeEffect"},function(){});i.a.registerAction({type:"lines3DToggleEffect",event:"lines3deffectchanged",update:"series.lines3D:toggleEffect"},function(){})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(6);var h=n["a"].vec3;var f=n["a"].vec2;var c=h.normalize;var d=h.cross;var v=h.sub;var p=h.add;var m=h.create;var g=m();var _=m();var y=m();var x=m();var T=[];var b=[];function s(e,t){f.copy(T,e[0]);f.copy(b,e[1]);var r=[];var a=r[0]=m();var i=r[1]=m();var n=r[2]=m();var o=r[3]=m();t.dataToPoint(T,a);t.dataToPoint(b,o);c(g,a);v(_,o,a);c(_,_);d(y,_,g);c(y,y);d(_,g,y);p(i,g,_);c(i,i);c(g,o);v(_,a,o);c(_,_);d(y,_,g);c(y,y);d(_,g,y);p(n,g,_);c(n,n);p(x,a,o);c(x,x);var s=h.dot(a,x);var u=h.dot(x,i);var l=(Math.max(h.len(a),h.len(o))-s)/u*2;h.scaleAndAdd(i,a,i,l);h.scaleAndAdd(n,o,n,l);return r}function u(e,t,r){var a=[];var i=a[0]=h.create();var n=a[1]=h.create();var o=a[2]=h.create();var s=a[3]=h.create();t.dataToPoint(e[0],i);t.dataToPoint(e[1],s);var u=h.dist(i,s);h.lerp(n,i,s,.3);h.lerp(o,i,s,.3);h.scaleAndAdd(n,n,r,Math.min(u*.1,10));h.scaleAndAdd(o,o,r,Math.min(u*.1,10));return a}function l(e,t){var r=new Float32Array(e.length*3);var a=0;var i=[];for(var n=0;n<e.length;n++){t.dataToPoint(e[n],i);r[a++]=i[0];r[a++]=i[1];r[a++]=i[2]}return r}function w(a){var i=[];a.each(function(e){var t=a.getItemModel(e);var r=t.option instanceof Array?t.option:t.getShallow("coords",true);if(true){if(!(r instanceof Array&&r.length>0&&r[0]instanceof Array)){throw new Error("Invalid coords "+JSON.stringify(r)+". Lines must have 2d coords array in data item.")}}i.push(r)});return{coordsList:i}}function o(e,a){var i=e.getData();var n=e.get("polyline");i.setLayout("lineType",n?"polyline":"cubicBezier");var o=w(i);i.each(function(e){var t=o.coordsList[e];var r=n?l:s;i.setItemLayout(e,r(t,a))})}function E(e,a,i){var n=e.getData();var o=e.get("polyline");var s=w(n);n.setLayout("lineType",o?"polyline":"cubicBezier");n.each(function(e){var t=s.coordsList[e];var r=o?l(t,a):u(t,a,i);n.setItemLayout(e,r)})}i.a.registerLayout(function(e,t){e.eachSeriesByType("lines3D",function(e){var t=e.coordinateSystem;if(t.type==="globe"){o(e,t)}else if(t.type==="geo3D"){E(e,t,[0,1,0])}else if(t.type==="mapbox3D"||t.type==="maptalks3D"){E(e,t,[0,0,1])}})})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var v=r(1);var n=r(25);var o=r(246);var s=r(46);v["a"].Shader.import(s["a"]);function p(e){if(e.radius!=null){return e.radius}if(e.size!=null){return Math.max(e.size[0],e.size[1],e.size[2])}else{return 100}}var u=i.a.extendChartView({type:"lines3D",__ecgl__:true,init:function(e,t){this.groupGL=new v["a"].Node;this._meshLinesMaterial=new v["a"].Material({shader:v["a"].createShader("ecgl.meshLines3D"),transparent:true,depthMask:false});this._linesMesh=new v["a"].Mesh({geometry:new n["a"],material:this._meshLinesMaterial,$ignorePicking:true});this._trailMesh=new o["a"]},render:function(e,t,r){this.groupGL.add(this._linesMesh);var a=e.coordinateSystem;var i=e.getData();if(a&&a.viewGL){var n=a.viewGL;n.add(this.groupGL);this._updateLines(e,t,r);var o=a.viewGL.isLinearSpace()?"define":"undefine";this._linesMesh.material[o]("fragment","SRGB_DECODE");this._trailMesh.material[o]("fragment","SRGB_DECODE")}var s=this._trailMesh;s.stopAnimation();if(e.get("effect.show")){this.groupGL.add(s);s.updateData(i,r,this._linesMesh.geometry);s.__time=s.__time||0;var u=3600*1e3;this._curveEffectsAnimator=s.animate("",{loop:true}).when(u,{__time:u}).during(function(){s.setAnimationTime(s.__time)}).start()}else{this.groupGL.remove(s);this._curveEffectsAnimator=null}this._linesMesh.material.blend=this._trailMesh.material.blend=e.get("blendMode")==="lighter"?v["a"].additiveBlend:null},pauseEffect:function(){if(this._curveEffectsAnimator){this._curveEffectsAnimator.pause()}},resumeEffect:function(){if(this._curveEffectsAnimator){this._curveEffectsAnimator.resume()}},toggleEffect:function(){var e=this._curveEffectsAnimator;if(e){e.isPaused()?e.resume():e.pause()}},_updateLines:function(e,t,r){var n=e.getData();var a=e.coordinateSystem;var o=this._linesMesh.geometry;var s=e.get("polyline");o.expandLine=true;var i=p(a);o.segmentScale=i/20;var u="lineStyle.width".split(".");var l=r.getDevicePixelRatio();var h=0;n.each(function(e){var t=n.getItemModel(e);var r=t.get(u);if(r==null){r=1}n.setItemVisual(e,"lineWidth",r);h=Math.max(r,h)});o.useNativeLine=false;var f=0;var c=0;n.each(function(e){var t=n.getItemLayout(e);if(s){f+=o.getPolylineVertexCount(t);c+=o.getPolylineTriangleCount(t)}else{f+=o.getCubicCurveVertexCount(t[0],t[1],t[2],t[3]);c+=o.getCubicCurveTriangleCount(t[0],t[1],t[2],t[3])}});o.setVertexCount(f);o.setTriangleCount(c);o.resetOffset();var d=[];n.each(function(e){var t=n.getItemLayout(e);var r=n.getItemVisual(e,"color");var a=n.getItemVisual(e,"opacity");var i=n.getItemVisual(e,"lineWidth")*l;if(a==null){a=1}d=v["a"].parseColor(r,d);d[3]*=a;if(s){o.addPolyline(t,d,i)}else{o.addCubicCurve(t[0],t[1],t[2],t[3],d,i)}});o.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var M=r(1);var n=r(6);var o=r(25);var s=r(247);var C=n["a"].vec3;function L(e){return e>0?1:-1}M["a"].Shader.import(s["a"]);t["a"]=M["a"].Mesh.extend(function(){var e=new M["a"].Material({shader:new M["a"].Shader(M["a"].Shader.source("ecgl.trail2.vertex"),M["a"].Shader.source("ecgl.trail2.fragment")),transparent:true,depthMask:false});var t=new o["a"]({dynamic:true});t.createAttribute("dist","float",1);t.createAttribute("distAll","float",1);t.createAttribute("start","float",1);return{geometry:t,material:e,culling:false,$ignorePicking:true}},{updateData:function(h,e,f){var t=h.hostModel;var c=this.geometry;var r=t.getModel("effect");var d=r.get("trailWidth")*e.getDevicePixelRatio();var a=r.get("trailLength");var i=t.get("effect.constantSpeed");var v=t.get("effect.period")*1e3;var p=i!=null;if(true){if(!this.getScene()){console.error("TrailMesh must been add to scene before updateData")}}p?this.material.set("speed",i/1e3):this.material.set("period",v);this.material[p?"define":"undefine"]("vertex","CONSTANT_SPEED");var m=t.get("polyline");c.trailLength=a;this.material.set("trailLength",a);c.resetOffset();["position","positionPrev","positionNext"].forEach(function(e){c.attributes[e].value=f.attributes[e].value});var n=["dist","distAll","start","offset","color"];n.forEach(function(e){c.attributes[e].init(c.vertexCount)});c.indices=f.indices;var g=[];var _=r.get("trailColor");var y=r.get("trailOpacity");var x=_!=null;var T=y!=null;this.updateWorldTransform();var b=this.worldTransform.x.len();var w=this.worldTransform.y.len();var E=this.worldTransform.z.len();var S=0;var A=0;h.each(function(e){var t=h.getItemLayout(e);var r=T?y:h.getItemVisual(e,"opacity");var a=h.getItemVisual(e,"color");if(r==null){r=1}g=M["a"].parseColor(x?_:a,g);g[3]*=r;var i=m?f.getPolylineVertexCount(t):f.getCubicCurveVertexCount(t[0],t[1],t[2],t[3]);var n=0;var o=[];var s=[];for(var u=S;u<S+i;u++){c.attributes.position.get(u,o);o[0]*=b;o[1]*=w;o[2]*=E;if(u>S){n+=C.dist(o,s)}c.attributes.dist.set(u,n);C.copy(s,o)}A=Math.max(A,n);var l=Math.random()*(p?n:v);for(var u=S;u<S+i;u++){c.attributes.distAll.set(u,n);c.attributes.start.set(u,l);c.attributes.offset.set(u,L(f.attributes.offset.get(u))*d/2);c.attributes.color.set(u,g)}S+=i});this.material.set("spotSize",A*.1*a);this.material.set("spotIntensity",r.get("spotIntensity"));c.dirty()},setAnimationTime:function(e){this.material.set("time",e)}})},function(e,t,r){"use strict";t["a"]="@export ecgl.trail2.vertex\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute float dist;\nattribute float distAll;\nattribute float start;\n\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nuniform float speed : 0;\nuniform float trailLength: 0.3;\nuniform float time;\nuniform float period: 1000;\n\nuniform float spotSize: 1;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n\n#ifdef CONSTANT_SPEED\n float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;\n#else\n float t = mod((time + start) / period, 1. + trailLength) - trailLength;\n#endif\n\n float trailLen = distAll * trailLength;\n\n v_Percent = (dist - t * distAll) / trailLen;\n\n v_SpotPercent = spotSize / distAll;\n\n }\n@end\n\n\n@export ecgl.trail2.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform float spotIntensity: 5;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n if (v_Percent > 1.0 || v_Percent < 0.0) {\n discard;\n }\n\n float fade = v_Percent;\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n\n if (v_Percent > (1.0 - v_SpotPercent)) {\n gl_FragColor.rgb *= spotIntensity;\n }\n\n gl_FragColor.a *= fade;\n}\n\n@end"},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);i.a.extendSeriesModel({type:"series.lines3D",dependencies:["globe"],visualColorAccessPath:"lineStyle.color",getInitialData:function(e,t){var n=new i.a.List(["value"],this);n.hasItemOption=false;n.initData(e.data,[],function(e,t,r,a){if(e instanceof Array){return NaN}else{n.hasItemOption=true;var i=e.value;if(i!=null){return i instanceof Array?i[a]:i}}});return n},defaultOption:{coordinateSystem:"globe",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:false,effect:{show:false,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:true,blendMode:"source-over",lineStyle:{width:1,opacity:.5}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(250);var o=r(251);var s=r(17);i.a.registerVisual(Object(s["a"])("polygons3D"))},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(31);function u(e,t){var r=[];for(var a=0;a<t.length;a++){r.push(e.dataToPoint(t[a]))}return r}var o=i.a.extendSeriesModel({type:"series.polygons3D",getRegionModel:function(e){return this.getData().getItemModel(e)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem;var r=this.getData().getItemModel(e);var a=r.option instanceof Array?r.option:r.getShallow("coords");if(!r.get("multiPolygon")){a=[a]}var i=[];for(var n=0;n<a.length;n++){var o=[];for(var s=1;s<a[n].length;s++){o.push(u(t,a[n][s]))}i.push({exterior:u(t,a[n][0]),interiors:o})}return i},getInitialData:function(e){var n=new i.a.List(["value"],this);n.hasItemOption=false;n.initData(e.data,[],function(e,t,r,a){if(e instanceof Array){return NaN}else{n.hasItemOption=true;var i=e.value;if(i!=null){return i instanceof Array?i[a]:i}}});return n},defaultOption:{show:true,data:null,multiPolygon:false,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:false,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:true}}}});i.a.util.merge(o.prototype,n["a"]);var s=o},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var o=r(64);var n=r(1);i.a.extendChartView({type:"polygons3D",__ecgl__:true,init:function(e,t){this.groupGL=new n["a"].Node;this._geo3DBuilderList=[];this._currentStep=0},render:function(e,t,r){this.groupGL.removeAll();var a=e.coordinateSystem;if(a&&a.viewGL){a.viewGL.add(this.groupGL)}var i=this._geo3DBuilderList[0];if(!i){i=new o["a"](r);i.extrudeY=a.type!=="mapbox3D"&&a.type!=="maptalks3D";this._geo3DBuilderList[0]=i}this._updateShaderDefines(a,i);i.update(e,t,r);this._geo3DBuilderList.length=1;this.groupGL.add(i.rootNode)},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll();var a=e.coordinateSystem;if(a&&a.viewGL){a.viewGL.add(this.groupGL)}this._currentStep=0},incrementalRender:function(e,t,r,a){var i=this._geo3DBuilderList[this._currentStep];var n=t.coordinateSystem;if(!i){i=new o["a"](a);i.extrudeY=n.type!=="mapbox3D"&&n.type!=="maptalks3D";this._geo3DBuilderList[this._currentStep]=i}i.update(t,r,a,e.start,e.end);this.groupGL.add(i.rootNode);this._updateShaderDefines(n,i);this._currentStep++},_updateShaderDefines:function(t,e){var r=t.viewGL.isLinearSpace()?"define":"undefine";e.rootNode.traverse(function(e){if(e.material){e.material[r]("fragment","SRGB_DECODE");if(t.type==="mapbox3D"||t.type==="maptalks3D"){e.material.define("fragment","NORMAL_UP_AXIS",2);e.material.define("fragment","NORMAL_FRONT_AXIS",1)}}})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(253);var o=r(254);var s=r(255);var u=r(17);i.a.registerVisual(Object(u["a"])("surface"))},function(e,t,r){"use strict";var a=r(0);var R=r.n(a);var i=r(31);var n=r(39);var P=r(50);var o=R.a.extendSeriesModel({type:"series.surface",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",formatTooltip:function(e){return Object(n["a"])(this,e)},getInitialData:function(e,t){var r=e.data;function a(e){return!(isNaN(e.min)||isNaN(e.max)||isNaN(e.step))}function i(e){var t=R.a.number.getPrecisionSafe;return Math.max(t(e.min),t(e.max),t(e.step))+1}if(!r){if(!e.parametric){var n=e.equation||{};var o=n.x||{};var s=n.y||{};["x","y"].forEach(function(e){if(!a(n[e])){if(true){console.error("Invalid equation.%s",e)}return}});if(typeof n.z!=="function"){if(true){console.error("equation.z needs to be function")}return}var u=Math.floor((o.max+o.step-o.min)/o.step);var l=Math.floor((s.max+s.step-s.min)/s.step);r=new Float32Array(u*l*3);var h=i(o);var f=i(s);var c=0;for(var d=0;d<l;d++){for(var v=0;v<u;v++){var p=v*o.step+o.min;var m=d*s.step+s.min;var g=R.a.number.round(Math.min(p,o.max),h);var _=R.a.number.round(Math.min(m,s.max),f);var y=n.z(g,_);r[c++]=g;r[c++]=_;r[c++]=y}}}else{var x=e.parametricEquation||{};var T=x.u||{};var b=x.v||{};["u","v"].forEach(function(e){if(!a(x[e])){if(true){console.error("Invalid parametricEquation.%s",e)}return}});["x","y","z"].forEach(function(e){if(typeof x[e]!=="function"){if(true){console.error("parametricEquation.%s needs to be function",e)}return}});var w=Math.floor((T.max+T.step-T.min)/T.step);var E=Math.floor((b.max+b.step-b.min)/b.step);r=new Float32Array(w*E*5);var S=i(T);var A=i(b);var c=0;for(var d=0;d<E;d++){for(var v=0;v<w;v++){var M=v*T.step+T.min;var C=d*b.step+b.min;var L=R.a.number.round(Math.min(M,T.max),S);var D=R.a.number.round(Math.min(C,b.max),A);var p=x.x(L,D);var m=x.y(L,D);var y=x.z(L,D);r[c++]=p;r[c++]=m;r[c++]=y;r[c++]=L;r[c++]=D}}}}var N=["x","y","z"];if(e.parametric){N.push("u","v")}var I=Object(P["a"])(this,N,r);return I},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,shading:"lambert",parametric:false,wireframe:{show:true,lineStyle:{color:"rgba(0,0,0,0.5)",width:1}},equation:{x:{min:-1,max:1,step:.1},y:{min:-1,max:1,step:.1},z:null},parametricEquation:{u:{min:-1,max:1,step:.1},v:{min:-1,max:1,step:.1},x:null,y:null,z:null},itemStyle:{},animationDurationUpdate:500}});R.a.util.merge(o.prototype,i["a"]);var s=o},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var Y=r(1);var n=r(2);var o=r(6);var s=r(65);var K=o["a"].vec3;function Q(e){return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])}i.a.extendChartView({type:"surface",__ecgl__:true,init:function(e,t){this.groupGL=new Y["a"].Node},render:function(e,t,r){var a=this._prevSurfaceMesh;this._prevSurfaceMesh=this._surfaceMesh;this._surfaceMesh=a;if(!this._surfaceMesh){this._surfaceMesh=this._createSurfaceMesh()}this.groupGL.remove(this._prevSurfaceMesh);this.groupGL.add(this._surfaceMesh);var i=e.coordinateSystem;var n=e.get("shading");var o=e.getData();var s="ecgl."+n;if(!this._surfaceMesh.material||this._surfaceMesh.material.shader.name!==s){this._surfaceMesh.material=Y["a"].createMaterial(s,["VERTEX_COLOR","DOUBLE_SIDED"])}Y["a"].setMaterialFromModel(n,this._surfaceMesh.material,e,r);if(i&&i.viewGL){i.viewGL.add(this.groupGL);var u=i.viewGL.isLinearSpace()?"define":"undefine";this._surfaceMesh.material[u]("fragment","SRGB_DECODE")}var l=e.get("parametric");var h=this._getDataShape(o,l);var f=e.getModel("wireframe");var c=f.get("lineStyle.width");var d=f.get("show")&&c>0;this._updateSurfaceMesh(this._surfaceMesh,e,h,d);var v=this._surfaceMesh.material;if(d){v.define("WIREFRAME_QUAD");v.set("wireframeLineWidth",c);v.set("wireframeLineColor",Y["a"].parseColor(f.get("lineStyle.color")))}else{v.undefine("WIREFRAME_QUAD")}this._initHandler(e,r);this._updateAnimation(e)},_updateAnimation:function(e){Y["a"].updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevSurfaceMesh,this._surfaceMesh,e)},_createSurfaceMesh:function(){var e=new Y["a"].Mesh({geometry:new Y["a"].Geometry({dynamic:true,sortTriangles:true}),shadowDepthMaterial:new Y["a"].Material({shader:new Y["a"].Shader(Y["a"].Shader.source("ecgl.sm.depth.vertex"),Y["a"].Shader.source("ecgl.sm.depth.fragment"))}),culling:false,renderOrder:10,renderNormal:true});e.geometry.createAttribute("barycentric","float",4);e.geometry.createAttribute("prevPosition","float",3);e.geometry.createAttribute("prevNormal","float",3);i.a.util.extend(e.geometry,s["a"]);return e},_initHandler:function(e,l){var h=e.getData();var f=this._surfaceMesh;var c=e.coordinateSystem;function d(e,t){var r=Infinity;var a=-1;var i=[];for(var n=0;n<e.length;n++){f.geometry.attributes.position.get(e[n],i);var o=K.dist(t.array,i);if(o<r){r=o;a=e[n]}}return a}f.seriesIndex=e.seriesIndex;var v=-1;f.off("mousemove");f.off("mouseout");f.on("mousemove",function(e){var t=d(e.triangle,e.point);if(t>=0){var r=[];f.geometry.attributes.position.get(t,r);var a=c.pointToData(r);var i=Infinity;var n=-1;var o=[];for(var s=0;s<h.count();s++){o[0]=h.get("x",s);o[1]=h.get("y",s);o[2]=h.get("z",s);var u=K.squaredDistance(o,a);if(u<i){n=s;i=u}}if(n!==v){l.dispatchAction({type:"grid3DShowAxisPointer",value:a})}v=n;f.dataIndex=n}else{f.dataIndex=-1}},this);f.on("mouseout",function(e){v=-1;f.dataIndex=-1;l.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateSurfaceMesh:function(e,t,r,a){var i=e.geometry;var n=t.getData();var o=n.getLayout("points");var s=0;n.each(function(e){if(!n.hasValue(e)){s++}});var u=s||a;var l=i.attributes.position;var h=i.attributes.normal;var f=i.attributes.texcoord0;var c=i.attributes.barycentric;var d=i.attributes.color;var v=r.row;var p=r.column;var m=t.get("shading");var g=m!=="color";if(u){var _=(v-1)*(p-1)*4;l.init(_);if(a){c.init(_)}}else{l.value=new Float32Array(o)}d.init(i.vertexCount);f.init(i.vertexCount);var y=[0,3,1,1,3,2];var x=[[1,1,0,0],[0,1,0,1],[1,0,0,1],[1,0,1,0]];var T=i.indices=new(i.vertexCount>65535?Uint32Array:Uint16Array)((v-1)*(p-1)*6);var b=function(e,t,r){r[1]=e*p+t;r[0]=e*p+t+1;r[3]=(e+1)*p+t+1;r[2]=(e+1)*p+t};var w=false;if(u){var E=[];var S=[];var A=0;if(g){h.init(i.vertexCount)}else{h.value=null}var M=[[],[],[]];var C=[],L=[];var D=K.create();var N=function(e,t,r){var a=t*3;r[0]=e[a];r[1]=e[a+1];r[2]=e[a+2];return r};var I=new Float32Array(o.length);var R=new Float32Array(o.length/3*4);for(var P=0;P<n.count();P++){if(n.hasValue(P)){var O=Y["a"].parseColor(n.getItemVisual(P,"color"));var F=n.getItemVisual(P,"opacity");O[3]*=F;if(O[3]<.99){w=true}for(var B=0;B<4;B++){R[P*4+B]=O[B]}}}var U=[1e7,1e7,1e7];for(var P=0;P<v-1;P++){for(var z=0;z<p-1;z++){var G=P*(p-1)+z;var H=G*4;b(P,z,E);var V=false;for(var B=0;B<4;B++){N(o,E[B],S);if(Q(S)){V=true}}for(var B=0;B<4;B++){if(V){l.set(H+B,U)}else{N(o,E[B],S);l.set(H+B,S)}if(a){c.set(H+B,x[B])}}for(var B=0;B<6;B++){T[A++]=y[B]+H}if(g&&!V){for(var B=0;B<2;B++){var k=B*3;for(var W=0;W<3;W++){var j=E[y[k]+W];N(o,j,M[W])}K.sub(C,M[0],M[1]);K.sub(L,M[1],M[2]);K.cross(D,C,L);for(var W=0;W<3;W++){var X=E[y[k]+W]*3;I[X]=I[X]+D[0];I[X+1]=I[X+1]+D[1];I[X+2]=I[X+2]+D[2]}}}}}if(g){for(var P=0;P<I.length/3;P++){N(I,P,D);K.normalize(D,D);I[P*3]=D[0];I[P*3+1]=D[1];I[P*3+2]=D[2]}}var O=[];var q=[];for(var P=0;P<v-1;P++){for(var z=0;z<p-1;z++){var G=P*(p-1)+z;var H=G*4;b(P,z,E);for(var B=0;B<4;B++){for(var W=0;W<4;W++){O[W]=R[E[B]*4+W]}d.set(H+B,O);if(g){N(I,E[B],D);h.set(H+B,D)}var j=E[B];q[0]=j%p/(p-1);q[1]=Math.floor(j/p)/(v-1);f.set(H+B,q)}G++}}}else{var q=[];for(var P=0;P<n.count();P++){q[0]=P%p/(p-1);q[1]=Math.floor(P/p)/(v-1);var O=Y["a"].parseColor(n.getItemVisual(P,"color"));var F=n.getItemVisual(P,"opacity");O[3]*=F;if(O[3]<.99){w=true}d.set(P,O);f.set(P,q)}var E=[];var Z=0;for(var P=0;P<v-1;P++){for(var z=0;z<p-1;z++){b(P,z,E);for(var B=0;B<6;B++){T[Z++]=E[y[B]]}}}if(g){i.generateVertexNormals()}else{h.value=null}}if(e.material.get("normalMap")){i.generateTangents()}i.updateBoundingBox();i.dirty();e.material.transparent=w;e.material.depthMask=!w},_getDataShape:function(e,t){var r=-Infinity;var a=0;var i=0;var n=0;var o=t?"u":"x";for(var s=0;s<e.count();s++){var u=e.get(o,s);if(u<r){if(n&&n!==i){if(true){throw new Error("Invalid data. data should be a row major 2d array.")}}n=i;i=0;a++}r=u;i++}return{row:a+1,column:i}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);i.a.registerLayout(function(e,t){e.eachSeriesByType("surface",function(t){var n=t.coordinateSystem;if(!n||n.type!=="cartesian3D"){if(true){console.error("Surface chart only support cartesian3D coordinateSystem")}}var o=t.getData();var s=new Float32Array(3*o.count());var u=[NaN,NaN,NaN];if(n&&n.type==="cartesian3D"){var e=n.dimensions;var r=e.map(function(e){return t.coordDimToDataDim(e)[0]});o.each(r,function(e,t,r,a){var i;if(!o.hasValue(a)){i=u}else{i=n.dataToPoint([e,t,r])}s[a*3]=i[0];s[a*3+1]=i[1];s[a*3+2]=i[2]})}o.setLayout("points",s)})})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(99);var o=r(257);var s=r(258);var u=r(17);i.a.registerVisual(Object(u["a"])("map3D"));i.a.registerAction({type:"map3DChangeCamera",event:"map3dcamerachanged",update:"series:updateCamera"},function(t,e){e.eachComponent({mainType:"series",subType:"map3D",query:t},function(e){e.setView(t)})})},function(e,t,r){"use strict";var a=r(0);var n=r.n(a);var i=r(44);var o=r(28);var s=r(29);var u=r(31);var l=r(96);var h=r(32);var f=r(39);var c=r(98);function d(e,t){var r=[];for(var a=0;a<t.length;a++){r.push(e.dataToPoint(t[a]))}return r}var v=n.a.extendSeriesModel({type:"series.map3D",layoutMode:"box",coordinateSystem:null,visualColorAccessPath:"itemStyle.color",optionUpdated:function(t){t=t||{};var e=this.get("coordinateSystem");if(e==null||e==="geo3D"){return}if(true){var r=["left","top","width","height","boxWidth","boxDepth","boxHeight","light","viewControl","postEffect","temporalSuperSampling","environment","groundPlane"];var a=[];r.forEach(function(e){if(t[e]!=null){a.push(e)}});if(a.length){console.warn("Property %s in map3D series will be ignored if coordinate system is %s",a.join(", "),e)}}if(this.get("groundPlane.show")){this.option.groundPlane.show=false}this._geo=null},getInitialData:function(e){e.data=this.getFilledRegions(e.data,e.map);var t=n.a.helper.completeDimensions(["value"],e.data);var a=new n.a.List(t,this);a.initData(e.data);var i={};a.each(function(e){var t=a.getName(e);var r=a.getItemModel(e);i[t]=r});this._regionModelMap=i;return a},formatTooltip:function(e){return Object(f["a"])(this,e)},getRegionModel:function(e){var t=this.getData().getName(e);return this._regionModelMap[t]||new n.a.Model(null,this)},getRegionPolygonCoords:function(e){var t=this.coordinateSystem;var r=this.getData().getName(e);if(t.transform){var a=t.getRegion(r);return a?a.geometries:[]}else{if(!this._geo){this._geo=c["a"].createGeo3D(this)}var a=this._geo.getRegion(r);var i=[];for(var n=0;n<a.geometries.length;n++){var o=a.geometries[n];var s=[];var u=d(t,o.exterior);if(s&&s.length){for(var l=0;l<o.interiors.length;l++){s.push(d(t,s[l]))}}i.push({interiors:s,exterior:u})}return i}},getFormattedLabel:function(e,t){var r=h["a"].getFormattedLabel(this,e,t);if(r==null){r=this.getData().getName(e)}return r},defaultOption:{coordinateSystem:"geo3D",data:null}});n.a.util.merge(v.prototype,l["a"]);n.a.util.merge(v.prototype,i["a"]);n.a.util.merge(v.prototype,o["a"]);n.a.util.merge(v.prototype,s["a"]);n.a.util.merge(v.prototype,u["a"]);var p=v},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(1);var u=r(45);var l=r(30);var o=r(64);var s=i.a.extendChartView({type:"map3D",__ecgl__:true,init:function(e,t){this._geo3DBuilder=new o["a"](t);this.groupGL=new n["a"].Node},render:function(e,t,r){var a=e.coordinateSystem;if(!a||!a.viewGL){return}this.groupGL.add(this._geo3DBuilder.rootNode);a.viewGL.add(this.groupGL);var i;if(a.type==="geo3D"){i=a;if(!this._sceneHelper){this._sceneHelper=new l["a"];this._sceneHelper.initLight(this.groupGL)}this._sceneHelper.setScene(a.viewGL.scene);this._sceneHelper.updateLight(e);a.viewGL.setPostEffect(e.getModel("postEffect"),r);a.viewGL.setTemporalSuperSampling(e.getModel("temporalSuperSampling"));var n=this._control;if(!n){n=this._control=new u["a"]({zr:r.getZr()});this._control.init()}var o=e.getModel("viewControl");n.setViewGL(a.viewGL);n.setFromViewControlModel(o,0);n.off("update");n.on("update",function(){r.dispatchAction({type:"map3DChangeCamera",alpha:n.getAlpha(),beta:n.getBeta(),distance:n.getDistance(),from:this.uid,map3DId:e.id})});this._geo3DBuilder.extrudeY=true}else{if(this._control){this._control.dispose();this._control=null}if(this._sceneHelper){this._sceneHelper.dispose();this._sceneHelper=null}i=e.getData().getLayout("geo3D");this._geo3DBuilder.extrudeY=false}this._geo3DBuilder.update(e,t,r,0,e.getData().count());var s=a.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(e){if(e.material){e.material[s]("fragment","SRGB_DECODE")}})},afterRender:function(e,t,r,a){var i=a.renderer;var n=e.coordinateSystem;if(n&&n.type==="geo3D"){this._sceneHelper.updateAmbientCubemap(i,e,r);this._sceneHelper.updateSkybox(i,e,r)}},dispose:function(){this.groupGL.removeAll();this._control.dispose()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(260);var o=r(261);var s=r(51);var u=r.n(s);var l=r(17);i.a.registerVisual(u()("scatterGL","circle",null));i.a.registerVisual(Object(l["a"])("scatterGL"));i.a.registerLayout({seriesType:"scatterGL",reset:function(e){var s=e.coordinateSystem;var t;if(s){var u=s.dimensions;var l=[];if(u.length===1){t=function(e,t){var r=new Float32Array((e.end-e.start)*2);for(var a=e.start;a<e.end;a++){var i=(a-e.start)*2;var n=t.get(u[0],a);var o=s.dataToPoint(n);r[i]=o[0];r[i+1]=o[1]}t.setLayout("points",r)}}else if(u.length===2){t=function(e,t){var r=new Float32Array((e.end-e.start)*2);for(var a=e.start;a<e.end;a++){var i=(a-e.start)*2;var n=t.get(u[0],a);var o=t.get(u[1],a);l[0]=n;l[1]=o;l=s.dataToPoint(l);r[i]=l[0];r[i+1]=l[1]}t.setLayout("points",r)}}}return{progress:t}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);i.a.extendSeriesModel({type:"series.scatterGL",dependencies:["grid","polar","geo","singleAxis"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){return i.a.helper.createList(this)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:false,symbol:"circle",symbolSize:10,zoomScale:0,blendMode:"source-over",itemStyle:{opacity:.8},postEffect:{enable:false,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:true}}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(1);var o=r(22);var s=r(67);var u=r(103);var l=r(2);i.a.extendChartView({type:"scatterGL",__ecgl__:true,init:function(e,t){this.groupGL=new n["a"].Node;this.viewGL=new o["a"]("orthographic");this.viewGL.add(this.groupGL);this._pointsBuilderList=[];this._currentStep=0;this._sizeScale=1;this._glViewHelper=new u["a"](this.viewGL)},render:function(e,t,r){this.groupGL.removeAll();this._glViewHelper.reset(e,r);if(!e.getData().count()){return}var a=this._pointsBuilderList[0];if(!a){a=this._pointsBuilderList[0]=new s["a"](true,r)}this._pointsBuilderList.length=1;this.groupGL.add(a.rootNode);this._removeTransformInPoints(e.getData().getLayout("points"));a.update(e,t,r);this.viewGL.setPostEffect(e.getModel("postEffect"),r)},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll();this._glViewHelper.reset(e,r);this._currentStep=0;this.viewGL.setPostEffect(e.getModel("postEffect"),r)},incrementalRender:function(e,t,r,a){if(e.end<=e.start){return}var i=this._pointsBuilderList[this._currentStep];if(!i){i=new s["a"](true,a);this._pointsBuilderList[this._currentStep]=i}this.groupGL.add(i.rootNode);this._removeTransformInPoints(t.getData().getLayout("points"));i.setSizeScale(this._sizeScale);i.update(t,r,a,e.start,e.end);a.getZr().refresh();this._currentStep++},updateTransform:function(e,t,r){if(e.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(e,r);var a=this._glViewHelper.getZoom();var i=Math.max((e.get("zoomScale")||0)*(a-1)+1,0);this._sizeScale=i;this._pointsBuilderList.forEach(function(e){e.setSizeScale(i)})}},_removeTransformInPoints:function(e){if(!e){return}var t=[];for(var r=0;r<e.length;r+=2){t[0]=e[r];t[1]=e[r+1];this._glViewHelper.removeTransformInPoint(t);e[r]=t[0];e[r+1]=t[1]}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(263);var o=r(268);var s=r(51);var u=r.n(s);var l=r(17);i.a.registerVisual(u()("graphGL","circle",null));i.a.registerVisual(Object(l["a"])("graphGL"));i.a.registerVisual(function(e){var s={};e.eachSeriesByType("graphGL",function(i){var n=i.getCategoriesData();var a=i.getData();var o={};n.each(function(e){var t=n.getName(e);o[t]=e;var r=n.getItemModel(e);var a=r.get("itemStyle.color")||i.getColorFromPalette(t,s);n.setItemVisual(e,"color",a)});if(n.count()){a.each(function(e){var t=a.getItemModel(e);var r=t.getShallow("category");if(r!=null){if(typeof r==="string"){r=o[r]}if(!a.getItemVisual(e,"color",true)){a.setItemVisual(e,"color",n.getItemVisual(r,"color"))}}})}})});i.a.registerVisual(function(e){e.eachSeriesByType("graphGL",function(e){var n=e.getGraph();var o=e.getEdgeData();var s="lineStyle.color".split(".");var u="lineStyle.opacity".split(".");o.setVisual("color",e.get(s));o.setVisual("opacity",e.get(u));o.each(function(e){var t=o.getItemModel(e);var r=n.getEdgeByIndex(e);var a=t.get(s);var i=t.get(u);switch(a){case"source":a=r.node1.getVisual("color");break;case"target":a=r.node2.getVisual("color");break}r.setVisual("color",a);r.setVisual("opacity",i)})})});i.a.registerAction({type:"graphGLRoam",event:"graphglroam",update:"series.graphGL:roam"},function(t,e){e.eachComponent({mainType:"series",query:t},function(e){e.setView(t)})});function h(){}i.a.registerAction({type:"graphGLStartLayout",event:"graphgllayoutstarted",update:"series.graphGL:startLayout"},h);i.a.registerAction({type:"graphGLStopLayout",event:"graphgllayoutstopped",update:"series.graphGL:stopLayout"},h);i.a.registerAction({type:"graphGLFocusNodeAdjacency",event:"graphGLFocusNodeAdjacency",update:"series.graphGL:focusNodeAdjacency"},h);i.a.registerAction({type:"graphGLUnfocusNodeAdjacency",event:"graphGLUnfocusNodeAdjacency",update:"series.graphGL:unfocusNodeAdjacency"},h)},function(e,t,r){"use strict";var a=r(0);var l=r.n(a);var i=r(264);var s=r(32);var h=l.a.extendSeriesModel({type:"series.graphGL",visualColorAccessPath:"itemStyle.color",init:function(e){h.superApply(this,"init",arguments);this.legendDataProvider=function(){return this._categoriesData};this._updateCategoriesData()},mergeOption:function(e){h.superApply(this,"mergeOption",arguments);this._updateCategoriesData()},getFormattedLabel:function(e,t,r,a){var i=s["a"].getFormattedLabel(this,e,t,r,a);if(i==null){var n=this.getData();var o=n.dimensions[n.dimensions.length-1];i=n.get(o,e)}return i},getInitialData:function(e,n){var t=e.edges||e.links||[];var r=e.data||e.nodes||[];var o=this;if(r&&t){return Object(i["a"])(r,t,this,true,a).data}function a(e,t){e.wrapMethod("getItemModel",function(e){var t=o._categoriesModels;var r=e.getShallow("category");var a=t[r];if(a){a.parentModel=e.parentModel;e.parentModel=a}return e});var r=o.getModel("edgeLabel");var a=new l.a.Model({label:r.option},r.parentModel,n);t.wrapMethod("getItemModel",function(e){e.customizeGetParent(i);return e});function i(e){e=this.parsePath(e);return e&&e[0]==="label"?a:this.parentModel}}},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(e,t,r){if(r==="edge"){var a=this.getData();var i=this.getDataParams(e,r);var n=a.graph.getEdgeByIndex(e);var o=a.getName(n.node1.dataIndex);var s=a.getName(n.node2.dataIndex);var u=[];o!=null&&u.push(o);s!=null&&u.push(s);u=l.a.format.encodeHTML(u.join(" > "));if(i.value){u+=" : "+l.a.format.encodeHTML(i.value)}return u}else{return h.superApply(this,"formatTooltip",arguments)}},_updateCategoriesData:function(){var e=(this.option.categories||[]).map(function(e){return e.value!=null?e:l.a.util.extend({value:0},e)});var t=new l.a.List(["value"],this);t.initData(e);this._categoriesData=t;this._categoriesModels=t.mapArray(function(e){return t.getItemModel(e,true)})},setView:function(e){if(e.zoom!=null){this.option.zoom=e.zoom}if(e.offset!=null){this.option.offset=e.offset}},setNodePosition:function(e){for(var t=0;t<e.length/2;t++){var r=e[t*2];var a=e[t*2+1];var i=this.getData().getRawDataItem(t);i.x=r;i.y=a}},isAnimationEnabled:function(){return h.superCall(this,"isAnimationEnabled")&&!(this.get("layout")==="force"&&this.get("force.layoutAnimation"))},defaultOption:{zlevel:10,z:2,legendHoverLink:true,layout:"forceAtlas2",forceAtlas2:{initLayout:null,GPU:true,steps:1,maxSteps:1e3,repulsionByDegree:true,linLogMode:false,strongGravityMode:false,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:false,gravityCenter:null},focusNodeAdjacency:true,focusNodeAdjacencyOn:"mouseover",left:"center",top:"center",symbol:"circle",symbolSize:5,roam:false,center:null,zoom:1,label:{show:false,formatter:"{b}",position:"right",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{label:{show:true}},animation:false}});var n=h},function(e,t,r){"use strict";var a=r(0);var m=r.n(a);var i=r(265);var g=r.n(i);var n=r(267);var _=r.n(n);var y=r(2);t["a"]=function(e,t,r,a,i){var n=new g.a(a);for(var o=0;o<e.length;o++){n.addNode(y["a"].firstNotNull(e[o].id,e[o].name,o),o)}var s=[];var u=[];var l=0;for(var o=0;o<t.length;o++){var h=t[o];var f=h.source;var c=h.target;if(n.addEdge(f,c,l)){u.push(h);s.push(y["a"].firstNotNull(h.id,f+" > "+c));l++}}var d;var v=m.a.helper.completeDimensions(["value"],e);d=new m.a.List(v,r);d.initData(e);var p=new m.a.List(["value"],r);p.initData(u,s);i&&i(d,p);_()({mainData:d,struct:n,structAttr:"graph",datas:{node:d,edge:p},datasAttr:{node:"data",edge:"edgeData"}});n.update();return n}},function(e,t,r){var a=r(104);var i=a.__DEV__;var n=r(13);var o=r(266);var s=o.enableClassCheck;function f(e){return"_EC_"+e}var u=function(e){this._directed=e||false;this.nodes=[];this.edges=[];this._nodesMap={};this._edgesMap={};this.data;this.edgeData};var l=u.prototype;l.type="graph";l.isDirected=function(){return this._directed};l.addNode=function(e,t){e=e||""+t;var r=this._nodesMap;if(r[f(e)]){return}var a=new c(e,t);a.hostGraph=this;this.nodes.push(a);r[f(e)]=a;return a};l.getNodeByIndex=function(e){var t=this.data.getRawIndex(e);return this.nodes[t]};l.getNodeById=function(e){return this._nodesMap[f(e)]};l.addEdge=function(e,t,r){var a=this._nodesMap;var i=this._edgesMap;if(typeof e==="number"){e=this.nodes[e]}if(typeof t==="number"){t=this.nodes[t]}if(!c.isInstance(e)){e=a[f(e)]}if(!c.isInstance(t)){t=a[f(t)]}if(!e||!t){return}var n=e.id+"-"+t.id;if(i[n]){return}var o=new h(e,t,r);o.hostGraph=this;if(this._directed){e.outEdges.push(o);t.inEdges.push(o)}e.edges.push(o);if(e!==t){t.edges.push(o)}this.edges.push(o);i[n]=o;return o};l.getEdgeByIndex=function(e){var t=this.edgeData.getRawIndex(e);return this.edges[t]};l.getEdge=function(e,t){if(c.isInstance(e)){e=e.id}if(c.isInstance(t)){t=t.id}var r=this._edgesMap;if(this._directed){return r[e+"-"+t]}else{return r[e+"-"+t]||r[t+"-"+e]}};l.eachNode=function(e,t){var r=this.nodes;var a=r.length;for(var i=0;i<a;i++){if(r[i].dataIndex>=0){e.call(t,r[i],i)}}};l.eachEdge=function(e,t){var r=this.edges;var a=r.length;for(var i=0;i<a;i++){if(r[i].dataIndex>=0&&r[i].node1.dataIndex>=0&&r[i].node2.dataIndex>=0){e.call(t,r[i],i)}}};l.breadthFirstTraverse=function(e,t,r,a){if(!c.isInstance(t)){t=this._nodesMap[f(t)]}if(!t){return}var i=r==="out"?"outEdges":r==="in"?"inEdges":"edges";for(var n=0;n<this.nodes.length;n++){this.nodes[n].__visited=false}if(e.call(a,t,null)){return}var o=[t];while(o.length){var s=o.shift();var u=s[i];for(var n=0;n<u.length;n++){var l=u[n];var h=l.node1===s?l.node2:l.node1;if(!h.__visited){if(e.call(a,h,s)){return}o.push(h);h.__visited=true}}}};l.update=function(){var e=this.data;var r=this.edgeData;var t=this.nodes;var a=this.edges;for(var i=0,n=t.length;i<n;i++){t[i].dataIndex=-1}for(var i=0,n=e.count();i<n;i++){t[e.getRawIndex(i)].dataIndex=i}r.filterSelf(function(e){var t=a[r.getRawIndex(e)];return t.node1.dataIndex>=0&&t.node2.dataIndex>=0});for(var i=0,n=a.length;i<n;i++){a[i].dataIndex=-1}for(var i=0,n=r.count();i<n;i++){a[r.getRawIndex(i)].dataIndex=i}};l.clone=function(){var e=new u(this._directed);var t=this.nodes;var r=this.edges;for(var a=0;a<t.length;a++){e.addNode(t[a].id,t[a].dataIndex)}for(var a=0;a<r.length;a++){var i=r[a];e.addEdge(i.node1.id,i.node2.id,i.dataIndex)}return e};function c(e,t){this.id=e==null?"":e;this.inEdges=[];this.outEdges=[];this.edges=[];this.hostGraph;this.dataIndex=t==null?-1:t}c.prototype={constructor:c,degree:function(){return this.edges.length},inDegree:function(){return this.inEdges.length},outDegree:function(){return this.outEdges.length},getModel:function(e){if(this.dataIndex<0){return}var t=this.hostGraph;var r=t.data.getItemModel(this.dataIndex);return r.getModel(e)}};function h(e,t,r){this.node1=e;this.node2=t;this.dataIndex=r==null?-1:r}h.prototype.getModel=function(e){if(this.dataIndex<0){return}var t=this.hostGraph;var r=t.edgeData.getItemModel(this.dataIndex);return r.getModel(e)};var d=function(r,a){return{getValue:function(e){var t=this[r][a];return t.get(t.getDimension(e||"value"),this.dataIndex)},setVisual:function(e,t){this.dataIndex>=0&&this[r][a].setItemVisual(this.dataIndex,e,t)},getVisual:function(e,t){return this[r][a].getItemVisual(this.dataIndex,e,t)},setLayout:function(e,t){this.dataIndex>=0&&this[r][a].setItemLayout(this.dataIndex,e,t)},getLayout:function(){return this[r][a].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[r][a].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[r][a].getRawIndex(this.dataIndex)}}};n.mixin(c,d("hostGraph","data"));n.mixin(h,d("hostGraph","edgeData"));u.Node=c;u.Edge=h;s(c);s(h);var v=u;e.exports=v},function(e,t,r){var a=r(104);var i=a.__DEV__;var o=r(13);var n=".";var s="___EC__COMPONENT__CONTAINER___";function u(e){var t={main:"",sub:""};if(e){e=e.split(n);t.main=e[0]||"";t.sub=e[1]||""}return t}function l(e){o.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(e),'componentType "'+e+'" illegal')}function h(e,t){e.$constructor=e;e.extend=function(e){var t=this;var r=function(){if(!e.$constructor){t.apply(this,arguments)}else{e.$constructor.apply(this,arguments)}};o.extend(r.prototype,e);r.extend=this.extend;r.superCall=d;r.superApply=v;o.inherits(r,this);r.superClass=t;return r}}var f=0;function c(e){var t=["__\0is_clz",f++,Math.random().toFixed(3)].join("_");e.prototype[t]=true;e.isInstance=function(e){return!!(e&&e[t])}}function d(e,t){var r=o.slice(arguments,2);return this.superClass.prototype[t].apply(e,r)}function v(e,t,r){return this.superClass.prototype[t].apply(e,r)}function p(r,e){e=e||{};var i={};r.registerClass=function(e,t){if(t){l(t);t=u(t);if(!t.sub){i[t.main]=e}else if(t.sub!==s){var r=a(t);r[t.sub]=e}}return e};r.getClass=function(e,t,r){var a=i[e];if(a&&a[s]){a=t?a[t]:null}if(r&&!a){throw new Error(!t?e+"."+"type should be specified.":"Component "+e+"."+(t||"")+" not exists. Load it first.")}return a};r.getClassesByMainType=function(e){e=u(e);var r=[];var t=i[e.main];if(t&&t[s]){o.each(t,function(e,t){t!==s&&r.push(e)})}else{r.push(t)}return r};r.hasClass=function(e){e=u(e);return!!i[e.main]};r.getAllClassMainTypes=function(){var r=[];o.each(i,function(e,t){r.push(t)});return r};r.hasSubTypes=function(e){e=u(e);var t=i[e.main];return t&&t[s]};r.parseClassType=u;function a(e){var t=i[e.main];if(!t||!t[s]){t=i[e.main]={};t[s]=true}return t}if(e.registerWhenExtend){var n=r.extend;if(n){r.extend=function(e){var t=n.call(this,e);return r.registerClass(t,e.type)}}}return r}function m(e,t){}t.parseClassType=u;t.enableClassExtend=h;t.enableClassCheck=c;t.enableClassManagement=p;t.setReadOnly=m},function(e,t,r){var i=r(13);var n=i.each;var o="\0__link_datas";var s="\0__link_mainData";function a(r){var a=r.mainData;var e=r.datas;if(!e){e={main:a};r.datasAttr={main:"data"}}r.datas=r.mainData=null;d(a,e,r);n(e,function(t){n(a.TRANSFERABLE_METHODS,function(e){t.wrapMethod(e,i.curry(u,r))})});a.wrapMethod("cloneShallow",i.curry(h,r));n(a.CHANGABLE_METHODS,function(e){a.wrapMethod(e,i.curry(l,r))});i.assert(e[a.dataType]===a)}function u(e,t){if(c(this)){var r=i.extend({},this[o]);r[this.dataType]=t;d(t,r,e)}else{v(t,this.dataType,this[s],e)}return t}function l(e,t){e.struct&&e.struct.update(this);return t}function h(r,a){n(a[o],function(e,t){e!==a&&v(e.cloneShallow(),t,a,r)});return a}function f(e){var t=this[s];return e==null||t==null?t:t[o][e]}function c(e){return e[s]===e}function d(r,e,a){r[o]={};n(e,function(e,t){v(e,t,r,a)})}function v(e,t,r,a){r[o][t]=e;e[s]=r;e.dataType=t;if(a.struct){e[a.structAttr]=a.struct;a.struct[a.datasAttr[t]]=e}e.getLinkedData=f}var p=a;e.exports=p},function(e,t,r){"use strict";var a=r(0);var T=r.n(a);var i=r(47);var b=r.n(i);var p=r(1);var n=r(22);var o=r(105);var w=r(2);var E=r(269);var S=r(271);var s=r(80);var m=r.n(s);var u=r(6);var l=r(273);var h=r(67);var f=r(274);var d=u["a"].vec2;p["a"].Shader.import(f["a"]);var g=1;T.a.extendChartView({type:"graphGL",__ecgl__:true,init:function(e,t){this.groupGL=new p["a"].Node;this.viewGL=new n["a"]("orthographic");this.viewGL.camera.left=this.viewGL.camera.right=0;this.viewGL.add(this.groupGL);this._pointsBuilder=new h["a"](true,t);this._forceEdgesMesh=new p["a"].Mesh({material:new p["a"].Material({shader:p["a"].createShader("ecgl.forceAtlas2.edges"),transparent:true,depthMask:false,depthTest:false}),$ignorePicking:true,geometry:new p["a"].Geometry({attributes:{node:new p["a"].Geometry.Attribute("node","float",2),color:new p["a"].Geometry.Attribute("color","float",4,"COLOR")},dynamic:true,mainAttribute:"node"}),renderOrder:-1,mode:p["a"].Mesh.LINES});this._edgesMesh=new p["a"].Mesh({material:new p["a"].Material({shader:p["a"].createShader("ecgl.meshLines2D"),transparent:true,depthMask:false,depthTest:false}),$ignorePicking:true,geometry:new o["a"]({useNativeLine:false,dynamic:true}),renderOrder:-1,culling:false});this._layoutId=0;this._control=new l["a"]({zr:t.getZr(),viewGL:this.viewGL});this._control.setTarget(this.groupGL);this._control.init();this._clickHandler=this._clickHandler.bind(this)},render:function(e,t,r){this.groupGL.add(this._pointsBuilder.rootNode);this._model=e;this._api=r;this._initLayout(e,t,r);this._pointsBuilder.update(e,t,r);if(!(this._forceLayoutInstance instanceof E["a"])){this.groupGL.remove(this._forceEdgesMesh)}this._updateCamera(e,r);this._control.off("update");this._control.on("update",function(){r.dispatchAction({type:"graphGLRoam",seriesId:e.id,zoom:this._control.getZoom(),offset:this._control.getOffset()});this._pointsBuilder.updateView(this.viewGL.camera)},this);this._control.setZoom(w["a"].firstNotNull(e.get("zoom"),1));this._control.setOffset(e.get("offset")||[0,0]);var a=this._pointsBuilder.getPointsMesh();a.off("mousemove",this._mousemoveHandler);a.off("mouseout",this._mouseOutHandler,this);r.getZr().off("click",this._clickHandler);this._pointsBuilder.highlightOnMouseover=true;if(e.get("focusNodeAdjacency")){var i=e.get("focusNodeAdjacencyOn");if(i==="click"){r.getZr().on("click",this._clickHandler)}else if(i==="mouseover"){a.on("mousemove",this._mousemoveHandler,this);a.on("mouseout",this._mouseOutHandler,this);this._pointsBuilder.highlightOnMouseover=false}else{if(true){console.warn("Unkown focusNodeAdjacencyOn value s"+i)}}}this._lastMouseOverDataIndex=-1},_clickHandler:function(e){if(this._layouting){return}var t=this._pointsBuilder.getPointsMesh().dataIndex;if(t>=0){this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:t})}else{this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id})}},_mousemoveHandler:function(e){if(this._layouting){return}var t=this._pointsBuilder.getPointsMesh().dataIndex;if(t>=0){if(t!==this._lastMouseOverDataIndex){this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:t})}}else{this._mouseOutHandler(e)}this._lastMouseOverDataIndex=t},_mouseOutHandler:function(e){if(this._layouting){return}this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id});this._lastMouseOverDataIndex=-1},_updateForceEdgesGeometry:function(i,e){var n=this._forceEdgesMesh.geometry;var o=e.getEdgeData();var s=0;var u=this._forceLayoutInstance;var t=o.count()*2;n.attributes.node.init(t);n.attributes.color.init(t);o.each(function(e){var t=i[e];n.attributes.node.set(s,u.getNodeUV(t.node1));n.attributes.node.set(s+1,u.getNodeUV(t.node2));var r=o.getItemVisual(t.dataIndex,"color");var a=p["a"].parseColor(r);a[3]*=w["a"].firstNotNull(o.getItemVisual(t.dataIndex,"opacity"),1);n.attributes.color.set(s,a);n.attributes.color.set(s+1,a);s+=2});n.dirty()},_updateMeshLinesGeometry:function(){var l=this._model.getEdgeData();var h=this._edgesMesh.geometry;var l=this._model.getEdgeData();var f=this._model.getData().getLayout("points");h.resetOffset();h.setVertexCount(l.count()*h.getLineVertexCount());h.setTriangleCount(l.count()*h.getLineTriangleCount());var c=[];var d=[];var v=["lineStyle","width"];this._originalEdgeColors=new Float32Array(l.count()*4);this._edgeIndicesMap=new Float32Array(l.count());l.each(function(e){var t=l.graph.getEdgeByIndex(e);var r=t.node1.dataIndex*2;var a=t.node2.dataIndex*2;c[0]=f[r];c[1]=f[r+1];d[0]=f[a];d[1]=f[a+1];var i=l.getItemVisual(t.dataIndex,"color");var n=p["a"].parseColor(i);n[3]*=w["a"].firstNotNull(l.getItemVisual(t.dataIndex,"opacity"),1);var o=l.getItemModel(t.dataIndex);var s=w["a"].firstNotNull(o.get(v),1)*this._api.getDevicePixelRatio();h.addLine(c,d,n,s);for(var u=0;u<4;u++){this._originalEdgeColors[t.dataIndex*4+u]=n[u]}this._edgeIndicesMap[t.dataIndex]=e},this);h.dirty()},_updateForceNodesGeometry:function(e){var t=this._pointsBuilder.getPointsMesh();var r=[];for(var a=0;a<e.count();a++){this._forceLayoutInstance.getNodeUV(a,r);t.geometry.attributes.position.set(a,r)}t.geometry.dirty("position")},_initLayout:function(e,t,r){var a=e.get("layout");var i=e.getGraph();var n=e.getBoxLayoutParams();var s=b.a.getLayoutRect(n,{width:r.getWidth(),height:r.getHeight()});if(a==="force"){if(true){console.warn("Currently only forceAtlas2 layout supported.")}a="forceAtlas2"}this.stopLayout(e,t,r,{beforeLayout:true});var u=e.getData();var o=e.getData();if(a==="forceAtlas2"){var l=e.getModel("forceAtlas2");var h=this._forceLayoutInstance;var f=[];var c=[];var d=u.getDataExtent("value");var v=o.getDataExtent("value");var p=w["a"].firstNotNull(l.get("edgeWeight"),1);var m=w["a"].firstNotNull(l.get("nodeWeight"),1);if(typeof p==="number"){p=[p,p]}if(typeof m==="number"){m=[m,m]}var g=0;var _={};var y=new Float32Array(u.count()*2);i.eachNode(function(e){var t=e.dataIndex;var r=u.get("value",t);var a;var i;if(u.hasItemOption){var n=u.getItemModel(t);a=n.get("x");i=n.get("y")}if(a==null){a=s.x+Math.random()*s.width;i=s.y+Math.random()*s.height}y[g*2]=a;y[g*2+1]=i;_[e.id]=g++;var o=T.a.number.linearMap(r,d,m);if(isNaN(o)){if(!isNaN(m[0])){o=m[0]}else{o=1}}f.push({x:a,y:i,mass:o,size:u.getItemVisual(t,"symbolSize")})});u.setLayout("points",y);i.eachEdge(function(e){var t=e.dataIndex;var r=u.get("value",t);var a=T.a.number.linearMap(r,v,p);if(isNaN(a)){if(!isNaN(p[0])){a=p[0]}else{a=1}}c.push({node1:_[e.node1.id],node2:_[e.node2.id],weight:a,dataIndex:t})});if(!h){var x=l.get("GPU");if(this._forceLayoutInstance){if(x&&!(this._forceLayoutInstance instanceof E["a"])||!x&&!(this._forceLayoutInstance instanceof S["a"])){this._forceLayoutInstanceToDispose=this._forceLayoutInstance}}h=this._forceLayoutInstance=x?new E["a"]:new S["a"]}h.initData(f,c);h.updateOption(l.option);this._updateForceEdgesGeometry(h.getEdges(),e);this._updatePositionTexture();r.dispatchAction({type:"graphGLStartLayout",from:this.uid})}else{var y=new Float32Array(u.count()*2);var g=0;i.eachNode(function(e){var t=e.dataIndex;var r;var a;if(u.hasItemOption){var i=u.getItemModel(t);r=i.get("x");a=i.get("y")}y[g++]=r;y[g++]=a});u.setLayout("points",y);this._updateAfterLayout(e,t,r)}},_updatePositionTexture:function(){var e=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(e);this._forceEdgesMesh.material.set("positionTex",e)},startLayout:function(t,e,r,a){if(a&&a.from!=null&&a.from!==this.uid){return}var i=this.viewGL;var r=this._api;var n=this._forceLayoutInstance;var o=this._model.getData();var s=this._model.getModel("forceAtlas2");if(!n){if(true){console.error("None layout don't have startLayout action")}return}this.groupGL.remove(this._edgesMesh);this.groupGL.add(this._forceEdgesMesh);if(!this._forceLayoutInstance){return}this._updateForceNodesGeometry(t.getData());this._pointsBuilder.hideLabels();var u=this;var l=this._layoutId=g++;var h=s.getShallow("maxSteps");var f=s.getShallow("steps");var c=0;var d=Math.max(f*2,20);var v=function(e){if(e!==u._layoutId){return}if(n.isFinished(h)){r.dispatchAction({type:"graphGLStopLayout",from:u.uid});r.dispatchAction({type:"graphGLFinishLayout",points:o.getLayout("points"),from:u.uid});return}n.update(i.layer.renderer,f,function(){u._updatePositionTexture();c+=f;if(c>=d){u._syncNodePosition(t);c=0}r.getZr().refresh();m()(function(){v(e)})})};m()(function(){if(u._forceLayoutInstanceToDispose){u._forceLayoutInstanceToDispose.dispose(i.layer.renderer);u._forceLayoutInstanceToDispose=null}v(l)});this._layouting=true},stopLayout:function(e,t,r,a){if(a&&a.from!=null&&a.from!==this.uid){return}this._layoutId=0;this.groupGL.remove(this._forceEdgesMesh);this.groupGL.add(this._edgesMesh);if(!this._forceLayoutInstance){return}if(!this.viewGL.layer){return}if(!(a&&a.beforeLayout)){this._syncNodePosition(e);this._updateAfterLayout(e,t,r)}this._api.getZr().refresh();this._layouting=false},_syncNodePosition:function(e){var t=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);e.getData().setLayout("points",t);e.setNodePosition(t)},_updateAfterLayout:function(e,t,r){this._updateMeshLinesGeometry();this._pointsBuilder.removePositionTexture();this._pointsBuilder.updateLayout(e,t,r);this._pointsBuilder.updateView(this.viewGL.camera);this._pointsBuilder.updateLabels();this._pointsBuilder.showLabels()},focusNodeAdjacency:function(e,t,r,a){var i=this._model.getData();this._downplayAll();var n=a.dataIndex;var o=i.graph;var s=[];var u=o.getNodeByIndex(n);s.push(u);u.edges.forEach(function(e){if(e.dataIndex<0){return}e.node1!==u&&s.push(e.node1);e.node2!==u&&s.push(e.node2)},this);this._pointsBuilder.fadeOutAll(.05);this._fadeOutEdgesAll(.05);s.forEach(function(e){this._pointsBuilder.highlight(i,e.dataIndex)},this);this._pointsBuilder.updateLabels(s.map(function(e){return e.dataIndex}));var l=[];u.edges.forEach(function(e){if(e.dataIndex>=0){this._highlightEdge(e.dataIndex);l.push(e)}},this);this._focusNodes=s;this._focusEdges=l},unfocusNodeAdjacency:function(e,t,r,a){this._downplayAll();this._pointsBuilder.fadeInAll();this._fadeInEdgesAll();this._pointsBuilder.updateLabels()},_highlightEdge:function(e){var t=this._model.getEdgeData().getItemModel(e);var r=p["a"].parseColor(t.get("emphasis.lineStyle.color")||t.get("lineStyle.color"));var a=w["a"].firstNotNull(t.get("emphasis.lineStyle.opacity"),t.get("lineStyle.opacity"),1);r[3]*=a;this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],r)},_downplayAll:function(){if(this._focusNodes){this._focusNodes.forEach(function(e){this._pointsBuilder.downplay(this._model.getData(),e.dataIndex)},this)}if(this._focusEdges){this._focusEdges.forEach(function(e){this._downplayEdge(e.dataIndex)},this)}},_downplayEdge:function(e){var t=this._getColor(e,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],t)},_setEdgeFade:function(){var r=[];return function(e,t){this._getColor(e,r);r[3]*=t;this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[e],r)}}(),_getColor:function(e,t){for(var r=0;r<4;r++){t[r]=this._originalEdgeColors[e*4+r]}return t},_fadeOutEdgesAll:function(t){var e=this._model.getData().graph;e.eachEdge(function(e){this._setEdgeFade(e.dataIndex,t)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(e,t){this.viewGL.setViewport(0,0,t.getWidth(),t.getHeight(),t.getDevicePixelRatio());var r=this.viewGL.camera;var a=e.getData();var i=a.getLayout("points");var n=d.create(Infinity,Infinity);var o=d.create(-Infinity,-Infinity);var s=[];for(var u=0;u<i.length;){s[0]=i[u++];s[1]=i[u++];d.min(n,n,s);d.max(o,o,s)}var l=(o[1]+n[1])/2;var h=(o[0]+n[0])/2;if(h>r.left&&h<r.right&&l<r.bottom&&l>r.top){return}var f=Math.max(o[0]-n[0],10);var c=f/t.getWidth()*t.getHeight();f*=1.4;c*=1.4;n[0]-=f*.2;r.left=n[0];r.top=l-c/2;r.bottom=l+c/2;r.right=f+n[0];r.near=0;r.far=100},dispose:function(){var e=this.viewGL.layer.renderer;if(this._forceLayoutInstance){this._forceLayoutInstance.dispose(e)}this.groupGL.removeAll();this._layoutId=-1},remove:function(){this.groupGL.removeAll();this._control.dispose()}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(1);var o=r(16);var s=r(10);var u=r(270);n["a"].Shader.import(u["a"]);var l={repulsionByDegree:true,linLogMode:false,strongGravityMode:false,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:false,dissuadeHubs:false,gravityCenter:null};function h(e){var t={type:n["a"].Texture.FLOAT,minFilter:n["a"].Texture.NEAREST,magFilter:n["a"].Texture.NEAREST};this._positionSourceTex=new n["a"].Texture2D(t);this._positionSourceTex.flipY=false;this._positionTex=new n["a"].Texture2D(t);this._positionPrevTex=new n["a"].Texture2D(t);this._forceTex=new n["a"].Texture2D(t);this._forcePrevTex=new n["a"].Texture2D(t);this._weightedSumTex=new n["a"].Texture2D(t);this._weightedSumTex.width=this._weightedSumTex.height=1;this._globalSpeedTex=new n["a"].Texture2D(t);this._globalSpeedPrevTex=new n["a"].Texture2D(t);this._globalSpeedTex.width=this._globalSpeedTex.height=1;this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1;this._nodeRepulsionPass=new o["a"]({fragment:n["a"].Shader.source("ecgl.forceAtlas2.updateNodeRepulsion")});this._positionPass=new o["a"]({fragment:n["a"].Shader.source("ecgl.forceAtlas2.updatePosition")});this._globalSpeedPass=new o["a"]({fragment:n["a"].Shader.source("ecgl.forceAtlas2.calcGlobalSpeed")});this._copyPass=new o["a"]({fragment:n["a"].Shader.source("clay.compositor.output")});var r=function(e){e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ONE,e.ONE)};this._edgeForceMesh=new n["a"].Mesh({geometry:new n["a"].Geometry({attributes:{node1:new n["a"].Geometry.Attribute("node1","float",2),node2:new n["a"].Geometry.Attribute("node2","float",2),weight:new n["a"].Geometry.Attribute("weight","float",1)},dynamic:true,mainAttribute:"node1"}),material:new n["a"].Material({transparent:true,shader:n["a"].createShader("ecgl.forceAtlas2.updateEdgeAttraction"),blend:r,depthMask:false,depthText:false}),mode:n["a"].Mesh.POINTS});this._weightedSumMesh=new n["a"].Mesh({geometry:new n["a"].Geometry({attributes:{node:new n["a"].Geometry.Attribute("node","float",2)},dynamic:true,mainAttribute:"node"}),material:new n["a"].Material({transparent:true,shader:n["a"].createShader("ecgl.forceAtlas2.calcWeightedSum"),blend:r,depthMask:false,depthText:false}),mode:n["a"].Mesh.POINTS});this._framebuffer=new s["a"]({depthBuffer:false});this._dummyCamera=new n["a"].OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100});this._globalSpeed=0}h.prototype.updateOption=function(e){for(var t in l){this[t]=l[t]}var r=this._nodes.length;if(r>5e4){this.jitterTolerence=10}else if(r>5e3){this.jitterTolerence=1}else{this.jitterTolerence=.1}if(r>100){this.scaling=2}else{this.scaling=10}if(e){for(var t in l){if(e[t]!=null){this[t]=e[t]}}}if(this.repulsionByDegree){var a=this._positionSourceTex.pixels;for(var i=0;i<this._nodes.length;i++){a[i*4+2]=(this._nodes[i].degree||0)+1}}};h.prototype._updateGravityCenter=function(e){var t=this._nodes;var r=this._edges;if(!this.gravityCenter){var a=[Infinity,Infinity];var i=[-Infinity,-Infinity];for(var n=0;n<t.length;n++){a[0]=Math.min(t[n].x,a[0]);a[1]=Math.min(t[n].y,a[1]);i[0]=Math.max(t[n].x,i[0]);i[1]=Math.max(t[n].y,i[1])}this._gravityCenter=[(a[0]+i[0])*.5,(a[1]+i[1])*.5]}else{this._gravityCenter=this.gravityCenter}for(var n=0;n<r.length;n++){var o=r[n].node1;var s=r[n].node2;t[o].degree=(t[o].degree||0)+1;t[s].degree=(t[s].degree||0)+1}};h.prototype.initData=function(e,t){this._nodes=e;this._edges=t;this._updateGravityCenter();var r=Math.ceil(Math.sqrt(e.length));var a=r;var i=new Float32Array(r*a*4);this._resize(r,a);var n=0;for(var o=0;o<e.length;o++){var s=e[o];i[n++]=s.x||0;i[n++]=s.y||0;i[n++]=s.mass||1;i[n++]=s.size||1}this._positionSourceTex.pixels=i;var u=this._edgeForceMesh.geometry;var l=t.length;u.attributes.node1.init(l*2);u.attributes.node2.init(l*2);u.attributes.weight.init(l*2);var h=[];for(var o=0;o<t.length;o++){var f=u.attributes;var c=t[o].weight;if(c==null){c=1}f.node1.set(o,this.getNodeUV(t[o].node1,h));f.node2.set(o,this.getNodeUV(t[o].node2,h));f.weight.set(o,c);f.node1.set(o+l,this.getNodeUV(t[o].node2,h));f.node2.set(o+l,this.getNodeUV(t[o].node1,h));f.weight.set(o+l,c)}var d=this._weightedSumMesh.geometry;d.attributes.node.init(e.length);for(var o=0;o<e.length;o++){d.attributes.node.set(o,this.getNodeUV(o,h))}u.dirty();d.dirty();this._nodeRepulsionPass.material.define("fragment","NODE_COUNT",e.length);this._nodeRepulsionPass.material.setUniform("textureSize",[r,a]);this._inited=false;this._frame=0};h.prototype.getNodes=function(){return this._nodes};h.prototype.getEdges=function(){return this._edges};h.prototype.step=function(e){if(!this._inited){this._initFromSource(e);this._inited=true}this._frame++;this._framebuffer.attach(this._forceTex);this._framebuffer.bind(e);var t=this._nodeRepulsionPass;t.setUniform("strongGravityMode",this.strongGravityMode);t.setUniform("gravity",this.gravity);t.setUniform("gravityCenter",this._gravityCenter);t.setUniform("scaling",this.scaling);t.setUniform("preventOverlap",this.preventOverlap);t.setUniform("positionTex",this._positionPrevTex);t.render(e);var r=this._edgeForceMesh;r.material.set("linLogMode",this.linLogMode);r.material.set("edgeWeightInfluence",this.edgeWeightInfluence);r.material.set("preventOverlap",this.preventOverlap);r.material.set("positionTex",this._positionPrevTex);e.gl.enable(e.gl.BLEND);e.renderPass([r],this._dummyCamera);this._framebuffer.attach(this._weightedSumTex);e.gl.clearColor(0,0,0,0);e.gl.clear(e.gl.COLOR_BUFFER_BIT);e.gl.enable(e.gl.BLEND);var a=this._weightedSumMesh;a.material.set("positionTex",this._positionPrevTex);a.material.set("forceTex",this._forceTex);a.material.set("forcePrevTex",this._forcePrevTex);e.renderPass([a],this._dummyCamera);this._framebuffer.attach(this._globalSpeedTex);var i=this._globalSpeedPass;i.setUniform("globalSpeedPrevTex",this._globalSpeedPrevTex);i.setUniform("weightedSumTex",this._weightedSumTex);i.setUniform("jitterTolerence",this.jitterTolerence);e.gl.disable(e.gl.BLEND);i.render(e);var n=this._positionPass;this._framebuffer.attach(this._positionTex);n.setUniform("globalSpeedTex",this._globalSpeedTex);n.setUniform("positionTex",this._positionPrevTex);n.setUniform("forceTex",this._forceTex);n.setUniform("forcePrevTex",this._forcePrevTex);n.render(e);this._framebuffer.unbind(e);this._swapTexture()};h.prototype.update=function(e,t,r){if(t==null){t=1}t=Math.max(t,1);for(var a=0;a<t;a++){this.step(e)}r&&r()};h.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex};h.prototype.getNodeUV=function(e,t){t=t||[];var r=this._positionTex.width;var a=this._positionTex.height;t[0]=e%r/(r-1);t[1]=Math.floor(e/r)/(a-1)||0;return t};h.prototype.getNodePosition=function(e,t){var r=this._positionArr;var a=this._positionTex.width;var i=this._positionTex.height;var n=a*i;if(!r||r.length!==n*4){r=this._positionArr=new Float32Array(n*4)}this._framebuffer.bind(e);this._framebuffer.attach(this._positionPrevTex);e.gl.readPixels(0,0,a,i,e.gl.RGBA,e.gl.FLOAT,r);this._framebuffer.unbind(e);if(!t){t=new Float32Array(this._nodes.length*2)}for(var o=0;o<this._nodes.length;o++){t[o*2]=r[o*4];t[o*2+1]=r[o*4+1]}return t};h.prototype.getTextureData=function(e,t){var r=this["_"+t+"Tex"];var a=r.width;var i=r.height;this._framebuffer.bind(e);this._framebuffer.attach(r);var n=new Float32Array(a*i*4);e.gl.readPixels(0,0,a,i,e.gl.RGBA,e.gl.FLOAT,n);this._framebuffer.unbind(e);return n};h.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}};h.prototype.isFinished=function(e){return this._frame>e};h.prototype._swapTexture=function(){var e=this._positionPrevTex;this._positionPrevTex=this._positionTex;this._positionTex=e;var e=this._forcePrevTex;this._forcePrevTex=this._forceTex;this._forceTex=e;var e=this._globalSpeedPrevTex;this._globalSpeedPrevTex=this._globalSpeedTex;this._globalSpeedTex=e};h.prototype._initFromSource=function(e){this._framebuffer.attach(this._positionPrevTex);this._framebuffer.bind(e);this._copyPass.setUniform("texture",this._positionSourceTex);this._copyPass.render(e);e.gl.clearColor(0,0,0,0);this._framebuffer.attach(this._forcePrevTex);e.gl.clear(e.gl.COLOR_BUFFER_BIT);this._framebuffer.attach(this._globalSpeedPrevTex);e.gl.clear(e.gl.COLOR_BUFFER_BIT);this._framebuffer.unbind(e)};h.prototype._resize=function(t,r){["_positionSourceTex","_positionTex","_positionPrevTex","_forceTex","_forcePrevTex"].forEach(function(e){this[e].width=t;this[e].height=r;this[e].dirty()},this)};h.prototype.dispose=function(e){this._framebuffer.dispose(e);this._copyPass.dispose(e);this._nodeRepulsionPass.dispose(e);this._positionPass.dispose(e);this._globalSpeedPass.dispose(e);this._edgeForceMesh.geometry.dispose(e);this._weightedSumMesh.geometry.dispose(e);this._positionSourceTex.dispose(e);this._positionTex.dispose(e);this._positionPrevTex.dispose(e);this._forceTex.dispose(e);this._forcePrevTex.dispose(e);this._weightedSumTex.dispose(e);this._globalSpeedTex.dispose(e);this._globalSpeedPrevTex.dispose(e)};i.a.ForceAtlas2GPU=h;t["a"]=h},function(e,t,r){"use strict";t["a"]="@export ecgl.forceAtlas2.updateNodeRepulsion\n\n#define NODE_COUNT 0\n\nuniform sampler2D positionTex;\n\nuniform vec2 textureSize;\nuniform float gravity;\nuniform float scaling;\nuniform vec2 gravityCenter;\n\nuniform bool strongGravityMode;\nuniform bool preventOverlap;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, v_Texcoord);\n\n vec2 force = vec2(0.0);\n for (int i = 0; i < NODE_COUNT; i++) {\n vec2 uv = vec2(\n mod(float(i), textureSize.x) / (textureSize.x - 1.0),\n floor(float(i) / textureSize.x) / (textureSize.y - 1.0)\n );\n vec4 n1 = texture2D(positionTex, uv);\n\n vec2 dir = n0.xy - n1.xy;\n float d2 = dot(dir, dir);\n\n if (d2 > 0.0) {\n float factor = 0.0;\n if (preventOverlap) {\n float d = sqrt(d2);\n d = d - n0.w - n1.w;\n if (d > 0.0) {\n factor = scaling * n0.z * n1.z / (d * d);\n }\n else if (d < 0.0) {\n factor = scaling * 100.0 * n0.z * n1.z;\n }\n }\n else {\n factor = scaling * n0.z * n1.z / d2;\n }\n force += dir * factor;\n }\n }\n\n vec2 dir = gravityCenter - n0.xy;\n float d = 1.0;\n if (!strongGravityMode) {\n d = length(dir);\n }\n\n force += dir * n0.z * gravity / (d + 1.0);\n\n gl_FragColor = vec4(force, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.vertex\n\nattribute vec2 node1;\nattribute vec2 node2;\nattribute float weight;\n\nuniform sampler2D positionTex;\nuniform float edgeWeightInfluence;\nuniform bool preventOverlap;\nuniform bool linLogMode;\n\nuniform vec2 windowSize: WINDOW_SIZE;\n\nvarying vec2 v_Force;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, node1);\n vec4 n1 = texture2D(positionTex, node2);\n\n vec2 dir = n1.xy - n0.xy;\n float d = length(dir);\n float w;\n if (edgeWeightInfluence == 0.0) {\n w = 1.0;\n }\n else if (edgeWeightInfluence == 1.0) {\n w = weight;\n }\n else {\n w = pow(weight, edgeWeightInfluence);\n }\n vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);\n vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);\n vec2 pos = node1 * scale * 2.0 - 1.0;\n gl_Position = vec4(pos + offset, 0.0, 1.0);\n gl_PointSize = 1.0;\n\n float factor;\n if (preventOverlap) {\n d = d - n1.w - n0.w;\n }\n if (d <= 0.0) {\n v_Force = vec2(0.0);\n return;\n }\n\n if (linLogMode) {\n factor = w * log(d) / d;\n }\n else {\n factor = w;\n }\n v_Force = dir * factor;\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.fragment\n\nvarying vec2 v_Force;\n\nvoid main() {\n gl_FragColor = vec4(v_Force, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.vertex\n\nattribute vec2 node;\n\nvarying vec2 v_NodeUv;\n\nvoid main() {\n\n v_NodeUv = node;\n gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n gl_PointSize = 1.0;\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.fragment\n\nvarying vec2 v_NodeUv;\n\nuniform sampler2D positionTex;\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_NodeUv).rg;\n vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;\n\n float mass = texture2D(positionTex, v_NodeUv).z;\n float swing = length(force - forcePrev) * mass;\n float traction = length(force + forcePrev) * 0.5 * mass;\n\n gl_FragColor = vec4(swing, traction, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcGlobalSpeed\n\nuniform sampler2D globalSpeedPrevTex;\nuniform sampler2D weightedSumTex;\nuniform float jitterTolerence;\n\nvoid main() {\n vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;\n float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;\n float globalSpeed = jitterTolerence * jitterTolerence\n * weightedSum.y / weightedSum.x;\n if (prevGlobalSpeed > 0.0) {\n globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;\n }\n gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updatePosition\n\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\nuniform sampler2D positionTex;\nuniform sampler2D globalSpeedTex;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_Texcoord).xy;\n vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;\n vec4 node = texture2D(positionTex, v_Texcoord);\n\n float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;\n float swing = length(force - forcePrev);\n float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));\n\n float df = length(force);\n if (df > 0.0) {\n speed = min(df * speed, 10.0) / df;\n\n gl_FragColor = vec4(node.xy + speed * force, node.zw);\n }\n else {\n gl_FragColor = node;\n }\n}\n@end\n\n@export ecgl.forceAtlas2.edges.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 node;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nuniform sampler2D positionTex;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(\n texture2D(positionTex, node).xy, -10.0, 1.0\n );\n v_Color = a_Color;\n}\n@end\n\n@export ecgl.forceAtlas2.edges.fragment\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nvarying vec4 v_Color;\nvoid main() {\n gl_FragColor = color * v_Color;\n}\n@end"},function(e,t,r){"use strict";var a=r(5);var i=r(4);var n=r(272);var x=n["a"].toString();x=x.slice(x.indexOf("{")+1,x.lastIndexOf("}"));var f={barnesHutOptimize:true,barnesHutTheta:1.5,repulsionByDegree:true,linLogMode:false,strongGravityMode:false,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:false,dissuadeHubs:false,gravityCenter:null};var o=function(e){for(var t in f){this[t]=f[t]}if(e){for(var t in e){this[t]=e[t]}}this._nodes=[];this._edges=[];this._disposed=false;this._positionTex=new a["a"]({type:i["a"].FLOAT,flipY:false,minFilter:i["a"].NEAREST,magFilter:i["a"].NEAREST})};o.prototype.initData=function(e,t){var r=new Blob([x]);var a=window.URL.createObjectURL(r);this._worker=new Worker(a);this._worker.onmessage=this._$onupdate.bind(this);this._nodes=e;this._edges=t;this._frame=0;var i=e.length;var n=t.length;var o=new Float32Array(i*2);var s=new Float32Array(i);var u=new Float32Array(i);var l=new Float32Array(n*2);var h=new Float32Array(n);for(var f=0;f<e.length;f++){var c=e[f];o[f*2]=c.x;o[f*2+1]=c.y;s[f]=c.mass==null?1:c.mass;u[f]=c.size==null?1:c.size}for(var f=0;f<t.length;f++){var d=t[f];var v=d.node1;var p=d.node2;l[f*2]=v;l[f*2+1]=p;h[f]=d.weight==null?1:d.weight}var m=Math.ceil(Math.sqrt(e.length));var g=m;var _=new Float32Array(m*g*4);var y=this._positionTex;y.width=m;y.height=g;y.pixels=_;this._worker.postMessage({cmd:"init",nodesPosition:o,nodesMass:s,nodesSize:u,edges:l,edgesWeight:h});this._globalSpeed=Infinity};o.prototype.updateOption=function(e){var t={};for(var r in f){t[r]=f[r]}var a=this._nodes;var i=this._edges;var n=a.length;if(n>5e4){t.jitterTolerence=10}else if(n>5e3){t.jitterTolerence=1}else{t.jitterTolerence=.1}if(n>100){t.scaling=2}else{t.scaling=10}if(n>1e3){t.barnesHutOptimize=true}else{t.barnesHutOptimize=false}if(e){for(var r in f){if(e[r]!=null){t[r]=e[r]}}}if(!t.gravityCenter){var o=[Infinity,Infinity];var s=[-Infinity,-Infinity];for(var u=0;u<a.length;u++){o[0]=Math.min(a[u].x,o[0]);o[1]=Math.min(a[u].y,o[1]);s[0]=Math.max(a[u].x,s[0]);s[1]=Math.max(a[u].y,s[1])}t.gravityCenter=[(o[0]+s[0])*.5,(o[1]+s[1])*.5]}for(var u=0;u<i.length;u++){var l=i[u].node1;var h=i[u].node2;a[l].degree=(a[l].degree||0)+1;a[h].degree=(a[h].degree||0)+1}if(this._worker){this._worker.postMessage({cmd:"updateConfig",config:t})}};o.prototype.update=function(e,t,r){if(t==null){t=1}t=Math.max(t,1);this._frame+=t;this._onupdate=r;if(this._worker){this._worker.postMessage({cmd:"update",steps:Math.round(t)})}};o.prototype._$onupdate=function(e){if(this._disposed){return}var t=new Float32Array(e.data.buffer);this._globalSpeed=e.data.globalSpeed;this._positionArr=t;this._updateTexture(t);this._onupdate&&this._onupdate()};o.prototype.getNodePositionTexture=function(){return this._positionTex};o.prototype.getNodeUV=function(e,t){t=t||[];var r=this._positionTex.width;var a=this._positionTex.height;t[0]=e%r/(r-1);t[1]=Math.floor(e/r)/(a-1);return t};o.prototype.getNodes=function(){return this._nodes};o.prototype.getEdges=function(){return this._edges};o.prototype.isFinished=function(e){return this._frame>e};o.prototype.getNodePosition=function(e,t){if(!t){t=new Float32Array(this._nodes.length*2)}if(this._positionArr){for(var r=0;r<this._positionArr.length;r++){t[r]=this._positionArr[r]}}return t};o.prototype._updateTexture=function(e){var t=this._positionTex.pixels;var r=0;for(var a=0;a<e.length;){t[r++]=e[a++];t[r++]=e[a++];t[r++]=1;t[r++]=1}this._positionTex.dirty()};o.prototype.dispose=function(e){this._disposed=true;this._worker=null};t["a"]=o},function(e,t,r){"use strict";function a(){var v={create:function(){return new Float32Array(2)},dist:function(e,t){var r=t[0]-e[0];var a=t[1]-e[1];return Math.sqrt(r*r+a*a)},len:function(e){var t=e[0];var r=e[1];return Math.sqrt(t*t+r*r)},scaleAndAdd:function(e,t,r,a){e[0]=t[0]+r[0]*a;e[1]=t[1]+r[1]*a;return e},scale:function(e,t,r){e[0]=t[0]*r;e[1]=t[1]*r;return e},add:function(e,t,r){e[0]=t[0]+r[0];e[1]=t[1]+r[1];return e},sub:function(e,t,r){e[0]=t[0]-r[0];e[1]=t[1]-r[1];return e},normalize:function(e,t){var r=t[0];var a=t[1];var i=r*r+a*a;if(i>0){i=1/Math.sqrt(i);e[0]=t[0]*i;e[1]=t[1]*i}return e},negate:function(e,t){e[0]=-t[0];e[1]=-t[1];return e},copy:function(e,t){e[0]=t[0];e[1]=t[1];return e},set:function(e,t,r){e[0]=t;e[1]=r;return e}};function t(){this.subRegions=[];this.nSubRegions=0;this.node=null;this.mass=0;this.centerOfMass=null;this.bbox=new Float32Array(4);this.size=0}var e=t.prototype;e.beforeUpdate=function(){for(var e=0;e<this.nSubRegions;e++){this.subRegions[e].beforeUpdate()}this.mass=0;if(this.centerOfMass){this.centerOfMass[0]=0;this.centerOfMass[1]=0}this.nSubRegions=0;this.node=null};e.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var e=0;e<this.nSubRegions;e++){this.subRegions[e].afterUpdate()}};e.addNode=function(e){if(this.nSubRegions===0){if(this.node==null){this.node=e;return}else{this._addNodeToSubRegion(this.node);this.node=null}}this._addNodeToSubRegion(e);this._updateCenterOfMass(e)};e.findSubRegion=function(e,t){for(var r=0;r<this.nSubRegions;r++){var a=this.subRegions[r];if(a.contain(e,t)){return a}}};e.contain=function(e,t){return this.bbox[0]<=e&&this.bbox[2]>=e&&this.bbox[1]<=t&&this.bbox[3]>=t};e.setBBox=function(e,t,r,a){this.bbox[0]=e;this.bbox[1]=t;this.bbox[2]=r;this.bbox[3]=a;this.size=(r-e+a-t)/2};e._newSubRegion=function(){var e=this.subRegions[this.nSubRegions];if(!e){e=new t;this.subRegions[this.nSubRegions]=e}this.nSubRegions++;return e};e._addNodeToSubRegion=function(e){var t=this.findSubRegion(e.position[0],e.position[1]);var r=this.bbox;if(!t){var a=(r[0]+r[2])/2;var i=(r[1]+r[3])/2;var n=(r[2]-r[0])/2;var o=(r[3]-r[1])/2;var s=e.position[0]>=a?1:0;var u=e.position[1]>=i?1:0;var t=this._newSubRegion();t.setBBox(s*n+r[0],u*o+r[1],(s+1)*n+r[0],(u+1)*o+r[1])}t.addNode(e)};e._updateCenterOfMass=function(e){if(this.centerOfMass==null){this.centerOfMass=new Float32Array(2)}var t=this.centerOfMass[0]*this.mass;var r=this.centerOfMass[1]*this.mass;t+=e.position[0]*e.mass;r+=e.position[1]*e.mass;this.mass+=e.mass;this.centerOfMass[0]=t/this.mass;this.centerOfMass[1]=r/this.mass};function s(){this.position=new Float32Array(2);this.force=v.create();this.forcePrev=v.create();this.mass=1;this.inDegree=0;this.outDegree=0}function l(e,t){this.source=e;this.target=t;this.weight=1}function u(){this.autoSettings=true;this.barnesHutOptimize=true;this.barnesHutTheta=1.5;this.repulsionByDegree=true;this.linLogMode=false;this.strongGravityMode=false;this.gravity=1;this.scaling=1;this.edgeWeightInfluence=1;this.jitterTolerence=.1;this.preventOverlap=false;this.dissuadeHubs=false;this.rootRegion=new t;this.rootRegion.centerOfMass=v.create();this.nodes=[];this.edges=[];this.bbox=new Float32Array(4);this.gravityCenter=null;this._massArr=null;this._swingingArr=null;this._sizeArr=null;this._globalSpeed=0}var r=u.prototype;r.initNodes=function(e,t,r){var a=t.length;this.nodes.length=0;var i=typeof r!="undefined";for(var n=0;n<a;n++){var o=new s;o.position[0]=e[n*2];o.position[1]=e[n*2+1];o.mass=t[n];if(i){o.size=r[n]}this.nodes.push(o)}this._massArr=t;this._swingingArr=new Float32Array(a);if(i){this._sizeArr=r}};r.initEdges=function(e,t){var r=e.length/2;this.edges.length=0;for(var a=0;a<r;a++){var i=e[a*2];var n=e[a*2+1];var o=this.nodes[i];var s=this.nodes[n];if(!o||!s){console.error("Node not exists, try initNodes before initEdges");return}o.outDegree++;s.inDegree++;var u=new l(o,s);if(t){u.weight=t[a]}this.edges.push(u)}};r.updateSettings=function(){if(this.repulsionByDegree){for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];t.mass=t.inDegree+t.outDegree+1}}else{for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];t.mass=this._massArr[e]}}};r.update=function(){var e=this.nodes.length;this.updateSettings();this.updateBBox();if(this.barnesHutOptimize){this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]);this.rootRegion.beforeUpdate();for(var t=0;t<e;t++){this.rootRegion.addNode(this.nodes[t])}this.rootRegion.afterUpdate()}for(var t=0;t<e;t++){var r=this.nodes[t];v.copy(r.forcePrev,r.force);v.set(r.force,0,0)}for(var t=0;t<e;t++){var a=this.nodes[t];if(this.barnesHutOptimize){this.applyRegionToNodeRepulsion(this.rootRegion,a)}else{for(var i=t+1;i<e;i++){var n=this.nodes[i];this.applyNodeToNodeRepulsion(a,n,false)}}if(this.gravity>0){if(this.strongGravityMode){this.applyNodeStrongGravity(a)}else{this.applyNodeGravity(a)}}}for(var t=0;t<this.edges.length;t++){this.applyEdgeAttraction(this.edges[t])}var o=0;var s=0;var u=v.create();for(var t=0;t<e;t++){var r=this.nodes[t];var l=v.dist(r.force,r.forcePrev);o+=l*r.mass;v.add(u,r.force,r.forcePrev);var h=v.len(u)*.5;s+=h*r.mass;this._swingingArr[t]=l}var f=this.jitterTolerence*this.jitterTolerence*s/o;if(this._globalSpeed>0){f=Math.min(f/this._globalSpeed,1.5)*this._globalSpeed}this._globalSpeed=f;for(var t=0;t<e;t++){var r=this.nodes[t];var l=this._swingingArr[t];var c=.1*f/(1+f*Math.sqrt(l));var d=v.len(r.force);if(d>0){c=Math.min(d*c,10)/d;v.scaleAndAdd(r.position,r.position,r.force,c)}}};r.applyRegionToNodeRepulsion=function(){var o=v.create();return function e(t,r){if(t.node){this.applyNodeToNodeRepulsion(t.node,r,true)}else{v.sub(o,r.position,t.centerOfMass);var a=o[0]*o[0]+o[1]*o[1];if(a>this.barnesHutTheta*t.size*t.size){var i=this.scaling*r.mass*t.mass/a;v.scaleAndAdd(r.force,r.force,o,i)}else{for(var n=0;n<t.nSubRegions;n++){this.applyRegionToNodeRepulsion(t.subRegions[n],r)}}}}}();r.applyNodeToNodeRepulsion=function(){var s=v.create();return function e(t,r,a){if(t==r){return}v.sub(s,t.position,r.position);var i=s[0]*s[0]+s[1]*s[1];if(i===0){return}var n;if(this.preventOverlap){var o=Math.sqrt(i);o=o-t.size-r.size;if(o>0){n=this.scaling*t.mass*r.mass/(o*o)}else if(o<0){n=this.scaling*100*t.mass*r.mass}else{return}}else{n=this.scaling*t.mass*r.mass/i}v.scaleAndAdd(t.force,t.force,s,n);v.scaleAndAdd(r.force,r.force,s,-n)}}();r.applyEdgeAttraction=function(){var s=v.create();return function e(t){var r=t.source;var a=t.target;v.sub(s,r.position,a.position);var i=v.len(s);var n;if(this.edgeWeightInfluence===0){n=1}else if(this.edgeWeightInfluence===1){n=t.weight}else{n=Math.pow(t.weight,this.edgeWeightInfluence)}var o;if(this.preventOverlap){i=i-r.size-a.size;if(i<=0){return}}if(this.linLogMode){o=-n*Math.log(i+1)/(i+1)}else{o=-n}v.scaleAndAdd(r.force,r.force,s,o);v.scaleAndAdd(a.force,a.force,s,-o)}}();r.applyNodeGravity=function(){var r=v.create();return function(e){v.sub(r,this.gravityCenter,e.position);var t=v.len(r);v.scaleAndAdd(e.force,e.force,r,this.gravity*e.mass/(t+1))}}();r.applyNodeStrongGravity=function(){var t=v.create();return function(e){v.sub(t,this.gravityCenter,e.position);v.scaleAndAdd(e.force,e.force,t,this.gravity*e.mass)}}();r.updateBBox=function(){var e=Infinity;var t=Infinity;var r=-Infinity;var a=-Infinity;for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].position;e=Math.min(e,n[0]);t=Math.min(t,n[1]);r=Math.max(r,n[0]);a=Math.max(a,n[1])}this.bbox[0]=e;this.bbox[1]=t;this.bbox[2]=r;this.bbox[3]=a};r.getGlobalSpeed=function(){return this._globalSpeed};var h=null;self.onmessage=function(e){switch(e.data.cmd){case"init":h=new u;h.initNodes(e.data.nodesPosition,e.data.nodesMass,e.data.nodesSize);h.initEdges(e.data.edges,e.data.edgesWeight);break;case"updateConfig":if(h){for(var t in e.data.config){h[t]=e.data.config[t]}}break;case"update":var r=e.data.steps;if(h){for(var a=0;a<r;a++){h.update()}var i=h.nodes.length;var n=new Float32Array(i*2);for(var a=0;a<i;a++){var o=h.nodes[a];n[a*2]=o.position[0];n[a*2+1]=o.position[1]}self.postMessage({buffer:n.buffer,globalSpeed:h.getGlobalSpeed()},[n.buffer])}else{var s=new Float32Array;self.postMessage({buffer:s.buffer,globalSpeed:h.getGlobalSpeed()},[s.buffer])}break}}}t["a"]=a},function(e,t,r){"use strict";var a=r(7);var i=r(2);var n=a["a"].extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:false,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this);this._mouseWheelHandler=this._mouseWheelHandler.bind(this);this._mouseMoveHandler=this._mouseMoveHandler.bind(this);this._mouseUpHandler=this._mouseUpHandler.bind(this);this._update=this._update.bind(this)},{init:function(){var e=this.zr;e.on("mousedown",this._mouseDownHandler);e.on("mousewheel",this._mouseWheelHandler);e.on("globalout",this._mouseUpHandler);e.animation.on("frame",this._update)},setTarget:function(e){this._target=e},setZoom:function(e){this._zoom=Math.max(Math.min(e,this.maxZoom),this.minZoom);this._needsUpdate=true},setOffset:function(e){this._dx=e[0];this._dy=e[1];this._needsUpdate=true},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){if(!this._target){return}if(!this._needsUpdate){return}var e=this._target;var t=this._zoom;e.position.x=this._dx;e.position.y=this._dy;e.scale.set(t,t,t);this.zr.refresh();this._needsUpdate=false;this.trigger("update")},_mouseDownHandler:function(e){if(e.target){return}var t=e.offsetX;var r=e.offsetY;if(this.viewGL&&!this.viewGL.containPoint(t,r)){return}this.zr.on("mousemove",this._mouseMoveHandler);this.zr.on("mouseup",this._mouseUpHandler);var a=this._convertPos(t,r);this._x=a.x;this._y=a.y},_convertPos:function(e,t){var r=this.viewGL.camera;var a=this.viewGL.viewport;return{x:(e-a.x)/a.width*(r.right-r.left)+r.left,y:(t-a.y)/a.height*(r.bottom-r.top)+r.top}},_mouseMoveHandler:function(e){var t=this._convertPos(e.offsetX,e.offsetY);this._dx+=t.x-this._x;this._dy+=t.y-this._y;this._x=t.x;this._y=t.y;this._needsUpdate=true},_mouseUpHandler:function(e){this.zr.off("mousemove",this._mouseMoveHandler);this.zr.off("mouseup",this._mouseUpHandler)},_mouseWheelHandler:function(e){e=e.event;var t=e.wheelDelta||-e.detail;if(t===0){return}var r=e.offsetX;var a=e.offsetY;if(this.viewGL&&!this.viewGL.containPoint(r,a)){return}var i=t>0?1.1:.9;var n=Math.max(Math.min(this._zoom*i,this.maxZoom),this.minZoom);i=n/this._zoom;var o=this._convertPos(r,a);var s=(o.x-this._dx)*(i-1);var u=(o.y-this._dy)*(i-1);this._dx-=s;this._dy-=u;this._zoom=n;this._needsUpdate=true},dispose:function(){var e=this.zr;e.off("mousedown",this._mouseDownHandler);e.off("mousemove",this._mouseMoveHandler);e.off("mouseup",this._mouseUpHandler);e.off("mousewheel",this._mouseWheelHandler);e.off("globalout",this._mouseUpHandler);e.animation.off("frame",this._update)}});t["a"]=n},function(e,t,r){"use strict";t["a"]="@export ecgl.lines2D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.vertex\n\nattribute vec2 position: POSITION;\nattribute vec2 normal;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n p2.xy /= p2.w;\n gl_Position.xy /= gl_Position.w;\n\n vec2 N = normalize(p2.xy - gl_Position.xy);\n gl_Position.xy += N * offset / viewport.zw * 2.0;\n\n gl_Position.xy *= gl_Position.w;\n\n v_Color = a_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n\n@end"},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(276);var o=r(280)},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var f=r(1);var c=r(2);var n=r(22);var o=r(277);i.a.extendChartView({type:"flowGL",__ecgl__:true,init:function(e,t){this.viewGL=new n["a"]("orthographic");this.groupGL=new f["a"].Node;this.viewGL.add(this.groupGL);this._particleSurface=new o["a"];var r=new f["a"].Mesh({geometry:new f["a"].PlaneGeometry,material:new f["a"].Material({shader:new f["a"].Shader({vertex:f["a"].Shader.source("ecgl.color.vertex"),fragment:f["a"].Shader.source("ecgl.color.fragment")}),transparent:true})});r.material.enableTexture("diffuseMap");this.groupGL.add(r);this._planeMesh=r},render:function(e,t,r){var a=this._particleSurface;a.setParticleType(e.get("particleType"));a.setSupersampling(e.get("supersampling"));this._updateData(e,r);this._updateCamera(r.getWidth(),r.getHeight(),r.getDevicePixelRatio());var i=c["a"].firstNotNull(e.get("particleDensity"),128);a.setParticleDensity(i,i);var n=this._planeMesh;var o=+new Date;var s=this;var u=true;n.__percent=0;n.stopAnimation();n.animate("",{loop:true}).when(1e5,{__percent:1}).during(function(){var e=+new Date;var t=Math.min(e-o,20);o=o+t;if(s._renderer){a.update(s._renderer,r,t/1e3,u);n.material.set("diffuseMap",a.getSurfaceTexture())}u=false}).start();var l=e.getModel("itemStyle");var h=f["a"].parseColor(l.get("color"));h[3]*=c["a"].firstNotNull(l.get("opacity"),1);n.material.set("color",h);a.setColorTextureImage(e.get("colorTexture"),r);a.setParticleSize(e.get("particleSize"));a.particleSpeedScaling=e.get("particleSpeed");a.motionBlurFactor=1-Math.pow(.1,e.get("particleTrail"))},updateTransform:function(e,t,r){this._updateData(e,r)},afterRender:function(e,t,r,a){var i=a.renderer;this._renderer=i},_updateData:function(t,e){var o=t.coordinateSystem;var r=o.dimensions.map(function(e){return t.coordDimToDataDim(e)[0]});var a=t.getData();var i=a.getDataExtent(r[0]);var n=a.getDataExtent(r[1]);var s=t.get("gridWidth");var u=t.get("gridHeight");if(s==null||s==="auto"){var l=(i[1]-i[0])/(n[1]-n[0]);s=Math.round(Math.sqrt(l*a.count()))}if(u==null||u==="auto"){u=Math.ceil(a.count()/s)}var h=this._particleSurface.vectorFieldTexture;var f=h.pixels;if(!f||f.length!==u*s*4){f=h.pixels=new Float32Array(s*u*4)}else{for(var c=0;c<f.length;c++){f[c]=0}}var d=0;var v=Infinity;var p=new Float32Array(a.count()*2);var m=0;var g=[[Infinity,Infinity],[-Infinity,-Infinity]];a.each([r[0],r[1],"vx","vy"],function(e,t,r,a){var i=o.dataToPoint([e,t]);p[m++]=i[0];p[m++]=i[1];g[0][0]=Math.min(i[0],g[0][0]);g[0][1]=Math.min(i[1],g[0][1]);g[1][0]=Math.max(i[0],g[1][0]);g[1][1]=Math.max(i[1],g[1][1]);var n=Math.sqrt(r*r+a*a);d=Math.max(d,n);v=Math.min(v,n)});a.each(["vx","vy"],function(e,t,r){var a=Math.round((p[r*2]-g[0][0])/(g[1][0]-g[0][0])*(s-1));var i=u-1-Math.round((p[r*2+1]-g[0][1])/(g[1][1]-g[0][1])*(u-1));var n=(i*s+a)*4;f[n]=e/d*.5+.5;f[n+1]=t/d*.5+.5;f[n+3]=1});h.width=s;h.height=u;if(t.get("coordinateSystem")==="bmap"){this._fillEmptyPixels(h)}h.dirty();this._updatePlanePosition(g[0],g[1],t,e);this._updateGradientTexture(a.getVisual("visualMeta"),[v,d])},_fillEmptyPixels:function(e){var i=e.pixels;var n=e.width;var o=e.height;function t(e,t,r){e=Math.max(Math.min(e,n-1),0);t=Math.max(Math.min(t,o-1),0);var a=(t*(n-1)+e)*4;if(i[a+3]===0){return false}r[0]=i[a];r[1]=i[a+1];return true}function r(e,t,r){r[0]=e[0]+t[0];r[1]=e[1]+t[1]}var a=[],s=[],u=[],l=[],h=[];var f=0;for(var c=0;c<o;c++){for(var d=0;d<n;d++){var v=(c*(n-1)+d)*4;if(i[v+3]===0){f=a[0]=a[1]=0;if(t(d-1,c,s)){f++;r(s,a,a)}if(t(d+1,c,u)){f++;r(u,a,a)}if(t(d,c-1,l)){f++;r(l,a,a)}if(t(d,c+1,h)){f++;r(h,a,a)}a[0]/=f;a[1]/=f;i[v]=a[0];i[v+1]=a[1]}i[v+3]=1}}},_updateGradientTexture:function(e,r){if(!e||!e.length){this._particleSurface.setGradientTexture(null);return}this._gradientTexture=this._gradientTexture||new f["a"].Texture2D({image:document.createElement("canvas")});var t=this._gradientTexture;var a=t.image;a.width=200;a.height=1;var i=a.getContext("2d");var n=i.createLinearGradient(0,.5,a.width,.5);e[0].stops.forEach(function(e){var t;if(r[1]===r[0]){t=0}else{t=e.value/r[1];t=Math.min(Math.max(t,0),1)}n.addColorStop(t,e.color)});i.fillStyle=n;i.fillRect(0,0,a.width,a.height);t.dirty();this._particleSurface.setGradientTexture(this._gradientTexture)},_updatePlanePosition:function(e,t,r,a){var i=this._limitInViewportAndFullFill(e,t,r,a);e=i.leftTop;t=i.rightBottom;this._particleSurface.setRegion(i.region);this._planeMesh.position.set((e[0]+t[0])/2,a.getHeight()-(e[1]+t[1])/2,0);var n=t[0]-e[0];var o=t[1]-e[1];this._planeMesh.scale.set(n/2,o/2,1);this._particleSurface.resize(Math.max(Math.min(n,2048),1),Math.max(Math.min(o,2048),1));if(this._renderer){this._particleSurface.clearFrame(this._renderer)}},_limitInViewportAndFullFill:function(e,t,r,a){var i=[Math.max(e[0],0),Math.max(e[1],0)];var n=[Math.min(t[0],a.getWidth()),Math.min(t[1],a.getHeight())];if(r.get("coordinateSystem")==="bmap"){var o=r.getData().getDataExtent(r.coordDimToDataDim("lng")[0]);var s=Math.floor(o[1]-o[0])>=359;if(s){if(i[0]>0){i[0]=0}if(n[0]<a.getWidth()){n[0]=a.getWidth()}}}var u=t[0]-e[0];var l=t[1]-e[1];var h=n[0]-i[0];var f=n[1]-i[1];var c=[(i[0]-e[0])/u,1-f/l-(i[1]-e[1])/l,h/u,f/l];return{leftTop:i,rightBottom:n,region:c}},_updateCamera:function(e,t,r){this.viewGL.setViewport(0,0,e,t,r);var a=this.viewGL.camera;a.left=a.bottom=0;a.top=t;a.right=e;a.near=0;a.far=100;a.position.z=10},remove:function(){this._planeMesh.stopAnimation();this.groupGL.removeAll()},dispose:function(){if(this._renderer){this._particleSurface.dispose(this._renderer)}this.groupGL.removeAll()}})},function(e,t,r){"use strict";var i=r(16);var n=r(15);var o=r(40);var s=r(19);var u=r(8);var l=r(5);var h=r(4);var f=r(37);var c=r(43);var d=r(10);var v=r(278);var a=r(279);u["a"]["import"](a["a"]);function p(e){var t=document.createElement("canvas");t.width=t.height=e;var r=t.getContext("2d");r.fillStyle="#fff";r.arc(e/2,e/2,e/2,0,Math.PI*2);r.fill();return t}var m=function(){this.motionBlurFactor=.99;this.vectorFieldTexture=new l["a"]({type:h["a"].FLOAT,flipY:false});this.particleLife=[5,20];this._particleType="point";this._particleSize=1;this.particleColor=[1,1,1,1];this.particleSpeedScaling=1;this._thisFrameTexture=null;this._particlePass=null;this._spawnTexture=null;this._particleTexture0=null;this._particleTexture1=null;this._particlePointsMesh=null;this._surfaceFrameBuffer=null;this._elapsedTime=0;this._scene=null;this._camera=null;this._lastFrameTexture=null;this._supersampling=1;this._downsampleTextures=[];this._width=512;this._height=512;this.init()};m.prototype={constructor:m,init:function(){var e={type:h["a"].FLOAT,minFilter:h["a"].NEAREST,magFilter:h["a"].NEAREST,useMipmap:false};this._spawnTexture=new l["a"](e);this._particleTexture0=new l["a"](e);this._particleTexture1=new l["a"](e);this._frameBuffer=new d["a"]({depthBuffer:false});this._particlePass=new i["a"]({fragment:u["a"].source("ecgl.vfParticle.particle.fragment")});this._particlePass.setUniform("velocityTexture",this.vectorFieldTexture);this._particlePass.setUniform("spawnTexture",this._spawnTexture);this._downsamplePass=new i["a"]({fragment:u["a"].source("clay.compositor.downsample")});var t=new o["a"]({renderOrder:10,material:new s["a"]({shader:new u["a"](u["a"].source("ecgl.vfParticle.renderPoints.vertex"),u["a"].source("ecgl.vfParticle.renderPoints.fragment"))}),mode:o["a"].POINTS,geometry:new n["a"]({dynamic:true,mainAttribute:"texcoord0"})});var r=new o["a"]({renderOrder:10,material:new s["a"]({shader:new u["a"](u["a"].source("ecgl.vfParticle.renderLines.vertex"),u["a"].source("ecgl.vfParticle.renderLines.fragment"))}),geometry:new v["a"],culling:false});var a=new o["a"]({material:new s["a"]({shader:new u["a"](u["a"].source("ecgl.color.vertex"),u["a"].source("ecgl.color.fragment"))}),geometry:new c["a"]});a.material.enableTexture("diffuseMap");this._particlePointsMesh=t;this._particleLinesMesh=r;this._lastFrameFullQuadMesh=a;this._camera=new f["a"];this._thisFrameTexture=new l["a"];this._lastFrameTexture=new l["a"]},setParticleDensity:function(e,t){var r=e*t;var a=new Float32Array(r*4);var i=0;var n=this.particleLife;for(var o=0;o<e;o++){for(var s=0;s<t;s++,i++){a[i*4]=Math.random();a[i*4+1]=Math.random();a[i*4+2]=Math.random();var u=(n[1]-n[0])*Math.random()+n[0];a[i*4+3]=u}}if(this._particleType==="line"){this._setLineGeometry(e,t)}else{this._setPointsGeometry(e,t)}this._spawnTexture.width=e;this._spawnTexture.height=t;this._spawnTexture.pixels=a;this._particleTexture0.width=this._particleTexture1.width=e;this._particleTexture0.height=this._particleTexture1.height=t;this._particlePass.setUniform("textureSize",[e,t])},_setPointsGeometry:function(e,t){var r=e*t;var a=this._particlePointsMesh.geometry;var i=a.attributes;i.texcoord0.init(r);var n=0;for(var o=0;o<e;o++){for(var s=0;s<t;s++,n++){i.texcoord0.value[n*2]=o/e;i.texcoord0.value[n*2+1]=s/t}}a.dirty()},_setLineGeometry:function(e,t){var r=e*t;var a=this._getParticleMesh().geometry;a.setLineCount(r);a.resetOffset();for(var i=0;i<e;i++){for(var n=0;n<t;n++){a.addLine([i/e,n/t])}}a.dirty()},_getParticleMesh:function(){return this._particleType==="line"?this._particleLinesMesh:this._particlePointsMesh},update:function(e,t,r,a){var i=this._getParticleMesh();var n=this._frameBuffer;var o=this._particlePass;if(a){this._updateDownsampleTextures(e,t)}i.material.set("size",this._particleSize*this._supersampling);i.material.set("color",this.particleColor);o.setUniform("speedScaling",this.particleSpeedScaling);n.attach(this._particleTexture1);o.setUniform("firstFrameTime",a?(this.particleLife[1]+this.particleLife[0])/2:0);o.setUniform("particleTexture",this._particleTexture0);o.setUniform("deltaTime",r);o.setUniform("elapsedTime",this._elapsedTime);o.render(e,n);i.material.set("particleTexture",this._particleTexture1);i.material.set("prevParticleTexture",this._particleTexture0);n.attach(this._thisFrameTexture);n.bind(e);e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT);var s=this._lastFrameFullQuadMesh;s.material.set("diffuseMap",this._lastFrameTexture);s.material.set("color",[1,1,1,this.motionBlurFactor]);this._camera.update(true);e.renderPass([s,i],this._camera);n.unbind(e);this._downsample(e);this._swapTexture();this._elapsedTime+=r},_downsample:function(e){var t=this._downsampleTextures;if(t.length===0){return}var r=0;var a=this._thisFrameTexture;var i=t[r];while(i){this._frameBuffer.attach(i);this._downsamplePass.setUniform("texture",a);this._downsamplePass.setUniform("textureSize",[a.width,a.height]);this._downsamplePass.render(e,this._frameBuffer);a=i;i=t[++r]}},getSurfaceTexture:function(){var e=this._downsampleTextures;return e.length>0?e[e.length-1]:this._lastFrameTexture},setRegion:function(e){this._particlePass.setUniform("region",e)},resize:function(e,t){this._lastFrameTexture.width=e*this._supersampling;this._lastFrameTexture.height=t*this._supersampling;this._thisFrameTexture.width=e*this._supersampling;this._thisFrameTexture.height=t*this._supersampling;this._width=e;this._height=t},setParticleSize:function(e){var t=this._getParticleMesh();if(e<=2){t.material.disableTexture("spriteTexture");t.material.transparent=false;return}if(!this._spriteTexture){this._spriteTexture=new l["a"]}if(!this._spriteTexture.image||this._spriteTexture.image.width!==e){this._spriteTexture.image=p(e);this._spriteTexture.dirty()}t.material.transparent=true;t.material.enableTexture("spriteTexture");t.material.set("spriteTexture",this._spriteTexture);this._particleSize=e},setGradientTexture:function(e){var t=this._getParticleMesh().material;t[e?"enableTexture":"disableTexture"]("gradientTexture");t.setUniform("gradientTexture",e)},setColorTextureImage:function(e,t){var r=this._getParticleMesh().material;r.setTextureImage("colorTexture",e,t,{flipY:true})},setParticleType:function(e){this._particleType=e},clearFrame:function(e){var t=this._frameBuffer;t.attach(this._lastFrameTexture);t.bind(e);e.gl.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.COLOR_BUFFER_BIT);t.unbind(e)},setSupersampling:function(e){this._supersampling=e;this.resize(this._width,this._height)},_updateDownsampleTextures:function(e,t){var r=this._downsampleTextures;var a=Math.max(Math.floor(Math.log(this._supersampling/t.getDevicePixelRatio())/Math.log(2)),0);var i=2;var n=this._width*this._supersampling;var o=this._height*this._supersampling;for(var s=0;s<a;s++){r[s]=r[s]||new l["a"];r[s].width=n/i;r[s].height=o/i;i*=2}for(;s<r.length;s++){r[s].dispose(e)}r.length=a},_swapTexture:function(){var e=this._particleTexture0;this._particleTexture0=this._particleTexture1;this._particleTexture1=e;var e=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture;this._lastFrameTexture=e},dispose:function(t){t.disposeFrameBuffer(this._frameBuffer);t.disposeTexture(this.vectorFieldTexture);t.disposeTexture(this._spawnTexture);t.disposeTexture(this._particleTexture0);t.disposeTexture(this._particleTexture1);t.disposeTexture(this._thisFrameTexture);t.disposeTexture(this._lastFrameTexture);t.disposeGeometry(this._particleLinesMesh.geometry);t.disposeGeometry(this._particlePointsMesh.geometry);t.disposeGeometry(this._lastFrameFullQuadMesh.geometry);if(this._spriteTexture){t.disposeTexture(this._spriteTexture)}this._particlePass.dispose(t);this._downsamplePass.dispose(t);this._downsampleTextures.forEach(function(e){e.dispose(t)})}};t["a"]=m},function(e,t,r){"use strict";var a=r(15);var i=r(0);var n=r.n(i);var o=a["a"].extend(function(){return{dynamic:true,attributes:{position:new a["a"].Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0;this._faceOffset=0},setLineCount:function(e){var t=this.attributes;var r=4*e;var a=2*e;if(this.vertexCount!==r){t.position.init(r)}if(this.triangleCount!==a){if(a===0){this.indices=null}else{this.indices=this.vertexCount>65535?new Uint32Array(a*3):new Uint16Array(a*3)}}},addLine:function(e){var t=this._vertexOffset;this.attributes.position.set(t,[e[0],e[1],1]);this.attributes.position.set(t+1,[e[0],e[1],-1]);this.attributes.position.set(t+2,[e[0],e[1],2]);this.attributes.position.set(t+3,[e[0],e[1],-2]);this.setTriangleIndices(this._faceOffset++,[t,t+1,t+2]);this.setTriangleIndices(this._faceOffset++,[t+1,t+2,t+3]);this._vertexOffset+=4}});t["a"]=o},function(e,t,r){"use strict";t["a"]="@export ecgl.vfParticle.particle.fragment\n\nuniform sampler2D particleTexture;\nuniform sampler2D spawnTexture;\nuniform sampler2D velocityTexture;\n\nuniform float deltaTime;\nuniform float elapsedTime;\n\nuniform float speedScaling : 1.0;\n\nuniform vec2 textureSize;\nuniform vec4 region : [0, 0, 1, 1];\nuniform float firstFrameTime;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, v_Texcoord);\n bool spawn = false;\n if (p.w <= 0.0) {\n p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));\n p.w -= firstFrameTime;\n spawn = true;\n }\n vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;\n v = (v - 0.5) * 2.0;\n p.z = length(v);\n p.xy += v * deltaTime / 10.0 * speedScaling;\n p.w -= deltaTime;\n\n if (spawn || p.xy != fract(p.xy)) {\n p.z = 0.0;\n }\n p.xy = fract(p.xy);\n\n gl_FragColor = p;\n}\n@end\n\n@export ecgl.vfParticle.renderPoints.vertex\n\n#define PI 3.1415926\n\nattribute vec2 texcoord : TEXCOORD_0;\n\nuniform sampler2D particleTexture;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nuniform float size : 1.0;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, texcoord);\n\n if (p.w > 0.0 && p.z > 1e-5) {\n gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n\n v_Mag = p.z;\n v_Uv = p.xy;\n\n gl_PointSize = size;\n}\n\n@end\n\n@export ecgl.vfParticle.renderPoints.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\nuniform sampler2D spriteTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n#ifdef SPRITETEXTURE_ENABLED\n gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);\n if (color.a == 0.0) {\n discard;\n }\n#endif\n#ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.vertex\n\n#define PI 3.1415926\n\nattribute vec3 position : POSITION;\n\nuniform sampler2D particleTexture;\nuniform sampler2D prevParticleTexture;\n\nuniform float size : 1.0;\nuniform vec4 vp: VIEWPORT;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\n@import clay.util.rand\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, position.xy);\n vec4 p2 = texture2D(prevParticleTexture, position.xy);\n\n p.xy = p.xy * 2.0 - 1.0;\n p2.xy = p2.xy * 2.0 - 1.0;\n\n if (p.w > 0.0 && p.z > 1e-5) {\n vec2 dir = normalize(p.xy - p2.xy);\n vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;\n if (abs(position.z) == 2.0) {\n gl_Position = vec4(p.xy + norm, 0.0, 1.0);\n v_Uv = p.xy;\n v_Mag = p.z;\n }\n else {\n gl_Position = vec4(p2.xy + norm, 0.0, 1.0);\n v_Mag = p2.z;\n v_Uv = p2.xy;\n }\n gl_Position = worldViewProjection * gl_Position;\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n #ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n"},function(e,t,r){"use strict";var a=r(0);var n=r.n(a);n.a.extendSeriesModel({type:"series.flowGL",dependencies:["geo","grid","bmap"],visualColorAccessPath:"itemStyle.color",getInitialData:function(e,t){var r=n.a.getCoordinateSystemDimensions(this.get("coordinateSystem"))||["x","y"];if(true){if(r.length>2){throw new Error("flowGL can only be used on 2d coordinate systems.")}}r.push("vx","vy");var a=n.a.helper.completeDimensions(r,this.getSource(),{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")});var i=new n.a.List(a,this);i.initData(this.getSource());return i},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,supersampling:1,particleType:"point",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:"auto",gridHeight:"auto",itemStyle:{color:"#fff",opacity:.8}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(282);var o=r(283);var s=r(17);i.a.registerVisual(Object(s["a"])("linesGL"))},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var n=r(13);var o=r.n(n);var s=i.a.extendSeriesModel({type:"series.linesGL",dependencies:["grid","geo"],visualColorAccessPath:"lineStyle.color",streamEnabled:true,init:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;if(t.flatCoords){e.data=new Float32Array(t.count)}s.superApply(this,"init",arguments)},mergeOption:function(e){var t=this._processFlatCoordsArray(e.data);this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset;if(t.flatCoords){e.data=new Float32Array(t.count)}s.superApply(this,"mergeOption",arguments)},appendData:function(e){var t=this._processFlatCoordsArray(e.data);if(t.flatCoords){if(!this._flatCoords){this._flatCoords=t.flatCoords;this._flatCoordsOffset=t.flatCoordsOffset}else{this._flatCoords=Object(n["concatArray"])(this._flatCoords,t.flatCoords);this._flatCoordsOffset=Object(n["concatArray"])(this._flatCoordsOffset,t.flatCoordsOffset)}e.data=new Float32Array(t.count)}this.getRawData().appendData(e.data)},_getCoordsFromItemModel:function(e){var t=this.getData().getItemModel(e);var r=t.option instanceof Array?t.option:t.getShallow("coords");if(true){if(!(r instanceof Array&&r.length>0&&r[0]instanceof Array)){throw new Error("Invalid coords "+JSON.stringify(r)+". Lines must have 2d coords array in data item.")}}return r},getLineCoordsCount:function(e){if(this._flatCoordsOffset){return this._flatCoordsOffset[e*2+1]}else{return this._getCoordsFromItemModel(e).length}},getLineCoords:function(e,t){if(this._flatCoordsOffset){var r=this._flatCoordsOffset[e*2];var a=this._flatCoordsOffset[e*2+1];for(var i=0;i<a;i++){t[i]=t[i]||[];t[i][0]=this._flatCoords[r+i*2];t[i][1]=this._flatCoords[r+i*2+1]}return a}else{var n=this._getCoordsFromItemModel(e);for(var i=0;i<n.length;i++){t[i]=t[i]||[];t[i][0]=n[i][0];t[i][1]=n[i][1]}return n.length}},_processFlatCoordsArray:function(e){var t=0;if(this._flatCoords){t=this._flatCoords.length}if(typeof e[0]==="number"){var r=e.length;var a=new Uint32Array(r);var i=new Float64Array(r);var n=0;var o=0;var s=0;for(var u=0;u<r;){s++;var l=e[u++];a[o++]=n+t;a[o++]=l;for(var h=0;h<l;h++){var f=e[u++];var c=e[u++];i[n++]=f;i[n++]=c;if(u>r){if(true){throw new Error("Invalid data format.")}}}}return{flatCoordsOffset:new Uint32Array(a.buffer,0,o),flatCoords:i,count:s}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}},getInitialData:function(e,t){var n=new i.a.List(["value"],this);n.hasItemOption=false;n.initData(e.data,[],function(e,t,r,a){if(e instanceof Array){return NaN}else{n.hasItemOption=true;var i=e.value;if(i!=null){return i instanceof Array?i[a]:i}}});return n},defaultOption:{coordinateSystem:"geo",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:"source-over",lineStyle:{opacity:.8},postEffect:{enable:false,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:true}}}})},function(e,t,r){"use strict";var a=r(0);var i=r.n(a);var M=r(1);var n=r(22);var o=r(105);var s=r(103);var C=r(2);i.a.extendChartView({type:"linesGL",__ecgl__:true,init:function(e,t){this.groupGL=new M["a"].Node;this.viewGL=new n["a"]("orthographic");this.viewGL.add(this.groupGL);this._glViewHelper=new s["a"](this.viewGL);this._nativeLinesShader=M["a"].createShader("ecgl.lines3D");this._meshLinesShader=M["a"].createShader("ecgl.meshLines3D");this._linesMeshes=[];this._currentStep=0},render:function(e,t,r){this.groupGL.removeAll();this._glViewHelper.reset(e,r);var a=this._linesMeshes[0];if(!a){a=this._linesMeshes[0]=this._createLinesMesh(e)}this._linesMeshes.length=1;this.groupGL.add(a);this._updateLinesMesh(e,a,0,e.getData().count());this.viewGL.setPostEffect(e.getModel("postEffect"),r)},incrementalPrepareRender:function(e,t,r){this.groupGL.removeAll();this._glViewHelper.reset(e,r);this._currentStep=0;this.viewGL.setPostEffect(e.getModel("postEffect"),r)},incrementalRender:function(e,t,r,a){var i=this._linesMeshes[this._currentStep];if(!i){i=this._createLinesMesh(t);this._linesMeshes[this._currentStep]=i}this._updateLinesMesh(t,i,e.start,e.end);this.groupGL.add(i);a.getZr().refresh();this._currentStep++},updateTransform:function(e,t,r){if(e.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(e,r)}},_createLinesMesh:function(e){var t=new M["a"].Mesh({$ignorePicking:true,material:new M["a"].Material({shader:M["a"].createShader("ecgl.lines3D"),transparent:true,depthMask:false,depthTest:false}),geometry:new o["a"]({segmentScale:10,useNativeLine:true,dynamic:false}),mode:M["a"].Mesh.LINES,culling:false});return t},_updateLinesMesh:function(e,t,r,a){var i=e.getData();t.material.blend=e.get("blendMode")==="lighter"?M["a"].additiveBlend:null;var n=e.get("lineStyle.curveness")||0;var o=e.get("polyline");var s=t.geometry;var u=e.coordinateSystem;var l=C["a"].firstNotNull(e.get("lineStyle.width"),1);if(l>1){if(t.material.shader!==this._meshLinesShader){t.material.attachShader(this._meshLinesShader)}t.mode=M["a"].Mesh.TRIANGLES}else{if(t.material.shader!==this._nativeLinesShader){t.material.attachShader(this._nativeLinesShader)}t.mode=M["a"].Mesh.LINES}r=r||0;a=a||i.count();s.resetOffset();var h=0;var f=0;var c=[];var d=[];var v=[];var p=[];var m=[];var g=.3;var _=.7;function y(){d[0]=c[0]*_+p[0]*g-(c[1]-p[1])*n;d[1]=c[1]*_+p[1]*g-(p[0]-c[0])*n;v[0]=c[0]*g+p[0]*_-(c[1]-p[1])*n;v[1]=c[1]*g+p[1]*_-(p[0]-c[0])*n}if(o||n!==0){for(var x=r;x<a;x++){if(o){var T=e.getLineCoordsCount(x);h+=s.getPolylineVertexCount(T);f+=s.getPolylineTriangleCount(T)}else{e.getLineCoords(x,m);this._glViewHelper.dataToPoint(u,m[0],c);this._glViewHelper.dataToPoint(u,m[1],p);y();h+=s.getCubicCurveVertexCount(c,d,v,p);f+=s.getCubicCurveTriangleCount(c,d,v,p)}}}else{var b=a-r;h+=b*s.getLineVertexCount();f+=b*s.getLineVertexCount()}s.setVertexCount(h);s.setTriangleCount(f);var w=r;var E=[];for(var x=r;x<a;x++){M["a"].parseColor(i.getItemVisual(w,"color"),E);var S=C["a"].firstNotNull(i.getItemVisual(w,"opacity"),1);E[3]*=S;var T=e.getLineCoords(x,m);for(var A=0;A<T;A++){this._glViewHelper.dataToPoint(u,m[A],m[A])}if(o){s.addPolyline(m,E,l,0,T)}else if(n!==0){c=m[0];p=m[1];y();s.addCubicCurve(c,d,v,p,E,l)}else{s.addPolyline(m,E,l,0,2)}w++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})}])});